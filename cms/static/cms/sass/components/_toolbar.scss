//##############################################################################
// TOOLBAR
@use "sass:list";
@use "sass:math";

.cms-toolbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: z(toolbar, base);
    min-height: $toolbar-height;
    margin-top: 0;
    background-color: $white;
    backface-visibility: hidden;
    &:after {
        position: absolute;
        content: '';
        box-shadow: $toolbar-shadow;
        top: 100%;
        left: 0;
        right: 0;
        height: 1px;
        margin-top: -1px;
        z-index: z(default);
        clip: rect(0, auto, 10px, 0);
        background: $toolbar-border !important;
        @at-root .cms-structure-mode-structure & {
            inset-inline-end: $toolbar-height - 1px;
        }
    }

    .cms-toolbar-left {
        position: absolute;
        inset-inline-start: 0;
        top: 0;
        z-index: z(toolbar, inset-inline-start);
    }
    .cms-toolbar-right {
        position: absolute;
        inset-inline-end: 0;
        top: 0;
        z-index: z(toolbar, inset-inline-end);
        padding-inline-end:$toolbar-height;
    }

    .cms-toolbar-left .cms-toolbar-item {
        margin-inline-end: $toolbar-left-space;
        &:last-child {
            margin-inline-end: 0;
        }
    }
    .cms-toolbar-right .cms-toolbar-item {
        margin-inline-end: $toolbar-right-space;
    }

    // items
    .cms-toolbar-item {
        float: left;
        &:dir(rtl) {
            float: right;
        }
    }
}


@at-root .cms-toolbar-non-sticky {
    position: static !important;
    .cms .cms-toolbar {
        position: absolute;
    }
}


//###########################################################
// #TOOLBAR/debug#
&.cms-toolbar-debug {
    .cms-debug-bar {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        z-index: z(debug);
        height: $toolbar-debug-height;
        background-color: $toolbar-debug-bgcolor;
        z-index: 30;

        @at-root .cms-structure-mode-structure & {
            inset-inline-end: $toolbar-height;
        }
    }
    .cms-toolbar .cms-btn-action {
        background-color: $toolbar-debug-bgcolor;
        border-color: $toolbar-debug-border;
        color: black;
        &:active,
        &:focus {
            background-color: $toolbar-debug-bgcolor;
            border-color: $toolbar-debug-bgcolor;
            color: black;
        }
    }
}

//###########################################################
// #TOOLBAR/navigation#
.cms-toolbar-item-navigation {
    li {
        position: relative;
        float: left;
        &:dir(rtl) {
            float: right;
        }
    }
    li a {
        float: left;
        &:dir(rtl) {
            float: right;
        }
        color: $toolbar-menu-item-color;
        padding: $toolbar-menu-item-padding;
        line-height: $toolbar-height;
        height: $toolbar-height;
        cursor: default;
    }
    li ul {
        display: none;
    }
    > li:first-child > a span {
        font-weight: 600;
    }
    .cms-icon {
        display: none;
        position: absolute;
        top: 50%;
        inset-inline-end: 7px;
        margin-top: math.div(-$toolbar-dropdown-item-icon-size, 2);
        font-size: $toolbar-dropdown-item-icon-size;
        transform: rotate(180deg);
    }

    // hover effect
    .cms-toolbar-item-navigation-hover {
        ul {
            display: block;
            position: absolute;
            top: $toolbar-height;
            inset-inline-start: 0;
            min-width: $toolbar-dropdown-min-width;
            padding: $toolbar-dropdown-padding;
            border: 1px solid $gray-lightest;
            border-top: none;
            border-radius: 0 0 $toolbar-dropdown-border-radius $toolbar-dropdown-border-radius;
            background-color: $toolbar-dropdown-bgcolor;
            box-shadow: $toolbar-dropdown-shadow;
        }
        ul li {
            float: none;
        }
        ul li a {
            display: block;
            float: none;
            white-space: nowrap;
            line-height: $toolbar-dropdown-item-height;
            height: $toolbar-dropdown-item-height;
            padding: $toolbar-dropdown-item-padding;
            cursor: pointer;
        }
        ul ul {
            border-top: 1px solid $gray-lightest;
            border-radius: 0 $toolbar-dropdown-border-radius $toolbar-dropdown-border-radius 0;
        }

        // second level
        .cms-toolbar-item-navigation-children {
            ul {
                display: none;
                top: -(list.nth($toolbar-dropdown-padding, 1) + 1px);
                inset-inline-start: 100%;
            }
            > a {
                cursor: default;
            }
            > a span {
                display: block;
                .cms-icon {
                    display: block;
                    &:dir(rtl) {
                        // undo arrow rotation for RTL
                        transform: rotate(0deg);
                    }
                }

            }
        }

        // anchor hover
        > a {
            color: $toolbar-menu-item-hover-color !important;
            background: $toolbar-menu-item-hover-bgcolor;
        }

        // add active style
        .cms-toolbar-item-navigation-active > a {
            font-weight: 800;
        }
    }

    .cms-toolbar-item-navigation-break {
        @include hide-content();
        height: 1px;
        margin: 0 0 4px;
        padding: 0 0 4px;
        border-bottom: 1px solid $gray-lighter;
    }

    .cms-toolbar-item-navigation-disabled {
        a {
            cursor: default !important;
            opacity: 0.33;
            &,
            &:hover,
            &:active,
            &:focus {
                color: $toolbar-menu-item-color !important;
                background: none !important;
                box-shadow: none;
            }
        }
        ul {
            display: none !important;
        }
    }
}

.cms-toolbar-more {
    display: none;

    .cms-toolbar-item-navigation-children {
        padding: 0;
    }

    .cms-toolbar-item {
        float: none;
        [dir="rtl"] & {
            // a bit weird, but if removed, it will best match
            // with [dir="rtl"] div.cms .cms-toolbar .cms-toolbar-item
            // and will float to the right
            float: none;
        }
        margin: $toolbar-menu-item-padding !important;
        overflow: hidden;
        margin-top: 5px;
        margin-bottom: 8px;
    }
    .cms-toolbar-item-cms-mode-switcher a {
        float: left !important;
        &:dir(rtl) {
            float: right !important;
        }
        width: 50%;
    }
    .cms-toolbar-item-buttons {
        .cms-btn {
            text-align: center;
        }
    }

    .cms-btn {
        color: $btn-default-color;
    }
    .cms-btn-action {
        color: $btn-action-color;
    }
    .cms-more-buttons + .cms-toolbar-item-navigation-children {
        padding-top: 8px;
        border-top: 1px solid $gray-lighter;
    }
    .cms-toolbar-item-dark-mode-toggle {
        display: none;
    }
}
.cms-toolbar-item-navigation .cms-toolbar-item-navigation-hover .cms-more-dropdown-full {
    position: fixed;
    width: 100%;
    // 100vw is better because if the user's content exceeds the viewport width
    // the dropdown will also go out of the screen, which is not ideal, esp. on mobile
    width: 100vw;
    top: $toolbar-height;
    bottom: 0;
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;

    .cms-icon {
        display: none !important;
    }

    > li {
        border-bottom: 1px solid $gray-lighter;
    }

    .cms-more-buttons {
        border-bottom: none;
    }

    li a:not(.cms-btn) {
        color: $toolbar-menu-item-color !important;
        background: transparent !important;
    }
    li a {
        position: relative;
        line-height: 1.4 * $toolbar-dropdown-item-height;
        height: 1.4 * $toolbar-dropdown-item-height;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    ul {
        display: block !important;
        border: none;
        box-shadow: none;
        position: relative;
        inset-inline-start: 0;
        top: 0;
        border-radius: 0;
        margin-inline-start:20px;
    }
}
.cms-toolbar-item-cms-mode-switcher {
    // display: none;
    position: absolute;
    inset-inline-end: 0;
    top: 0;
    width: $toolbar-height;
    height: $toolbar-height;
    margin-inline-end:0 !important;

    .cms-btn {
        position: absolute;
        inset-inline-end: 0;
        top: 0;
        border-top: 0 !important;
        border-right: 0 !important;
        width: $toolbar-height;
        height: $toolbar-height - 1px;
        display: block;
        border-radius: 0;
        border-bottom: 0;
        clip: rect(0, $toolbar-height, $toolbar-height, 0px);
        .cms-icon {
            position: absolute;
            inset-inline-start: math.div($toolbar-height, 2);
            top: math.div($toolbar-height, 2);
            margin-inline-start:-10px;
            margin-top: -9px;
            font-size: 20px !important;
        }
        &.cms-btn-active {
            height: $toolbar-height;
            &,
            &:active,
            &:focus {
                border-color: $toolbar-border !important;
                background-color: $structure-bgcolor !important;
            }
        }
    }
}

@at-root .cms-structure-mode-endpoint.cms-structure-mode-structure & {
    .cms-toolbar-item-cms-mode-switcher {
        display: none;
    }
    .cms-toolbar-right {
        padding-inline-end: 0;
    }
    .cms-toolbar::after, .cms-debug-bar {
        inset-inline-end: 0;
    }
}
//###########################################################
// #TOOLBAR/dialog#
.cms-messages {
    display: none;
    position: fixed;
    top: $toolbar-height;
    z-index: z(messages);
    color: $messages-color;
    font-size: $messages-font-size;
    font-weight: $messages-font-weight;
    line-height: $messages-line-height;
    width: $messages-width;
    min-height: $messages-line-height;
    margin: 0;
    padding: $messages-padding;
    border-radius: 0 0 $messages-border-radius $messages-border-radius;
    background: $messages-bgcolor;
    transition: top $speed-base;
    * {
        color: $messages-color;
        font-size: $messages-font-size;
        font-weight: $messages-font-weight;
        line-height: $messages-line-height;
    }

    a {
        color: $color-primary;
    }
    a:hover {
        text-decoration: underline;
    }
    strong {
        color: $color-primary;
        filter: brightness(1.1);
        font-weight: $messages-font-weight;
    }
    ul {
        display: inline;
        color: $messages-color;
    }
    ul li {
        display: inline;
        color: $messages-color;
        font-weight: $messages-font-weight;
    }

    .cms-messages-close {
        cursor: pointer;
        display: none;
        float: right;
        &:dir(rtl) {
            float: left;
        }
        position: relative;
        width: $messages-close-area-size;
        height: $messages-line-height;
        text-align: end;
        span {
            font-size: $messages-close-icon-size;
        }
        &:hover span {
            color: $color-primary;
        }
    }
}
.cms-messages-error strong {
    color: $color-danger;
}

//###########################################################
// #TOOLBAR/elements/logo#
.cms-toolbar-item-logo {
    margin-inline-end:0 !important;

    a {
        @extend .cms-icon;
        @extend .cms-icon-logo;
        color: light-dark(transparent, $black);
        font-size: $toolbar-logo-height;
        line-height: $toolbar-height;
        height: $toolbar-height;
        transition: color $speed-base, background-image $speed-base;
        padding-inline-start:$toolbar-left-space;
        padding-inline-end:$toolbar-left-space;
        background-repeat: no-repeat;
        background-position: center;
        background-size: 96px;
        background-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 320 71" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M19.3809 10.8841H28.0976V50.8357C23.6327 51.6803 20.3457 52.0125 16.7895 52.0125C6.14321 52.0014 0.601318 47.2452 0.601318 38.1104C0.601318 29.3091 6.47976 23.5971 15.5891 23.5971C17.0026 23.5971 18.0796 23.7083 19.3809 24.0416V10.8841ZM19.3809 30.9871C18.3601 30.6538 17.5187 30.5426 16.4417 30.5426C12.0329 30.5426 9.4863 33.2319 9.4863 37.9449C9.4863 42.5333 11.9207 45.067 16.3856 45.067C17.3504 45.067 18.1357 45.0126 19.3809 44.8459V30.9871ZM41.9524 24.2083V44.2114C41.9524 51.1002 41.4363 54.4129 39.9218 57.2689C38.5083 60.0149 36.6461 61.7462 32.7981 63.6587L24.7097 59.8471C28.5576 58.059 30.4198 56.4788 31.609 54.0673C32.8542 51.6014 33.2469 48.7454 33.2469 41.2331V24.2083H41.9524ZM33.2469 10.9285H41.9636V19.7854H33.2469V10.9285ZM47.2127 26.1753C51.0617 24.3861 54.7413 23.5971 58.7575 23.5971C63.2337 23.5971 66.1718 24.7751 67.4742 27.0754C68.2034 28.3645 68.439 30.0425 68.439 33.632V51.168C64.5361 51.7236 59.6101 52.1226 55.9967 52.1226C48.6935 52.1226 45.4177 49.6 45.4177 44.0002C45.4177 37.9437 49.7716 35.1433 60.4616 34.2532V32.3529C60.4616 30.786 59.6651 30.2192 57.4663 30.2192C54.2466 30.2192 50.6231 31.1194 47.2239 32.853L47.2127 26.1753ZM60.8543 39.8985C55.088 40.4541 53.2145 41.3554 53.2145 43.599C53.2145 45.2793 54.2915 46.0672 56.6698 46.0672C57.9711 46.0672 59.1603 45.9561 60.8531 45.6782L60.8543 39.8985ZM72.6796 25.553C77.8288 24.2083 82.0683 23.5971 86.3649 23.5971C90.8298 23.5971 94.0619 24.6084 95.9791 26.5642C97.7841 28.409 98.3585 30.4315 98.3585 34.7433V51.668H89.6407V35.0878C89.6407 31.7761 88.5076 30.5426 85.4013 30.5426C84.211 30.5426 83.1351 30.6538 81.3851 31.1649V51.6692H72.6796V25.553ZM101.746 56.3788C104.797 57.9457 107.849 58.6691 111.08 58.6691C116.79 58.6691 119.225 56.3688 119.225 50.879V50.7123C117.531 51.5458 115.824 51.8914 113.57 51.8914C105.931 51.8914 101.073 46.9018 101.073 39.0006C101.073 29.188 108.264 23.6427 120.986 23.6427C124.722 23.6427 128.177 24.0316 132.36 24.8762L129.376 31.0994C127.056 30.6549 129.186 31.0327 127.437 30.866V31.7661L127.549 35.4111L127.604 40.123C127.661 41.302 127.661 42.4778 127.718 43.6568V46.0116C127.718 53.4128 127.089 56.8811 125.227 59.7482C122.512 63.9477 117.812 66.0269 111.135 66.0269C107.737 66.0269 104.797 65.5257 101.746 64.3466V56.3788ZM119.056 30.5982H118.776H118.147C116.453 30.5426 114.468 30.9871 113.11 31.8317C111.024 33.0097 109.948 35.1433 109.948 38.166C109.948 42.4767 112.102 44.9448 115.95 44.9448C117.138 44.9448 118.104 44.7237 119.226 44.3892V43.7657V41.4109C119.226 40.3997 119.169 39.2773 119.169 38.0993L119.114 34.1209L119.056 31.265V30.5982ZM145.88 23.486C154.585 23.486 159.903 28.9202 159.903 37.7215C159.903 46.7451 154.362 52.4004 145.531 52.4004C136.814 52.4004 131.439 46.9673 131.439 38.2227C131.454 29.1424 136.995 23.486 145.88 23.486ZM145.7 45.4438C149.043 45.4438 151.018 42.7 151.018 37.9326C151.018 33.2208 149.098 30.4204 145.757 30.4204C142.302 30.4204 140.325 33.1652 140.325 37.9326C140.325 42.7 142.312 45.4438 145.7 45.4438Z" fill="%232C4D4C"/><rect x="169.412" y="0.161987" width="150.111" height="70.4602" rx="15.3174" fill="%23DEFCB9"/><path d="M275.275 41.86C275.459 44.4701 276.506 46.5655 278.418 48.1462C280.33 49.6902 282.756 50.4622 285.697 50.4622C288.344 50.4622 290.476 49.8924 292.093 48.7528C293.748 47.5764 294.575 45.9589 294.575 43.9002C294.575 42.393 294.115 41.1982 293.196 40.316C292.314 39.4337 291.156 38.7903 289.722 38.386C288.325 37.9448 286.414 37.5221 283.987 37.1177C280.127 36.456 277.058 35.3715 274.779 33.8643C272.499 32.357 271.36 29.9124 271.36 26.5303C271.36 24.3613 271.911 22.4497 273.014 20.7954C274.117 19.1044 275.661 17.7993 277.646 16.8803C279.668 15.9612 281.966 15.5017 284.539 15.5017C287.259 15.5017 289.667 15.998 291.763 16.9906C293.858 17.9831 295.512 19.3801 296.725 21.1814C297.939 22.946 298.619 24.9863 298.766 27.3023H294.023C293.729 25.0598 292.718 23.2585 290.991 21.8983C289.263 20.5381 287.112 19.858 284.539 19.858C281.966 19.858 279.925 20.4278 278.418 21.5674C276.911 22.6703 276.157 24.2326 276.157 26.2546C276.157 27.725 276.598 28.883 277.481 29.7285C278.363 30.5373 279.503 31.1623 280.899 31.6034C282.296 32.0078 284.208 32.4122 286.634 32.8165C290.494 33.4783 293.582 34.5811 295.898 36.1251C298.214 37.6323 299.372 40.077 299.372 43.4591C299.372 45.6648 298.784 47.6316 297.608 49.3594C296.468 51.0872 294.851 52.429 292.755 53.3848C290.697 54.3406 288.325 54.8185 285.642 54.8185C282.627 54.8185 279.999 54.2855 277.756 53.2194C275.514 52.1165 273.768 50.5909 272.518 48.6425C271.305 46.6574 270.643 44.3965 270.533 41.86H275.275Z" fill="%232C4D4C"/><path d="M224.986 15.8879H231.052L244.727 47.9259L258.237 15.8879H264.193V54.4879H259.506V24.0491L246.713 54.4879H242.467L229.673 24.0491V54.4879H224.986V15.8879Z" fill="%232C4D4C"/><path d="M184.559 35.188C184.559 31.328 185.313 27.9092 186.82 24.9315C188.327 21.9538 190.478 19.6561 193.272 18.0386C196.066 16.3843 199.301 15.5572 202.977 15.5572C207.241 15.5572 210.807 16.7152 213.674 19.0312C216.579 21.3472 218.398 24.5087 219.134 28.5157H214.336C213.638 25.8321 212.259 23.7367 210.2 22.2295C208.179 20.7222 205.697 19.9686 202.756 19.9686C200.109 19.9686 197.775 20.6119 195.753 21.8986C193.731 23.1853 192.169 24.9866 191.066 27.3026C190 29.5818 189.467 32.2103 189.467 35.188C189.467 38.129 190 40.7574 191.066 43.0734C192.169 45.3894 193.731 47.1908 195.753 48.4774C197.775 49.7641 200.109 50.4074 202.756 50.4074C205.734 50.4074 208.215 49.6722 210.2 48.2017C212.186 46.6945 213.546 44.5807 214.281 41.8603H219.078C218.343 45.8673 216.542 49.0289 213.674 51.3449C210.844 53.6609 207.278 54.8189 202.977 54.8189C199.301 54.8189 196.066 54.0101 193.272 52.3926C190.478 50.7383 188.327 48.4407 186.82 45.4997C185.313 42.522 184.559 39.0848 184.559 35.188Z" fill="%232C4D4C"/></svg>');
        [data-theme="dark"] & {
            background-image: none;
        }
        span {
            display: none;
        }

        &:hover,
        &:active,
        &:focus {
            filter: brightness(0.9);
        }
    }
}

@media (prefers-color-scheme: dark) {
    [data-theme="auto"] .cms-toolbar-item-logo a {
        background-image: none;
    }
}

// #TOOLBAR/elements/form#
.cms-form-login {
    label {
        display: inline-block;
        vertical-align: middle;
        line-height: $toolbar-height;
        padding-inline-start:$toolbar-left-space;
        margin: 0;
        cursor: pointer;
    }
    label span {
        display: inline-block;
    }
    input[type="text"],
    input[type="password"] {
        display: inline-block;
        color: $login-form-input-color;
        font-size: $login-form-input-font-size;
        height: $login-form-input-height - 2px;
        line-height: $login-form-input-height - 2px;
        width: $login-form-input-width;
        margin: 0;
        padding: 0 $login-form-input-padding-horizontal;
        border: 1px solid $login-form-input-border;
        border-radius: $login-form-input-border-radius;
        box-shadow: 0 1px 0 $white;
        text-transform: none;

        &:focus {
            transition: outline 0.2s;
            border-color: $color-primary;
            box-shadow: inset 0 0 2px $gray-lighter;
        }
    }
    input[type="submit"] {
        display: block;
        font-size: $login-form-input-font-size - 1px;
        text-transform: uppercase;
        height: $login-form-input-height - 2px;
        line-height: $login-form-input-height - 2px;
        padding: 0 $login-form-submit-padding-horizontal;
        &:-moz-focus-inner {
            border: 0;
        }
    }

    .cms-error {
        color: $color-danger;
    }
    .cms-error input {
        border: 1px solid $color-danger;
    }

    // overlap with logo when it gets too small
    @media (max-width: $screen-tablet - 280px) {
        margin-inline-start:-110px;
    }
    // mobile only
    @media (max-width: $screen-tablet) {
        position: relative;
        // remove spaces
        font-size: 1px;
        line-height: 0;
        background: $white;
        label {
            position: relative;
            padding: 0;
            margin-inline-end:-1px;
            margin-bottom: -1px;
        }
        label span {
            position: absolute;
            inset-inline-start: 5px;
            top: 0;
            z-index: 1;
            color: $gray-light;
        }
        // setup inputs
        input[type="text"] {
            border-radius: $border-radius-base 0 0 $border-radius-base;
        }
        input[type="password"] {
            border-radius: 0;
        }
        input[type="text"],
        input[type="password"] {
            position: relative;
            z-index: 10;
            width: 95px;
            &:focus,
            &:valid {
                background: $white;
            }
        }
        input[type="submit"] {
            border-radius: 0 $border-radius-base $border-radius-base 0;
            padding: 0 math.div($login-form-submit-padding-horizontal, 2);
        }
    }
}

// #TOOLBAR/elements/buttongroups#
.cms-toolbar-item-buttons {
    $margin: math.div($toolbar-height - $toolbar-button-height, 2);
    margin: $margin 0 $margin;

    a {
        float: left;
        &:dir(rtl) {
            float: right;
        }
        line-height: $toolbar-button-height;
        height: $toolbar-button-height;
        font-size: $toolbar-button-font-size;
        padding: 0 $toolbar-button-padding-horizontal;
    }
    a:first-child {
        border-radius: $toolbar-button-border-radius 0 0 $toolbar-button-border-radius;
    }
    a:last-child {
        margin-inline-start:-1px;
        border-radius: 0 $toolbar-button-border-radius $toolbar-button-border-radius 0;
    }
    a:only-child {
        border-radius: $toolbar-button-border-radius;
    }
}

// TODO Reimplement blinking if unpublished content is present
//###########################################################
// #TOOLBAR/blocker#
.cms-screenblock {
    position: fixed;
    top: 0;
    inset-inline-end: 0;
    z-index: z(screenblock);
    color: $screenblock-color;
    text-align: center;
    width: 100%;
    height: 100%;
    background-color: $screenblock-bgcolor;
}

.cms-screenblock-inner {
    margin-top: $screenblock-inner-position;
    h1 {
        font-size: 28px;
        line-height: 30px;
    }
    h1,
    p {
        color: $gray-light;
        text-align: center;
    }
    a {
        color: $white;
    }
    a:hover {
        text-decoration: underline;
    }
}

@at-root .cms-scrollbar-measure {
    position: absolute;
    top: -9999px;
    width: 50px;
    height: 50px;
    overflow: scroll;
}

.cms-loading-bar {
    background: $color-primary;

    position: fixed;
    z-index: 99999999;
    top: 0;
    inset-inline-start: 0;

    width: 100%;
    height: 3px;
}

.cms-loading-peg {
    display: block;
    position: absolute;
    inset-inline-end: 0px;
    width: 100px;
    height: 100%;
    box-shadow: 0 0 10px #29d, 0 0 5px $color-primary;
    opacity: 1.0;
    transform: rotate(3deg) translate(0px, -4px);
}
