/*! jQuery UI - v1.11.4 - 2015-09-09
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, sortable.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])
},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})});

//##############################################################################
// CHANGELIST
/* global CMS, tree_component */

(function ($) {
    'use strict';
    // CMS.$ will be passed for $
    $(document).ready(function () {

        /*!
         * TreeManager
         * Handles treeview
         * TODO this will be refactored in 3.2
         */
        CMS.TreeManager = new CMS.Class({

            options: {
                'lang': {}
            },

            initialize: function (options) {
                this.options = $.extend(true, {}, this.options, options);

                this.setupFunctions();
                this.setupTreePublishing();
                this.setupUIHacks();

                // load internal functions
                if (!this.options.settings.filtered) {
                    this.setupGlobals();
                    this.setupTree();

                    // init tree component
                    window.initTree();
                } else {
                    // when filtered is active, prevent tree actions
                    $.syncCols();
                }
            },

            setupFunctions: function () {
                var that = this;

                $.syncCols = function () {
                    $('#sitemap .col-softroot').syncWidth(0);
                    $('#sitemap .col-apphook').syncWidth(0);
                    $('#sitemap .col-language').syncWidth(0);
                    $('#sitemap .col-navigation').syncWidth(0);
                    $('#sitemap .col-actions').syncWidth(0);
                    $('#sitemap .col-info').syncWidth(0);

                    that.refreshColumns.call($('ul.tree-default li'));
                };

                /* Colums width sync */
                $.fn.syncWidth = function (max) {
                    var visible = false;

                    $(this).each(function () {
                        if ($(this).is(':visible')) {
                            visible = true;
                            var val = $(this).width();
                            if (val > max) {
                                max = val;
                            }
                        }
                    });
                    if (visible && max > 0) {
                        $(this).each(function () {
                            $(this).css('width', max);
                        });
                    }
                };

                // jquery.functional
                $.curry = function (fn) {
                    if (arguments.length < 2) {
                        return fn;
                    }
                    var args = $.makeArray(arguments).slice(1, arguments.length);
                    return function () {
                        return fn.apply(this, args.concat($.makeArray(arguments)));
                    };
                };

                $.__callbackPool = {};

                $.callbackRegister = function (name, fn /*, arg0, arg1, ..*/) {
                    if (arguments.length > 2) {
                        // create curried function
                        fn = $.curry.apply(this, $.makeArray(arguments).slice(1, arguments.length));
                    }
                    $.__callbackPool[name] = fn;
                    return name;
                };

                $.callbackCall = function (name/*, extra arg0, extra arg1, ..*/) {
                    if (!name || !(name in $.__callbackPool)) {
                        throw 'No callback registered with name: ' + name;
                    }
                    $.__callbackPool[name].apply(this, $.makeArray(arguments).slice(1, arguments.length));
                    $.callbackRemove(name);
                    return name;
                };

                $.callbackRemove = function (name) {
                    delete $.__callbackPool[name];
                };

                // very simple yellow fade plugin..
                $.fn.yft = function () {
                    this.effect('highlight', {}, 1000);
                };

                // jquery replace plugin :)
                $.fn.replace = function (o) {
                    return this.after(o).remove().end();
                };

            },

            setupTreePublishing: function () {
                // ADD DIRECT PUBLISHING
                var that = this;
                var tree = $('.tree');
                var langTrigger = '.col-language .trigger-tooltip span';
                var langTooltips = '.language-tooltip';
                var langTimer = function () {};
                var langDelay = 100;
                var langFadeDuration = 200;
                // workaround for the publishing tooltip on touch devices
                var touchUsedNode;

                // show the tooltip
                tree.delegate(langTrigger, 'pointerover touchstart', function (e) {
                    var el = $(this).closest('.col-language').find('.language-tooltip');

                    // clear timer
                    clearTimeout(langTimer);

                    // cancel if tooltip already visible
                    if (el.is(':visible') && !touchUsedNode) {
                        return false;
                    }

                    // set correct position
                    el.css('right', 20 + $(this).position().left);

                    // hide all elements
                    $(langTooltips).hide();
                    $('.moveable').removeClass('hover');

                    if (e.type === 'touchstart') {
                        e.preventDefault();
                        touchUsedNode = touchUsedNode === e.target ? false : e.target;
                        if (touchUsedNode) {
                            return;
                        }
                    }

                    // use a timeout to display the tooltip
                    langTimer = setTimeout(function () {
                        el.stop(true, true).fadeIn(langFadeDuration);
                        el.closest('.moveable').addClass('hover');
                    }, langDelay);
                });
                // hide the tooltip when leaving the area
                tree.delegate(langTrigger, 'pointerout', function () {
                    if (touchUsedNode) {
                        return;
                    }

                    // clear timer
                    clearTimeout(langTimer);
                    // hide all elements
                    langTimer = setTimeout(function () {
                        $(langTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }, langDelay * 2);
                });
                // reset hiding when entering the tooltip itself
                tree.delegate(langTooltips, 'pointerover', function () {
                    // clear timer
                    clearTimeout(langTimer);
                });
                tree.delegate(langTooltips, 'pointerout', function () {
                    // hide all elements
                    langTimer = setTimeout(function () {
                        $(langTooltips).hide();
                        $('.moveable').removeClass('hover');
                    }, langDelay * 2);
                });
                // attach double check event if publish or unpublish should be triggered
                tree.delegate('.language-tooltip a', 'click', function (e) {
                    e.preventDefault();

                    // cancel if not confirmed
                    if (!confirm(that.options.lang.publish.replace('ยง', $(this).text().toLowerCase()))) {
                        return false;
                    }

                    // send post request to prevent xss attacks
                    $.ajax({
                        type: 'post',
                        url: $(this).prop('href'),
                        success: function () {
                            CMS.API.Helpers.reloadBrowser();
                        },
                        error: function (request) {
                            throw new Error(request);
                        }
                    });
                });
            },

            setupUIHacks: function () {
                // adds functionality to the filter
                $('#changelist-filter-button').bind('click', function () {
                    $('#changelist-filter').toggle();
                });

                // set correct active entry
                if (window.parent && window.parent.CMS && window.parent.CMS.config) {
                    var page_id = window.parent.CMS.config.request.page_id;

                    $('div[data-page_id="' + page_id + '"]').addClass('cont-active');
                }
            },

            setupGlobals: function () {
                var that = this;
                var msg = '';
                var parent = null;

                window.moveSuccess = function (node) {
                    $.syncCols();

                    msg = $('<span class="success">' + that.options.lang.success + '</span>');
                    parent = window.parent;

                    node.after(msg);
                    node.parent().find('.col2').hide();
                    msg.fadeOut(1000, function () {
                        node.parent().find('.col2').show();
                    });
                    // check for reload changes
                    if (window.self !== window.top) {
                        window.parent.CMS.API.Helpers.reloadBrowser(false, false, true);
                        window.parent.CMS.API.Messages.open({
                            message: that.options.lang.changes,
                            delay: 0
                        });
                    }
                };

                window.moveError = function (node, message) {
                    if (message && message !== 'error') {
                        msg = $('<span class="success">' + message + '</span>');
                    } else {
                        msg = $('<span class="success">' + that.options.lang.error + '</span>');
                    }
                    node.parent().find('.col2').hide();
                    node.after(msg);
                };

            },

            setupTree: function () {
                var that = this;
                var tree;
                var origin = window.location.protocol + '//' + window.location.hostname +
                    (window.location.port ? ':' + window.location.port : '');
                // global initTree function
                window.initTree = function () {
                    // jshint newcap: false
                    // jscs:disable requireCapitalizedConstructors
                    tree = new tree_component();
                    // jscs:enable requireCapitalizedConstructors
                    // jshint newcap: true
                    var options = {
                        rules: {
                            clickable: 'all',
                            renameable: 'none',
                            deletable: 'all',
                            creatable: 'all',
                            draggable: 'all',
                            dragrules: 'all',
                            droppable: 'all',
                            metadata : 'mdata',
                            use_inline: true
                            //droppable : ['tree_drop']
                        },
                        // has to be absolute full path
                        path: origin + that.options.settings.staticPath + 'cms/js/jstree/',
                        ui: {
                            dots: true,
                            rtl: false,
                            animation: 0,
                            hover_mode: true,
                            //theme_path: script_url_path() + '/../jstree/themes/',
                            a_class: 'title',
                            context: false
                        },
                        cookies : {
                            prefix: 'djangocms_nodes'
                        },
                        callback: {
                            beforemove  : function (what, where, position) {
                                window.item_id = what.id.split('page_')[1];
                                window.target_id = where.id.split('page_')[1];
                                window.old_node = what;

                                if ($(what).parent().children('li').length > 1) {
                                    if ($(what).next('li').length) {
                                        window.old_target = $(what).next('li')[0];
                                        window.old_position = 'right';
                                    }
                                    if ($(what).prev('li').length) {
                                        window.old_target = $(what).prev('li')[0];
                                        window.old_position = 'left';
                                    }
                                } else {
                                    if ($(what).attr('rel') !== 'topnode') {
                                        window.old_target = $(what).parent().parent()[0];
                                        window.old_position = 'inside';
                                    }
                                }

                                addUndo(what, where, position);
                                return true;
                            },
                            onmove: function (what, where, position) {
                                window.item_id = what.id.split('page_')[1];
                                window.target_id = where.id.split('page_')[1];

                                if (position === 'before') {
                                    position = 'left';
                                } else if (position === 'after') {
                                    position = 'right';
                                } else if (position === 'inside') {
                                    position = 'last-child';
                                }
                                moveTreeItem(what, window.item_id, window.target_id, position, false);
                            },

                            onload: function () {
                                setTimeout(function () {
                                    reCalc();
                                }, 250);
                            }

                        }
                    };

                    if (!$($('div.tree').get(0)).hasClass('root_allow_children')) {
                        // disalow possibility for adding subnodes to main tree, user doesn't
                        // have permissions for this
                        options.rules.dragrules = ['node inside topnode', 'topnode inside topnode', 'node * node'];
                    }

                    tree.init($('div.tree'), options);
                };

                window.selected_page = false;
                action = false;

                var _oldAjax = $.ajax;

                $.ajax = function (s) {
                    // just override ajax function, so the loader message gets displayed
                    // always
                    $('#loader-message').show();

                    var callback = s.success || false;
                    s.success = function (data, status) {
                        if (callback) {
                            callback(data, status);
                        }
                        $('#loader-message').hide();
                    };

                    // just for debuging!!
                    /*s.complete = function (xhr, status) {
                        if (status == 'error' && that.options.settings.debug) {
                            $('body').before(xhr.responseText);
                        }
                    }*/
                    // end just for debuging

                    // TODO: add error state!
                    return _oldAjax(s);
                };

                // // defined but never used
                // function refresh() {
                //     window.location = window.location.href;
                // }

                // // defined but never used
                // function refreshIfChildren(pageId) {
                //     return $('#page_' + pageId).find('li[id^=page_]').length ?
                //     refresh :
                //     function () { return true; };
                // }

                /**
                 * Loads remote dialog to dialogs div.
                 *
                 * @param {String} url
                 * @param {Object} data Data to be send over post
                 * @param {Function} noDialogCallback Gets called when response is empty.
                 * @param {Function} callback Standard callback function.
                 */
                function loadDialog(url, data, noDialogCallback, callback) {
                    if (data === undefined) {
                        data = {};
                    }
                    $.post(url, data, function (response) {
                        if (response === '' && noDialogCallback) {
                            noDialogCallback();
                        }
                        $('#dialogs').empty().append(response);
                        if (callback) {
                            callback(response);
                        }
                    });
                }

                function mark_copy_node(id) {
                    $('a.move-target, span.move-target-container, span.line').show();
                    $('#page_' + id).addClass('selected');
                    $('#page_' + id).parent().parent()
                        .children('div.cont').find('a.move-target.first-child, span.second').hide();
                    $('#page_' + id).parent().parent()
                        .children('ul').children('li').children('div.cont')
                        .find('a.move-target.left, a.move-target.right, span.first, span.second').hide();
                    return 'copy';
                }


                // let's start event delegation
                $('#changelist li').on('click', function (e) {
                    // I want a link to check the class
                    if (e.target.tagName === 'IMG' || e.target.tagName === 'SPAN') {
                        window.target = e.target.parentNode;
                    } else {
                        window.target = e.target;
                    }
                    var jtarget = $(window.target);
                    var id;
                    var page_id;
                    if (jtarget.hasClass('move')) {
                        // prepare tree for move / cut paste
                        id = e.target.id.split('move-link-')[1];
                        if (!id) {
                            id = e.target.parentNode.id.split('move-link-')[1];
                        }
                        page_id = id;
                        window.selected_page = page_id;
                        action = 'move';
                        $('span.move-target-container, span.line, a.move-target').show();
                        $('#page_' + page_id).addClass('selected');
                        $('#page_' + page_id + ' span.move-target-container').hide();
                        e.stopPropagation();
                        return false;
                    }

                    if (jtarget.hasClass('copy')) {
                        // prepare tree for copy
                        id = e.target.id.split('copy-link-')[1];
                        if (!id) {
                            id = e.target.parentNode.id.split('copy-link-')[1];
                        }
                        window.selected_page = id;
                        action = mark_copy_node(id);
                        e.stopPropagation();
                        return false;
                    }

                    if (jtarget.hasClass('viewpage')) {
                        var view_page_url = $('#' + window.target.id + '-select').val();
                        if (view_page_url) {
                            window.open(view_page_url);
                        }
                    }

                    if (jtarget.hasClass('addlink')) {
                        if (!/#$/g.test(jtarget.attr('href'))) {
                            // if there is url instead of # inside href, follow this url
                            // used if user haves add_page
                            return true;
                        }

                        $('tr').removeClass('target');
                        $('#changelist table').removeClass('table-selected');
                        page_id = window.target.id.split('add-link-')[1];
                        window.selected_page = page_id;
                        action = 'add';
                        $('tr').removeClass('selected');
                        $('#page-row-' + page_id).addClass('selected');
                        $('.move-target-container').hide();
                        $('a.move-target, span.line, #move-target-' + page_id).show();
                        e.stopPropagation();
                        return false;
                    }

                    // don't assume admin site is root-level
                    // grab base url to construct full absolute URLs
                    window.admin_base_url = document.URL.split('/cms/page/')[0] + '/';

                    var pageId;
                    var language;
                    // in navigation
                    if (jtarget.hasClass('navigation-checkbox')) {
                        e.stopPropagation();

                        pageId = jtarget.attr('name').split('navigation-')[1];
                        language = jtarget.closest('.cont').find('a[lang]').attr('lang') || '';

                        // if I don't put data in the post, django doesn't get it
                        reloadItem(
                            jtarget,
                            window.admin_base_url + 'cms/page/' + pageId + '/change-navigation/?language=' + language,
                            { 1: 1 }
                        );
                    }

                    // lazy load descendants on tree open
                    if (jtarget.hasClass('closed')) {
                        // only load them once
                        if (jtarget.find('ul > li').length === 0 && !jtarget.hasClass('loading')) {
                            // keeps this event from firing multiple times before
                            // the dom as changed. it still needs to propagate for
                            // the other click event on this element to fire
                            jtarget.addClass('loading');
                            pageId = $(jtarget).attr('id').split('page_')[1];
                            language = $(jtarget)
                                .children('div.cont')
                                .children('div.col1')
                                .children('.title').attr('lang');
                            $.get(
                                window.admin_base_url + 'cms/page/' + pageId + '/' + language + '/descendants/',
                                {},
                                function (r) {
                                    jtarget.children('ul').append(r);
                                    // show move targets if needed
                                    if ($('span.move-target-container:visible').length > 0) {
                                        jtarget.children('ul')
                                            .find('a.move-target, span.move-target-container, span.line')
                                            .show();
                                    }
                                    reCalc();
                                }
                            );
                        } else {
                            reCalc();
                        }
                    }

                    if (jtarget.hasClass('move-target')) {
                        if (jtarget.hasClass('left')) {
                            window.position = 'left';
                        }
                        if (jtarget.hasClass('right')) {
                            window.position = 'right';
                        }
                        if (jtarget.hasClass('last-child')) {
                            window.position = 'last-child';
                        }
                        window.target_id = window.target.parentNode.id.split('move-target-')[1];

                        if (action === 'move') {
                            moveTreeItem(null, window.selected_page, window.target_id, window.position, tree);
                            $('.move-target-container').hide();
                        } else if (action === 'copy') {
                            window.site = $('#site-select')[0].value;
                            copyTreeItem(window.selected_page, window.target_id, window.position, window.site);
                            $('.move-target-container').hide();
                        } else if (action === 'add') {
                            window.site = $('#site-select')[0].value;
                            window.location.href = window.location.href.split('?')[0].split('#')[0] +
                                'add/?target=' + window.target_id + '&amp;position=' + window.position +
                                '&amp;site=' + window.site;
                        }
                        e.stopPropagation();
                        return false;
                    }
                    return true;
                });
                $('div#sitemap').show();

                function reCalc() {
                    $.syncCols();
                }

                $(window).bind('resize', reCalc);
                /* Site Selector */
                $('#site-select').change(function () {
                    var form = $(this).closest('form');
                    // add correct value for copy
                    if (action === 'copy') {
                        $('#site-copy').val(window.selected_page);
                    }
                    // submit form
                    form.submit();
                });

                //
                // If an A element has a data-attribute 'alt-class'. At this time,
                // this is only the edit button in the page-tree, but could be
                // more in future. It is important that the CSS be written in such
                // a manner that the alt-class is defined after the normal class,
                // so that it can be overridden when the alt-key is depressed.
                //
                // NOTE: This 'preview' part of the 'alt-click to [alternative
                // function]' feature may not work in some environments (Windows
                // in a some virtual machine environments, notably), but is only a
                // nice-'extra', not a requirement for the feature.
                //
                $(document).on('keydown keyup', function (evt) {
                    if (evt.which === 18) {
                        $('a[data-alt-class]').each(function () {
                            var self = $(this);
                            self.toggleClass(self.data('alt-class'), evt.type === 'keydown');
                        });
                    }
                });

                //
                // If the A-element has a data-attribute 'alt-href', then this
                // click-handler uses that instead of the normal href attribute as
                // the click-destination. Again, currently this is only on the
                // edit button, but could be more in future.
                //
                $('a[data-alt-href]').on('click', function (evt) {
                    var href;
                    evt.preventDefault();
                    if (evt.shiftKey) {
                        href = $(this).data('alt-href');
                    } else {
                        href = $(this).attr('href');
                    }
                    window.location = href;
                });

                var copy_splits = window.location.href.split('copy=');
                if (copy_splits.length > 1) {
                    var id = copy_splits[1].split('&')[0];
                    // jshint latedef: false
                    var action = mark_copy_node(id);
                    // jshint latedef: true
                    window.selected_page = id;
                }

                function copyTreeItem(item_id, target_id, position, site) {
                    if (that.options.settings.permission) {
                        return loadDialog('./' + item_id + '/dialog/copy/', {
                            position: position,
                            target: target_id,
                            site: site,
                            callback: $.callbackRegister(
                                '_copyTreeItem', _copyTreeItem, item_id, target_id, position, site
                            )
                        });
                    }
                    return _copyTreeItem(item_id, target_id, position, site);
                }

                function _copyTreeItem(item_id, target_id, position, site, options) {
                    var data = {
                        position: position,
                        target: target_id,
                        site: site
                    };
                    data = $.extend(data, options);

                    $.post('./' + item_id + '/copy-page/', data, function (decoded) {
                        var response = decoded.content;
                        var status = decoded.status;
                        if (status === 200) {
                            // reload tree
                            window.location = window.location.href;
                        } else {
                            alert(response);
                            window.moveError($('#page_' + item_id + ' div.col1:eq(0)'), response);
                        }
                    });
                }

                /**
                 * Reloads tree item (one line). If some filtering is found, adds
                 * filtered variable into posted data.
                 *
                 * @param {HTMLElement} el Any child element of tree item
                 * @param {String} url Requested url
                 * @param {Object} data Optional posted data
                 * @param {Function} callback Optional calback function
                 */
                function reloadItem(el, url, data, callback, errorCallback) {
                    if (data === undefined) {
                        data = {};
                    }

                    if (/\/\?/ig.test(window.location.href)) {
                        // probably some filter here, tell backend, we need a filtered
                        // version of item
                        data.fitlered = 1;
                    }

                    function onSuccess(response, textStatus) {
                        var status = true;
                        var target = null;

                        if (callback) {
                            status = callback(response, textStatus);
                        }
                        if (status) {
                            if (/page_\d+/.test($(el).attr('id'))) {
                                // one level higher
                                target = $(el).find('div.cont:first');
                            } else {
                                target = $(el).parents('div.cont:first');
                            }

                            var parent = target.parent();

                            // remove the element if something went wrong
                            if (response === 'NotFound') {
                                return parent.remove();
                            }

                            var origin = $('.messagelist');
                            target.replace(response);

                            var messages = $(parent).find('.messagelist');
                            if (messages.length) {
                                origin.remove();
                                messages.insertAfter('.breadcrumbs');
                            }
                            parent.find('div.cont:first').yft();

                            // ensure after removal everything is aligned again
                            $(window).trigger('resize');
                        }
                    }

                    $.ajax({
                        'type': 'POST',
                        'data': data,
                        'url': url,
                        'success': onSuccess,
                        'error': function (XMLHttpRequest, textStatus, errorThrown) {
                            // errorCallback is passed through the reloadItem function
                            if (errorCallback) {
                                errorCallback(XMLHttpRequest, textStatus, errorThrown);
                            }
                        },
                        'xhr': (window.ActiveXObject) ?
                            function () {
                                try {
                                    return new window.ActiveXObject('Microsoft.XMLHTTP');
                                } catch (e) {}
                            } :
                            function () {
                                return new window.XMLHttpRequest();
                            }
                    });
                }

                function moveTreeItem(jtarget, item_id, target_id, position, tree) {
                    reloadItem(
                        jtarget, './' + item_id + '/move-page/',

                        { position: position, target: target_id },

                        // on success
                        function (decoded) {
                            var response = decoded.content;
                            var status = decoded.status;
                            if (status === 200) {
                                if (tree) {
                                    var tree_pos = { 'left': 'before', 'right': 'after' }[position] || 'inside';
                                    tree.moved(
                                        '#page_' + item_id,
                                        $('#page_' + target_id + ' a.title')[0],
                                        tree_pos,
                                        false,
                                        false
                                    );
                                } else {
                                    window.moveSuccess($('#page_' + item_id + ' div.col1:eq(0)'));
                                }
                                return false;
                            } else {
                                window.moveError($('#page_' + item_id + ' div.col1:eq(0)'), response);
                                return false;
                            }
                        }
                    );
                }

                var undos = [];

                function addUndo(node, target, position) {
                    undos.push({ node: node, target: target, position: position });
                }
            },

            refreshColumns: function () {
                $('div.col2').children('div').each(function (index, item) {
                    $(item).css('display', 'block');
                });
                var min_width = 100000;
                var max_col2_width = 0;
                var max_col2 = null;
                $(this).each(function () {
                    var cont = $(this).children('div.cont');
                    if (!cont.is(':visible')) {
                        return;
                    }
                    var col1 = cont.children('div.col1').find('.title span');
                    var col2 = cont.children('div.col2');
                    var col1_width = col1.outerWidth(true);
                    var col2_width = col2.outerWidth(true);
                    var total_width = cont.outerWidth(true);

                    var dif = total_width - col1_width;
                    if (dif < min_width) {
                        min_width = dif;
                    }
                    if (col2_width > max_col2_width) {
                        max_col2_width = col2_width;
                        max_col2 = col2;
                    }
                });

                var offset = 50;
                var w = 0;
                var hidden_count = 0;
                var max_reached = false;
                if (max_col2) {
                    max_col2.children('div').each(function () {
                        if (!max_reached) {
                            w += $(this).outerWidth(true);
                        }

                        if (max_reached || w > (min_width - offset)) {
                            hidden_count = hidden_count + 1;
                            max_reached = true;
                        }
                    });

                    if (hidden_count) {
                        $(this).each(function () {
                            $(this).children('div.cont').children('div.col2').children('div')
                                .slice(-hidden_count).each(function () {
                                    $(this).css('display', 'none');
                                });
                        });
                        $('div#sitemap ul.header div.col2').children().slice(-hidden_count).each(function () {
                            $(this).css('display', 'none');
                        });
                    }
                }
            }

        });

    });
})(CMS.$);

// all, but without jquery !! (modified by Peter Cicman)

// css.js

function get_css(rule_name,stylesheet,delete_flag){if(!document.styleSheets)return false;rule_name=rule_name.toLowerCase();stylesheet=stylesheet||0;for(var i=stylesheet;i<document.styleSheets.length;i++){var styleSheet=document.styleSheets[i];css_rules=document.styleSheets[i].cssRules||document.styleSheets[i].rules;if(!css_rules)continue;var j=0;do{if(css_rules[j].selectorText.toLowerCase()==rule_name){if(delete_flag==true){if(document.styleSheets[i].removeRule)document.styleSheets[i].removeRule(j);if(document.styleSheets[i].deleteRule)document.styleSheets[i].deleteRule(j);return true;}
else return css_rules[j];}}
while(css_rules[++j]);}
return false;}
function add_css(rule_name,stylesheet){rule_name=rule_name.toLowerCase();stylesheet=stylesheet||0;if(!document.styleSheets||get_css(rule_name,stylesheet))return false;(document.styleSheets[stylesheet].addRule)?document.styleSheets[stylesheet].addRule(rule_name,null,0):document.styleSheets[stylesheet].insertRule(rule_name+' { }',0);return get_css(rule_name);}
function get_sheet_num(href_name){if(!document.styleSheets)return false;for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].href&&document.styleSheets[i].href.toString().match(href_name))return i;}
return false;}
function remove_css(rule_name,stylesheet){return get_css(rule_name,stylesheet,true);}
function add_sheet(url){if(document.createStyleSheet){document.createStyleSheet(url);}
else{var styles="@import url(' "+url+" ');";var newSS=document.createElement('link');newSS.rel='stylesheet';newSS.href='data:text/css,'+escape(styles);document.getElementsByTagName("head")[0].appendChild(newSS);}}

// jquery.listen.js
;(function($){var a='indexer',h=$.event,j=h.special,k=$.listen=function(c,d,e,f){if(typeof d!='object'){f=e;e=d;d=document}o(c.split(/\s+/),function(a){a=k.fixes[a]||a;var b=m(d,a)||m(d,a,new n(a,d));b.append(e,f);b.start()})},m=function(b,c,d){return $.data(b,c+'.'+a,d)};$.fn[a]=function(a){return this[0]&&m(this[0],a)||null};$[a]=function(a){return m(document,a)};$.extend(k,{regex:/^((?:\w*?|\*))(?:([#.])([\w-]+))?$/,fixes:{focus:'focusin',blur:'focusout'},cache:function(a){this.caching=a}});$.each(k.fixes,function(a,b){j[b]={setup:function(){if($.browser.msie)return!1;this.addEventListener(a,j[b].handler,!0)},teardown:function(){if($.browser.msie)return!1;this.removeEventListener(a,j[b].handler,!0)},handler:function(e){arguments[0]=e=h.fix(e);e.type=b;return h.handle.apply(this,arguments)}}});$.fn.listen=function(a,b,c){return this.each(function(){k(a,this,b,c)})};function n(a,b){$.extend(this,{ids:{},tags:{},listener:b,event:a});this.id=n.instances.push(this)};n.instances=[];n.prototype={constructor:n,handle:function(e){var a=e.stopPropagation;e.stopPropagation=function(){e.stopped=1;a.apply(this,arguments)};m(this,e.type).parse(e);e.stopPropagation=a;a=e.data=null},on:0,bubbles:0,start:function(){var a=this;if(!a.on){h.add(a.listener,a.event,a.handle);a.on=1}},stop:function(){var a=this;if(a.on){h.remove(a.listener,a.event,a.handle);a.on=0}},cache:function(a,b){return $.data(a,'listenCache_'+this.id,b)},parse:function(e){var z=this,c=e.data||e.target,d=arguments,f;if(!k.caching||!(f=z.cache(c))){f=[];if(c.id&&z.ids[c.id])p(f,z.ids[c.id]);o([c.nodeName,'*'],function(a){var b=z.tags[a];if(b)o((c.className+' *').split(' '),function(a){if(a&&b[a])p(f,b[a])})});if(k.caching)z.cache(c,f)}if(f[0]){o(f,function(a){if(a.apply(c,d)===!1){e.preventDefault();e.stopPropagation()}})}if(!e.stopped&&(c=c.parentNode)&&(c.nodeName=='A'||z.bubbles&&c!=z.listener)){e.data=c;z.parse(e)}f=d=c=null},append:function(f,g){var z=this;o(f.split(/\s*,\s*/),function(a){var b=k.regex.exec(a);if(!b)throw'$.listen > "'+a+'" is not a supported selector.';var c=b[2]=='#'&&b[3],d=b[1].toUpperCase()||'*',e=b[3]||'*';if(c)(z.ids[c]||(z.ids[c]=[])).push(g);else if(d){d=z.tags[d]=z.tags[d]||{};(d[e]||(d[e]=[])).push(g)}})}};function o(a,b,c){for(var i=0,l=a.length;i<l;i++)b.call(c,a[i],i)};function p(a,b){a.push.apply(a,b);return a};$(window).unload(function(){if(typeof n=='function')o(n.instances,function(b){b.stop();$.removeData(b.listener,b.event+'.'+a);b.ids=b.names=b.listener=null})})})(jQuery);

// sarissa.js

function Sarissa(){}
Sarissa.VERSION="0.9.9.4";Sarissa.PARSED_OK="Document contains no parsing errors";Sarissa.PARSED_EMPTY="Document is empty";Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error";Sarissa.IS_ENABLED_TRANSFORM_NODE=false;Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG";Sarissa._lastUniqueSuffix=0;Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++;};Sarissa._SARISSA_IEPREFIX4XSLPARAM="";Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&true;Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument;Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature;Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE;Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1;Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&(parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420);Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1;Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE){Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};}
if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__;HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;x=null;}
if(typeof XMLDocument=="undefined"&&typeof Document!="undefined"){XMLDocument=Document;}
if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="";var _SARISSA_XMLHTTP_PROGID="";var _SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(idList){var bFound=false,e;var o2Store;for(var i=0;i<idList.length&&!bFound;i++){try{var oDoc=new ActiveXObject(idList[i]);o2Store=idList[i];bFound=true;}catch(objException){e=objException;}}
if(!bFound){throw"Could not retrieve a valid progID of Class: "+idList[idList.length-1]+". (original exception: "+e+")";}
idList=null;return o2Store;};_SARISSA_DOM_PROGID=null;_SARISSA_THREADEDDOM_PROGID=null;_SARISSA_XSLTEMPLATE_PROGID=null;_SARISSA_XMLHTTP_PROGID=null;XMLHttpRequest=function(){if(!_SARISSA_XMLHTTP_PROGID){_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"]);}
return new ActiveXObject(_SARISSA_XMLHTTP_PROGID);};Sarissa.getDomDocument=function(sUri,sName){if(!_SARISSA_DOM_PROGID){_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]);}
var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(sName){var prefix="";if(sUri){if(sName.indexOf(":")>1){prefix=sName.substring(0,sName.indexOf(":"));sName=sName.substring(sName.indexOf(":")+1);}else{prefix="a"+Sarissa._getUniqueSuffix();}}
if(sUri){oDoc.loadXML('<'+prefix+':'+sName+" xmlns:"+prefix+"=\""+sUri+"\""+" />");}else{oDoc.loadXML('<'+sName+" />");}}
return oDoc;};Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if(oDoc&&oDoc.parseError&&oDoc.parseError.errorCode&&oDoc.parseError.errorCode!=0){parseErrorText="XML Parsing Error: "+oDoc.parseError.reason+"\nLocation: "+oDoc.parseError.url+"\nLine Number "+oDoc.parseError.line+", Column "+
oDoc.parseError.linepos+":\n"+oDoc.parseError.srcText+"\n";for(var i=0;i<oDoc.parseError.linepos;i++){parseErrorText+="-";}
parseErrorText+="^\n";}
else if(oDoc.documentElement===null){parseErrorText=Sarissa.PARSED_EMPTY;}
return parseErrorText;};Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc.setProperty("SelectionLanguage","XPath");oDoc.setProperty("SelectionNamespaces",sNsSet);};XSLTProcessor=function(){if(!_SARISSA_XSLTEMPLATE_PROGID){_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"]);}
this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID);this.processor=null;};XSLTProcessor.prototype.importStylesheet=function(xslDoc){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"]);}
xslDoc.setProperty("SelectionLanguage","XPath");xslDoc.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var converted=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{converted.resolveExternals=true;converted.setProperty("AllowDocumentFunction",true);}
catch(e){}
if(xslDoc.url&&xslDoc.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null){converted.async=false;converted.load(xslDoc.url);}
else{converted.loadXML(xslDoc.xml);}
converted.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var output=converted.selectSingleNode("//xsl:output");if(output){this.outputMethod=output.getAttribute("method");}
else{delete this.outputMethod;}
this.template.stylesheet=converted;this.processor=this.template.createProcessor();this.paramsSet=[];};XSLTProcessor.prototype.transformToDocument=function(sourceDoc){var outDoc;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_PROGID);this.processor.output=outDoc;this.processor.transform();return outDoc;}
else{if(!_SARISSA_DOM_XMLWRITER){_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"]);}
this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_XMLWRITER);this.processor.output=outDoc;this.processor.transform();var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);oDoc.loadXML(outDoc.output+"");return oDoc;}};XSLTProcessor.prototype.transformToFragment=function(sourceDoc,ownerDoc){this.processor.input=sourceDoc;this.processor.transform();var s=this.processor.output;var f=ownerDoc.createDocumentFragment();var container;if(this.outputMethod=='text'){f.appendChild(ownerDoc.createTextNode(s));}else if(ownerDoc.body&&ownerDoc.body.innerHTML){container=ownerDoc.createElement('div');container.innerHTML=s;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}
else{var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(s.substring(0,5)=='<?xml'){s=s.substring(s.indexOf('?>')+2);}
var xml=''.concat('<my>',s,'</my>');oDoc.loadXML(xml);container=oDoc.documentElement;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}
return f;};XSLTProcessor.prototype.setParameter=function(nsURI,name,value){value=value?value:"";if(nsURI){this.processor.addParameter(name,value,nsURI);}else{this.processor.addParameter(name,value);}
nsURI=""+(nsURI||"");if(!this.paramsSet[nsURI]){this.paramsSet[nsURI]=[];}
this.paramsSet[nsURI][name]=value;};XSLTProcessor.prototype.getParameter=function(nsURI,name){nsURI=""+(nsURI||"");if(this.paramsSet[nsURI]&&this.paramsSet[nsURI][name]){return this.paramsSet[nsURI][name];}else{return null;}};XSLTProcessor.prototype.clearParameters=function(){for(var nsURI in this.paramsSet){for(var name in this.paramsSet[nsURI]){if(nsURI!=""){this.processor.addParameter(name,"",nsURI);}else{this.processor.addParameter(name,"");}}}
this.paramsSet=[];};}else{if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT){Sarissa.__handleLoad__=function(oDoc){Sarissa.__setReadyState__(oDoc,4);};_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this);};Sarissa.__setReadyState__=function(oDoc,iReadyState){oDoc.readyState=iReadyState;oDoc.readystate=iReadyState;if(oDoc.onreadystatechange!=null&&typeof oDoc.onreadystatechange=="function"){oDoc.onreadystatechange();}};Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(!oDoc.onreadystatechange){oDoc.onreadystatechange=null;}
if(!oDoc.readyState){oDoc.readyState=0;}
oDoc.addEventListener("load",_sarissa_XMLDocument_onload,false);return oDoc;};if(window.XMLDocument){}
else if(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature('LS','3.0')){Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);return oDoc;};}
else{Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(oDoc&&(sUri||sName)&&!oDoc.documentElement){oDoc.appendChild(oDoc.createElementNS(sUri,sName));}
return oDoc;};}}}
if(!window.DOMParser){if(Sarissa._SARISSA_IS_SAFARI){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(sXml),false);xmlhttp.send(null);return xmlhttp.responseXML;};}else if(Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var doc=Sarissa.getDomDocument();doc.loadXML(sXml);return doc;};}}
if((typeof(document.importNode)=="undefined")&&Sarissa._SARISSA_IS_IE){try{document.importNode=function(oNode,bChildren){var tmp;if(oNode.nodeName=='#text'){return document.createTextNode(oNode.data);}
else{if(oNode.nodeName=="tbody"||oNode.nodeName=="tr"){tmp=document.createElement("table");}
else if(oNode.nodeName=="td"){tmp=document.createElement("tr");}
else if(oNode.nodeName=="option"){tmp=document.createElement("select");}
else{tmp=document.createElement("div");}
if(bChildren){tmp.innerHTML=oNode.xml?oNode.xml:oNode.outerHTML;}else{tmp.innerHTML=oNode.xml?oNode.cloneNode(false).xml:oNode.cloneNode(false).outerHTML;}
return tmp.getElementsByTagName("*")[0];}};}catch(e){}}
if(!Sarissa.getParseErrorText){Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if((!oDoc)||(!oDoc.documentElement)){parseErrorText=Sarissa.PARSED_EMPTY;}else if(oDoc.documentElement.tagName=="parsererror"){parseErrorText=oDoc.documentElement.firstChild.data;parseErrorText+="\n"+oDoc.documentElement.firstChild.nextSibling.firstChild.data;}else if(oDoc.getElementsByTagName("parsererror").length>0){var parsererror=oDoc.getElementsByTagName("parsererror")[0];parseErrorText=Sarissa.getText(parsererror,true)+"\n";}else if(oDoc.parseError&&oDoc.parseError.errorCode!=0){parseErrorText=Sarissa.PARSED_UNKNOWN_ERROR;}
return parseErrorText;};}
Sarissa.getText=function(oNode,deep){var s="";var nodes=oNode.childNodes;for(var i=0;i<nodes.length;i++){var node=nodes[i];var nodeType=node.nodeType;if(nodeType==Node.TEXT_NODE||nodeType==Node.CDATA_SECTION_NODE){s+=node.data;}else if(deep===true&&(nodeType==Node.ELEMENT_NODE||nodeType==Node.DOCUMENT_NODE||nodeType==Node.DOCUMENT_FRAGMENT_NODE)){s+=Sarissa.getText(node,true);}}
return s;};if(!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer=function(){};XMLSerializer.prototype.serializeToString=function(oNode){return oNode.xml;};}
Sarissa.stripTags=function(s){return s?s.replace(/<[^>]+>/g,""):s;};Sarissa.clearChildNodes=function(oNode){while(oNode.firstChild){oNode.removeChild(oNode.firstChild);}};Sarissa.copyChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if(Sarissa._SARISSA_IS_SAFARI&&nodeTo.nodeType==Node.DOCUMENT_NODE){nodeTo=nodeTo.documentElement;}
if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}
if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}
var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var nodes=nodeFrom.childNodes;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}};Sarissa.moveChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}
if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}
var nodes=nodeFrom.childNodes;if(nodeFrom.ownerDocument==nodeTo.ownerDocument){while(nodeFrom.firstChild){nodeTo.appendChild(nodeFrom.firstChild);}}else{var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}
Sarissa.clearChildNodes(nodeFrom);}};Sarissa.xmlize=function(anyObject,objectName,indentSpace){indentSpace=indentSpace?indentSpace:'';var s=indentSpace+'<'+objectName+'>';var isLeaf=false;if(!(anyObject instanceof Object)||anyObject instanceof Number||anyObject instanceof String||anyObject instanceof Boolean||anyObject instanceof Date){s+=Sarissa.escape(""+anyObject);isLeaf=true;}else{s+="\n";var isArrayItem=anyObject instanceof Array;for(var name in anyObject){s+=Sarissa.xmlize(anyObject[name],(isArrayItem?"array-item key=\""+name+"\"":name),indentSpace+"   ");}
s+=indentSpace;}
return(s+=(objectName.indexOf(' ')!=-1?"</array-item>\n":"</"+objectName+">\n"));};Sarissa.escape=function(sXml){return sXml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");};Sarissa.unescape=function(sXml){return sXml.replace(/&apos;/g,"'").replace(/&quot;/g,"\"").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");};Sarissa.updateCursor=function(oTargetElement,sValue){if(oTargetElement&&oTargetElement.style&&oTargetElement.style.cursor!=undefined){oTargetElement.style.cursor=sValue;}};Sarissa.updateContentFromURI=function(sFromUrl,oTargetElement,xsltproc,callback,skipCache){try{Sarissa.updateCursor(oTargetElement,"wait");var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",sFromUrl,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){try{var oDomDoc=xmlhttp.responseXML;if(oDomDoc&&Sarissa.getParseErrorText(oDomDoc)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(xmlhttp.responseXML,oTargetElement,xsltproc);if(callback){callback(sFromUrl,oTargetElement);}}
else{throw Sarissa.getParseErrorText(oDomDoc);}}
catch(e){if(callback){callback(sFromUrl,oTargetElement,e);}
else{throw e;}}}};if(skipCache){var oldage="Sat, 1 Jan 2000 00:00:00 GMT";xmlhttp.setRequestHeader("If-Modified-Since",oldage);}
xmlhttp.send("");}
catch(e){Sarissa.updateCursor(oTargetElement,"auto");if(callback){callback(sFromUrl,oTargetElement,e);}
else{throw e;}}};Sarissa.updateContentFromNode=function(oNode,oTargetElement,xsltproc){try{Sarissa.updateCursor(oTargetElement,"wait");Sarissa.clearChildNodes(oTargetElement);var ownerDoc=oNode.nodeType==Node.DOCUMENT_NODE?oNode:oNode.ownerDocument;if(ownerDoc.parseError&&ownerDoc.parseError.errorCode!=0){var pre=document.createElement("pre");pre.appendChild(document.createTextNode(Sarissa.getParseErrorText(ownerDoc)));oTargetElement.appendChild(pre);}
else{if(xsltproc){oNode=xsltproc.transformToDocument(oNode);}
if(oTargetElement.tagName.toLowerCase()=="textarea"||oTargetElement.tagName.toLowerCase()=="input"){oTargetElement.value=new XMLSerializer().serializeToString(oNode);}
else{try{oTargetElement.appendChild(oTargetElement.ownerDocument.importNode(oNode,true));}
catch(e){oTargetElement.innerHTML=new XMLSerializer().serializeToString(oNode);}}}}
catch(e){throw e;}
finally{Sarissa.updateCursor(oTargetElement,"auto");}};Sarissa.formToQueryString=function(oForm){var qs="";for(var i=0;i<oForm.elements.length;i++){var oField=oForm.elements[i];var sFieldName=oField.getAttribute("name")?oField.getAttribute("name"):oField.getAttribute("id");if(sFieldName&&((!oField.disabled)||oField.type=="hidden")){switch(oField.type){case"hidden":case"text":case"textarea":case"password":qs+=sFieldName+"="+encodeURIComponent(oField.value)+"&";break;case"select-one":qs+=sFieldName+"="+encodeURIComponent(oField.options[oField.selectedIndex].value)+"&";break;case"select-multiple":for(var j=0;j<oField.length;j++){var optElem=oField.options[j];if(optElem.selected===true){qs+=sFieldName+"[]"+"="+encodeURIComponent(optElem.value)+"&";}}
break;case"checkbox":case"radio":if(oField.checked){qs+=sFieldName+"="+encodeURIComponent(oField.value)+"&";}
break;}}}
return qs.substr(0,qs.length-1);};Sarissa.updateContentFromForm=function(oForm,oTargetElement,xsltproc,callback){try{Sarissa.updateCursor(oTargetElement,"wait");var params=Sarissa.formToQueryString(oForm)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true";var xmlhttp=new XMLHttpRequest();var bUseGet=oForm.getAttribute("method")&&oForm.getAttribute("method").toLowerCase()=="get";if(bUseGet){xmlhttp.open("GET",oForm.getAttribute("action")+"?"+params,true);}
else{xmlhttp.open('POST',oForm.getAttribute("action"),true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.setRequestHeader("Content-length",params.length);xmlhttp.setRequestHeader("Connection","close");}
xmlhttp.onreadystatechange=function(){try{if(xmlhttp.readyState==4){var oDomDoc=xmlhttp.responseXML;if(oDomDoc&&Sarissa.getParseErrorText(oDomDoc)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(xmlhttp.responseXML,oTargetElement,xsltproc);if(callback){callback(oForm,oTargetElement);}}
else{throw Sarissa.getParseErrorText(oDomDoc);}}}
catch(e){if(callback){callback(oForm,oTargetElement,e);}
else{throw e;}}};xmlhttp.send(bUseGet?"":params);}
catch(e){Sarissa.updateCursor(oTargetElement,"auto");if(callback){callback(oForm,oTargetElement,e);}
else{throw e;}}
return false;};Sarissa.FUNCTION_NAME_REGEXP=new RegExp("");Sarissa.getFunctionName=function(oFunc,bForce){var name;if(!name){if(bForce){name="SarissaAnonymous"+Sarissa._getUniqueSuffix();window[name]=oFunc;}
else{name=null;}}
if(name){window[name]=oFunc;}
return name;};Sarissa.setRemoteJsonCallback=function(url,callback,callbackParam){if(!callbackParam){callbackParam="callback";}
var callbackFunctionName=Sarissa.getFunctionName(callback,true);var id="sarissa_json_script_id_"+Sarissa._getUniqueSuffix();var oHead=document.getElementsByTagName("head")[0];var scriptTag=document.createElement('script');scriptTag.type='text/javascript';scriptTag.id=id;scriptTag.onload=function(){};if(url.indexOf("?")!=-1){url+=("&"+callbackParam+"="+callbackFunctionName);}
else{url+=("?"+callbackParam+"="+callbackFunctionName);}
scriptTag.src=url;oHead.appendChild(scriptTag);return id;};

// sarissa_ieemu_xpath.js

if(Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")){SarissaNodeList=function(i){this.length=i;};SarissaNodeList.prototype=[];SarissaNodeList.prototype.constructor=Array;SarissaNodeList.prototype.item=function(i){return(i<0||i>=this.length)?null:this[i];};SarissaNodeList.prototype.expr="";if(window.XMLDocument&&(!XMLDocument.prototype.setProperty)){XMLDocument.prototype.setProperty=function(x,y){};}
Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc._sarissa_useCustomResolver=true;var namespaces=sNsSet.indexOf(" ")>-1?sNsSet.split(" "):[sNsSet];oDoc._sarissa_xpathNamespaces=[];for(var i=0;i<namespaces.length;i++){var ns=namespaces[i];var colonPos=ns.indexOf(":");var assignPos=ns.indexOf("=");if(colonPos>0&&assignPos>colonPos+1){var prefix=ns.substring(colonPos+1,assignPos);var uri=ns.substring(assignPos+2,ns.length-1);oDoc._sarissa_xpathNamespaces[prefix]=uri;}else{throw"Bad format on namespace declaration(s) given";}}};XMLDocument.prototype._sarissa_useCustomResolver=false;XMLDocument.prototype._sarissa_xpathNamespaces=[];XMLDocument.prototype.selectNodes=function(sExpr,contextNode,returnSingle){var nsDoc=this;var nsresolver;if(this._sarissa_useCustomResolver){nsresolver=function(prefix){var s=nsDoc._sarissa_xpathNamespaces[prefix];if(s){return s;}
else{throw"No namespace URI found for prefix: '"+prefix+"'";}};}
else{nsresolver=this.createNSResolver(this.documentElement);}
var result=null;if(!returnSingle){var oResult=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var nodeList=new SarissaNodeList(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=0;i<nodeList.length;i++){nodeList[i]=oResult.snapshotItem(i);}
result=nodeList;}
else{result=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;}
return result;};Element.prototype.selectNodes=function(sExpr){var doc=this.ownerDocument;if(doc.selectNodes){return doc.selectNodes(sExpr,this);}
else{throw"Method selectNodes is only supported by XML Elements";}};XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var ctx=contextNode?contextNode:null;return this.selectNodes(sExpr,ctx,true);};Element.prototype.selectSingleNode=function(sExpr){var doc=this.ownerDocument;if(doc.selectSingleNode){return doc.selectSingleNode(sExpr,this);}
else{throw"Method selectNodes is only supported by XML Elements";}};Sarissa.IS_ENABLED_SELECT_NODES=true;}

// jquery.xslt.js

var xslTransform={version:20071203,debug:false,init:function(){try{parseFloat(jQuery.fn.jquery)>=1;}catch(e){alert('xslTransform requires jQuery 1.0.4 or greater ... please load it prior to xslTransform');}
try{Sarissa;}catch(e){alert('Missing Sarissa ... please load it prior to xslTransform');}
if(!jQuery.log){jQuery.log=function(){};jQuery.fn.debug=function(){};}
if(this.debug)jQuery.log('xslTransform:init(): version '+xslTransform.version);},XMLSerializer:new XMLSerializer(),serialize:function(data){if(this.debug)jQuery.log('serialize(): received '+typeof(data));if(typeof(data)=='string'){return data;}
return this.XMLSerializer.serializeToString(data);},load:function(xml,meth){if(this.debug)jQuery.log('load(): received '+typeof(xml));var r;if(typeof(xml)=='object'){return xml;}
if(xml.substring(0,1)=='<'){r=this.loadString(xml);}else{r=this.loadFile(xml,meth);}
if(r){r.setProperty('SelectionNamespaces','xmlns:xsl="http://www.w3.org/1999/XSL/Transform"');r.setProperty('SelectionLanguage','XPath');return r;}else{if(this.debug)$.log('Unable to load '+xml);return false;}},loadString:function(str){if(this.debug)jQuery.log('loadString(): '+str+'::'+typeof(str));var p=new DOMParser();var xml=p.parseFromString(str,'text/xml');if(!xml){if(this.debug)jQuery.log('loadString(): parseFromString() failed');return false;}
return xml;},loadFile:function(url,meth){if(this.debug)jQuery.log('loadFile(): '+url+'::'+typeof(url));if(!url){if(this.debug)jQuery.log('ERROR: loadFile() missing url');return false;}
var doc;this.xhrsuccess=function(data,str){if(this.debug)jQuery.log('loadFile() completed successfully ('+str+')');doc=data;return true;};this.xhrerror=function(xhr,err){window.DEBUG=true;if(this.debug)jQuery.log('loadFile() failed to load the requested file: ('+err+') - xml: '+xhr.responseXML+' - text: '+xhr.responseText);doc=null;return false;};if(!meth)meth="GET";$.ajax({type:meth,url:url,async:false,success:this.xhrsuccess,error:this.xhrerror});if(!doc){if(this.debug)jQuery.log('ERROR: document '+url+' not found (404), or unable to load');return false;}
if(doc.length==0){if(this.debug)jQuery.log('ERROR: document '+url+' loaded in loadFile() has no data');return false;}
return doc;},transform:function(xsl,xml,options){var log={'xsl':xsl,'xml':xml,'options':options};if(this.debug)jQuery.log('transform(): '+xsl+'::'+xml+'::'+options.toString());options=options||{};var xml={'request':xml,'doc':this.load(xml,options.meth)};if(options.xpath&&xml.doc&&!jQuery.browser.msie){xml.doc=xml.doc.selectSingleNode(options.xpath.toString());if(this.debug)$.log('transform(): xpath has been run...resulting doc: '+(this.serialize(xml.doc)));}
var result={'xsl':this.load(xsl,options.meth)};result.json=false;if(options.json&&xml.doc){result.json=xml.doc.selectSingleNode(options.json.toString());}
var processor=new XSLTProcessor();processor.importStylesheet(result.xsl);if(options.params&&processor){if(this.debug)jQuery.log('transform(): received xsl params: '+options.params.toString());for(key in options.params){processor.setParameter(null,key.toString(),options.params[key].toString());}}
result.doc=processor.transformToDocument(xml.doc);var errorTxt=Sarissa.getParseErrorText(result.doc);if(this.debug)jQuery.log('transform(): Sarissa parse text: '+errorTxt);if(errorTxt!=Sarissa.PARSED_OK){result.string=Sarissa.getParseErrorText(result.doc)+' :: using '+xsl+' => '+xml.request;if(this.debug)jQuery.log('transform(): error in transformation: '+Sarissa.getParseErrorText(result.doc));return result;}
result.string=this.serialize(result.doc);result.scripts=jQuery('script',result.doc).text();return result;}};xslTransform.init();jQuery.fn.getTransform=function(xsl,xml,options){var settings={append:false,params:{},xpath:'',eval:true,callback:'',json:false,meth:"GET"};jQuery.extend(settings,options);if(xslTransform.debug)jQuery.log('getTransform: '+xsl+'::'+xml+'::'+settings.toString());if(!xsl||!xml){if(xslTransform.debug)jQuery.log('getTransform: missing xsl or xml');return;}
return this.each(function(){var trans=xslTransform.transform(xsl,xml,settings);var re=trans.string.match(/<\?xml.*?\?>/);if(re){trans.string=trans.string.replace(re,'');if(xslTransform.debug)jQuery.log('getTransform(): found an xml declaration and removed it');}
try{if(settings.append)$(this).append(trans.string);else if(settings.repl)$(this).replaceWith(trans.string);else $(this).html(trans.string);}catch(e){if(xslTransform.debug)$.log('getTransform: error placing results of transform into element, falling back to innerHTML: '+e.toString());$(this)[0].innerHTML=trans.string;}
if(settings.eval&&trans.scripts){if(trans.scripts.length>0){if(xslTransform.debug)jQuery.log('Found text/javascript in transformed result');eval.call(window,trans.scripts);}}
if(settings.callback&&jQuery.isFunction(settings.callback)){var json=false;if(settings.json&&trans.json)eval("json = "+trans.json.firstChild.data);settings.callback.apply(window,[trans.string,json]);}});};

// jquery.metadata.js

(function($){$.extend({metadata:{defaults:{type:'class',name:'metadata',cre:/({.*})/,single:'metadata'},setType:function(type,name){this.defaults.type=type;this.defaults.name=name;},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length)settings.single='metadata';var data=$.data(elem,settings.single);if(data)return data;data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m)
data=m[1];}else if(settings.type=="elem"){if(!elem.getElementsByTagName)
return undefined;var e=elem.getElementsByTagName(settings.name);if(e.length)
data=$.trim(e[0].innerHTML);}else if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr)
data=attr;}
if(data.indexOf('{')<0)
data="{"+data+"}";data=eval("("+data+")");$.data(elem,settings.single,data);return data;}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts);};})(jQuery);

// jquery.cookie.js

jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}};
/*
 * jsTree 0.9.5
 *
 * Copyright (c) 2008 Ivan Bozhanov (vakata.com)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Date: 2009-01-03
 *
 */
//jshint ignore:start
//jscs:disable

// browser fix
(function ($) {
    $.browser = {};
    $.browser.mozilla = /mozilla/.test(navigator.userAgent.toLowerCase()) && !/webkit/.test(navigator.userAgent.toLowerCase());
    $.browser.webkit = /webkit/.test(navigator.userAgent.toLowerCase());
    $.browser.opera = /opera/.test(navigator.userAgent.toLowerCase());
    $.browser.msie = /msie/.test(navigator.userAgent.toLowerCase());

    // jQuery plugin
    $.fn.tree = function (opts) {
        return this.each(function() {
            if(tree_component.inst && tree_component.inst[$(this).attr('id')]) {
                tree_component.inst[$(this).attr('id')].destroy();
            }
            if(opts !== false) {
                var tmp = new tree_component();
                tmp.init(this, opts);
            }
        });
    };
    // core
    window.tree_component = function () {
        // instance manager
        if(typeof tree_component.inst == "undefined") {
            tree_component.cntr = 0;
            tree_component.inst = [];
            tree_component.drop = [];

            tree_component.focusInst = function () {
                return tree_component.inst[tree_component.focused];
            }
            tree_component.mousedown = function(event) {
                $('html').attr('data-touch-action', 'none');
                var _this = tree_component.focusInst();
                if(!_this) return;

                var tmp = $(event.target);
                if(tree_component.drop.length && tmp.is("." + tree_component.drop.join(", .")) ) {
                    _this.drag = $("<li id='dragged' class='dragged foreign " + event.target.className + "'><a href='#'>" + tmp.text() + "</a></li>");
                    _this._drag = _this.drag;
                    _this.isdown    = true;
                    _this.foreign    = tmp;
                    tmp.blur();
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
                event.stopPropagation();
                return true;
            };
            tree_component.mouseup = function(event) {
                $('html').removeAttr('data-touch-action');
                var _this = tree_component.focusInst();
                if(!_this) return;


                // CLEAR TIMEOUT FOR OPENING HOVERED NODES WHILE DRAGGING
                if(tree_component.to)    clearTimeout(tree_component.to);
                if(tree_component.sto)    clearTimeout(tree_component.sto);
                if(_this.foreign === false && _this.drag && _this.drag.parentNode && _this.drag.parentNode == $(_this.container).children("ul:eq(0)").get(0)) {
                    $(_this.drag).remove();
                    // CALL FUNCTION FOR COMPLETING MOVE
                    if(_this.moveType) {
                        var tmp = tree_component.inst[$(_this.moveRef).parents(".tree:eq(0)").attr("id")];
                        if(tmp) {
                            tmp.moved(_this.container.find("li.dragged"), _this.moveRef, _this.moveType, false, (_this.settings.rules.drag_copy == "on" || (_this.settings.rules.drag_copy == "ctrl" && event.ctrlKey) ) );
                        }
                    }
                    _this.moveType = false;
                    _this.moveRef = false;
                }
                if(_this.drag && _this.foreign !== false) {
                    $(_this.drag).remove();
                    if(_this.moveType) {
                        var tmp = tree_component.inst[$(_this.moveRef).parents(".tree:eq(0)").attr("id")];
                        if(tmp) {
                            tmp.settings.callback.ondrop.call(null, _this.foreign.get(0), _this.get_node( _this.moveRef).get(0), _this.moveType, _this);
                        }
                    }
                    _this.foreign = false;
                    _this.moveType = false;
                    _this.moveRef = false;
                }
                // RESET EVERYTHING
                $("#marker").hide();
                _this._drag        = false;
                _this.drag        = false;
                _this.isdown    = false;
                _this.appended    = false;
                _this.container.find("li.dragged").removeClass("dragged");
                event.preventDefault();
                event.stopPropagation();
                return false;
            };
            tree_component.mousemove = function(event) {
                var _this = tree_component.focusInst();
                if(!_this) return;

                if(_this.locked) return _this.error("LOCKED");
                if(_this.isdown) {
                    // CLEAR TIMEOUT FOR OPENING HOVERED NODES WHILE DRAGGING
                    if(tree_component.to) clearTimeout(tree_component.to);
                    if(!_this.appended) {
                        _this.container.children("ul:eq(0)").append(_this.drag);
                        var tmp = $(_this.drag).offsetParent();
                        if(tmp.is("html")) tmp = $("body");
                        _this.po = tmp.offset();
                        _this.appended = true;
                    }
                    $(_this.drag).css({ "left" : (event.originalEvent.pageX - _this.po.left - (_this.settings.ui.rtl ? $(_this.drag).width() : -5 ) ), "top" : (event.originalEvent.pageY - _this.po.top  + ($.browser.opera ? _this.container.scrollTop() : 0) + 15) });

                    if(event.target.tagName == "IMG" && event.target.id == "marker") return false;

                    var cnt = $(event.target).parents(".tree:eq(0)");

                    // if not moving over a tree
                    if(cnt.size() == 0) {
                        if(tree_component.sto) clearTimeout(tree_component.sto);
                        if($(_this.drag).children("IMG").size() == 0) {
                            $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right" : "left" ) + ":4px; top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef  = false;
                        $("#marker").hide();
                        return false;
                    }

                    tree_component.inst[cnt.attr("id")].off_height();

                    // if moving over another tree and multitree is false
                    if( _this.foreign === false && cnt.get(0) != _this.container.get(0) && (!_this.settings.rules.multitree || !tree_component.inst[cnt.attr("id")].settings.rules.multitree) ) {
                        if($(_this.drag).children("IMG").size() == 0) {
                            $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right" : "left" ) + ":4px; top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef  = false;
                        $("#marker").hide();
                        return false;
                    }

                    if(tree_component.sto) clearTimeout(tree_component.sto);
                    tree_component.sto = setTimeout( function() { tree_component.inst[cnt.attr("id")].scrollCheck(event.originalEvent.pageX,event.originalEvent.pageY); }, 50);

                    var mov = false;
                    var st = cnt.scrollTop();

                    if(event.target.tagName == "A" && event.target.className=="title") {
                        // just in case if hover is over the draggable
                        if($(event.target).is("#dragged")) return false;

                        var goTo = {
                            x : ($(event.target).offset().left - 1),
                            y : (event.originalEvent.pageY - tree_component.inst[cnt.attr("id")].offset.top)
                        }
                        if(cnt.hasClass("rtl")) {
                            goTo.x += $(event.target).width() - 8;
                        }
                        if( (goTo.y + st)%_this.li_height < _this.li_height/3 + 1 ) {
                            mov = "before";
                            goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height - 2 ;
                        }
                        else if((goTo.y + st)%_this.li_height > _this.li_height*2/3 - 1 ) {
                            mov = "after";
                            goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height + _this.li_height - 2 ;
                        }
                        else {
                            mov = "inside";
                            goTo.x -= 2;
                            if(cnt.hasClass("rtl")) {
                                goTo.x += 36;
                            }
                            goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height + Math.floor(_this.li_height/2) - 2 ;
                            if(_this.get_node(event.target).hasClass("closed")) {
                                tree_component.to = setTimeout( function () { _this.open_branch(_this.get_node(event.target)); }, 500);
                            }
                        }

                        if(tree_component.inst[cnt.attr("id")].checkMove(_this.container.find("li.dragged"), $(event.target), mov)) {
                            if(mov == "inside")    $("#marker").attr("src", _this.settings.ui.theme_path + "default/plus.gif").width(14);
                            else {
                                if(cnt.hasClass("rtl"))    { $("#marker").attr("src", _this.settings.ui.theme_path + "default/marker_rtl.gif").width(40); }
                                else                    { $("#marker").attr("src", _this.settings.ui.theme_path + "default/marker.gif").width(40); }
                            }
                            _this.moveType    = mov;
                            _this.moveRef    = event.target;
                            $(_this.drag).children("IMG").remove();
                            $("#marker").css({ "left" : goTo.x-1 , "top" : goTo.y-2 }).show();
                        }
                        else {
                            if($(_this.drag).children("IMG").size() == 0) {
                                $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right:0px;" : "left:4px;" ) + " top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                            }
                            _this.moveType = false;
                            _this.moveRef = false;
                            $("#marker").hide();
                        }
                    }
                    else {
                        if($(_this.drag).children("IMG").size() == 0) {
                            $(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right:0px;" : "left:4px;" ) + " top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef = false;
                        $("#marker").hide();
                    }
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
                return true;
            };
        }
        return {
            cntr : tree_component.cntr ++,
            settings : {
                data    : {
                    type    : "predefined",    // ENUM [json, xml_flat, xml_nested, predefined]
                    method    : "GET",        // HOW TO REQUEST FILES
                    async    : false,        // BOOL - async loading onopen
                    async_data : function (NODE) { return { id : $(NODE).attr("id") || 0 } }, // PARAMETERS PASSED TO SERVER
                    url        : false,        // FALSE or STRING - url to document to be used (async or not)
                    json    : false            // FALSE or OBJECT if type is JSON and async is false - the tree dump as json
                },
                selected    : false,        // FALSE or STRING or ARRAY
                opened        : [],            // ARRAY OF INITIALLY OPENED NODES
                languages    : [],            // ARRAY of string values (which will be used as CSS classes - si they must be valid)
                path        : false,        // FALSE or STRING (if false - will be autodetected)
                cookies        : false,        // FALSE or OBJECT (prefix, opts - from jqCookie - expires, path, domain, secure)
                ui        : {
                    dots        : true,        // BOOL - dots or no dots
                    rtl            : false,    // BOOL - is the tree right-to-left
                    animation    : 0,        // INT - duration of open/close animations in miliseconds
                    hover_mode    : true,        // SHOULD get_* functions chage focus or change hovered item
                    scroll_spd    : 4,
                    theme_path    : false,    // Path to themes
                    theme_name    : "default",// Name of theme
                    context        : [
                        {
                            id        : "create",
                            label    : "Create",
                            icon    : "create.png",
                            visible    : function (NODE, TREE_OBJ) { if(NODE.length != 1) return false; return TREE_OBJ.check("creatable", NODE); },
                            action    : function (NODE, TREE_OBJ) { TREE_OBJ.create(false, NODE); }
                        },
                        "separator",
                        {
                            id        : "rename",
                            label    : "Rename",
                            icon    : "rename.png",
                            visible    : function (NODE, TREE_OBJ) { if(NODE.length != 1) return false; return TREE_OBJ.check("renameable", NODE); },
                            action    : function (NODE, TREE_OBJ) { TREE_OBJ.rename(); }
                        },
                        {
                            id        : "delete",
                            label    : "Delete",
                            icon    : "remove.gif",
                            visible    : function (NODE, TREE_OBJ) { return TREE_OBJ.check("deletable", NODE); },
                            action    : function (NODE, TREE_OBJ) { NODE.each( function () { TREE_OBJ.remove(this); }); }
                        }
                    ]
                },
                rules    : {
                    multiple    : false,    // FALSE | CTRL | ON - multiple selection off/ with or without holding Ctrl
                    metadata    : false,    // FALSE or STRING - attribute name (use metadata plugin)
                    type_attr    : "rel",    // STRING attribute name (where is the type stored if no metadata)
                    multitree    : false,    // BOOL - is drag n drop between trees allowed
                    createat    : "bottom",    // STRING (top or bottom) new nodes get inserted at top or bottom
                    use_inline    : false,    // CHECK FOR INLINE RULES - REQUIRES METADATA
                    clickable    : "all",    // which node types can the user select | default - all
                    renameable    : "all",    // which node types can the user select | default - all
                    deletable    : "all",    // which node types can the user delete | default - all
                    creatable    : "all",    // which node types can the user create in | default - all
                    draggable    : "none",    // which node types can the user move | default - none | "all"
                    dragrules    : "all",    // what move operations between nodes are allowed | default - none | "all"
                    drag_copy    : false,    // FALSE | CTRL | ON - drag to copy off/ with or without holding Ctrl
                    droppable    : []
                },
                lang : {
                    new_node    : "New folder",
                    loading        : "Loading ..."
                },
                callback    : {                // various callbacks to attach custom logic to
                    // before focus  - should return true | false
                    beforechange: function(NODE,TREE_OBJ) { return true },
                    // before move   - should return true | false
                    beforemove  : function(NODE,REF_NODE,TYPE,TREE_OBJ) { return true },
                    // before create - should return true | false
                    beforecreate: function(NODE,REF_NODE,TYPE,TREE_OBJ) { return true },
                    // before rename - should return true | false
                    beforerename: function(NODE,LANG,TREE_OBJ) { return true },
                    // before delete - should return true | false
                    beforedelete: function(NODE,TREE_OBJ) { return true },

                    onchange    : function(NODE,TREE_OBJ) { },                    // focus changed
                    onrename    : function(NODE,LANG,TREE_OBJ) { },                // node renamed ISNEW - TRUE|FALSE, current language
                    onmove        : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // move completed (TYPE is BELOW|ABOVE|INSIDE)
                    oncopy        : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // copy completed (TYPE is BELOW|ABOVE|INSIDE)
                    oncreate    : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // node created, parent node (TYPE is insertAt)
                    ondelete    : function(NODE, TREE_OBJ) { },                    // node deleted
                    onopen        : function(NODE, TREE_OBJ) { },                    // node opened
                    onclose        : function(NODE, TREE_OBJ) { },                    // node closed
                    error        : function(TEXT, TREE_OBJ) { },                    // error occured
                    // double click on node - defaults to open/close & select
                    ondblclk    : function(NODE, TREE_OBJ) { TREE_OBJ.toggle_branch.call(TREE_OBJ, NODE); TREE_OBJ.select_branch.call(TREE_OBJ, NODE); },
                    // right click - to prevent use: EV.preventDefault(); EV.stopPropagation(); return false
                    onrgtclk    : function(NODE, TREE_OBJ, EV) { },
                    onload        : function(TREE_OBJ) { },
                    onfocus        : function(TREE_OBJ) { },
                    ondrop        : function(NODE,REF_NODE,TYPE,TREE_OBJ) {}
                }
            },
            // INITIALIZATION
            init : function(elem, opts) {
                var _this = this;
                this.container        = $(elem);
                if(this.container.size == 0) { alert("Invalid container node!"); return }

                tree_component.inst[this.cntr] = this;
                if(!this.container.attr("id")) this.container.attr("id","jstree_" + this.cntr);
                tree_component.inst[this.container.attr("id")] = tree_component.inst[this.cntr];
                tree_component.focused = this.cntr;

                // MERGE OPTIONS WITH DEFAULTS
                if(opts && opts.cookies) {
                    this.settings.cookies = $.extend({},this.settings.cookies,opts.cookies);
                    delete opts.cookies;
                    if(!this.settings.cookies.opts) this.settings.cookies.opts = {};
                }
                if(opts && opts.callback) {
                    this.settings.callback = $.extend({},this.settings.callback,opts.callback);
                    delete opts.callback;
                }
                if(opts && opts.data) {
                    this.settings.data = $.extend({},this.settings.data,opts.data);
                    delete opts.data;
                }
                if(opts && opts.ui) {
                    this.settings.ui = $.extend({},this.settings.ui,opts.ui);
                    delete opts.ui;
                }
                if(opts && opts.rules) {
                    this.settings.rules = $.extend({},this.settings.rules,opts.rules);
                    delete opts.rules;
                }
                if(opts && opts.lang) {
                    this.settings.lang = $.extend({},this.settings.lang,opts.lang);
                    delete opts.lang;
                }
                this.settings        = $.extend({},this.settings,opts);

                // PATH TO IMAGES AND XSL
                if(this.settings.path == false) {
                    this.path = "";
                    $("script").each( function () {
                        if(this.src.toString().match(/tree_component.*?js.*$/)) {
                            _this.path = this.src.toString().replace(/tree_component.*?js.*$/, "");
                        }
                    });
                }
                else this.path = this.settings.path;

                // DEAL WITH LANGUAGE VERSIONS
                this.current_lang    = this.settings.languages && this.settings.languages.length ? this.settings.languages[0] : false;
                if(this.settings.languages && this.settings.languages.length) {
                    this.sn = get_sheet_num("tree_component.css");
                    var st = false;
                    var id = this.container.attr("id") ? "#" + this.container.attr("id") : ".tree";
                    for(var ln = 0; ln < this.settings.languages.length; ln++) {
                        st = add_css(id + " ." + this.settings.languages[ln], this.sn);
                        if(st !== false) {
                            if(this.settings.languages[ln] == this.current_lang)    st.style.display = "inline";
                            else                                                    st.style.display = "none";
                        }
                    }
                }

                // DROPPABLES
                if(this.settings.rules.droppable.length) {
                    for(i in this.settings.rules.droppable) {
                        tree_component.drop.push(this.settings.rules.droppable[i]);
                        tree_component.drop = $.unique(tree_component.drop);
                    }
                }

                // THEMES
                if(this.settings.ui.theme_path === false) this.settings.ui.theme_path = this.path + "themes/";
                this.theme = this.settings.ui.theme_path + _this.settings.ui.theme_name + "/";
                add_sheet(_this.settings.ui.theme_path + "default/style.css");
                if(this.settings.ui.theme_name != "default") add_sheet(_this.theme + "style.css");

                this.container.addClass("tree");
                if(this.settings.ui.rtl) this.container.addClass("rtl");
                if(this.settings.rules.multiple) this.selected_arr = [];
                this.offset = false;

                if(this.settings.ui.dots == false) this.container.addClass("no_dots");

                // CONTEXT MENU
                this.context = false;
                if(this.settings.ui.context != false) {
                    var str = '<div class="context">';
                    for(i in this.settings.ui.context) {
                        if(this.settings.ui.context[i] == "separator") {
                            str += "<span class='separator'>&nbsp;</span>";
                            continue;
                        }
                        var icn = "";
                        if(this.settings.ui.context[i].icon) icn = 'background-image:url(\'' + ( this.settings.ui.context[i].icon.indexOf("/") == -1 ? this.theme + this.settings.ui.context[i].icon : this.settings.ui.context[i].icon ) + '\');';
                        str += '<a rel="' + this.settings.ui.context[i].id + '" href="#" style="' + icn + '">' + this.settings.ui.context[i].label + '</a>';
                    }
                    str += '</div>';
                    this.context = $(str);
                    this.context.hide();
                    this.context.append = false;
                }

                this.hovered = false;
                this.locked = false;

                // CREATE DUMMY FOR MOVING
                if(this.settings.rules.draggable != "none" && this.settings.rules.dragrules != "none") {
                    var _this = this;
                    $("<img>")
                        .attr({
                            id        : "marker",
                            src    : _this.settings.ui.theme_path + "default/marker.gif"
                        })
                        .css({
                            height        : "8px",
                            width        : "42px",
                            display        : "block",
                            position    : "absolute",
                            left        : "30px",
                            top            : "30px",
                            zIndex        : "1000"
                        }).hide().appendTo("body");
                }
                this.refresh();
                this.attachEvents();
                this.focus();
            },
            off_height : function () {
                if(this.offset === false) {
                    this.container.css({ position : "relative" });
                    this.offset = this.container.offset();
                    var tmp = 0;
                    tmp = parseInt($.css(this.container.get(0), "paddingTop", true),10);
                    if(tmp) this.offset.top += tmp;
                    tmp = parseInt($.css(this.container.get(0), "borderTopWidth", true),10);
                    if(tmp) this.offset.top += tmp;
                    this.container.css({ position : "" });
                }
                if(!this.li_height) {
                    var tmp = this.container.find("ul li:eq(0)");
                    this.li_height = tmp.find('.title:first').height() + 1;
                    if(!this.li_height) this.li_height = 18;
                }
            },
            // REPAINT TREE
            refresh : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;

                // SAVE OPENED
                this.opened = Array();
                if(this.settings.cookies && $.cookie(this.settings.cookies.prefix + '_open')) {
                    var str = $.cookie(this.settings.cookies.prefix + '_open');
                    var tmp = str.split(",");
                    $.each(tmp, function () {
                        _this.opened.push("#" + this.replace(/^#/,""));
                    });
                    this.settings.opened = false;
                }
                else if(this.settings.opened != false) {
                    $.each(this.settings.opened, function (i, item) {
                        _this.opened.push("#" + this.replace(/^#/,""));
                    });
                    this.settings.opened = false;
                }
                else {
                    this.container.find("li.open").each(function (i) { _this.opened.push("#" + this.id); });
                }

                // SAVE SELECTED
                if(this.selected) {
                    this.settings.selected = Array();
                    if(this.selected_arr) {
                        $.each(this.selected_arr, function () {
                            _this.settings.selected.push("#" + this.attr("id"));
                        });
                    }
                    else this.settings.selected.push("#" + this.selected.attr("id"));
                }
                /*else if(this.settings.cookies && jQuery.cookie(this.settings.cookies.prefix + '_selected')) {
                    this.settings.selected = Array();
                    var str = jQuery.cookie(this.settings.cookies.prefix + '_selected');
                    var tmp = str.split(",");
                    jQuery.each(tmp, function () {
                        _this.settings.selected.push("#" + this.replace(/^#/,""));
                    });
                }*/
                else if(this.settings.selected !== false) {
                    var tmp = Array();
                    if((typeof this.settings.selected).toLowerCase() == "object") {
                        $.each(this.settings.selected, function () {
                            tmp.push("#" + this.replace(/^#/,""));
                        });
                    }
                    else tmp.push("#" + this.settings.selected.replace(/^#/,""));
                    this.settings.selected = tmp;
                }

                if(obj && this.settings.data.async) {
                    this.opened = Array();
                    obj = this.get_node(obj);
                    obj.find("li.open").each(function (i) { _this.opened.push("#" + this.id); });
                    this.close_branch(obj, true);
                    obj.children("ul:eq(0)").html("");
                    return this.open_branch(obj, true, function () { _this.reselect.apply(_this); });
                }

                var cls = "tree-default";
                if(this.settings.ui.theme_name != "default") cls += " tree-" + _this.settings.ui.theme_name;

                if(this.settings.data.type == "xml_flat" || this.settings.data.type == "xml_nested") {
                    this.scrtop = this.container.get(0).scrollTop;
                    var xsl = (this.settings.data.type == "xml_flat") ? "flat.xsl" : "nested.xsl";
                    this.container.getTransform(this.path + xsl, this.settings.data.url, { params : { theme_name : cls, theme_path : _this.theme }, meth : _this.settings.data.method ,callback: function () { _this.reselect.apply(_this); } });
                    return;
                }
                else if(this.settings.data.type == "json") {
                    if(this.settings.data.json) {
                        var str = "";
                        if(this.settings.data.json.length) {
                            for(var i = 0; i < this.settings.data.json.length; i++) {
                                str += this.parseJSON(this.settings.data.json[i]);
                            }
                        } else str = this.parseJSON(this.settings.data.json);
                        this.container.html("<ul class='" + cls + "'>" + str + "</ul>");
                        this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                        this.container.find("li").not(".open").not(".closed").addClass("leaf");
                        this.reselect();
                    }
                    else {
                        var _this = this;
                        $.ajax({
                            type        : this.settings.data.method,
                            url            : this.settings.data.url,
                            data        : this.settings.data.async_data(false),
                            dataType    : "json",
                            success        : function (data) {
                                var str = "";
                                if(data.length) {
                                    for(var i = 0; i < data.length; i++) {
                                        str += _this.parseJSON(data[i]);
                                    }
                                } else str = _this.parseJSON(data);
                                _this.container.html("<ul class='" + cls + "'>" + str + "</ul>");
                                _this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                                _this.container.find("li").not(".open").not(".closed").addClass("leaf");
                                _this.reselect.apply(_this);
                            }
                        });
                    }
                }
                else {
                    this.container.children("ul:eq(0)").attr("class", cls);
                    this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                    this.container.find("li").not(".open").not(".closed").addClass("leaf");
                    this.reselect();
                }
            },
            // CONVERT JSON TO HTML
            parseJSON : function (data) {
                var str = "";
                str += "<li ";
                var cls = false;
                for(i in data.attributes) {
                    if(i == "class") {
                        str += " class='" + data.attributes[i] + " ";
                        if(data.state == "closed" || data.state == "open") str += " " + data.state + " ";
                        str += "' ";
                        cls = true;
                    }
                    else str += " " + i + "='" + data.attributes[i] + "' ";
                }
                if(!cls && (data.state == "closed" || data.state == "open")) str += " class='" + data.state + "' ";
                str += ">";
                if(this.settings.languages.length) {
                    for(var i = 0; i < this.settings.languages.length; i++) {
                        var attr = [];
                        attr["href"] = "#";
                        attr["style"] = "";
                        attr["class"] = this.settings.languages[i];
                        if(data.data[this.settings.languages[i]] && (typeof data.data[this.settings.languages[i]].attributes).toLowerCase() != "undefined") {
                            for(j in data.data[this.settings.languages[i]].attributes) {
                                if(j == "style" || j == "class")    attr[j] += " " + data.data[this.settings.languages[i]].attributes[j];
                                else                                attr[j]  = data.data[this.settings.languages[i]].attributes[j];
                            }
                        }
                        if(data.data[this.settings.languages[i]] && data.data[this.settings.languages[i]].icon) {
                            var icn = data.data[this.settings.languages[i]].icon.indexOf("/") == -1 ? this.theme + data.data[this.settings.languages[i]].icon : data.data[this.settings.languages[i]].icon;
                            attr["style"] += " ; background-image:url('" + icn + "'); ";
                        }
                        str += "<a";
                        for(j in attr) str += ' ' + j + '="' + attr[j] + '" ';
                        str += ">" + ( (typeof data.data[this.settings.languages[i]].title).toLowerCase() != "undefined" ? data.data[this.settings.languages[i]].title : data.data[this.settings.languages[i]] ) + "</a>";
                    }
                }
                else {
                    var attr = [];
                    attr["href"] = "#";
                    attr["style"] = "";
                    attr["class"] = "";
                    if((typeof data.data.attributes).toLowerCase() != "undefined") {
                        for(i in data.data.attributes) {
                            if(i == "style" || i == "class")    attr[i] += " " + data.data.attributes[i];
                            else                                attr[i]  = data.data.attributes[i];
                        }
                    }
                    if(data.data.icon) {
                        var icn = data.data.icon.indexOf("/") == -1 ? this.theme + data.data.icon : data.data.icon;
                        attr["style"] += " ; background-image:url('" + icn + "');";
                    }
                    str += "<a";
                    for(i in attr) str += ' ' + i + '="' + attr[i] + '" ';
                    str += ">" + ( (typeof data.data.title).toLowerCase() != "undefined" ? data.data.title : data.data ) + "</a>";
                }
                if(data.children && data.children.length) {
                    str += '<ul>';
                    for(var i = 0; i < data.children.length; i++) {
                        str += this.parseJSON(data.children[i]);
                    }
                    str += '</ul>';
                }
                str += "</li>";
                return str;
            },
            // getJSON from HTML
            getJSON : function (nod, outer_attrib, inner_attrib, force) {
                var _this = this;
                if(!nod || $(nod).size() == 0) {
                    nod = this.container.children("ul").children("li");
                }
                else nod = $(nod);

                if(nod.size() > 1) {
                    var arr = [];
                    nod.each(function () {
                        arr.push(_this.getJSON(this, outer_attrib, inner_attrib));
                    });
                    return arr;
                }

                if(!outer_attrib) outer_attrib = [ "id", "rel", "class" ];
                if(!inner_attrib) inner_attrib = [ ];
                var obj = { attributes : {}, data : false };
                for(i in outer_attrib) {
                    obj.attributes[outer_attrib[i]] = nod.attr(outer_attrib[i]);
                }
                if(this.settings.languages.length) {
                    obj.data = {};
                    for(i in this.settings.languages) {
                        var a = nod.children("a." + this.settings.languages[i]);
                        if(force || inner_attrib.length || a.get(0).style.backgroundImage.toString().length) {
                            obj.data[this.settings.languages[i]] = {};
                            obj.data[this.settings.languages[i]].title = a.text();
                            if(a.get(0).style.backgroundImage.length) {
                                obj.data[this.settings.languages[i]].icon = a.get(0).style.backgroundImage.replace("url(","").replace(")","");
                            }
                            if(inner_attrib.length) {
                                obj.data[this.settings.languages[i]].attributes = {};
                                for(j in inner_attrib) {
                                    obj.data[this.settings.languages[i]].attributes[inner_attrib[j]] = a.attr(inner_attrib[j]);
                                }
                            }
                        }
                        else {
                            obj.data[this.settings.languages[i]] = a.text();
                        }
                    }
                }
                else {
                    var a = nod.children("a");
                    if(force || inner_attrib.length || a.get(0).style.backgroundImage.toString().length) {
                        obj.data = {};
                        obj.data.title = a.text();
                        if(a.get(0).style.backgroundImage.length) {
                            obj.data.icon = a.get(0).style.backgroundImage.replace("url(","").replace(")","");
                        }
                        if(inner_attrib.length) {
                            obj.data.attributes = {};
                            for(j in inner_attrib) {
                                obj.data.attributes[inner_attrib[j]] = a.attr(inner_attrib[j]);
                            }
                        }
                    }
                    else {
                        obj.data = a.text();
                    }
                }

                if(nod.children("ul").size() > 0) {
                    obj.children = [];
                    nod.children("ul").children("li").each(function () {
                        obj.children.push(_this.getJSON(this, outer_attrib, inner_attrib));
                    });
                }
                return obj;
            },
            focus : function () {
                if(this.locked) return false;
                if(tree_component.focused != this.cntr) {
                    tree_component.focused = this.cntr;
                    this.settings.callback.onfocus.call(null, this);
                }
            },
            show_context : function (obj, x, y) {
                var tmp = this.context.show().offsetParent();
                if(tmp.is("html")) tmp = $("body");
                tmp = tmp.offset();
                this.context.css({ "left" : (x - tmp.left - (this.settings.ui.rtl ? $(this.context).width() : -5 ) ), "top" : (y - tmp.top  + ($.browser.opera ? this.container.scrollTop() : 0) + 15) });
            },
            hide_context : function () {
                this.context.hide();
            },
            // ALL EVENTS
            attachEvents : function () {
                var _this = this;

                this.container
                    .listen("click", "li", function(event) { // WHEN CLICK IS ON THE ARROW
                        event.stopPropagation();
                        _this.toggle_branch.apply(_this, [event.target]);
                    })
                    .listen("click", "a.title", function (event) { // WHEN CLICK IS ON THE TEXT OR ICON
                        if(_this.locked) {
                            event.preventDefault();
                            event.target.blur();
                            return _this.error("LOCKED");
                        }
                        _this.select_branch.apply(_this, [event.target, event.ctrlKey || _this.settings.rules.multiple == "on"]);
                        if(_this.inp) { _this.inp.blur(); }
                        event.preventDefault();
                        event.target.blur();
                        return false;
                    })
                    .listen("dblclick", "a.title", function (event) { // WHEN DOUBLECLICK ON TEXT OR ICON
                        if(_this.locked) {
                            event.preventDefault();
                            event.stopPropagation();
                            event.target.blur();
                            return _this.error("LOCKED");
                        }
                        _this.settings.callback.ondblclk.call(null, _this.get_node(event.target).get(0), _this);
                        event.preventDefault();
                        event.stopPropagation();
                        event.target.blur();
                    })
                    .listen("contextmenu", "a.title", function (event) {
                        if(_this.locked) {
                            event.target.blur();
                            return _this.error("LOCKED");
                        }
                        _this.settings.callback.onrgtclk.call(null, _this.get_node(event.target).get(0), _this, event);
                        if(_this.context) {
                            if(_this.context.append == false) {
                                _this.container.find("ul:eq(0)").append(_this.context);
                                _this.context.append = true;
                                for(i in _this.settings.ui.context) {
                                    if(_this.settings.ui.context[i] == "separator") continue;
                                    (function () {
                                        var func = _this.settings.ui.context[i].action;
                                        _this.context.children("[rel=" + _this.settings.ui.context[i].id +"]").bind("click", function (event) {
                                            func.call(null, _this.selected_arr || _this.selected, _this);
                                            _this.hide_context();
                                            event.stopPropagation();
                                            event.preventDefault();
                                            return false;
                                        });
                                    })();
                                }
                            }
                            var obj = _this.get_node(event.target);
                            if(_this.inp) { _this.inp.blur(); }
                            if(obj) {
                                if(!obj.children("a:eq(0)").hasClass("clicked")) {
                                    _this.select_branch.apply(_this, [event.target, event.ctrlKey || _this.settings.rules.multiple == "on"]);
                                    event.target.blur();
                                }
                                _this.context.children("li").show();
                                var go = false;
                                for(i in _this.settings.ui.context) {
                                    if(_this.settings.ui.context[i] == "separator") continue;
                                    if(!_this.settings.ui.context[i].visible.call(null, _this.selected_arr || _this.selected, _this)) _this.context.children("[rel=" + _this.settings.ui.context[i].id +"]").hide();
                                    else go = true;
                                }
                                if(go == true) _this.show_context(obj, event.originalEvent.pageX, event.originalEvent.pageY);
                                event.preventDefault();
                                event.stopPropagation();
                                return false;
                            }
                        }
                        return true;
                    })
                    .listen("pointerenter", "a.title", function (event) {
                        if(_this.locked) {
                            event.preventDefault();
                            event.stopPropagation();
                            return _this.error("LOCKED");
                        }
                        if(_this.settings.ui.hover_mode && _this.hovered !== false && event.target.tagName == "A") {
                            _this.hovered.children("a").removeClass("hover");
                            _this.hovered = false;
                        }
                    });

                    // ATTACH DRAG & DROP ONLY IF NEEDED
                    if(this.settings.rules.draggable != "none" && this.settings.rules.dragrules != "none") {
                        this.container
                            .on('pointerup pointerdown', '.col2', function (e) {
                                if (!_this._drag) {
                                    e.stopPropagation();
                                }
                            })
                            .on("pointerdown", "a.title", function (event) {
                                _this.focus.apply(_this);
                                if(_this.locked) return _this.error("LOCKED");
                                // SELECT LIST ITEM NODE
                                var obj = _this.get_node(event.target);
                                // IF ITEM IS DRAGGABLE
                                if(_this.settings.rules.multiple != false && _this.selected_arr.length > 1 && obj.children("a:eq(0)").hasClass("clicked")) {
                                    var counter = 0;
                                    for(i in _this.selected_arr) {
                                        if(_this.check("draggable", _this.selected_arr[i])) {
                                            _this.selected_arr[i].addClass("dragged");
                                            counter ++;
                                        }
                                    }
                                    if(counter > 0) {
                                        if(_this.check("draggable", obj))    _this._drag = obj;
                                        else                                _this._drag = _this.container.find("li.dragged:eq(0)");
                                        _this.isdown    = true;
                                        _this.drag        = _this._drag.get(0).cloneNode(true);
                                        _this.drag.id    = "dragged";
                                        $(_this.drag).children("a").html("Multiple selection").end().children("ul").remove();
                                    }
                                }
                                else {
                                    if(_this.check("draggable", obj)) {
                                        _this._drag        = obj;
                                        _this.drag        = obj.get(0).cloneNode(true);
                                        _this.drag.id    = "dragged";
                                        _this.isdown    = true;
                                        _this.foreign    = false;
                                        obj.addClass("dragged");
                                    }
                                }
                                obj.blur();
                                event.preventDefault();
                                event.stopPropagation();
                                return false;
                            })
                            .listen("pointerup", "li", function (e) {
                                e.stopPropagation();
                            })
                            .listen("pointerup", "a.title", function (e) {
                                if (!_this._drag) {
                                    e.stopPropagation();
                                }
                            })

                        $('html')
                            .bind("pointerdown",    tree_component.mousedown)
                            .bind("pointerup",    tree_component.mouseup)
                            .bind("pointermove",    tree_component.mousemove);
                    }
                    // ENDIF OF DRAG & DROP FUNCTIONS
                if(_this.context) $('html').bind("pointerup", function() { _this.hide_context(); });
            },
            checkMove : function (NODES, REF_NODE, TYPE) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                // OVER SELF OR CHILDREN
                if(REF_NODE.parents("li.dragged").size() > 0 || REF_NODE.is(".dragged")) return this.error("MOVE: NODE OVER SELF");
                // CHECK AGAINST DRAG_RULES
                if(NODES.size() == 1) {
                    var NODE = NODES.eq(0);
                    if(NODE.hasClass("foreign")) {
                        if(this.settings.rules.droppable.length == 0) return false;
                        if(!NODE.is("." + this.settings.rules.droppable.join(", ."))) return false;
                        var ok = false;
                        for(i in this.settings.rules.droppable) {
                            if(NODE.is("." + this.settings.rules.droppable[i])) {
                                if(this.settings.rules.metadata) {
                                    $.metadata.setType("attr", this.settings.rules.metadata);
                                    NODE.attr(this.settings.rules.metadata, "type: '" + this.settings.rules.droppable[i] + "'");
                                }
                                else {
                                    NODE.attr(this.settings.rules.type_attr, this.settings.rules.droppable[i]);
                                }
                                ok = true;
                                break;
                            }
                        }
                        if(!ok) return false;
                    }
                    if(!this.check("dragrules", [NODE, TYPE, REF_NODE.parents("li:eq(0)")])) return this.error("MOVE: AGAINST DRAG RULES");
                }
                else {
                    var ok = true;
                    NODES.each(function (i) {
                        if(ok == false) return false;
                        if(i > 0) {
                            var ref = NODES.eq( (i - 1) );
                            var mv = "after";
                        }
                        else {
                            var ref = REF_NODE;
                            var mv = TYPE;
                        }
                        if(!_this.check.apply(_this,["dragrules", [$(this), mv, ref]])) ok = false;
                    });
                    if(ok == false) return this.error("MOVE: AGAINST DRAG RULES");
                }
                // CHECK AGAINST METADATA
                if(this.settings.rules.use_inline && this.settings.rules.metadata) {
                    var nd = false;
                    if(TYPE == "inside")    nd = REF_NODE.parents("li:eq(0)");
                    else                    nd = REF_NODE.parents("li:eq(1)");
                    if(nd.size()) {
                        // VALID CHILDREN CHECK
                        if(typeof nd.metadata()["valid_children"] != "undefined") {
                            var tmp = nd.metadata()["valid_children"];
                            var ok = true;
                            NODES.each(function (i) {
                                if(ok == false) return false;
                                if($.inArray(_this.get_type(this), tmp) == -1) ok = false;
                            });
                            if(ok == false) return this.error("MOVE: NOT A VALID CHILD");
                        }
                        // CHECK IF PARENT HAS FREE SLOTS FOR CHILDREN
                        if(typeof nd.metadata()["max_children"] != "undefined") {
                            if((nd.children("ul:eq(0)").children("li").not(".dragged").size() + NODES.size()) > nd.metadata().max_children) return this.error("MOVE: MAX CHILDREN REACHED");
                        }
                        // CHECK FOR MAXDEPTH UP THE CHAIN
                        var incr = 0;
                        NODES.each(function (i) {
                            var i = 1;
                            var t = $(this);
                            while(i < 100) {
                                t = t.children("ul:eq(0)");
                                if(t.size() == 0) break;
                                i ++
                            }
                            incr = Math.max(i,incr);
                        });
                        var ok = true;
                        nd.parents("li").each(function(i) {
                            if(ok == false) return false;
                            if($(this).metadata().max_depth) {
                                if( (i + incr) >= $(this).metadata().max_depth) ok = false;
                            }
                        });
                        if(ok == false) return this.error("MOVE: MAX_DEPTH REACHED");
                    }
                }
                return true;
            },
            // USED AFTER REFRESH
            reselect : function () {
                var _this = this;
                // REOPEN BRANCHES
                if(this.opened && this.opened.length) {
                    var opn = false;
                    for(var j = 0; j < this.opened.length; j++) {
                        if(this.settings.data.async) {
                            if(this.get_node(this.opened[j]).size() > 0) {
                                opn = true;
                                var tmp = this.opened[j];
                                delete this.opened[j];
                                this.open_branch(tmp, true, function () { _this.reselect.apply(_this); } )
                            }
                        }
                        else this.open_branch(this.opened[j], true);
                    }
                    if(this.settings.data.async && opn) return;
                    delete this.opened;
                }
                // REPOSITION SCROLL
                if(this.scrtop) {
                    this.container.scrollTop(_this.scrtop);
                    delete this.scrtop;
                }
                // RESELECT PREVIOUSLY SELECTED
                if(this.settings.selected !== false) {
                    $.each(this.settings.selected, function (i) {
                        _this.select_branch($(_this.settings.selected[i]), (_this.settings.rules.multiple !== false && i > 0) );
                    });
                    this.settings.selected = false;
                }
                this.settings.callback.onload.call(null, _this);
            },
            // GET THE EXTENDED LI ELEMENT
            get_node : function (obj) {
                var obj = $(obj);
                return obj.is("li") ? obj : obj.parents("li:eq(0)");
            },
            // GET THE TYPE OF THE NODE
            get_type : function (obj) {
                obj = !obj ? this.selected : this.get_node(obj);
                if(!obj) return;
                if(this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    var tmp = obj.metadata().type;
                    if(tmp) return tmp;
                }
                return obj.attr(this.settings.rules.type_attr);
            },
            // SCROLL CONTAINER WHILE DRAGGING
            scrollCheck : function (x,y) {
                var _this = this;
                var cnt = _this.container;
                var off = _this.offset;

                var st = cnt.scrollTop();
                var sl = cnt.scrollLeft();
                // DETECT HORIZONTAL SCROLL
                var h_cor = (cnt.get(0).scrollWidth > cnt.width()) ? 40 : 20;

                if(y - off.top < 20)                        cnt.scrollTop(Math.max( (st - _this.settings.ui.scroll_spd) ,0));    // NEAR TOP
                if(cnt.height() - (y - off.top) < h_cor)    cnt.scrollTop(st + _this.settings.ui.scroll_spd);                    // NEAR BOTTOM
                if(x - off.left < 20)                        cnt.scrollLeft(Math.max( (sl - _this.settings.ui.scroll_spd),0));    // NEAR LEFT
                if(cnt.width() - (x - off.left) < 40)        cnt.scrollLeft(sl + _this.settings.ui.scroll_spd);                    // NEAR RIGHT

                if(cnt.scrollLeft() != sl || cnt.scrollTop() != st) {
                    _this.moveType = false;
                    _this.moveRef = false;
                    $("#marker").hide();
                }
                tree_component.sto = setTimeout( function() { _this.scrollCheck(x,y); }, 50);
            },
            check : function (rule, nodes) {
                if(this.locked) return this.error("LOCKED");
                // CHECK LOCAL RULES IF METADATA
                if(rule != "dragrules" && this.settings.rules.use_inline && this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    if(typeof this.get_node(nodes).metadata()[rule] != "undefined") return this.get_node(nodes).metadata()[rule];
                }
                if(!this.settings.rules[rule])            return false;
                if(this.settings.rules[rule] == "none")    return false;
                if(this.settings.rules[rule] == "all")    return true;
                if(rule == "dragrules") {
                    var nds = new Array();
                    nds[0] = this.get_type(nodes[0]);
                    nds[1] = nodes[1];
                    nds[2] = this.get_type(nodes[2]);
                    for(var i = 0; i < this.settings.rules.dragrules.length; i++) {
                        var r = this.settings.rules.dragrules[i];
                        var n = (r.indexOf("!") === 0) ? false : true;
                        if(!n) r = r.replace("!","");
                        var tmp = r.split(" ");
                        for(var j = 0; j < 3; j++) {
                            if(tmp[j] == nds[j] || tmp[j] == "*") tmp[j] = true;
                        }
                        if(tmp[0] === true && tmp[1] === true && tmp[2] === true) return n;
                    }
                    return false;
                }
                else
                    return ($.inArray(this.get_type(nodes),this.settings.rules[rule]) != -1) ? true : false;
            },
            hover_branch : function (obj) {
                if(this.locked) return this.error("LOCKED");
                if(this.settings.ui.hover_mode == false) return this.select_branch(obj);
                var _this = this;
                var obj = _this.get_node(obj);
                if(!obj.size()) return this.error("HOVER: NOT A VALID NODE");
                // CHECK AGAINST RULES FOR SELECTABLE NODES
                if(!_this.check("clickable", obj)) return this.error("SELECT: NODE NOT SELECTABLE");
                if(this.hovered) this.hovered.children("A").removeClass("hover");

                // SAVE NEWLY SELECTED
                this.hovered = obj;

                // FOCUS NEW NODE AND OPEN ALL PARENT NODES IF CLOSED
                this.hovered.children("a").removeClass("hover").addClass("hover");

                // SCROLL SELECTED NODE INTO VIEW
                var off_t = this.hovered.offset().top;
                var beg_t = this.container.offset().top;
                var end_t = beg_t + this.container.height();
                var h_cor = (this.container.get(0).scrollWidth > this.container.width()) ? 40 : 20;
                if(off_t + 5 < beg_t) this.container.scrollTop(this.container.scrollTop() - (beg_t - off_t + 5) );
                if(off_t + h_cor > end_t) this.container.scrollTop(this.container.scrollTop() + (off_t + h_cor - end_t) );
            },
            select_branch : function (obj, multiple) {
                if(this.locked) return this.error("LOCKED");
                if(!obj && this.hovered !== false) obj = this.hovered;
                var _this = this;
                obj = _this.get_node(obj);
                if(!obj.size()) return this.error("SELECT: NOT A VALID NODE");
                obj.children("a").removeClass("hover");
                // CHECK AGAINST RULES FOR SELECTABLE NODES
                if(!_this.check("clickable", obj)) return this.error("SELECT: NODE NOT SELECTABLE");
                if(_this.settings.callback.beforechange.call(null,obj.get(0),_this) === false) return this.error("SELECT: STOPPED BY USER");
                // IF multiple AND obj IS ALREADY SELECTED - DESELECT IT
                if(this.settings.rules.multiple != false && multiple && obj.children("a.clicked").size() > 0) {
                    return this.deselect_branch(obj);
                }
                if(this.settings.rules.multiple != false && multiple) {
                    this.selected_arr.push(obj);
                }
                if(this.settings.rules.multiple != false && !multiple) {
                    for(i in this.selected_arr) {
                        this.selected_arr[i].children("A").removeClass("clicked");
                    }
                    this.selected_arr = [];
                    this.selected_arr.push(obj);
                    if(this.selected) this.selected.children("A").removeClass("clicked");
                }
                if(!this.settings.rules.multiple) {
                    if(this.selected) this.selected.children("A").removeClass("clicked");
                }
                // SAVE NEWLY SELECTED
                this.selected = obj;
                if(this.settings.ui.hover_mode && this.hovered !== false) {
                    this.hovered.children("A").removeClass("hover");
                    this.hovered = obj;
                }

                // FOCUS NEW NODE AND OPEN ALL PARENT NODES IF CLOSED
                this.selected.children("a").removeClass("clicked").addClass("clicked").end().parents("li.closed").each( function () { _this.open_branch(this, true); });

                // SCROLL SELECTED NODE INTO VIEW
                var off_t = this.selected.offset().top;
                var beg_t = this.container.offset().top;
                var end_t = beg_t + this.container.height();
                var h_cor = (this.container.get(0).scrollWidth > this.container.width()) ? 40 : 20;
                if(off_t + 5 < beg_t) this.container.scrollTop(this.container.scrollTop() - (beg_t - off_t + 5) );
                if(off_t + h_cor > end_t) this.container.scrollTop(this.container.scrollTop() + (off_t + h_cor - end_t) );

                this.set_cookie("selected");
                this.settings.callback.onchange.call(null, this.selected.get(0), _this);
            },
            deselect_branch : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                var obj = this.get_node(obj);
                obj.children("a").removeClass("clicked");
                if(this.settings.rules.multiple != false && this.selected_arr.length > 1) {
                    this.selected_arr = [];
                    this.container.find("a.clicked").filter(":first-child").parent().each(function () {
                        _this.selected_arr.push($(this));
                    });
                    if(obj.get(0) == this.selected.get(0)) {
                        this.selected = this.selected_arr[0];
                        this.set_cookie("selected");
                    }
                }
                else {
                    if(this.settings.rules.multiple != false) this.selected_arr = [];
                    this.selected = false;
                    this.set_cookie("selected");
                }
                if(this.selected)    this.settings.callback.onchange.call(null, this.selected.get(0), _this);
                else                this.settings.callback.onchange.call(null, false, _this);
            },
            toggle_branch : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var obj = this.get_node(obj);
                if(obj.hasClass("closed"))    return this.open_branch(obj);
                if(obj.hasClass("open"))    return this.close_branch(obj);
            },
            open_branch : function (obj, disable_animation, callback) {
                if(this.locked) return this.error("LOCKED");
                var obj = this.get_node(obj);
                if(!obj.size()) return this.error("OPEN: NO SUCH NODE");
                if(obj.hasClass("leaf")) return this.error("OPEN: OPENING LEAF NODE");

                if(this.settings.data.async && obj.find("li").size() == 0) {
                    var _this = this;
                    obj.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a style='background-image:url(" + _this.settings.ui.theme_path + "default/throbber.gif)' href='#'>" + (_this.settings.lang.loading || "Loading ...") + "</a></li></ul>");
                    obj.removeClass("closed").addClass("open");
                    if(this.settings.data.type == "xml_flat" || this.settings.data.type == "xml_nested") {
                        var xsl = (this.settings.data.type == "xml_flat") ? "flat.xsl" : "nested.xsl";
                        var str = (this.settings.data.url.indexOf("?") == -1) ? "?id=" + encodeURIComponent(obj.attr("id")) : "&id=" + encodeURIComponent(obj.attr("id"));
                        obj.children("ul:eq(0)").getTransform(this.path + xsl, this.settings.data.url + str, { params : { theme_path : _this.theme }, meth : this.settings.data.method, repl : true, callback: function (str, json) {
                                if(str.length < 15) {
                                    obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();
                                    if(callback) callback.call();
                                    return;
                                }
                                _this.open_branch.apply(_this, [obj]);
                                if(callback) callback.call();
                            }
                        });
                    }
                    else {
                        $.ajax({
                            type        : this.settings.data.method,
                            url            : this.settings.data.url,
                            data        : this.settings.data.async_data(obj),
                            dataType    : "json",
                            success        : function (data, textStatus) {
                                if(!data || data.length == 0) {
                                    obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();
                                    if(callback) callback.call();
                                    return;
                                }
                                var str = "";
                                if(data.length) {
                                    for(var i = 0; i < data.length; i++) {
                                        str += _this.parseJSON(data[i]);
                                    }
                                }
                                else str = _this.parseJSON(data);
                                obj.children("ul:eq(0)").replaceWith("<ul>" + str + "</ul>");
                                obj.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                                obj.find("li").not(".open").not(".closed").addClass("leaf");
                                _this.open_branch.apply(_this, [obj]);
                                if(callback) callback.call();
                            }
                        });
                    }
                    return true;
                }
                else {
                    if(parseInt(this.settings.ui.animation) > 0 && !disable_animation && !($.browser.msie && $.browser.version < 7) ) {
                        obj.children("ul:eq(0)").css("display","none");
                        obj.removeClass("closed").addClass("open");
                        obj.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation), function() {
                            $(this).css("display","");
                            if(callback) callback.call();
                        });
                    } else {
                        obj.removeClass("closed").addClass("open");
                        if(callback) callback.call();
                    }
                    this.set_cookie("open");
                    this.settings.callback.onopen.call(null, obj.get(0), this);
                    return true;
                }
            },
            close_branch : function (obj, disable_animation) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                var obj = this.get_node(obj);
                if(parseInt(this.settings.ui.animation) > 0 && !disable_animation && !($.browser.msie && $.browser.version < 7) && obj.children("ul:eq(0)").size() == 1) {
                    obj.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation), function() {
                        obj.removeClass("open").addClass("closed");
                        _this.set_cookie("open");
                        $(this).css("display","");
                    });
                }
                else {
                    obj.removeClass("open").addClass("closed");
                    this.set_cookie("open");
                }
                if(this.selected && obj.children("ul:eq(0)").find("a.clicked").size() > 0) {
                    obj.find("li:has(a.clicked)").each(function() {
                        _this.deselect_branch(this);
                    });
                    if(obj.children("a.clicked").size() == 0) this.select_branch(obj, (this.settings.rules.multiple != false && this.selected_arr.length > 0) );
                }
                this.settings.callback.onclose.call(null, obj.get(0), this);
            },
            open_all : function (obj) {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                obj = obj ? $(obj) : this.container;
                obj.find("li.closed").each( function () { var __this = this; _this.open_branch.apply(_this, [this, true, function() { _this.open_all.apply(_this, [__this]); } ]); });
            },
            close_all : function () {
                if(this.locked) return this.error("LOCKED");
                var _this = this;
                $(this.container).find("li.open").each( function () { _this.close_branch(this, true); });
            },
            show_lang : function (i) {
                if(this.locked) return this.error("LOCKED");
                if(this.settings.languages[i] == this.current_lang) return true;
                var st = false;
                var id = this.container.attr("id") ? "#" + this.container.attr("id") : ".tree";
                st = get_css(id + " ." + this.current_lang, this.sn);
                if(st !== false) st.style.display = "none";
                st = get_css(id + " ." + this.settings.languages[i], this.sn);
                if(st !== false) st.style.display = "block";
                this.current_lang = this.settings.languages[i];
                return true;
            },
            cycle_lang : function() {
                if(this.locked) return this.error("LOCKED");
                var i = $.inArray(this.current_lang, this.settings.languages);
                i ++;
                if(i > this.settings.languages.length - 1) i = 0;
                this.show_lang(i);
            },
            create : function (type, obj, data, icon, id ) {
                if(this.locked) return this.error("LOCKED");
                // NOTHING SELECTED
                obj = obj ? this.get_node(obj) : this.selected;
                if(!obj || !obj.size()) return this.error("CREATE: NO NODE SELECTED");
                if(!this.check("creatable", obj)) return this.error("CREATE: CANNOT CREATE IN NODE");

                var t = type || this.get_type(obj) || "";
                if(this.settings.rules.use_inline && this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    if(typeof obj.metadata()["valid_children"] != "undefined") {
                        if($.inArray(t, obj.metadata()["valid_children"]) == -1) return this.error("CREATE: NODE NOT A VALID CHILD");
                    }
                    if(typeof obj.metadata()["max_children"] != "undefined") {
                        if( (obj.children("ul:eq(0)").children("li").size() + 1) > obj.metadata().max_children) return this.error("CREATE: MAX_CHILDREN REACHED");
                    }
                    var ok = true;
                    obj.parents("li").each(function(i) {
                        if($(this).metadata().max_depth) {
                            if( (i + 1) >= $(this).metadata().max_depth) {
                                ok = false;
                            }
                        }
                    });
                    if(!ok) return this.error("CREATE: MAX_DEPTH REACHED");
                }
                if(obj.hasClass("closed")) {
                    var _this = this;
                    return this.open_branch(obj, true, function () { _this.create.apply(_this, [type, obj, data, icon, id]); } );
                }

                if(id)    $li = $("<li id='" + id + "' />");
                else    $li = $("<li />");
                // NEW NODE IS OF PASSED TYPE OR PARENT'S TYPE
                if(this.settings.rules.metadata) {
                    $.metadata.setType("attr", this.settings.rules.metadata);
                    $li.attr(this.settings.rules.metadata, "type: '" + t + "'");
                }
                else {
                    $li.attr(this.settings.rules.type_attr, t)
                }

                var icn = "";
                if((typeof icon).toLowerCase() == "string") {
                    icn = icon;
                    icn = icn.indexOf("/") == -1 ? this.theme + icn : icn;
                }
                if(this.settings.languages.length) {
                    for(i = 0; i < this.settings.languages.length; i++) {
                        if((typeof data).toLowerCase() == "string") val = data;
                        else if(data && data[i]) {
                            val = data[i];
                        }
                        else if(this.settings.lang.new_node) {
                            if((typeof this.settings.lang.new_node).toLowerCase() != "string" && this.settings.lang.new_node[i])
                                val = this.settings.lang.new_node[i];
                            else
                                val = this.settings.lang.new_node;
                        }
                        else {
                            val = "New folder";
                        }
                        if((typeof icon).toLowerCase() != "string" && icon && icon[i]) {
                            icn = icon[i];
                            icn = icn.indexOf("/") == -1 ? this.theme + icn : icn;
                        }
                        $li.append("<a href='#'" + ( icn.length ? " style='background-image:url(\"" + icn + "\");' " : " ") + "class='" + this.settings.languages[i] + "'>" + val + "</a>");
                    }
                }
                else { $li.append("<a href='#'" + ( icn.length ? " style='background-image:url(\"" + icn + "\");' " : " ") + ">" + (data || this.settings.lang.new_node || "New folder") + "</a>"); }
                $li.addClass("leaf");
                if(this.settings.rules.createat == "top" || obj.children("ul").size() == 0) {
                    this.moved($li,obj.children("a:eq(0)"),"inside", true);
                }
                else {
                    this.moved($li,obj.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",true);
                }
                this.select_branch($li.children("a:eq(0)"));
                if(!data) this.rename();
                return $li;
            },
            rename : function () {
                if(this.locked) return this.error("LOCKED");
                if(this.selected) {
                    var _this = this;
                    if(!this.check("renameable", this.selected)) return this.error("RENAME: NODE NOT RENAMABLE");
                    if(!this.settings.callback.beforerename.call(null,this.selected.get(0), _this.current_lang, _this)) return this.error("RENAME: STOPPED BY USER");
                    var obj = this.selected;
                    if(this.current_lang)    obj = obj.find("a." + this.current_lang).get(0);
                    else                    obj = obj.find("a:first").get(0);
                    last_value = obj.innerHTML;
                    _this.inp = $("<input type='text' />");
                    _this.inp
                        .val(last_value)
                        .bind("pointerdown",        function (event) { event.stopPropagation(); })
                        .bind("pointerup",        function (event) { event.stopPropagation(); })
                        .bind("click",            function (event) { event.stopPropagation(); })
                        .bind("keyup",            function (event) {
                                var key = event.keyCode || event.which;
                                if(key == 27) { this.value = last_value; this.blur(); return }
                                if(key == 13) { this.blur(); return }
                            });
                    _this.inp.blur(function(event) {
                            if(this.value == "") this.value == last_value;
                            $(obj).html( $(obj).parent().find("input").eq(0).attr("value") ).get(0).style.display = "";
                            $(obj).prevAll("span").remove();
                            if(this.value != last_value) _this.settings.callback.onrename.call(null, _this.get_node(obj).get(0), _this.current_lang, _this);
                            _this.inp = false;
                        });
                    var spn = $("<span />").addClass(obj.className).append(_this.inp);
                    spn.attr("style", $(obj).attr("style"));
                    obj.style.display = "none";
                    $(obj).parent().prepend(spn);
                    _this.inp.get(0).focus();
                    _this.inp.get(0).select();
                }
                else return this.error("RENAME: NO NODE SELECTED");
            },
            // REMOVE NODES
            remove : function(obj) {
                if(this.locked) return this.error("LOCKED");
                if(obj) {
                    obj = this.get_node(obj);
                    if(obj.size()) {
                        if(!this.check("deletable", obj)) return this.error("DELETE: NODE NOT DELETABLE");
                        if(!this.settings.callback.beforedelete.call(null,obj.get(0), _this)) return this.error("DELETE: STOPPED BY USER");
                        $parent = obj.parent();
                        obj = obj.remove();
                        $parent.children("li:last").addClass("last");
                        if($parent.children("li").size() == 0) {
                            $li = $parent.parents("li:eq(0)");
                            $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                            this.set_cookie("open");
                        }
                        this.settings.callback.ondelete.call(null, obj, this);
                    }
                }
                else if(this.selected) {
                    if(!this.check("deletable", this.selected)) return this.error("DELETE: NODE NOT DELETABLE");
                    if(!this.settings.callback.beforedelete.call(null,this.selected.get(0), _this)) return this.error("DELETE: STOPPED BY USER");
                    $parent = this.selected.parent();
                    var obj = this.selected;
                    if(this.settings.rules.multiple == false || this.selected_arr.length == 1) {
                        var stop = true;
                        var tmp = (this.selected.prev("li:eq(0)").size()) ? this.selected.prev("li:eq(0)") : this.selected.parents("li:eq(0)");
                        // this.get_prev(true);
                    }
                    obj = obj.remove();
                    $parent.children("li:last").addClass("last");
                    if($parent.children("li").size() == 0) {
                        $li = $parent.parents("li:eq(0)");
                        $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                        this.set_cookie("open");
                    }
                    //this.selected = false;
                    this.settings.callback.ondelete.call(null, obj, this);
                    if(stop && tmp) this.select_branch(tmp);
                    if(this.settings.rules.multiple != false && !stop) {
                        var _this = this;
                        this.selected_arr = [];
                        this.container.find("a.clicked").filter(":first-child").parent().each(function () {
                            _this.selected_arr.push($(this));
                        });
                        if(this.selected_arr.length > 0) {
                            this.selected = this.selected_arr[0];
                            this.remove();
                        }
                    }
                }
                else return this.error("DELETE: NO NODE SELECTED");
            },
            // FOR EXPLORER-LIKE KEYBOARD SHORTCUTS
            get_next : function(force) {
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.hasClass("open"))                        return force ? this.select_branch(obj.find("li:eq(0)")) : this.hover_branch(obj.find("li:eq(0)"));
                    else if($(obj).nextAll("li").size() > 0)    return force ? this.select_branch(obj.nextAll("li:eq(0)")) : this.hover_branch(obj.nextAll("li:eq(0)"));
                    else                                            return force ? this.select_branch(obj.parents("li").next("li").eq(0)) : this.hover_branch(obj.parents("li").next("li").eq(0));
                }
            },
            get_prev : function(force) {
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.prev("li").size()) {
                        var obj = obj.prev("li").eq(0);
                        while(obj.hasClass("open")) obj = obj.children("ul:eq(0)").children("li:last");
                        return force ? this.select_branch(obj) : this.hover_branch(obj);
                    }
                    else { return force ? this.select_branch(obj.parents("li:eq(0)")) : this.hover_branch(obj.parents("li:eq(0)")); }
                }
            },
            get_left : function(force, rtl) {
                if(this.settings.ui.rtl && !rtl) return this.get_right(force, true);
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.hasClass("open"))    this.close_branch(obj);
                    else {
                        return force ? this.select_branch(obj.parents("li:eq(0)")) : this.hover_branch(obj.parents("li:eq(0)"));
                    }
                }
            },
            get_right : function(force, rtl) {
                if(this.settings.ui.rtl && !rtl) return this.get_left(force, true);
                var obj = this.hovered || this.selected;
                if(obj) {
                    if(obj.hasClass("closed"))    this.open_branch(obj);
                    else {
                        return force ? this.select_branch(obj.find("li:eq(0)")) : this.hover_branch(obj.find("li:eq(0)"));
                    }
                }
            },
            toggleDots : function () {
                this.container.toggleClass("no_dots");
            },
            set_cookie : function (type) {
                if(this.settings.cookies === false) return false;
                switch(type) {
                    /*case "selected":
                        if(this.settings.rules.multiple != false && this.selected_arr.length > 1) {
                            var val = Array();
                            jQuery.each(this.selected_arr, function () {
                                val.push(this.attr("id"));
                            });
                            val = val.join(",");
                        }
                        else var val = this.selected ? this.selected.attr("id") : false;
                        jQuery.cookie(this.settings.cookies.prefix + '_selected',val,this.settings.cookies.opts);
                        break;*/
                    case "open":
                        var str = "";
                        this.container.find("li.open").each(function (i) { str += this.id + ","; });
                        $.cookie(this.settings.cookies.prefix + '_open',str.replace(/,$/ig,""),this.settings.cookies.opts);
                        break;
                }
            },
            moved : function (what, where, how, is_new, is_copy) {
                var what    = $(what);
                var $parent    = $(what).parents("ul:eq(0)");
                var $where    = $(where);
                // IF MULTIPLE
                if(what.size() > 1) {
                    var _this = this;
                    var tmp = this.moved(what.eq(0),where,how, false, is_copy);
                    what.each(function (i) {
                        if(i == 0) return;
                        tmp = _this.moved(this, tmp.children("a:eq(0)"), "after", false, is_copy);
                    })
                    return;
                }
                if(is_copy) {
                    what = what.clone();
                    what.each(function (i) {
                        this.id = this.id + "_copy";
                        $(this).find("li").each(function () {
                            this.id = this.id + "_copy";
                        })
                        $(this).find("a.clicked").removeClass("clicked");
                    });
                }
                if(is_new) {
                    if(!this.settings.callback.beforecreate.call(null,this.get_node(what).get(0), this.get_node(where).get(0),how,this)) return;
                }
                else {
                    if(!this.settings.callback.beforemove.call(null,this.get_node(what).get(0), this.get_node(where).get(0),how,this)) return;
                }

                if(!is_new) {
                    var tmp = $(what).parents(".tree:eq(0)");
                    // if different trees
                    if(tmp.get(0) != this.container.get(0)) {
                        tmp = tree_component.inst[tmp.attr("id")];
                        // if there are languages - otherwise - no cleanup needed
                        if(tmp.settings.languages.length) {
                            var res = [];
                            // if new tree has no languages - use current visible
                            if(this.settings.languages.length == 0) res.push("." + tmp.current_lang);
                            else {
                                for(i in this.settings.languages) {
                                    for(j in tmp.settings.languages) {
                                        if(this.settings.languages[i] == tmp.settings.languages[j]) res.push("." + this.settings.languages[i]);
                                    }
                                }
                            }
                            if(res.length == 0) return this.error("MOVE: NO COMMON LANGUAGES");
                            what.find("a").removeClass("clicked").not(res.join(",")).remove();
                        }
                    }
                }

                // ADD NODE TO NEW PLACE
                switch(how) {
                    case "before":
                        $where.parents("ul:eq(0)").children("li.last").removeClass("last");
                        $where.parents("li:eq(0)").before(what.removeClass("last"));
                        $where.parents("ul:eq(0)").children("li:last").addClass("last");
                        break;
                    case "after":
                        $where.parents("ul:eq(0)").children("li.last").removeClass("last");
                        $where.parents("li:eq(0)").after(what.removeClass("last"));
                        $where.parents("ul:eq(0)").children("li:last").addClass("last");
                        break;
                    case "inside":
                        if(this.settings.data.async) {
                            var obj = this.get_node($where);
                            if(obj.hasClass("closed")) {
                                var _this = this;
                                return this.open_branch(obj, true, function () { _this.moved.apply(_this, [what, where, how, is_new, is_copy]); })
                            }
                        }
                        if($where.parents("li:eq(0)").children("ul:first").size()) {
                            if(this.settings.rules.createat == "top")    $where.parents("li:eq(0)").children("ul:first").prepend(what.removeClass("last")).children("li:last").addClass("last");
                            else                                        $where.parents("li:eq(0)").children("ul:first").children(".last").removeClass("last").end().append(what.removeClass("last")).children("li:last").addClass("last");
                        }
                        else {
                            what.addClass("last");
                            $where.parents("li:eq(0)").append("<ul/>").removeClass("leaf").addClass("closed");
                            $where.parents("li:eq(0)").children("ul:first").prepend(what);
                        }
                        if(!this.settings.data.async) {
                            this.open_branch($where);
                        }
                        break;
                    default:
                        break;
                }
                // CLEANUP OLD PARENT
                if($parent.find("li").size() == 0) {
                    var $li = $parent.parent();
                    $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                    $li.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last");
                    this.set_cookie("open");
                }
                else {
                    $parent.children("li.last").removeClass("last");
                    $parent.children("li:last").addClass("last");
                }
                if(is_new && how != "inside") where = this.get_node(where).parents("li:eq(0)");
                if(is_copy)        this.settings.callback.oncopy.call(null, this.get_node(what).get(0), this.get_node(where).get(0), how, this)
                else if(is_new)    this.settings.callback.oncreate.call(null, this.get_node(what).get(0), this.get_node(where).get(0), this.settings.insertAt, this);
                else            this.settings.callback.onmove.call(null, this.get_node(what).get(0), this.get_node(where).get(0), how, this);
                return what;
            },
            error : function (code) {
                this.settings.callback.error.call(null,code,this);
                return false;
            },
            lock : function (state) {
                this.locked = state;
                if(this.locked)    this.container.addClass("locked");
                else            this.container.removeClass("locked");
            },
            cut : function () {
                if(this.locked) return this.error("LOCKED");
                if(!this.selected) return this.error("CUT: NO NODE SELECTED");
                this.copy_nodes = false;
                this.cut_nodes = this.container.find("a.clicked").filter(":first-child").parent();
            },
            copy : function () {
                if(this.locked) return this.error("LOCKED");
                if(!this.selected) return this.error("COPY: NO NODE SELECTED");
                this.copy_nodes = this.container.find("a.clicked").filter(":first-child").parent();
                this.cut_nodes = false;
            },
            paste : function () {
                if(this.locked) return this.error("LOCKED");
                if(!this.selected) return this.error("PASTE: NO NODE SELECTED");
                if(!this.copy_nodes && !this.cut_nodes) return this.error("PASTE: NOTHING TO DO");
                if(this.copy_nodes && this.copy_nodes.size()) {
                    if(!this.checkMove(this.copy_nodes, this.selected.children("a:eq(0)"), "inside")) return false;
                    this.moved(this.copy_nodes, this.selected.children("a:eq(0)"), "inside", false, true);
                    this.copy_nodes = false;
                }
                if(this.cut_nodes && this.cut_nodes.size()) {
                    if(!this.checkMove(this.cut_nodes, this.selected.children("a:eq(0)"), "inside")) return false;
                    this.moved(this.cut_nodes, this.selected.children("a:eq(0)"), "inside");
                    this.cut_nodes = false;
                }
            },
            search : function(str) {
                var _this = this;
                if(!str || (this.srch && str != this.srch) ) {
                    this.srch = "";
                    this.srch_opn = false;
                    this.container.find("a.search").removeClass("search");
                }
                this.srch = str;
                if(!str) return;
                if(this.settings.data.async) {
                    if(!this.srch_opn) {
                        var dd = $.extend( { "search" : str } , this.settings.data.async_data(false) );
                        $.ajax({
                            type        : this.settings.data.method,
                            url            : this.settings.data.url,
                            data        : dd,
                            dataType    : "text",
                            success        : function (data) {
                                _this.srch_opn = $.unique(data.split(","));
                                _this.search.apply(_this,[str]);
                            }
                        });
                    }
                    else if(this.srch_opn.length) {
                        if(this.srch_opn && this.srch_opn.length) {
                            var opn = false;
                            for(var j = 0; j < this.srch_opn.length; j++) {
                                if(this.get_node("#" + this.srch_opn[j]).size() > 0) {
                                    opn = true;
                                    var tmp = "#" + this.srch_opn[j];
                                    delete this.srch_opn[j];
                                    this.open_branch(tmp, true, function () { _this.search.apply(_this,[str]); } );
                                }
                            }
                            if(!opn) {
                                this.srch_opn = [];
                                 _this.search.apply(_this,[str]);
                            }
                        }
                    }
                    else {
                        var selector = "a";
                        // IF LANGUAGE VERSIONS
                        if(this.settings.languages.length) selector += "." + this.current_lang;
                        this.container.find(selector + ":contains('" + str + "')").addClass("search");
                        this.srch_opn = false;
                    }
                }
                else {
                    var selector = "a";
                    // IF LANGUAGE VERSIONS
                    if(this.settings.languages.length) selector += "." + this.current_lang;
                    this.container.find(selector + ":contains('" + str + "')").addClass("search").parents("li.closed").each( function () { _this.open_branch(this, true); });
                }
            },

            destroy : function() {
                try {
                    var evts = ["click","dblclick","contextmenu","pointerover","pointerdown"];
                    for(i in evts) {
                        var idxer = this.container.indexer(evts[i]);
                        idxer.stop();
                        $.removeData( idxer.listener, idxer.event + '.indexer' );
                    }
                } catch(err) { }
                this.container.unbind();

                this.container.removeClass("tree").children("ul").removeClass("tree-" + this.settings.ui.theme_name).find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked");

                if(this.cntr == tree_component.focused) {
                    for(i in tree_component.inst) {
                        if(i != this.cntr && i != this.container.attr("id")) {
                            tree_component.inst[i].focus();
                            break;
                        }
                    }
                }
                delete tree_component.inst[this.cntr];
                delete tree_component.inst[this.container.attr("id")];
                tree_component.cntr --;
            }
        }
    };
}(CMS.$));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS51aS5jdXN0b20uanMiLCJjbXMuY2hhbmdlbGlzdC5qcyIsIl9hbGwuanMiLCJ0cmVlX2NvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0MkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImJ1bmRsZS5hZG1pbi5jaGFuZ2VsaXN0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBqUXVlcnkgVUkgLSB2MS4xMS40IC0gMjAxNS0wOS0wOVxuKiBodHRwOi8vanF1ZXJ5dWkuY29tXG4qIEluY2x1ZGVzOiBjb3JlLmpzLCB3aWRnZXQuanMsIG1vdXNlLmpzLCBzb3J0YWJsZS5qc1xuKiBDb3B5cmlnaHQgMjAxNSBqUXVlcnkgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzOyBMaWNlbnNlZCBNSVQgKi9cblxuKGZ1bmN0aW9uKGUpe1wiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW1wianF1ZXJ5XCJdLGUpOmUoalF1ZXJ5KX0pKGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQodCxzKXt2YXIgbixhLG8scj10Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuXCJhcmVhXCI9PT1yPyhuPXQucGFyZW50Tm9kZSxhPW4ubmFtZSx0LmhyZWYmJmEmJlwibWFwXCI9PT1uLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk/KG89ZShcImltZ1t1c2VtYXA9JyNcIithK1wiJ11cIilbMF0sISFvJiZpKG8pKTohMSk6KC9eKGlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvLnRlc3Qocik/IXQuZGlzYWJsZWQ6XCJhXCI9PT1yP3QuaHJlZnx8czpzKSYmaSh0KX1mdW5jdGlvbiBpKHQpe3JldHVybiBlLmV4cHIuZmlsdGVycy52aXNpYmxlKHQpJiYhZSh0KS5wYXJlbnRzKCkuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVyblwiaGlkZGVuXCI9PT1lLmNzcyh0aGlzLFwidmlzaWJpbGl0eVwiKX0pLmxlbmd0aH1lLnVpPWUudWl8fHt9LGUuZXh0ZW5kKGUudWkse3ZlcnNpb246XCIxLjExLjRcIixrZXlDb2RlOntCQUNLU1BBQ0U6OCxDT01NQToxODgsREVMRVRFOjQ2LERPV046NDAsRU5EOjM1LEVOVEVSOjEzLEVTQ0FQRToyNyxIT01FOjM2LExFRlQ6MzcsUEFHRV9ET1dOOjM0LFBBR0VfVVA6MzMsUEVSSU9EOjE5MCxSSUdIVDozOSxTUEFDRTozMixUQUI6OSxVUDozOH19KSxlLmZuLmV4dGVuZCh7c2Nyb2xsUGFyZW50OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuY3NzKFwicG9zaXRpb25cIikscz1cImFic29sdXRlXCI9PT1pLG49dD8vKGF1dG98c2Nyb2xsfGhpZGRlbikvOi8oYXV0b3xzY3JvbGwpLyxhPXRoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3ZhciB0PWUodGhpcyk7cmV0dXJuIHMmJlwic3RhdGljXCI9PT10LmNzcyhcInBvc2l0aW9uXCIpPyExOm4udGVzdCh0LmNzcyhcIm92ZXJmbG93XCIpK3QuY3NzKFwib3ZlcmZsb3cteVwiKSt0LmNzcyhcIm92ZXJmbG93LXhcIikpfSkuZXEoMCk7cmV0dXJuXCJmaXhlZFwiIT09aSYmYS5sZW5ndGg/YTplKHRoaXNbMF0ub3duZXJEb2N1bWVudHx8ZG9jdW1lbnQpfSx1bmlxdWVJZDpmdW5jdGlvbigpe3ZhciBlPTA7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3RoaXMuaWR8fCh0aGlzLmlkPVwidWktaWQtXCIrICsrZSl9KX19KCkscmVtb3ZlVW5pcXVlSWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7L151aS1pZC1cXGQrJC8udGVzdCh0aGlzLmlkKSYmZSh0aGlzKS5yZW1vdmVBdHRyKFwiaWRcIil9KX19KSxlLmV4dGVuZChlLmV4cHJbXCI6XCJdLHtkYXRhOmUuZXhwci5jcmVhdGVQc2V1ZG8/ZS5leHByLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuISFlLmRhdGEoaSx0KX19KTpmdW5jdGlvbih0LGkscyl7cmV0dXJuISFlLmRhdGEodCxzWzNdKX0sZm9jdXNhYmxlOmZ1bmN0aW9uKGkpe3JldHVybiB0KGksIWlzTmFOKGUuYXR0cihpLFwidGFiaW5kZXhcIikpKX0sdGFiYmFibGU6ZnVuY3Rpb24oaSl7dmFyIHM9ZS5hdHRyKGksXCJ0YWJpbmRleFwiKSxuPWlzTmFOKHMpO3JldHVybihufHxzPj0wKSYmdChpLCFuKX19KSxlKFwiPGE+XCIpLm91dGVyV2lkdGgoMSkuanF1ZXJ5fHxlLmVhY2goW1wiV2lkdGhcIixcIkhlaWdodFwiXSxmdW5jdGlvbih0LGkpe2Z1bmN0aW9uIHModCxpLHMsYSl7cmV0dXJuIGUuZWFjaChuLGZ1bmN0aW9uKCl7aS09cGFyc2VGbG9hdChlLmNzcyh0LFwicGFkZGluZ1wiK3RoaXMpKXx8MCxzJiYoaS09cGFyc2VGbG9hdChlLmNzcyh0LFwiYm9yZGVyXCIrdGhpcytcIldpZHRoXCIpKXx8MCksYSYmKGktPXBhcnNlRmxvYXQoZS5jc3ModCxcIm1hcmdpblwiK3RoaXMpKXx8MCl9KSxpfXZhciBuPVwiV2lkdGhcIj09PWk/W1wiTGVmdFwiLFwiUmlnaHRcIl06W1wiVG9wXCIsXCJCb3R0b21cIl0sYT1pLnRvTG93ZXJDYXNlKCksbz17aW5uZXJXaWR0aDplLmZuLmlubmVyV2lkdGgsaW5uZXJIZWlnaHQ6ZS5mbi5pbm5lckhlaWdodCxvdXRlcldpZHRoOmUuZm4ub3V0ZXJXaWR0aCxvdXRlckhlaWdodDplLmZuLm91dGVySGVpZ2h0fTtlLmZuW1wiaW5uZXJcIitpXT1mdW5jdGlvbih0KXtyZXR1cm4gdm9pZCAwPT09dD9vW1wiaW5uZXJcIitpXS5jYWxsKHRoaXMpOnRoaXMuZWFjaChmdW5jdGlvbigpe2UodGhpcykuY3NzKGEscyh0aGlzLHQpK1wicHhcIil9KX0sZS5mbltcIm91dGVyXCIraV09ZnVuY3Rpb24odCxuKXtyZXR1cm5cIm51bWJlclwiIT10eXBlb2YgdD9vW1wib3V0ZXJcIitpXS5jYWxsKHRoaXMsdCk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZSh0aGlzKS5jc3MoYSxzKHRoaXMsdCwhMCxuKStcInB4XCIpfSl9fSksZS5mbi5hZGRCYWNrfHwoZS5mbi5hZGRCYWNrPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmFkZChudWxsPT1lP3RoaXMucHJldk9iamVjdDp0aGlzLnByZXZPYmplY3QuZmlsdGVyKGUpKX0pLGUoXCI8YT5cIikuZGF0YShcImEtYlwiLFwiYVwiKS5yZW1vdmVEYXRhKFwiYS1iXCIpLmRhdGEoXCJhLWJcIikmJihlLmZuLnJlbW92ZURhdGE9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGkpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2FsbCh0aGlzLGUuY2FtZWxDYXNlKGkpKTp0LmNhbGwodGhpcyl9fShlLmZuLnJlbW92ZURhdGEpKSxlLnVpLmllPSEhL21zaWUgW1xcdy5dKy8uZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpLGUuZm4uZXh0ZW5kKHtmb2N1czpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSxzKXtyZXR1cm5cIm51bWJlclwiPT10eXBlb2YgaT90aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdD10aGlzO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtlKHQpLmZvY3VzKCkscyYmcy5jYWxsKHQpfSxpKX0pOnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oZS5mbi5mb2N1cyksZGlzYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3ZhciBlPVwib25zZWxlY3RzdGFydFwiaW4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKT9cInNlbGVjdHN0YXJ0XCI6XCJtb3VzZWRvd25cIjtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5iaW5kKGUrXCIudWktZGlzYWJsZVNlbGVjdGlvblwiLGZ1bmN0aW9uKGUpe2UucHJldmVudERlZmF1bHQoKX0pfX0oKSxlbmFibGVTZWxlY3Rpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51bmJpbmQoXCIudWktZGlzYWJsZVNlbGVjdGlvblwiKX0sekluZGV4OmZ1bmN0aW9uKHQpe2lmKHZvaWQgMCE9PXQpcmV0dXJuIHRoaXMuY3NzKFwiekluZGV4XCIsdCk7aWYodGhpcy5sZW5ndGgpZm9yKHZhciBpLHMsbj1lKHRoaXNbMF0pO24ubGVuZ3RoJiZuWzBdIT09ZG9jdW1lbnQ7KXtpZihpPW4uY3NzKFwicG9zaXRpb25cIiksKFwiYWJzb2x1dGVcIj09PWl8fFwicmVsYXRpdmVcIj09PWl8fFwiZml4ZWRcIj09PWkpJiYocz1wYXJzZUludChuLmNzcyhcInpJbmRleFwiKSwxMCksIWlzTmFOKHMpJiYwIT09cykpcmV0dXJuIHM7bj1uLnBhcmVudCgpfXJldHVybiAwfX0pLGUudWkucGx1Z2luPXthZGQ6ZnVuY3Rpb24odCxpLHMpe3ZhciBuLGE9ZS51aVt0XS5wcm90b3R5cGU7Zm9yKG4gaW4gcylhLnBsdWdpbnNbbl09YS5wbHVnaW5zW25dfHxbXSxhLnBsdWdpbnNbbl0ucHVzaChbaSxzW25dXSl9LGNhbGw6ZnVuY3Rpb24oZSx0LGkscyl7dmFyIG4sYT1lLnBsdWdpbnNbdF07aWYoYSYmKHN8fGUuZWxlbWVudFswXS5wYXJlbnROb2RlJiYxMSE9PWUuZWxlbWVudFswXS5wYXJlbnROb2RlLm5vZGVUeXBlKSlmb3Iobj0wO2EubGVuZ3RoPm47bisrKWUub3B0aW9uc1thW25dWzBdXSYmYVtuXVsxXS5hcHBseShlLmVsZW1lbnQsaSl9fTt2YXIgcz0wLG49QXJyYXkucHJvdG90eXBlLnNsaWNlO2UuY2xlYW5EYXRhPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihpKXt2YXIgcyxuLGE7Zm9yKGE9MDtudWxsIT0obj1pW2FdKTthKyspdHJ5e3M9ZS5fZGF0YShuLFwiZXZlbnRzXCIpLHMmJnMucmVtb3ZlJiZlKG4pLnRyaWdnZXJIYW5kbGVyKFwicmVtb3ZlXCIpfWNhdGNoKG8pe310KGkpfX0oZS5jbGVhbkRhdGEpLGUud2lkZ2V0PWZ1bmN0aW9uKHQsaSxzKXt2YXIgbixhLG8scixoPXt9LGw9dC5zcGxpdChcIi5cIilbMF07cmV0dXJuIHQ9dC5zcGxpdChcIi5cIilbMV0sbj1sK1wiLVwiK3Qsc3x8KHM9aSxpPWUuV2lkZ2V0KSxlLmV4cHJbXCI6XCJdW24udG9Mb3dlckNhc2UoKV09ZnVuY3Rpb24odCl7cmV0dXJuISFlLmRhdGEodCxuKX0sZVtsXT1lW2xdfHx7fSxhPWVbbF1bdF0sbz1lW2xdW3RdPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuX2NyZWF0ZVdpZGdldD8oYXJndW1lbnRzLmxlbmd0aCYmdGhpcy5fY3JlYXRlV2lkZ2V0KGUsdCksdm9pZCAwKTpuZXcgbyhlLHQpfSxlLmV4dGVuZChvLGEse3ZlcnNpb246cy52ZXJzaW9uLF9wcm90bzplLmV4dGVuZCh7fSxzKSxfY2hpbGRDb25zdHJ1Y3RvcnM6W119KSxyPW5ldyBpLHIub3B0aW9ucz1lLndpZGdldC5leHRlbmQoe30sci5vcHRpb25zKSxlLmVhY2gocyxmdW5jdGlvbih0LHMpe3JldHVybiBlLmlzRnVuY3Rpb24ocyk/KGhbdF09ZnVuY3Rpb24oKXt2YXIgZT1mdW5jdGlvbigpe3JldHVybiBpLnByb3RvdHlwZVt0XS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LG49ZnVuY3Rpb24oZSl7cmV0dXJuIGkucHJvdG90eXBlW3RdLmFwcGx5KHRoaXMsZSl9O3JldHVybiBmdW5jdGlvbigpe3ZhciB0LGk9dGhpcy5fc3VwZXIsYT10aGlzLl9zdXBlckFwcGx5O3JldHVybiB0aGlzLl9zdXBlcj1lLHRoaXMuX3N1cGVyQXBwbHk9bix0PXMuYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX3N1cGVyPWksdGhpcy5fc3VwZXJBcHBseT1hLHR9fSgpLHZvaWQgMCk6KGhbdF09cyx2b2lkIDApfSksby5wcm90b3R5cGU9ZS53aWRnZXQuZXh0ZW5kKHIse3dpZGdldEV2ZW50UHJlZml4OmE/ci53aWRnZXRFdmVudFByZWZpeHx8dDp0fSxoLHtjb25zdHJ1Y3RvcjpvLG5hbWVzcGFjZTpsLHdpZGdldE5hbWU6dCx3aWRnZXRGdWxsTmFtZTpufSksYT8oZS5lYWNoKGEuX2NoaWxkQ29uc3RydWN0b3JzLGZ1bmN0aW9uKHQsaSl7dmFyIHM9aS5wcm90b3R5cGU7ZS53aWRnZXQocy5uYW1lc3BhY2UrXCIuXCIrcy53aWRnZXROYW1lLG8saS5fcHJvdG8pfSksZGVsZXRlIGEuX2NoaWxkQ29uc3RydWN0b3JzKTppLl9jaGlsZENvbnN0cnVjdG9ycy5wdXNoKG8pLGUud2lkZ2V0LmJyaWRnZSh0LG8pLG99LGUud2lkZ2V0LmV4dGVuZD1mdW5jdGlvbih0KXtmb3IodmFyIGkscyxhPW4uY2FsbChhcmd1bWVudHMsMSksbz0wLHI9YS5sZW5ndGg7cj5vO28rKylmb3IoaSBpbiBhW29dKXM9YVtvXVtpXSxhW29dLmhhc093blByb3BlcnR5KGkpJiZ2b2lkIDAhPT1zJiYodFtpXT1lLmlzUGxhaW5PYmplY3Qocyk/ZS5pc1BsYWluT2JqZWN0KHRbaV0pP2Uud2lkZ2V0LmV4dGVuZCh7fSx0W2ldLHMpOmUud2lkZ2V0LmV4dGVuZCh7fSxzKTpzKTtyZXR1cm4gdH0sZS53aWRnZXQuYnJpZGdlPWZ1bmN0aW9uKHQsaSl7dmFyIHM9aS5wcm90b3R5cGUud2lkZ2V0RnVsbE5hbWV8fHQ7ZS5mblt0XT1mdW5jdGlvbihhKXt2YXIgbz1cInN0cmluZ1wiPT10eXBlb2YgYSxyPW4uY2FsbChhcmd1bWVudHMsMSksaD10aGlzO3JldHVybiBvP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBpLG49ZS5kYXRhKHRoaXMscyk7cmV0dXJuXCJpbnN0YW5jZVwiPT09YT8oaD1uLCExKTpuP2UuaXNGdW5jdGlvbihuW2FdKSYmXCJfXCIhPT1hLmNoYXJBdCgwKT8oaT1uW2FdLmFwcGx5KG4sciksaSE9PW4mJnZvaWQgMCE9PWk/KGg9aSYmaS5qcXVlcnk/aC5wdXNoU3RhY2soaS5nZXQoKSk6aSwhMSk6dm9pZCAwKTplLmVycm9yKFwibm8gc3VjaCBtZXRob2QgJ1wiK2ErXCInIGZvciBcIit0K1wiIHdpZGdldCBpbnN0YW5jZVwiKTplLmVycm9yKFwiY2Fubm90IGNhbGwgbWV0aG9kcyBvbiBcIit0K1wiIHByaW9yIHRvIGluaXRpYWxpemF0aW9uOyBcIitcImF0dGVtcHRlZCB0byBjYWxsIG1ldGhvZCAnXCIrYStcIidcIil9KTooci5sZW5ndGgmJihhPWUud2lkZ2V0LmV4dGVuZC5hcHBseShudWxsLFthXS5jb25jYXQocikpKSx0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdD1lLmRhdGEodGhpcyxzKTt0Pyh0Lm9wdGlvbihhfHx7fSksdC5faW5pdCYmdC5faW5pdCgpKTplLmRhdGEodGhpcyxzLG5ldyBpKGEsdGhpcykpfSkpLGh9fSxlLldpZGdldD1mdW5jdGlvbigpe30sZS5XaWRnZXQuX2NoaWxkQ29uc3RydWN0b3JzPVtdLGUuV2lkZ2V0LnByb3RvdHlwZT17d2lkZ2V0TmFtZTpcIndpZGdldFwiLHdpZGdldEV2ZW50UHJlZml4OlwiXCIsZGVmYXVsdEVsZW1lbnQ6XCI8ZGl2PlwiLG9wdGlvbnM6e2Rpc2FibGVkOiExLGNyZWF0ZTpudWxsfSxfY3JlYXRlV2lkZ2V0OmZ1bmN0aW9uKHQsaSl7aT1lKGl8fHRoaXMuZGVmYXVsdEVsZW1lbnR8fHRoaXMpWzBdLHRoaXMuZWxlbWVudD1lKGkpLHRoaXMudXVpZD1zKyssdGhpcy5ldmVudE5hbWVzcGFjZT1cIi5cIit0aGlzLndpZGdldE5hbWUrdGhpcy51dWlkLHRoaXMuYmluZGluZ3M9ZSgpLHRoaXMuaG92ZXJhYmxlPWUoKSx0aGlzLmZvY3VzYWJsZT1lKCksaSE9PXRoaXMmJihlLmRhdGEoaSx0aGlzLndpZGdldEZ1bGxOYW1lLHRoaXMpLHRoaXMuX29uKCEwLHRoaXMuZWxlbWVudCx7cmVtb3ZlOmZ1bmN0aW9uKGUpe2UudGFyZ2V0PT09aSYmdGhpcy5kZXN0cm95KCl9fSksdGhpcy5kb2N1bWVudD1lKGkuc3R5bGU/aS5vd25lckRvY3VtZW50OmkuZG9jdW1lbnR8fGkpLHRoaXMud2luZG93PWUodGhpcy5kb2N1bWVudFswXS5kZWZhdWx0Vmlld3x8dGhpcy5kb2N1bWVudFswXS5wYXJlbnRXaW5kb3cpKSx0aGlzLm9wdGlvbnM9ZS53aWRnZXQuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyx0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksdCksdGhpcy5fY3JlYXRlKCksdGhpcy5fdHJpZ2dlcihcImNyZWF0ZVwiLG51bGwsdGhpcy5fZ2V0Q3JlYXRlRXZlbnREYXRhKCkpLHRoaXMuX2luaXQoKX0sX2dldENyZWF0ZU9wdGlvbnM6ZS5ub29wLF9nZXRDcmVhdGVFdmVudERhdGE6ZS5ub29wLF9jcmVhdGU6ZS5ub29wLF9pbml0OmUubm9vcCxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5fZGVzdHJveSgpLHRoaXMuZWxlbWVudC51bmJpbmQodGhpcy5ldmVudE5hbWVzcGFjZSkucmVtb3ZlRGF0YSh0aGlzLndpZGdldEZ1bGxOYW1lKS5yZW1vdmVEYXRhKGUuY2FtZWxDYXNlKHRoaXMud2lkZ2V0RnVsbE5hbWUpKSx0aGlzLndpZGdldCgpLnVuYmluZCh0aGlzLmV2ZW50TmFtZXNwYWNlKS5yZW1vdmVBdHRyKFwiYXJpYS1kaXNhYmxlZFwiKS5yZW1vdmVDbGFzcyh0aGlzLndpZGdldEZ1bGxOYW1lK1wiLWRpc2FibGVkIFwiK1widWktc3RhdGUtZGlzYWJsZWRcIiksdGhpcy5iaW5kaW5ncy51bmJpbmQodGhpcy5ldmVudE5hbWVzcGFjZSksdGhpcy5ob3ZlcmFibGUucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKSx0aGlzLmZvY3VzYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfSxfZGVzdHJveTplLm5vb3Asd2lkZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudH0sb3B0aW9uOmZ1bmN0aW9uKHQsaSl7dmFyIHMsbixhLG89dDtpZigwPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4gZS53aWRnZXQuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyk7aWYoXCJzdHJpbmdcIj09dHlwZW9mIHQpaWYobz17fSxzPXQuc3BsaXQoXCIuXCIpLHQ9cy5zaGlmdCgpLHMubGVuZ3RoKXtmb3Iobj1vW3RdPWUud2lkZ2V0LmV4dGVuZCh7fSx0aGlzLm9wdGlvbnNbdF0pLGE9MDtzLmxlbmd0aC0xPmE7YSsrKW5bc1thXV09bltzW2FdXXx8e30sbj1uW3NbYV1dO2lmKHQ9cy5wb3AoKSwxPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4gdm9pZCAwPT09blt0XT9udWxsOm5bdF07blt0XT1pfWVsc2V7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIHZvaWQgMD09PXRoaXMub3B0aW9uc1t0XT9udWxsOnRoaXMub3B0aW9uc1t0XTtvW3RdPWl9cmV0dXJuIHRoaXMuX3NldE9wdGlvbnMobyksdGhpc30sX3NldE9wdGlvbnM6ZnVuY3Rpb24oZSl7dmFyIHQ7Zm9yKHQgaW4gZSl0aGlzLl9zZXRPcHRpb24odCxlW3RdKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLm9wdGlvbnNbZV09dCxcImRpc2FibGVkXCI9PT1lJiYodGhpcy53aWRnZXQoKS50b2dnbGVDbGFzcyh0aGlzLndpZGdldEZ1bGxOYW1lK1wiLWRpc2FibGVkXCIsISF0KSx0JiYodGhpcy5ob3ZlcmFibGUucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKSx0aGlzLmZvY3VzYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpKSksdGhpc30sZW5hYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NldE9wdGlvbnMoe2Rpc2FibGVkOiExfSl9LGRpc2FibGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2V0T3B0aW9ucyh7ZGlzYWJsZWQ6ITB9KX0sX29uOmZ1bmN0aW9uKHQsaSxzKXt2YXIgbixhPXRoaXM7XCJib29sZWFuXCIhPXR5cGVvZiB0JiYocz1pLGk9dCx0PSExKSxzPyhpPW49ZShpKSx0aGlzLmJpbmRpbmdzPXRoaXMuYmluZGluZ3MuYWRkKGkpKToocz1pLGk9dGhpcy5lbGVtZW50LG49dGhpcy53aWRnZXQoKSksZS5lYWNoKHMsZnVuY3Rpb24ocyxvKXtmdW5jdGlvbiByKCl7cmV0dXJuIHR8fGEub3B0aW9ucy5kaXNhYmxlZCE9PSEwJiYhZSh0aGlzKS5oYXNDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpPyhcInN0cmluZ1wiPT10eXBlb2Ygbz9hW29dOm8pLmFwcGx5KGEsYXJndW1lbnRzKTp2b2lkIDB9XCJzdHJpbmdcIiE9dHlwZW9mIG8mJihyLmd1aWQ9by5ndWlkPW8uZ3VpZHx8ci5ndWlkfHxlLmd1aWQrKyk7dmFyIGg9cy5tYXRjaCgvXihbXFx3Oi1dKilcXHMqKC4qKSQvKSxsPWhbMV0rYS5ldmVudE5hbWVzcGFjZSx1PWhbMl07dT9uLmRlbGVnYXRlKHUsbCxyKTppLmJpbmQobCxyKX0pfSxfb2ZmOmZ1bmN0aW9uKHQsaSl7aT0oaXx8XCJcIikuc3BsaXQoXCIgXCIpLmpvaW4odGhpcy5ldmVudE5hbWVzcGFjZStcIiBcIikrdGhpcy5ldmVudE5hbWVzcGFjZSx0LnVuYmluZChpKS51bmRlbGVnYXRlKGkpLHRoaXMuYmluZGluZ3M9ZSh0aGlzLmJpbmRpbmdzLm5vdCh0KS5nZXQoKSksdGhpcy5mb2N1c2FibGU9ZSh0aGlzLmZvY3VzYWJsZS5ub3QodCkuZ2V0KCkpLHRoaXMuaG92ZXJhYmxlPWUodGhpcy5ob3ZlcmFibGUubm90KHQpLmdldCgpKX0sX2RlbGF5OmZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gaSgpe3JldHVybihcInN0cmluZ1wiPT10eXBlb2YgZT9zW2VdOmUpLmFwcGx5KHMsYXJndW1lbnRzKX12YXIgcz10aGlzO3JldHVybiBzZXRUaW1lb3V0KGksdHx8MCl9LF9ob3ZlcmFibGU6ZnVuY3Rpb24odCl7dGhpcy5ob3ZlcmFibGU9dGhpcy5ob3ZlcmFibGUuYWRkKHQpLHRoaXMuX29uKHQse21vdXNlZW50ZXI6ZnVuY3Rpb24odCl7ZSh0LmN1cnJlbnRUYXJnZXQpLmFkZENsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9LG1vdXNlbGVhdmU6ZnVuY3Rpb24odCl7ZSh0LmN1cnJlbnRUYXJnZXQpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtaG92ZXJcIil9fSl9LF9mb2N1c2FibGU6ZnVuY3Rpb24odCl7dGhpcy5mb2N1c2FibGU9dGhpcy5mb2N1c2FibGUuYWRkKHQpLHRoaXMuX29uKHQse2ZvY3VzaW46ZnVuY3Rpb24odCl7ZSh0LmN1cnJlbnRUYXJnZXQpLmFkZENsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9LGZvY3Vzb3V0OmZ1bmN0aW9uKHQpe2UodC5jdXJyZW50VGFyZ2V0KS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWZvY3VzXCIpfX0pfSxfdHJpZ2dlcjpmdW5jdGlvbih0LGkscyl7dmFyIG4sYSxvPXRoaXMub3B0aW9uc1t0XTtpZihzPXN8fHt9LGk9ZS5FdmVudChpKSxpLnR5cGU9KHQ9PT10aGlzLndpZGdldEV2ZW50UHJlZml4P3Q6dGhpcy53aWRnZXRFdmVudFByZWZpeCt0KS50b0xvd2VyQ2FzZSgpLGkudGFyZ2V0PXRoaXMuZWxlbWVudFswXSxhPWkub3JpZ2luYWxFdmVudClmb3IobiBpbiBhKW4gaW4gaXx8KGlbbl09YVtuXSk7cmV0dXJuIHRoaXMuZWxlbWVudC50cmlnZ2VyKGkscyksIShlLmlzRnVuY3Rpb24obykmJm8uYXBwbHkodGhpcy5lbGVtZW50WzBdLFtpXS5jb25jYXQocykpPT09ITF8fGkuaXNEZWZhdWx0UHJldmVudGVkKCkpfX0sZS5lYWNoKHtzaG93OlwiZmFkZUluXCIsaGlkZTpcImZhZGVPdXRcIn0sZnVuY3Rpb24odCxpKXtlLldpZGdldC5wcm90b3R5cGVbXCJfXCIrdF09ZnVuY3Rpb24ocyxuLGEpe1wic3RyaW5nXCI9PXR5cGVvZiBuJiYobj17ZWZmZWN0Om59KTt2YXIgbyxyPW4/bj09PSEwfHxcIm51bWJlclwiPT10eXBlb2Ygbj9pOm4uZWZmZWN0fHxpOnQ7bj1ufHx7fSxcIm51bWJlclwiPT10eXBlb2YgbiYmKG49e2R1cmF0aW9uOm59KSxvPSFlLmlzRW1wdHlPYmplY3Qobiksbi5jb21wbGV0ZT1hLG4uZGVsYXkmJnMuZGVsYXkobi5kZWxheSksbyYmZS5lZmZlY3RzJiZlLmVmZmVjdHMuZWZmZWN0W3JdP3NbdF0obik6ciE9PXQmJnNbcl0/c1tyXShuLmR1cmF0aW9uLG4uZWFzaW5nLGEpOnMucXVldWUoZnVuY3Rpb24oaSl7ZSh0aGlzKVt0XSgpLGEmJmEuY2FsbChzWzBdKSxpKCl9KX19KSxlLndpZGdldDt2YXIgYT0hMTtlKGRvY3VtZW50KS5tb3VzZXVwKGZ1bmN0aW9uKCl7YT0hMX0pLGUud2lkZ2V0KFwidWkubW91c2VcIix7dmVyc2lvbjpcIjEuMTEuNFwiLG9wdGlvbnM6e2NhbmNlbDpcImlucHV0LHRleHRhcmVhLGJ1dHRvbixzZWxlY3Qsb3B0aW9uXCIsZGlzdGFuY2U6MSxkZWxheTowfSxfbW91c2VJbml0OmZ1bmN0aW9uKCl7dmFyIHQ9dGhpczt0aGlzLmVsZW1lbnQuYmluZChcIm1vdXNlZG93bi5cIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oZSl7cmV0dXJuIHQuX21vdXNlRG93bihlKX0pLmJpbmQoXCJjbGljay5cIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oaSl7cmV0dXJuITA9PT1lLmRhdGEoaS50YXJnZXQsdC53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpPyhlLnJlbW92ZURhdGEoaS50YXJnZXQsdC53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIpLGkuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksITEpOnZvaWQgMH0pLHRoaXMuc3RhcnRlZD0hMX0sX21vdXNlRGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC51bmJpbmQoXCIuXCIrdGhpcy53aWRnZXROYW1lKSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSYmdGhpcy5kb2N1bWVudC51bmJpbmQoXCJtb3VzZW1vdmUuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS51bmJpbmQoXCJtb3VzZXVwLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpfSxfbW91c2VEb3duOmZ1bmN0aW9uKHQpe2lmKCFhKXt0aGlzLl9tb3VzZU1vdmVkPSExLHRoaXMuX21vdXNlU3RhcnRlZCYmdGhpcy5fbW91c2VVcCh0KSx0aGlzLl9tb3VzZURvd25FdmVudD10O3ZhciBpPXRoaXMscz0xPT09dC53aGljaCxuPVwic3RyaW5nXCI9PXR5cGVvZiB0aGlzLm9wdGlvbnMuY2FuY2VsJiZ0LnRhcmdldC5ub2RlTmFtZT9lKHQudGFyZ2V0KS5jbG9zZXN0KHRoaXMub3B0aW9ucy5jYW5jZWwpLmxlbmd0aDohMTtyZXR1cm4gcyYmIW4mJnRoaXMuX21vdXNlQ2FwdHVyZSh0KT8odGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXksdGhpcy5tb3VzZURlbGF5TWV0fHwodGhpcy5fbW91c2VEZWxheVRpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtpLm1vdXNlRGVsYXlNZXQ9ITB9LHRoaXMub3B0aW9ucy5kZWxheSkpLHRoaXMuX21vdXNlRGlzdGFuY2VNZXQodCkmJnRoaXMuX21vdXNlRGVsYXlNZXQodCkmJih0aGlzLl9tb3VzZVN0YXJ0ZWQ9dGhpcy5fbW91c2VTdGFydCh0KSE9PSExLCF0aGlzLl9tb3VzZVN0YXJ0ZWQpPyh0LnByZXZlbnREZWZhdWx0KCksITApOighMD09PWUuZGF0YSh0LnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIikmJmUucmVtb3ZlRGF0YSh0LnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIiksdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGkuX21vdXNlTW92ZShlKX0sdGhpcy5fbW91c2VVcERlbGVnYXRlPWZ1bmN0aW9uKGUpe3JldHVybiBpLl9tb3VzZVVwKGUpfSx0aGlzLmRvY3VtZW50LmJpbmQoXCJtb3VzZW1vdmUuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS5iaW5kKFwibW91c2V1cC5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKSx0LnByZXZlbnREZWZhdWx0KCksYT0hMCwhMCkpOiEwfX0sX21vdXNlTW92ZTpmdW5jdGlvbih0KXtpZih0aGlzLl9tb3VzZU1vdmVkKXtpZihlLnVpLmllJiYoIWRvY3VtZW50LmRvY3VtZW50TW9kZXx8OT5kb2N1bWVudC5kb2N1bWVudE1vZGUpJiYhdC5idXR0b24pcmV0dXJuIHRoaXMuX21vdXNlVXAodCk7aWYoIXQud2hpY2gpcmV0dXJuIHRoaXMuX21vdXNlVXAodCl9cmV0dXJuKHQud2hpY2h8fHQuYnV0dG9uKSYmKHRoaXMuX21vdXNlTW92ZWQ9ITApLHRoaXMuX21vdXNlU3RhcnRlZD8odGhpcy5fbW91c2VEcmFnKHQpLHQucHJldmVudERlZmF1bHQoKSk6KHRoaXMuX21vdXNlRGlzdGFuY2VNZXQodCkmJnRoaXMuX21vdXNlRGVsYXlNZXQodCkmJih0aGlzLl9tb3VzZVN0YXJ0ZWQ9dGhpcy5fbW91c2VTdGFydCh0aGlzLl9tb3VzZURvd25FdmVudCx0KSE9PSExLHRoaXMuX21vdXNlU3RhcnRlZD90aGlzLl9tb3VzZURyYWcodCk6dGhpcy5fbW91c2VVcCh0KSksIXRoaXMuX21vdXNlU3RhcnRlZCl9LF9tb3VzZVVwOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLmRvY3VtZW50LnVuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSksdGhpcy5fbW91c2VTdGFydGVkJiYodGhpcy5fbW91c2VTdGFydGVkPSExLHQudGFyZ2V0PT09dGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0JiZlLmRhdGEodC50YXJnZXQsdGhpcy53aWRnZXROYW1lK1wiLnByZXZlbnRDbGlja0V2ZW50XCIsITApLHRoaXMuX21vdXNlU3RvcCh0KSksYT0hMSwhMX0sX21vdXNlRGlzdGFuY2VNZXQ6ZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgubWF4KE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VYLWUucGFnZVgpLE1hdGguYWJzKHRoaXMuX21vdXNlRG93bkV2ZW50LnBhZ2VZLWUucGFnZVkpKT49dGhpcy5vcHRpb25zLmRpc3RhbmNlfSxfbW91c2VEZWxheU1ldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1vdXNlRGVsYXlNZXR9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKCl7fSxfbW91c2VEcmFnOmZ1bmN0aW9uKCl7fSxfbW91c2VTdG9wOmZ1bmN0aW9uKCl7fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKCl7cmV0dXJuITB9fSksZS53aWRnZXQoXCJ1aS5zb3J0YWJsZVwiLGUudWkubW91c2Use3ZlcnNpb246XCIxLjExLjRcIix3aWRnZXRFdmVudFByZWZpeDpcInNvcnRcIixyZWFkeTohMSxvcHRpb25zOnthcHBlbmRUbzpcInBhcmVudFwiLGF4aXM6ITEsY29ubmVjdFdpdGg6ITEsY29udGFpbm1lbnQ6ITEsY3Vyc29yOlwiYXV0b1wiLGN1cnNvckF0OiExLGRyb3BPbkVtcHR5OiEwLGZvcmNlUGxhY2Vob2xkZXJTaXplOiExLGZvcmNlSGVscGVyU2l6ZTohMSxncmlkOiExLGhhbmRsZTohMSxoZWxwZXI6XCJvcmlnaW5hbFwiLGl0ZW1zOlwiPiAqXCIsb3BhY2l0eTohMSxwbGFjZWhvbGRlcjohMSxyZXZlcnQ6ITEsc2Nyb2xsOiEwLHNjcm9sbFNlbnNpdGl2aXR5OjIwLHNjcm9sbFNwZWVkOjIwLHNjb3BlOlwiZGVmYXVsdFwiLHRvbGVyYW5jZTpcImludGVyc2VjdFwiLHpJbmRleDoxZTMsYWN0aXZhdGU6bnVsbCxiZWZvcmVTdG9wOm51bGwsY2hhbmdlOm51bGwsZGVhY3RpdmF0ZTpudWxsLG91dDpudWxsLG92ZXI6bnVsbCxyZWNlaXZlOm51bGwscmVtb3ZlOm51bGwsc29ydDpudWxsLHN0YXJ0Om51bGwsc3RvcDpudWxsLHVwZGF0ZTpudWxsfSxfaXNPdmVyQXhpczpmdW5jdGlvbihlLHQsaSl7cmV0dXJuIGU+PXQmJnQraT5lfSxfaXNGbG9hdGluZzpmdW5jdGlvbihlKXtyZXR1cm4vbGVmdHxyaWdodC8udGVzdChlLmNzcyhcImZsb2F0XCIpKXx8L2lubGluZXx0YWJsZS1jZWxsLy50ZXN0KGUuY3NzKFwiZGlzcGxheVwiKSl9LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmNvbnRhaW5lckNhY2hlPXt9LHRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLXNvcnRhYmxlXCIpLHRoaXMucmVmcmVzaCgpLHRoaXMub2Zmc2V0PXRoaXMuZWxlbWVudC5vZmZzZXQoKSx0aGlzLl9tb3VzZUluaXQoKSx0aGlzLl9zZXRIYW5kbGVDbGFzc05hbWUoKSx0aGlzLnJlYWR5PSEwfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGUsdCl7dGhpcy5fc3VwZXIoZSx0KSxcImhhbmRsZVwiPT09ZSYmdGhpcy5fc2V0SGFuZGxlQ2xhc3NOYW1lKCl9LF9zZXRIYW5kbGVDbGFzc05hbWU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuZmluZChcIi51aS1zb3J0YWJsZS1oYW5kbGVcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oYW5kbGVcIiksZS5lYWNoKHRoaXMuaXRlbXMsZnVuY3Rpb24oKXsodGhpcy5pbnN0YW5jZS5vcHRpb25zLmhhbmRsZT90aGlzLml0ZW0uZmluZCh0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGFuZGxlKTp0aGlzLml0ZW0pLmFkZENsYXNzKFwidWktc29ydGFibGUtaGFuZGxlXCIpfSl9LF9kZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUgdWktc29ydGFibGUtZGlzYWJsZWRcIikuZmluZChcIi51aS1zb3J0YWJsZS1oYW5kbGVcIikucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oYW5kbGVcIiksdGhpcy5fbW91c2VEZXN0cm95KCk7Zm9yKHZhciBlPXRoaXMuaXRlbXMubGVuZ3RoLTE7ZT49MDtlLS0pdGhpcy5pdGVtc1tlXS5pdGVtLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lK1wiLWl0ZW1cIik7cmV0dXJuIHRoaXN9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24odCxpKXt2YXIgcz1udWxsLG49ITEsYT10aGlzO3JldHVybiB0aGlzLnJldmVydGluZz8hMTp0aGlzLm9wdGlvbnMuZGlzYWJsZWR8fFwic3RhdGljXCI9PT10aGlzLm9wdGlvbnMudHlwZT8hMToodGhpcy5fcmVmcmVzaEl0ZW1zKHQpLGUodC50YXJnZXQpLnBhcmVudHMoKS5lYWNoKGZ1bmN0aW9uKCl7cmV0dXJuIGUuZGF0YSh0aGlzLGEud2lkZ2V0TmFtZStcIi1pdGVtXCIpPT09YT8ocz1lKHRoaXMpLCExKTp2b2lkIDB9KSxlLmRhdGEodC50YXJnZXQsYS53aWRnZXROYW1lK1wiLWl0ZW1cIik9PT1hJiYocz1lKHQudGFyZ2V0KSkscz8hdGhpcy5vcHRpb25zLmhhbmRsZXx8aXx8KGUodGhpcy5vcHRpb25zLmhhbmRsZSxzKS5maW5kKFwiKlwiKS5hZGRCYWNrKCkuZWFjaChmdW5jdGlvbigpe3RoaXM9PT10LnRhcmdldCYmKG49ITApfSksbik/KHRoaXMuY3VycmVudEl0ZW09cyx0aGlzLl9yZW1vdmVDdXJyZW50c0Zyb21JdGVtcygpLCEwKTohMTohMSl9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKHQsaSxzKXt2YXIgbixhLG89dGhpcy5vcHRpb25zO2lmKHRoaXMuY3VycmVudENvbnRhaW5lcj10aGlzLHRoaXMucmVmcmVzaFBvc2l0aW9ucygpLHRoaXMuaGVscGVyPXRoaXMuX2NyZWF0ZUhlbHBlcih0KSx0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCksdGhpcy5fY2FjaGVNYXJnaW5zKCksdGhpcy5zY3JvbGxQYXJlbnQ9dGhpcy5oZWxwZXIuc2Nyb2xsUGFyZW50KCksdGhpcy5vZmZzZXQ9dGhpcy5jdXJyZW50SXRlbS5vZmZzZXQoKSx0aGlzLm9mZnNldD17dG9wOnRoaXMub2Zmc2V0LnRvcC10aGlzLm1hcmdpbnMudG9wLGxlZnQ6dGhpcy5vZmZzZXQubGVmdC10aGlzLm1hcmdpbnMubGVmdH0sZS5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OnQucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6dC5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSksdGhpcy5oZWxwZXIuY3NzKFwicG9zaXRpb25cIixcImFic29sdXRlXCIpLHRoaXMuY3NzUG9zaXRpb249dGhpcy5oZWxwZXIuY3NzKFwicG9zaXRpb25cIiksdGhpcy5vcmlnaW5hbFBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24odCksdGhpcy5vcmlnaW5hbFBhZ2VYPXQucGFnZVgsdGhpcy5vcmlnaW5hbFBhZ2VZPXQucGFnZVksby5jdXJzb3JBdCYmdGhpcy5fYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcihvLmN1cnNvckF0KSx0aGlzLmRvbVBvc2l0aW9uPXtwcmV2OnRoaXMuY3VycmVudEl0ZW0ucHJldigpWzBdLHBhcmVudDp0aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdfSx0aGlzLmhlbHBlclswXSE9PXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMuY3VycmVudEl0ZW0uaGlkZSgpLHRoaXMuX2NyZWF0ZVBsYWNlaG9sZGVyKCksby5jb250YWlubWVudCYmdGhpcy5fc2V0Q29udGFpbm1lbnQoKSxvLmN1cnNvciYmXCJhdXRvXCIhPT1vLmN1cnNvciYmKGE9dGhpcy5kb2N1bWVudC5maW5kKFwiYm9keVwiKSx0aGlzLnN0b3JlZEN1cnNvcj1hLmNzcyhcImN1cnNvclwiKSxhLmNzcyhcImN1cnNvclwiLG8uY3Vyc29yKSx0aGlzLnN0b3JlZFN0eWxlc2hlZXQ9ZShcIjxzdHlsZT4qeyBjdXJzb3I6IFwiK28uY3Vyc29yK1wiICFpbXBvcnRhbnQ7IH08L3N0eWxlPlwiKS5hcHBlbmRUbyhhKSksby5vcGFjaXR5JiYodGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiKSYmKHRoaXMuX3N0b3JlZE9wYWNpdHk9dGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiKSksdGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiLG8ub3BhY2l0eSkpLG8uekluZGV4JiYodGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIpJiYodGhpcy5fc3RvcmVkWkluZGV4PXRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiKSksdGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIsby56SW5kZXgpKSx0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMuZG9jdW1lbnRbMF0mJlwiSFRNTFwiIT09dGhpcy5zY3JvbGxQYXJlbnRbMF0udGFnTmFtZSYmKHRoaXMub3ZlcmZsb3dPZmZzZXQ9dGhpcy5zY3JvbGxQYXJlbnQub2Zmc2V0KCkpLHRoaXMuX3RyaWdnZXIoXCJzdGFydFwiLHQsdGhpcy5fdWlIYXNoKCkpLHRoaXMuX3ByZXNlcnZlSGVscGVyUHJvcG9ydGlvbnN8fHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSwhcylmb3Iobj10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7bj49MDtuLS0pdGhpcy5jb250YWluZXJzW25dLl90cmlnZ2VyKFwiYWN0aXZhdGVcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSk7cmV0dXJuIGUudWkuZGRtYW5hZ2VyJiYoZS51aS5kZG1hbmFnZXIuY3VycmVudD10aGlzKSxlLnVpLmRkbWFuYWdlciYmIW8uZHJvcEJlaGF2aW91ciYmZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcyx0KSx0aGlzLmRyYWdnaW5nPSEwLHRoaXMuaGVscGVyLmFkZENsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpLHRoaXMuX21vdXNlRHJhZyh0KSwhMH0sX21vdXNlRHJhZzpmdW5jdGlvbih0KXt2YXIgaSxzLG4sYSxvPXRoaXMub3B0aW9ucyxyPSExO2Zvcih0aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24odCksdGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbyhcImFic29sdXRlXCIpLHRoaXMubGFzdFBvc2l0aW9uQWJzfHwodGhpcy5sYXN0UG9zaXRpb25BYnM9dGhpcy5wb3NpdGlvbkFicyksdGhpcy5vcHRpb25zLnNjcm9sbCYmKHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmXCJIVE1MXCIhPT10aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lPyh0aGlzLm92ZXJmbG93T2Zmc2V0LnRvcCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQtdC5wYWdlWTxvLnNjcm9sbFNlbnNpdGl2aXR5P3RoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1yPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCtvLnNjcm9sbFNwZWVkOnQucGFnZVktdGhpcy5vdmVyZmxvd09mZnNldC50b3A8by5zY3JvbGxTZW5zaXRpdml0eSYmKHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1yPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1vLnNjcm9sbFNwZWVkKSx0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQrdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0V2lkdGgtdC5wYWdlWDxvLnNjcm9sbFNlbnNpdGl2aXR5P3RoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9cj10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0K28uc2Nyb2xsU3BlZWQ6dC5wYWdlWC10aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQ8by5zY3JvbGxTZW5zaXRpdml0eSYmKHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9cj10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0LW8uc2Nyb2xsU3BlZWQpKToodC5wYWdlWS10aGlzLmRvY3VtZW50LnNjcm9sbFRvcCgpPG8uc2Nyb2xsU2Vuc2l0aXZpdHk/cj10aGlzLmRvY3VtZW50LnNjcm9sbFRvcCh0aGlzLmRvY3VtZW50LnNjcm9sbFRvcCgpLW8uc2Nyb2xsU3BlZWQpOnRoaXMud2luZG93LmhlaWdodCgpLSh0LnBhZ2VZLXRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCkpPG8uc2Nyb2xsU2Vuc2l0aXZpdHkmJihyPXRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKHRoaXMuZG9jdW1lbnQuc2Nyb2xsVG9wKCkrby5zY3JvbGxTcGVlZCkpLHQucGFnZVgtdGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KCk8by5zY3JvbGxTZW5zaXRpdml0eT9yPXRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCh0aGlzLmRvY3VtZW50LnNjcm9sbExlZnQoKS1vLnNjcm9sbFNwZWVkKTp0aGlzLndpbmRvdy53aWR0aCgpLSh0LnBhZ2VYLXRoaXMuZG9jdW1lbnQuc2Nyb2xsTGVmdCgpKTxvLnNjcm9sbFNlbnNpdGl2aXR5JiYocj10aGlzLmRvY3VtZW50LnNjcm9sbExlZnQodGhpcy5kb2N1bWVudC5zY3JvbGxMZWZ0KCkrby5zY3JvbGxTcGVlZCkpKSxyIT09ITEmJmUudWkuZGRtYW5hZ2VyJiYhby5kcm9wQmVoYXZpb3VyJiZlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLHQpKSx0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIiksdGhpcy5vcHRpb25zLmF4aXMmJlwieVwiPT09dGhpcy5vcHRpb25zLmF4aXN8fCh0aGlzLmhlbHBlclswXS5zdHlsZS5sZWZ0PXRoaXMucG9zaXRpb24ubGVmdCtcInB4XCIpLHRoaXMub3B0aW9ucy5heGlzJiZcInhcIj09PXRoaXMub3B0aW9ucy5heGlzfHwodGhpcy5oZWxwZXJbMF0uc3R5bGUudG9wPXRoaXMucG9zaXRpb24udG9wK1wicHhcIiksaT10aGlzLml0ZW1zLmxlbmd0aC0xO2k+PTA7aS0tKWlmKHM9dGhpcy5pdGVtc1tpXSxuPXMuaXRlbVswXSxhPXRoaXMuX2ludGVyc2VjdHNXaXRoUG9pbnRlcihzKSxhJiZzLmluc3RhbmNlPT09dGhpcy5jdXJyZW50Q29udGFpbmVyJiZuIT09dGhpcy5jdXJyZW50SXRlbVswXSYmdGhpcy5wbGFjZWhvbGRlclsxPT09YT9cIm5leHRcIjpcInByZXZcIl0oKVswXSE9PW4mJiFlLmNvbnRhaW5zKHRoaXMucGxhY2Vob2xkZXJbMF0sbikmJihcInNlbWktZHluYW1pY1wiPT09dGhpcy5vcHRpb25zLnR5cGU/IWUuY29udGFpbnModGhpcy5lbGVtZW50WzBdLG4pOiEwKSl7aWYodGhpcy5kaXJlY3Rpb249MT09PWE/XCJkb3duXCI6XCJ1cFwiLFwicG9pbnRlclwiIT09dGhpcy5vcHRpb25zLnRvbGVyYW5jZSYmIXRoaXMuX2ludGVyc2VjdHNXaXRoU2lkZXMocykpYnJlYWs7dGhpcy5fcmVhcnJhbmdlKHQscyksdGhpcy5fdHJpZ2dlcihcImNoYW5nZVwiLHQsdGhpcy5fdWlIYXNoKCkpO2JyZWFrfXJldHVybiB0aGlzLl9jb250YWN0Q29udGFpbmVycyh0KSxlLnVpLmRkbWFuYWdlciYmZS51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLHQpLHRoaXMuX3RyaWdnZXIoXCJzb3J0XCIsdCx0aGlzLl91aUhhc2goKSksdGhpcy5sYXN0UG9zaXRpb25BYnM9dGhpcy5wb3NpdGlvbkFicywhMX0sX21vdXNlU3RvcDpmdW5jdGlvbih0LGkpe2lmKHQpe2lmKGUudWkuZGRtYW5hZ2VyJiYhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXImJmUudWkuZGRtYW5hZ2VyLmRyb3AodGhpcyx0KSx0aGlzLm9wdGlvbnMucmV2ZXJ0KXt2YXIgcz10aGlzLG49dGhpcy5wbGFjZWhvbGRlci5vZmZzZXQoKSxhPXRoaXMub3B0aW9ucy5heGlzLG89e307YSYmXCJ4XCIhPT1hfHwoby5sZWZ0PW4ubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdC10aGlzLm1hcmdpbnMubGVmdCsodGhpcy5vZmZzZXRQYXJlbnRbMF09PT10aGlzLmRvY3VtZW50WzBdLmJvZHk/MDp0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KSksYSYmXCJ5XCIhPT1hfHwoby50b3A9bi50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcC10aGlzLm1hcmdpbnMudG9wKyh0aGlzLm9mZnNldFBhcmVudFswXT09PXRoaXMuZG9jdW1lbnRbMF0uYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbFRvcCkpLHRoaXMucmV2ZXJ0aW5nPSEwLGUodGhpcy5oZWxwZXIpLmFuaW1hdGUobyxwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0LDEwKXx8NTAwLGZ1bmN0aW9uKCl7cy5fY2xlYXIodCl9KX1lbHNlIHRoaXMuX2NsZWFyKHQsaSk7cmV0dXJuITF9fSxjYW5jZWw6ZnVuY3Rpb24oKXtpZih0aGlzLmRyYWdnaW5nKXt0aGlzLl9tb3VzZVVwKHt0YXJnZXQ6bnVsbH0pLFwib3JpZ2luYWxcIj09PXRoaXMub3B0aW9ucy5oZWxwZXI/dGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhlbHBlclwiKTp0aGlzLmN1cnJlbnRJdGVtLnNob3coKTtmb3IodmFyIHQ9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO3Q+PTA7dC0tKXRoaXMuY29udGFpbmVyc1t0XS5fdHJpZ2dlcihcImRlYWN0aXZhdGVcIixudWxsLHRoaXMuX3VpSGFzaCh0aGlzKSksdGhpcy5jb250YWluZXJzW3RdLmNvbnRhaW5lckNhY2hlLm92ZXImJih0aGlzLmNvbnRhaW5lcnNbdF0uX3RyaWdnZXIoXCJvdXRcIixudWxsLHRoaXMuX3VpSGFzaCh0aGlzKSksdGhpcy5jb250YWluZXJzW3RdLmNvbnRhaW5lckNhY2hlLm92ZXI9MCl9cmV0dXJuIHRoaXMucGxhY2Vob2xkZXImJih0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUmJnRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLnBsYWNlaG9sZGVyWzBdKSxcIm9yaWdpbmFsXCIhPT10aGlzLm9wdGlvbnMuaGVscGVyJiZ0aGlzLmhlbHBlciYmdGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5oZWxwZXIucmVtb3ZlKCksZS5leHRlbmQodGhpcyx7aGVscGVyOm51bGwsZHJhZ2dpbmc6ITEscmV2ZXJ0aW5nOiExLF9ub0ZpbmFsU29ydDpudWxsfSksdGhpcy5kb21Qb3NpdGlvbi5wcmV2P2UodGhpcy5kb21Qb3NpdGlvbi5wcmV2KS5hZnRlcih0aGlzLmN1cnJlbnRJdGVtKTplKHRoaXMuZG9tUG9zaXRpb24ucGFyZW50KS5wcmVwZW5kKHRoaXMuY3VycmVudEl0ZW0pKSx0aGlzfSxzZXJpYWxpemU6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5fZ2V0SXRlbXNBc2pRdWVyeSh0JiZ0LmNvbm5lY3RlZCkscz1bXTtyZXR1cm4gdD10fHx7fSxlKGkpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT0oZSh0Lml0ZW18fHRoaXMpLmF0dHIodC5hdHRyaWJ1dGV8fFwiaWRcIil8fFwiXCIpLm1hdGNoKHQuZXhwcmVzc2lvbnx8LyguKylbXFwtPV9dKC4rKS8pO2kmJnMucHVzaCgodC5rZXl8fGlbMV0rXCJbXVwiKStcIj1cIisodC5rZXkmJnQuZXhwcmVzc2lvbj9pWzFdOmlbMl0pKX0pLCFzLmxlbmd0aCYmdC5rZXkmJnMucHVzaCh0LmtleStcIj1cIikscy5qb2luKFwiJlwiKX0sdG9BcnJheTpmdW5jdGlvbih0KXt2YXIgaT10aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KHQmJnQuY29ubmVjdGVkKSxzPVtdO3JldHVybiB0PXR8fHt9LGkuZWFjaChmdW5jdGlvbigpe3MucHVzaChlKHQuaXRlbXx8dGhpcykuYXR0cih0LmF0dHJpYnV0ZXx8XCJpZFwiKXx8XCJcIil9KSxzfSxfaW50ZXJzZWN0c1dpdGg6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wb3NpdGlvbkFicy5sZWZ0LGk9dCt0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLHM9dGhpcy5wb3NpdGlvbkFicy50b3Asbj1zK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGE9ZS5sZWZ0LG89YStlLndpZHRoLHI9ZS50b3AsaD1yK2UuaGVpZ2h0LGw9dGhpcy5vZmZzZXQuY2xpY2sudG9wLHU9dGhpcy5vZmZzZXQuY2xpY2subGVmdCxkPVwieFwiPT09dGhpcy5vcHRpb25zLmF4aXN8fHMrbD5yJiZoPnMrbCxjPVwieVwiPT09dGhpcy5vcHRpb25zLmF4aXN8fHQrdT5hJiZvPnQrdSxwPWQmJmM7cmV0dXJuXCJwb2ludGVyXCI9PT10aGlzLm9wdGlvbnMudG9sZXJhbmNlfHx0aGlzLm9wdGlvbnMuZm9yY2VQb2ludGVyRm9yQ29udGFpbmVyc3x8XCJwb2ludGVyXCIhPT10aGlzLm9wdGlvbnMudG9sZXJhbmNlJiZ0aGlzLmhlbHBlclByb3BvcnRpb25zW3RoaXMuZmxvYXRpbmc/XCJ3aWR0aFwiOlwiaGVpZ2h0XCJdPmVbdGhpcy5mbG9hdGluZz9cIndpZHRoXCI6XCJoZWlnaHRcIl0/cDp0K3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMj5hJiZvPmktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yJiZzK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzI+ciYmaD5uLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzJ9LF9pbnRlcnNlY3RzV2l0aFBvaW50ZXI6ZnVuY3Rpb24oZSl7dmFyIHQ9XCJ4XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLnRvcCt0aGlzLm9mZnNldC5jbGljay50b3AsZS50b3AsZS5oZWlnaHQpLGk9XCJ5XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQrdGhpcy5vZmZzZXQuY2xpY2subGVmdCxlLmxlZnQsZS53aWR0aCkscz10JiZpLG49dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksYT10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO3JldHVybiBzP3RoaXMuZmxvYXRpbmc/YSYmXCJyaWdodFwiPT09YXx8XCJkb3duXCI9PT1uPzI6MTpuJiYoXCJkb3duXCI9PT1uPzI6MSk6ITF9LF9pbnRlcnNlY3RzV2l0aFNpZGVzOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2lzT3ZlckF4aXModGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGUudG9wK2UuaGVpZ2h0LzIsZS5oZWlnaHQpLGk9dGhpcy5faXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQrdGhpcy5vZmZzZXQuY2xpY2subGVmdCxlLmxlZnQrZS53aWR0aC8yLGUud2lkdGgpLHM9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksbj10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO3JldHVybiB0aGlzLmZsb2F0aW5nJiZuP1wicmlnaHRcIj09PW4mJml8fFwibGVmdFwiPT09biYmIWk6cyYmKFwiZG93blwiPT09cyYmdHx8XCJ1cFwiPT09cyYmIXQpfSxfZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5wb3NpdGlvbkFicy50b3AtdGhpcy5sYXN0UG9zaXRpb25BYnMudG9wO3JldHVybiAwIT09ZSYmKGU+MD9cImRvd25cIjpcInVwXCIpfSxfZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb246ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnBvc2l0aW9uQWJzLmxlZnQtdGhpcy5sYXN0UG9zaXRpb25BYnMubGVmdDtyZXR1cm4gMCE9PWUmJihlPjA/XCJyaWdodFwiOlwibGVmdFwiKX0scmVmcmVzaDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fcmVmcmVzaEl0ZW1zKGUpLHRoaXMuX3NldEhhbmRsZUNsYXNzTmFtZSgpLHRoaXMucmVmcmVzaFBvc2l0aW9ucygpLHRoaXN9LF9jb25uZWN0V2l0aDpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3B0aW9ucztyZXR1cm4gZS5jb25uZWN0V2l0aC5jb25zdHJ1Y3Rvcj09PVN0cmluZz9bZS5jb25uZWN0V2l0aF06ZS5jb25uZWN0V2l0aH0sX2dldEl0ZW1zQXNqUXVlcnk6ZnVuY3Rpb24odCl7ZnVuY3Rpb24gaSgpe3IucHVzaCh0aGlzKX12YXIgcyxuLGEsbyxyPVtdLGg9W10sbD10aGlzLl9jb25uZWN0V2l0aCgpO2lmKGwmJnQpZm9yKHM9bC5sZW5ndGgtMTtzPj0wO3MtLSlmb3IoYT1lKGxbc10sdGhpcy5kb2N1bWVudFswXSksbj1hLmxlbmd0aC0xO24+PTA7bi0tKW89ZS5kYXRhKGFbbl0sdGhpcy53aWRnZXRGdWxsTmFtZSksbyYmbyE9PXRoaXMmJiFvLm9wdGlvbnMuZGlzYWJsZWQmJmgucHVzaChbZS5pc0Z1bmN0aW9uKG8ub3B0aW9ucy5pdGVtcyk/by5vcHRpb25zLml0ZW1zLmNhbGwoby5lbGVtZW50KTplKG8ub3B0aW9ucy5pdGVtcyxvLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLG9dKTtmb3IoaC5wdXNoKFtlLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnQsbnVsbCx7b3B0aW9uczp0aGlzLm9wdGlvbnMsaXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KS5ub3QoXCIudWktc29ydGFibGUtaGVscGVyXCIpLm5vdChcIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlclwiKSx0aGlzXSkscz1oLmxlbmd0aC0xO3M+PTA7cy0tKWhbc11bMF0uZWFjaChpKTtyZXR1cm4gZShyKX0sX3JlbW92ZUN1cnJlbnRzRnJvbUl0ZW1zOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5jdXJyZW50SXRlbS5maW5kKFwiOmRhdGEoXCIrdGhpcy53aWRnZXROYW1lK1wiLWl0ZW0pXCIpO3RoaXMuaXRlbXM9ZS5ncmVwKHRoaXMuaXRlbXMsZnVuY3Rpb24oZSl7Zm9yKHZhciBpPTA7dC5sZW5ndGg+aTtpKyspaWYodFtpXT09PWUuaXRlbVswXSlyZXR1cm4hMTtyZXR1cm4hMH0pfSxfcmVmcmVzaEl0ZW1zOmZ1bmN0aW9uKHQpe3RoaXMuaXRlbXM9W10sdGhpcy5jb250YWluZXJzPVt0aGlzXTt2YXIgaSxzLG4sYSxvLHIsaCxsLHU9dGhpcy5pdGVtcyxkPVtbZS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5pdGVtcyk/dGhpcy5vcHRpb25zLml0ZW1zLmNhbGwodGhpcy5lbGVtZW50WzBdLHQse2l0ZW06dGhpcy5jdXJyZW50SXRlbX0pOmUodGhpcy5vcHRpb25zLml0ZW1zLHRoaXMuZWxlbWVudCksdGhpc11dLGM9dGhpcy5fY29ubmVjdFdpdGgoKTtpZihjJiZ0aGlzLnJlYWR5KWZvcihpPWMubGVuZ3RoLTE7aT49MDtpLS0pZm9yKG49ZShjW2ldLHRoaXMuZG9jdW1lbnRbMF0pLHM9bi5sZW5ndGgtMTtzPj0wO3MtLSlhPWUuZGF0YShuW3NdLHRoaXMud2lkZ2V0RnVsbE5hbWUpLGEmJmEhPT10aGlzJiYhYS5vcHRpb25zLmRpc2FibGVkJiYoZC5wdXNoKFtlLmlzRnVuY3Rpb24oYS5vcHRpb25zLml0ZW1zKT9hLm9wdGlvbnMuaXRlbXMuY2FsbChhLmVsZW1lbnRbMF0sdCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZShhLm9wdGlvbnMuaXRlbXMsYS5lbGVtZW50KSxhXSksdGhpcy5jb250YWluZXJzLnB1c2goYSkpO2ZvcihpPWQubGVuZ3RoLTE7aT49MDtpLS0pZm9yKG89ZFtpXVsxXSxyPWRbaV1bMF0scz0wLGw9ci5sZW5ndGg7bD5zO3MrKyloPWUocltzXSksaC5kYXRhKHRoaXMud2lkZ2V0TmFtZStcIi1pdGVtXCIsbyksdS5wdXNoKHtpdGVtOmgsaW5zdGFuY2U6byx3aWR0aDowLGhlaWdodDowLGxlZnQ6MCx0b3A6MH0pfSxyZWZyZXNoUG9zaXRpb25zOmZ1bmN0aW9uKHQpe3RoaXMuZmxvYXRpbmc9dGhpcy5pdGVtcy5sZW5ndGg/XCJ4XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5faXNGbG9hdGluZyh0aGlzLml0ZW1zWzBdLml0ZW0pOiExLHRoaXMub2Zmc2V0UGFyZW50JiZ0aGlzLmhlbHBlciYmKHRoaXMub2Zmc2V0LnBhcmVudD10aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSk7dmFyIGkscyxuLGE7Zm9yKGk9dGhpcy5pdGVtcy5sZW5ndGgtMTtpPj0wO2ktLSlzPXRoaXMuaXRlbXNbaV0scy5pbnN0YW5jZSE9PXRoaXMuY3VycmVudENvbnRhaW5lciYmdGhpcy5jdXJyZW50Q29udGFpbmVyJiZzLml0ZW1bMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdfHwobj10aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudD9lKHRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50LHMuaXRlbSk6cy5pdGVtLHR8fChzLndpZHRoPW4ub3V0ZXJXaWR0aCgpLHMuaGVpZ2h0PW4ub3V0ZXJIZWlnaHQoKSksYT1uLm9mZnNldCgpLHMubGVmdD1hLmxlZnQscy50b3A9YS50b3ApO2lmKHRoaXMub3B0aW9ucy5jdXN0b20mJnRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMpdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycy5jYWxsKHRoaXMpO2Vsc2UgZm9yKGk9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2k+PTA7aS0tKWE9dGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub2Zmc2V0KCksdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLmxlZnQ9YS5sZWZ0LHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS50b3A9YS50b3AsdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLndpZHRoPXRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVyV2lkdGgoKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUuaGVpZ2h0PXRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVySGVpZ2h0KCk7cmV0dXJuIHRoaXN9LF9jcmVhdGVQbGFjZWhvbGRlcjpmdW5jdGlvbih0KXt0PXR8fHRoaXM7dmFyIGkscz10Lm9wdGlvbnM7cy5wbGFjZWhvbGRlciYmcy5wbGFjZWhvbGRlci5jb25zdHJ1Y3RvciE9PVN0cmluZ3x8KGk9cy5wbGFjZWhvbGRlcixzLnBsYWNlaG9sZGVyPXtlbGVtZW50OmZ1bmN0aW9uKCl7dmFyIHM9dC5jdXJyZW50SXRlbVswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLG49ZShcIjxcIitzK1wiPlwiLHQuZG9jdW1lbnRbMF0pLmFkZENsYXNzKGl8fHQuY3VycmVudEl0ZW1bMF0uY2xhc3NOYW1lK1wiIHVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpO3JldHVyblwidGJvZHlcIj09PXM/dC5fY3JlYXRlVHJQbGFjZWhvbGRlcih0LmN1cnJlbnRJdGVtLmZpbmQoXCJ0clwiKS5lcSgwKSxlKFwiPHRyPlwiLHQuZG9jdW1lbnRbMF0pLmFwcGVuZFRvKG4pKTpcInRyXCI9PT1zP3QuX2NyZWF0ZVRyUGxhY2Vob2xkZXIodC5jdXJyZW50SXRlbSxuKTpcImltZ1wiPT09cyYmbi5hdHRyKFwic3JjXCIsdC5jdXJyZW50SXRlbS5hdHRyKFwic3JjXCIpKSxpfHxuLmNzcyhcInZpc2liaWxpdHlcIixcImhpZGRlblwiKSxufSx1cGRhdGU6ZnVuY3Rpb24oZSxuKXsoIWl8fHMuZm9yY2VQbGFjZWhvbGRlclNpemUpJiYobi5oZWlnaHQoKXx8bi5oZWlnaHQodC5jdXJyZW50SXRlbS5pbm5lckhlaWdodCgpLXBhcnNlSW50KHQuY3VycmVudEl0ZW0uY3NzKFwicGFkZGluZ1RvcFwiKXx8MCwxMCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nQm90dG9tXCIpfHwwLDEwKSksbi53aWR0aCgpfHxuLndpZHRoKHQuY3VycmVudEl0ZW0uaW5uZXJXaWR0aCgpLXBhcnNlSW50KHQuY3VycmVudEl0ZW0uY3NzKFwicGFkZGluZ0xlZnRcIil8fDAsMTApLXBhcnNlSW50KHQuY3VycmVudEl0ZW0uY3NzKFwicGFkZGluZ1JpZ2h0XCIpfHwwLDEwKSkpfX0pLHQucGxhY2Vob2xkZXI9ZShzLnBsYWNlaG9sZGVyLmVsZW1lbnQuY2FsbCh0LmVsZW1lbnQsdC5jdXJyZW50SXRlbSkpLHQuY3VycmVudEl0ZW0uYWZ0ZXIodC5wbGFjZWhvbGRlcikscy5wbGFjZWhvbGRlci51cGRhdGUodCx0LnBsYWNlaG9sZGVyKX0sX2NyZWF0ZVRyUGxhY2Vob2xkZXI6ZnVuY3Rpb24odCxpKXt2YXIgcz10aGlzO3QuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCl7ZShcIjx0ZD4mIzE2MDs8L3RkPlwiLHMuZG9jdW1lbnRbMF0pLmF0dHIoXCJjb2xzcGFuXCIsZSh0aGlzKS5hdHRyKFwiY29sc3BhblwiKXx8MSkuYXBwZW5kVG8oaSl9KX0sX2NvbnRhY3RDb250YWluZXJzOmZ1bmN0aW9uKHQpe3ZhciBpLHMsbixhLG8scixoLGwsdSxkLGM9bnVsbCxwPW51bGw7Zm9yKGk9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2k+PTA7aS0tKWlmKCFlLmNvbnRhaW5zKHRoaXMuY3VycmVudEl0ZW1bMF0sdGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnRbMF0pKWlmKHRoaXMuX2ludGVyc2VjdHNXaXRoKHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZSkpe2lmKGMmJmUuY29udGFpbnModGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnRbMF0sYy5lbGVtZW50WzBdKSljb250aW51ZTtjPXRoaXMuY29udGFpbmVyc1tpXSxwPWl9ZWxzZSB0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlciYmKHRoaXMuY29udGFpbmVyc1tpXS5fdHJpZ2dlcihcIm91dFwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3Zlcj0wKTtpZihjKWlmKDE9PT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoKXRoaXMuY29udGFpbmVyc1twXS5jb250YWluZXJDYWNoZS5vdmVyfHwodGhpcy5jb250YWluZXJzW3BdLl90cmlnZ2VyKFwib3ZlclwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbcF0uY29udGFpbmVyQ2FjaGUub3Zlcj0xKTtlbHNle2ZvcihuPTFlNCxhPW51bGwsdT1jLmZsb2F0aW5nfHx0aGlzLl9pc0Zsb2F0aW5nKHRoaXMuY3VycmVudEl0ZW0pLG89dT9cImxlZnRcIjpcInRvcFwiLHI9dT9cIndpZHRoXCI6XCJoZWlnaHRcIixkPXU/XCJjbGllbnRYXCI6XCJjbGllbnRZXCIscz10aGlzLml0ZW1zLmxlbmd0aC0xO3M+PTA7cy0tKWUuY29udGFpbnModGhpcy5jb250YWluZXJzW3BdLmVsZW1lbnRbMF0sdGhpcy5pdGVtc1tzXS5pdGVtWzBdKSYmdGhpcy5pdGVtc1tzXS5pdGVtWzBdIT09dGhpcy5jdXJyZW50SXRlbVswXSYmKGg9dGhpcy5pdGVtc1tzXS5pdGVtLm9mZnNldCgpW29dLGw9ITEsdFtkXS1oPnRoaXMuaXRlbXNbc11bcl0vMiYmKGw9ITApLG4+TWF0aC5hYnModFtkXS1oKSYmKG49TWF0aC5hYnModFtkXS1oKSxhPXRoaXMuaXRlbXNbc10sdGhpcy5kaXJlY3Rpb249bD9cInVwXCI6XCJkb3duXCIpKTtpZighYSYmIXRoaXMub3B0aW9ucy5kcm9wT25FbXB0eSlyZXR1cm47aWYodGhpcy5jdXJyZW50Q29udGFpbmVyPT09dGhpcy5jb250YWluZXJzW3BdKXJldHVybiB0aGlzLmN1cnJlbnRDb250YWluZXIuY29udGFpbmVyQ2FjaGUub3Zlcnx8KHRoaXMuY29udGFpbmVyc1twXS5fdHJpZ2dlcihcIm92ZXJcIix0LHRoaXMuX3VpSGFzaCgpKSx0aGlzLmN1cnJlbnRDb250YWluZXIuY29udGFpbmVyQ2FjaGUub3Zlcj0xKSx2b2lkIDA7YT90aGlzLl9yZWFycmFuZ2UodCxhLG51bGwsITApOnRoaXMuX3JlYXJyYW5nZSh0LG51bGwsdGhpcy5jb250YWluZXJzW3BdLmVsZW1lbnQsITApLHRoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIix0LHRoaXMuX3VpSGFzaCgpKSx0aGlzLmNvbnRhaW5lcnNbcF0uX3RyaWdnZXIoXCJjaGFuZ2VcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSksdGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMuY29udGFpbmVyc1twXSx0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIudXBkYXRlKHRoaXMuY3VycmVudENvbnRhaW5lcix0aGlzLnBsYWNlaG9sZGVyKSx0aGlzLmNvbnRhaW5lcnNbcF0uX3RyaWdnZXIoXCJvdmVyXCIsdCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1twXS5jb250YWluZXJDYWNoZS5vdmVyPTF9fSxfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMub3B0aW9ucyxzPWUuaXNGdW5jdGlvbihpLmhlbHBlcik/ZShpLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW3QsdGhpcy5jdXJyZW50SXRlbV0pKTpcImNsb25lXCI9PT1pLmhlbHBlcj90aGlzLmN1cnJlbnRJdGVtLmNsb25lKCk6dGhpcy5jdXJyZW50SXRlbTtyZXR1cm4gcy5wYXJlbnRzKFwiYm9keVwiKS5sZW5ndGh8fGUoXCJwYXJlbnRcIiE9PWkuYXBwZW5kVG8/aS5hcHBlbmRUbzp0aGlzLmN1cnJlbnRJdGVtWzBdLnBhcmVudE5vZGUpWzBdLmFwcGVuZENoaWxkKHNbMF0pLHNbMF09PT10aGlzLmN1cnJlbnRJdGVtWzBdJiYodGhpcy5fc3RvcmVkQ1NTPXt3aWR0aDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLndpZHRoLGhlaWdodDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLmhlaWdodCxwb3NpdGlvbjp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInBvc2l0aW9uXCIpLHRvcDp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInRvcFwiKSxsZWZ0OnRoaXMuY3VycmVudEl0ZW0uY3NzKFwibGVmdFwiKX0pLCghc1swXS5zdHlsZS53aWR0aHx8aS5mb3JjZUhlbHBlclNpemUpJiZzLndpZHRoKHRoaXMuY3VycmVudEl0ZW0ud2lkdGgoKSksKCFzWzBdLnN0eWxlLmhlaWdodHx8aS5mb3JjZUhlbHBlclNpemUpJiZzLmhlaWdodCh0aGlzLmN1cnJlbnRJdGVtLmhlaWdodCgpKSxzfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbih0KXtcInN0cmluZ1wiPT10eXBlb2YgdCYmKHQ9dC5zcGxpdChcIiBcIikpLGUuaXNBcnJheSh0KSYmKHQ9e2xlZnQ6K3RbMF0sdG9wOit0WzFdfHwwfSksXCJsZWZ0XCJpbiB0JiYodGhpcy5vZmZzZXQuY2xpY2subGVmdD10LmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQpLFwicmlnaHRcImluIHQmJih0aGlzLm9mZnNldC5jbGljay5sZWZ0PXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdC5yaWdodCt0aGlzLm1hcmdpbnMubGVmdCksXCJ0b3BcImluIHQmJih0aGlzLm9mZnNldC5jbGljay50b3A9dC50b3ArdGhpcy5tYXJnaW5zLnRvcCksXCJib3R0b21cImluIHQmJih0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdC5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcCl9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgdD10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtyZXR1cm5cImFic29sdXRlXCI9PT10aGlzLmNzc1Bvc2l0aW9uJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMuZG9jdW1lbnRbMF0mJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pJiYodC5sZWZ0Kz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCksdC50b3ArPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpKSwodGhpcy5vZmZzZXRQYXJlbnRbMF09PT10aGlzLmRvY3VtZW50WzBdLmJvZHl8fHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUmJlwiaHRtbFwiPT09dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpJiZlLnVpLmllKSYmKHQ9e3RvcDowLGxlZnQ6MH0pLHt0b3A6dC50b3ArKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCksbGVmdDp0LmxlZnQrKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcyhcImJvcmRlckxlZnRXaWR0aFwiKSwxMCl8fDApfX0sX2dldFJlbGF0aXZlT2Zmc2V0OmZ1bmN0aW9uKCl7aWYoXCJyZWxhdGl2ZVwiPT09dGhpcy5jc3NQb3NpdGlvbil7dmFyIGU9dGhpcy5jdXJyZW50SXRlbS5wb3NpdGlvbigpO3JldHVybnt0b3A6ZS50b3AtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcInRvcFwiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLGxlZnQ6ZS5sZWZ0LShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoXCJsZWZ0XCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpfX1yZXR1cm57dG9wOjAsbGVmdDowfX0sX2NhY2hlTWFyZ2luczpmdW5jdGlvbigpe3RoaXMubWFyZ2lucz17bGVmdDpwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcyhcIm1hcmdpbkxlZnRcIiksMTApfHwwLHRvcDpwYXJzZUludCh0aGlzLmN1cnJlbnRJdGVtLmNzcyhcIm1hcmdpblRvcFwiKSwxMCl8fDB9fSxfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczpmdW5jdGlvbigpe3RoaXMuaGVscGVyUHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKX19LF9zZXRDb250YWlubWVudDpmdW5jdGlvbigpe3ZhciB0LGkscyxuPXRoaXMub3B0aW9ucztcInBhcmVudFwiPT09bi5jb250YWlubWVudCYmKG4uY29udGFpbm1lbnQ9dGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSksKFwiZG9jdW1lbnRcIj09PW4uY29udGFpbm1lbnR8fFwid2luZG93XCI9PT1uLmNvbnRhaW5tZW50KSYmKHRoaXMuY29udGFpbm1lbnQ9WzAtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCwwLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLFwiZG9jdW1lbnRcIj09PW4uY29udGFpbm1lbnQ/dGhpcy5kb2N1bWVudC53aWR0aCgpOnRoaXMud2luZG93LndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCwoXCJkb2N1bWVudFwiPT09bi5jb250YWlubWVudD90aGlzLmRvY3VtZW50LndpZHRoKCk6dGhpcy53aW5kb3cuaGVpZ2h0KCl8fHRoaXMuZG9jdW1lbnRbMF0uYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF0pLC9eKGRvY3VtZW50fHdpbmRvd3xwYXJlbnQpJC8udGVzdChuLmNvbnRhaW5tZW50KXx8KHQ9ZShuLmNvbnRhaW5tZW50KVswXSxpPWUobi5jb250YWlubWVudCkub2Zmc2V0KCkscz1cImhpZGRlblwiIT09ZSh0KS5jc3MoXCJvdmVyZmxvd1wiKSx0aGlzLmNvbnRhaW5tZW50PVtpLmxlZnQrKHBhcnNlSW50KGUodCkuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ0xlZnRcIiksMTApfHwwKS10aGlzLm1hcmdpbnMubGVmdCxpLnRvcCsocGFyc2VJbnQoZSh0KS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSwxMCl8fDApKyhwYXJzZUludChlKHQpLmNzcyhcInBhZGRpbmdUb3BcIiksMTApfHwwKS10aGlzLm1hcmdpbnMudG9wLGkubGVmdCsocz9NYXRoLm1heCh0LnNjcm9sbFdpZHRoLHQub2Zmc2V0V2lkdGgpOnQub2Zmc2V0V2lkdGgpLShwYXJzZUludChlKHQpLmNzcyhcImJvcmRlckxlZnRXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChlKHQpLmNzcyhcInBhZGRpbmdSaWdodFwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQsaS50b3ArKHM/TWF0aC5tYXgodC5zY3JvbGxIZWlnaHQsdC5vZmZzZXRIZWlnaHQpOnQub2Zmc2V0SGVpZ2h0KS0ocGFyc2VJbnQoZSh0KS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChlKHQpLmNzcyhcInBhZGRpbmdCb3R0b21cIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXSlcbn0sX2NvbnZlcnRQb3NpdGlvblRvOmZ1bmN0aW9uKHQsaSl7aXx8KGk9dGhpcy5wb3NpdGlvbik7dmFyIHM9XCJhYnNvbHV0ZVwiPT09dD8xOi0xLG49XCJhYnNvbHV0ZVwiIT09dGhpcy5jc3NQb3NpdGlvbnx8dGhpcy5zY3JvbGxQYXJlbnRbMF0hPT10aGlzLmRvY3VtZW50WzBdJiZlLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKT90aGlzLnNjcm9sbFBhcmVudDp0aGlzLm9mZnNldFBhcmVudCxhPS8oaHRtbHxib2R5KS9pLnRlc3QoblswXS50YWdOYW1lKTtyZXR1cm57dG9wOmkudG9wK3RoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcCpzK3RoaXMub2Zmc2V0LnBhcmVudC50b3Aqcy0oXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6YT8wOm4uc2Nyb2xsVG9wKCkpKnMsbGVmdDppLmxlZnQrdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCpzK3RoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KnMtKFwiZml4ZWRcIj09PXRoaXMuY3NzUG9zaXRpb24/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTphPzA6bi5zY3JvbGxMZWZ0KCkpKnN9fSxfZ2VuZXJhdGVQb3NpdGlvbjpmdW5jdGlvbih0KXt2YXIgaSxzLG49dGhpcy5vcHRpb25zLGE9dC5wYWdlWCxvPXQucGFnZVkscj1cImFic29sdXRlXCIhPT10aGlzLmNzc1Bvc2l0aW9ufHx0aGlzLnNjcm9sbFBhcmVudFswXSE9PXRoaXMuZG9jdW1lbnRbMF0mJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pP3RoaXMuc2Nyb2xsUGFyZW50OnRoaXMub2Zmc2V0UGFyZW50LGg9LyhodG1sfGJvZHkpL2kudGVzdChyWzBdLnRhZ05hbWUpO3JldHVyblwicmVsYXRpdmVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5kb2N1bWVudFswXSYmdGhpcy5zY3JvbGxQYXJlbnRbMF0hPT10aGlzLm9mZnNldFBhcmVudFswXXx8KHRoaXMub2Zmc2V0LnJlbGF0aXZlPXRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCkpLHRoaXMub3JpZ2luYWxQb3NpdGlvbiYmKHRoaXMuY29udGFpbm1lbnQmJih0LnBhZ2VYLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8dGhpcy5jb250YWlubWVudFswXSYmKGE9dGhpcy5jb250YWlubWVudFswXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0KSx0LnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdJiYobz10aGlzLmNvbnRhaW5tZW50WzFdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCksdC5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PnRoaXMuY29udGFpbm1lbnRbMl0mJihhPXRoaXMuY29udGFpbm1lbnRbMl0rdGhpcy5vZmZzZXQuY2xpY2subGVmdCksdC5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A+dGhpcy5jb250YWlubWVudFszXSYmKG89dGhpcy5jb250YWlubWVudFszXSt0aGlzLm9mZnNldC5jbGljay50b3ApKSxuLmdyaWQmJihpPXRoaXMub3JpZ2luYWxQYWdlWStNYXRoLnJvdW5kKChvLXRoaXMub3JpZ2luYWxQYWdlWSkvbi5ncmlkWzFdKSpuLmdyaWRbMV0sbz10aGlzLmNvbnRhaW5tZW50P2ktdGhpcy5vZmZzZXQuY2xpY2sudG9wPj10aGlzLmNvbnRhaW5tZW50WzFdJiZpLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDw9dGhpcy5jb250YWlubWVudFszXT9pOmktdGhpcy5vZmZzZXQuY2xpY2sudG9wPj10aGlzLmNvbnRhaW5tZW50WzFdP2ktbi5ncmlkWzFdOmkrbi5ncmlkWzFdOmkscz10aGlzLm9yaWdpbmFsUGFnZVgrTWF0aC5yb3VuZCgoYS10aGlzLm9yaWdpbmFsUGFnZVgpL24uZ3JpZFswXSkqbi5ncmlkWzBdLGE9dGhpcy5jb250YWlubWVudD9zLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+PXRoaXMuY29udGFpbm1lbnRbMF0mJnMtdGhpcy5vZmZzZXQuY2xpY2subGVmdDw9dGhpcy5jb250YWlubWVudFsyXT9zOnMtdGhpcy5vZmZzZXQuY2xpY2subGVmdD49dGhpcy5jb250YWlubWVudFswXT9zLW4uZ3JpZFswXTpzK24uZ3JpZFswXTpzKSkse3RvcDpvLXRoaXMub2Zmc2V0LmNsaWNrLnRvcC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCsoXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6aD8wOnIuc2Nyb2xsVG9wKCkpLGxlZnQ6YS10aGlzLm9mZnNldC5jbGljay5sZWZ0LXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQrKFwiZml4ZWRcIj09PXRoaXMuY3NzUG9zaXRpb24/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTpoPzA6ci5zY3JvbGxMZWZ0KCkpfX0sX3JlYXJyYW5nZTpmdW5jdGlvbihlLHQsaSxzKXtpP2lbMF0uYXBwZW5kQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk6dC5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sXCJkb3duXCI9PT10aGlzLmRpcmVjdGlvbj90Lml0ZW1bMF06dC5pdGVtWzBdLm5leHRTaWJsaW5nKSx0aGlzLmNvdW50ZXI9dGhpcy5jb3VudGVyPysrdGhpcy5jb3VudGVyOjE7dmFyIG49dGhpcy5jb3VudGVyO3RoaXMuX2RlbGF5KGZ1bmN0aW9uKCl7bj09PXRoaXMuY291bnRlciYmdGhpcy5yZWZyZXNoUG9zaXRpb25zKCFzKX0pfSxfY2xlYXI6ZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKGUsdCxpKXtyZXR1cm4gZnVuY3Rpb24ocyl7aS5fdHJpZ2dlcihlLHMsdC5fdWlIYXNoKHQpKX19dGhpcy5yZXZlcnRpbmc9ITE7dmFyIHMsbj1bXTtpZighdGhpcy5fbm9GaW5hbFNvcnQmJnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KCkubGVuZ3RoJiZ0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0aGlzLmN1cnJlbnRJdGVtKSx0aGlzLl9ub0ZpbmFsU29ydD1udWxsLHRoaXMuaGVscGVyWzBdPT09dGhpcy5jdXJyZW50SXRlbVswXSl7Zm9yKHMgaW4gdGhpcy5fc3RvcmVkQ1NTKShcImF1dG9cIj09PXRoaXMuX3N0b3JlZENTU1tzXXx8XCJzdGF0aWNcIj09PXRoaXMuX3N0b3JlZENTU1tzXSkmJih0aGlzLl9zdG9yZWRDU1Nbc109XCJcIik7dGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhlbHBlclwiKX1lbHNlIHRoaXMuY3VycmVudEl0ZW0uc2hvdygpO2Zvcih0aGlzLmZyb21PdXRzaWRlJiYhdCYmbi5wdXNoKGZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJyZWNlaXZlXCIsZSx0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpfSksIXRoaXMuZnJvbU91dHNpZGUmJnRoaXMuZG9tUG9zaXRpb24ucHJldj09PXRoaXMuY3VycmVudEl0ZW0ucHJldigpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIilbMF0mJnRoaXMuZG9tUG9zaXRpb24ucGFyZW50PT09dGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKVswXXx8dHx8bi5wdXNoKGZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJ1cGRhdGVcIixlLHRoaXMuX3VpSGFzaCgpKX0pLHRoaXMhPT10aGlzLmN1cnJlbnRDb250YWluZXImJih0fHwobi5wdXNoKGZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJyZW1vdmVcIixlLHRoaXMuX3VpSGFzaCgpKX0pLG4ucHVzaChmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7ZS5fdHJpZ2dlcihcInJlY2VpdmVcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jdXJyZW50Q29udGFpbmVyKSksbi5wdXNoKGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtlLl90cmlnZ2VyKFwidXBkYXRlXCIsdCx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY3VycmVudENvbnRhaW5lcikpKSkscz10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7cz49MDtzLS0pdHx8bi5wdXNoKGkoXCJkZWFjdGl2YXRlXCIsdGhpcyx0aGlzLmNvbnRhaW5lcnNbc10pKSx0aGlzLmNvbnRhaW5lcnNbc10uY29udGFpbmVyQ2FjaGUub3ZlciYmKG4ucHVzaChpKFwib3V0XCIsdGhpcyx0aGlzLmNvbnRhaW5lcnNbc10pKSx0aGlzLmNvbnRhaW5lcnNbc10uY29udGFpbmVyQ2FjaGUub3Zlcj0wKTtpZih0aGlzLnN0b3JlZEN1cnNvciYmKHRoaXMuZG9jdW1lbnQuZmluZChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsdGhpcy5zdG9yZWRDdXJzb3IpLHRoaXMuc3RvcmVkU3R5bGVzaGVldC5yZW1vdmUoKSksdGhpcy5fc3RvcmVkT3BhY2l0eSYmdGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiLHRoaXMuX3N0b3JlZE9wYWNpdHkpLHRoaXMuX3N0b3JlZFpJbmRleCYmdGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIsXCJhdXRvXCI9PT10aGlzLl9zdG9yZWRaSW5kZXg/XCJcIjp0aGlzLl9zdG9yZWRaSW5kZXgpLHRoaXMuZHJhZ2dpbmc9ITEsdHx8dGhpcy5fdHJpZ2dlcihcImJlZm9yZVN0b3BcIixlLHRoaXMuX3VpSGFzaCgpKSx0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSksdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsfHwodGhpcy5oZWxwZXJbMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmhlbHBlci5yZW1vdmUoKSx0aGlzLmhlbHBlcj1udWxsKSwhdCl7Zm9yKHM9MDtuLmxlbmd0aD5zO3MrKyluW3NdLmNhbGwodGhpcyxlKTt0aGlzLl90cmlnZ2VyKFwic3RvcFwiLGUsdGhpcy5fdWlIYXNoKCkpfXJldHVybiB0aGlzLmZyb21PdXRzaWRlPSExLCF0aGlzLmNhbmNlbEhlbHBlclJlbW92YWx9LF90cmlnZ2VyOmZ1bmN0aW9uKCl7ZS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmFwcGx5KHRoaXMsYXJndW1lbnRzKT09PSExJiZ0aGlzLmNhbmNlbCgpfSxfdWlIYXNoOmZ1bmN0aW9uKHQpe3ZhciBpPXR8fHRoaXM7cmV0dXJue2hlbHBlcjppLmhlbHBlcixwbGFjZWhvbGRlcjppLnBsYWNlaG9sZGVyfHxlKFtdKSxwb3NpdGlvbjppLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246aS5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDppLnBvc2l0aW9uQWJzLGl0ZW06aS5jdXJyZW50SXRlbSxzZW5kZXI6dD90LmVsZW1lbnQ6bnVsbH19fSl9KTtcbiIsIi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXG4vLyBDSEFOR0VMSVNUXG4vKiBnbG9iYWwgQ01TLCB0cmVlX2NvbXBvbmVudCAqL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy8gQ01TLiQgd2lsbCBiZSBwYXNzZWQgZm9yICRcbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLyohXG4gICAgICAgICAqIFRyZWVNYW5hZ2VyXG4gICAgICAgICAqIEhhbmRsZXMgdHJlZXZpZXdcbiAgICAgICAgICogVE9ETyB0aGlzIHdpbGwgYmUgcmVmYWN0b3JlZCBpbiAzLjJcbiAgICAgICAgICovXG4gICAgICAgIENNUy5UcmVlTWFuYWdlciA9IG5ldyBDTVMuQ2xhc3Moe1xuXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgJ2xhbmcnOiB7fVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dXBGdW5jdGlvbnMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwVHJlZVB1Ymxpc2hpbmcoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHVwVUlIYWNrcygpO1xuXG4gICAgICAgICAgICAgICAgLy8gbG9hZCBpbnRlcm5hbCBmdW5jdGlvbnNcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5zZXR0aW5ncy5maWx0ZXJlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHVwR2xvYmFscygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHVwVHJlZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGluaXQgdHJlZSBjb21wb25lbnRcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmluaXRUcmVlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBmaWx0ZXJlZCBpcyBhY3RpdmUsIHByZXZlbnQgdHJlZSBhY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgICQuc3luY0NvbHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzZXR1cEZ1bmN0aW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgICAgICQuc3luY0NvbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtc29mdHJvb3QnKS5zeW5jV2lkdGgoMCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtYXBwaG9vaycpLnN5bmNXaWR0aCgwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpdGVtYXAgLmNvbC1sYW5ndWFnZScpLnN5bmNXaWR0aCgwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpdGVtYXAgLmNvbC1uYXZpZ2F0aW9uJykuc3luY1dpZHRoKDApO1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2l0ZW1hcCAuY29sLWFjdGlvbnMnKS5zeW5jV2lkdGgoMCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtaW5mbycpLnN5bmNXaWR0aCgwKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LnJlZnJlc2hDb2x1bW5zLmNhbGwoJCgndWwudHJlZS1kZWZhdWx0IGxpJykpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKiBDb2x1bXMgd2lkdGggc3luYyAqL1xuICAgICAgICAgICAgICAgICQuZm4uc3luY1dpZHRoID0gZnVuY3Rpb24gKG1heCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSAkKHRoaXMpLndpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA+IG1heCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXggPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZpc2libGUgJiYgbWF4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnd2lkdGgnLCBtYXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8ganF1ZXJ5LmZ1bmN0aW9uYWxcbiAgICAgICAgICAgICAgICAkLmN1cnJ5ID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gJC5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxLCBhcmd1bWVudHMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmdzLmNvbmNhdCgkLm1ha2VBcnJheShhcmd1bWVudHMpKSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICQuX19jYWxsYmFja1Bvb2wgPSB7fTtcblxuICAgICAgICAgICAgICAgICQuY2FsbGJhY2tSZWdpc3RlciA9IGZ1bmN0aW9uIChuYW1lLCBmbiAvKiwgYXJnMCwgYXJnMSwgLi4qLykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBjdXJyaWVkIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBmbiA9ICQuY3VycnkuYXBwbHkodGhpcywgJC5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxLCBhcmd1bWVudHMubGVuZ3RoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJC5fX2NhbGxiYWNrUG9vbFtuYW1lXSA9IGZuO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgJC5jYWxsYmFja0NhbGwgPSBmdW5jdGlvbiAobmFtZS8qLCBleHRyYSBhcmcwLCBleHRyYSBhcmcxLCAuLiovKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbmFtZSB8fCAhKG5hbWUgaW4gJC5fX2NhbGxiYWNrUG9vbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93ICdObyBjYWxsYmFjayByZWdpc3RlcmVkIHdpdGggbmFtZTogJyArIG5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJC5fX2NhbGxiYWNrUG9vbFtuYW1lXS5hcHBseSh0aGlzLCAkLm1ha2VBcnJheShhcmd1bWVudHMpLnNsaWNlKDEsIGFyZ3VtZW50cy5sZW5ndGgpKTtcbiAgICAgICAgICAgICAgICAgICAgJC5jYWxsYmFja1JlbW92ZShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICQuY2FsbGJhY2tSZW1vdmUgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgJC5fX2NhbGxiYWNrUG9vbFtuYW1lXTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gdmVyeSBzaW1wbGUgeWVsbG93IGZhZGUgcGx1Z2luLi5cbiAgICAgICAgICAgICAgICAkLmZuLnlmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZmZlY3QoJ2hpZ2hsaWdodCcsIHt9LCAxMDAwKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8ganF1ZXJ5IHJlcGxhY2UgcGx1Z2luIDopXG4gICAgICAgICAgICAgICAgJC5mbi5yZXBsYWNlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWZ0ZXIobykucmVtb3ZlKCkuZW5kKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2V0dXBUcmVlUHVibGlzaGluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIEFERCBESVJFQ1QgUFVCTElTSElOR1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgdHJlZSA9ICQoJy50cmVlJyk7XG4gICAgICAgICAgICAgICAgdmFyIGxhbmdUcmlnZ2VyID0gJy5jb2wtbGFuZ3VhZ2UgLnRyaWdnZXItdG9vbHRpcCBzcGFuJztcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1Rvb2x0aXBzID0gJy5sYW5ndWFnZS10b29sdGlwJztcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1RpbWVyID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgdmFyIGxhbmdEZWxheSA9IDEwMDtcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ0ZhZGVEdXJhdGlvbiA9IDIwMDtcbiAgICAgICAgICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciB0aGUgcHVibGlzaGluZyB0b29sdGlwIG9uIHRvdWNoIGRldmljZXNcbiAgICAgICAgICAgICAgICB2YXIgdG91Y2hVc2VkTm9kZTtcblxuICAgICAgICAgICAgICAgIC8vIHNob3cgdGhlIHRvb2x0aXBcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGxhbmdUcmlnZ2VyLCAncG9pbnRlcm92ZXIgdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcykuY2xvc2VzdCgnLmNvbC1sYW5ndWFnZScpLmZpbmQoJy5sYW5ndWFnZS10b29sdGlwJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxhbmdUaW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHRvb2x0aXAgYWxyZWFkeSB2aXNpYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5pcygnOnZpc2libGUnKSAmJiAhdG91Y2hVc2VkTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvcnJlY3QgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgZWwuY3NzKCdyaWdodCcsIDIwICsgJCh0aGlzKS5wb3NpdGlvbigpLmxlZnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgYWxsIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgICQobGFuZ1Rvb2x0aXBzKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hVc2VkTm9kZSA9IHRvdWNoVXNlZE5vZGUgPT09IGUudGFyZ2V0ID8gZmFsc2UgOiBlLnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaFVzZWROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIGEgdGltZW91dCB0byBkaXNwbGF5IHRoZSB0b29sdGlwXG4gICAgICAgICAgICAgICAgICAgIGxhbmdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuc3RvcCh0cnVlLCB0cnVlKS5mYWRlSW4obGFuZ0ZhZGVEdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5jbG9zZXN0KCcubW92ZWFibGUnKS5hZGRDbGFzcygnaG92ZXInKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgbGFuZ0RlbGF5KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBoaWRlIHRoZSB0b29sdGlwIHdoZW4gbGVhdmluZyB0aGUgYXJlYVxuICAgICAgICAgICAgICAgIHRyZWUuZGVsZWdhdGUobGFuZ1RyaWdnZXIsICdwb2ludGVyb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodG91Y2hVc2VkTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxhbmdUaW1lcik7XG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgYWxsIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIGxhbmdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChsYW5nVG9vbHRpcHMpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuICAgICAgICAgICAgICAgICAgICB9LCBsYW5nRGVsYXkgKiAyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyByZXNldCBoaWRpbmcgd2hlbiBlbnRlcmluZyB0aGUgdG9vbHRpcCBpdHNlbGZcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGxhbmdUb29sdGlwcywgJ3BvaW50ZXJvdmVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciB0aW1lclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobGFuZ1RpbWVyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGxhbmdUb29sdGlwcywgJ3BvaW50ZXJvdXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgYWxsIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgIGxhbmdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJChsYW5nVG9vbHRpcHMpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlYWJsZScpLnJlbW92ZUNsYXNzKCdob3ZlcicpO1xuICAgICAgICAgICAgICAgICAgICB9LCBsYW5nRGVsYXkgKiAyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBhdHRhY2ggZG91YmxlIGNoZWNrIGV2ZW50IGlmIHB1Ymxpc2ggb3IgdW5wdWJsaXNoIHNob3VsZCBiZSB0cmlnZ2VyZWRcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKCcubGFuZ3VhZ2UtdG9vbHRpcCBhJywgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCBpZiBub3QgY29uZmlybWVkXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29uZmlybSh0aGF0Lm9wdGlvbnMubGFuZy5wdWJsaXNoLnJlcGxhY2UoJ8KnJywgJCh0aGlzKS50ZXh0KCkudG9Mb3dlckNhc2UoKSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIHBvc3QgcmVxdWVzdCB0byBwcmV2ZW50IHhzcyBhdHRhY2tzXG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncG9zdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICQodGhpcykucHJvcCgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldHVwVUlIYWNrczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIGFkZHMgZnVuY3Rpb25hbGl0eSB0byB0aGUgZmlsdGVyXG4gICAgICAgICAgICAgICAgJCgnI2NoYW5nZWxpc3QtZmlsdGVyLWJ1dHRvbicpLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjY2hhbmdlbGlzdC1maWx0ZXInKS50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNldCBjb3JyZWN0IGFjdGl2ZSBlbnRyeVxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cucGFyZW50ICYmIHdpbmRvdy5wYXJlbnQuQ01TICYmIHdpbmRvdy5wYXJlbnQuQ01TLmNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZV9pZCA9IHdpbmRvdy5wYXJlbnQuQ01TLmNvbmZpZy5yZXF1ZXN0LnBhZ2VfaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgJCgnZGl2W2RhdGEtcGFnZV9pZD1cIicgKyBwYWdlX2lkICsgJ1wiXScpLmFkZENsYXNzKCdjb250LWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldHVwR2xvYmFsczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gJyc7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cubW92ZVN1Y2Nlc3MgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAkLnN5bmNDb2xzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgbXNnID0gJCgnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+JyArIHRoYXQub3B0aW9ucy5sYW5nLnN1Y2Nlc3MgKyAnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSB3aW5kb3cucGFyZW50O1xuXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYWZ0ZXIobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQoKS5maW5kKCcuY29sMicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgbXNnLmZhZGVPdXQoMTAwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQoKS5maW5kKCcuY29sMicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciByZWxvYWQgY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LnNlbGYgIT09IHdpbmRvdy50b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQuQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIoZmFsc2UsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQuQ01TLkFQSS5NZXNzYWdlcy5vcGVuKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiB0aGF0Lm9wdGlvbnMubGFuZy5jaGFuZ2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiAwXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cubW92ZUVycm9yID0gZnVuY3Rpb24gKG5vZGUsIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZSAhPT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gJCgnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+JyArIG1lc3NhZ2UgKyAnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gJCgnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+JyArIHRoYXQub3B0aW9ucy5sYW5nLmVycm9yICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBub2RlLnBhcmVudCgpLmZpbmQoJy5jb2wyJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICBub2RlLmFmdGVyKG1zZyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2V0dXBUcmVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciB0cmVlO1xuICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICtcbiAgICAgICAgICAgICAgICAgICAgKHdpbmRvdy5sb2NhdGlvbi5wb3J0ID8gJzonICsgd2luZG93LmxvY2F0aW9uLnBvcnQgOiAnJyk7XG4gICAgICAgICAgICAgICAgLy8gZ2xvYmFsIGluaXRUcmVlIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgd2luZG93LmluaXRUcmVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBqc2hpbnQgbmV3Y2FwOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAvLyBqc2NzOmRpc2FibGUgcmVxdWlyZUNhcGl0YWxpemVkQ29uc3RydWN0b3JzXG4gICAgICAgICAgICAgICAgICAgIHRyZWUgPSBuZXcgdHJlZV9jb21wb25lbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8ganNjczplbmFibGUgcmVxdWlyZUNhcGl0YWxpemVkQ29uc3RydWN0b3JzXG4gICAgICAgICAgICAgICAgICAgIC8vIGpzaGludCBuZXdjYXA6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuYW1lYWJsZTogJ25vbmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0YWJsZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRhYmxlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdydWxlczogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHBhYmxlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YSA6ICdtZGF0YScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlX2lubGluZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZHJvcHBhYmxlIDogWyd0cmVlX2Ryb3AnXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhcyB0byBiZSBhYnNvbHV0ZSBmdWxsIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG9yaWdpbiArIHRoYXQub3B0aW9ucy5zZXR0aW5ncy5zdGF0aWNQYXRoICsgJ2Ntcy9qcy9qc3RyZWUvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG90czogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl9tb2RlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhlbWVfcGF0aDogc2NyaXB0X3VybF9wYXRoKCkgKyAnLy4uL2pzdHJlZS90aGVtZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhX2NsYXNzOiAndGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcyA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXg6ICdkamFuZ29jbXNfbm9kZXMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVtb3ZlICA6IGZ1bmN0aW9uICh3aGF0LCB3aGVyZSwgcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lml0ZW1faWQgPSB3aGF0LmlkLnNwbGl0KCdwYWdlXycpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0X2lkID0gd2hlcmUuaWQuc3BsaXQoJ3BhZ2VfJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRfbm9kZSA9IHdoYXQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQod2hhdCkucGFyZW50KCkuY2hpbGRyZW4oJ2xpJykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQod2hhdCkubmV4dCgnbGknKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX3RhcmdldCA9ICQod2hhdCkubmV4dCgnbGknKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX3Bvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHdoYXQpLnByZXYoJ2xpJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF90YXJnZXQgPSAkKHdoYXQpLnByZXYoJ2xpJylbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF9wb3NpdGlvbiA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHdoYXQpLmF0dHIoJ3JlbCcpICE9PSAndG9wbm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX3RhcmdldCA9ICQod2hhdCkucGFyZW50KCkucGFyZW50KClbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF9wb3NpdGlvbiA9ICdpbnNpZGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVW5kbyh3aGF0LCB3aGVyZSwgcG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubW92ZTogZnVuY3Rpb24gKHdoYXQsIHdoZXJlLCBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaXRlbV9pZCA9IHdoYXQuaWQuc3BsaXQoJ3BhZ2VfJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy50YXJnZXRfaWQgPSB3aGVyZS5pZC5zcGxpdCgncGFnZV8nKVsxXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPT09ICdiZWZvcmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ2FmdGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAncmlnaHQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAnaW5zaWRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAnbGFzdC1jaGlsZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZVRyZWVJdGVtKHdoYXQsIHdpbmRvdy5pdGVtX2lkLCB3aW5kb3cudGFyZ2V0X2lkLCBwb3NpdGlvbiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZUNhbGMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoISQoJCgnZGl2LnRyZWUnKS5nZXQoMCkpLmhhc0NsYXNzKCdyb290X2FsbG93X2NoaWxkcmVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc2Fsb3cgcG9zc2liaWxpdHkgZm9yIGFkZGluZyBzdWJub2RlcyB0byBtYWluIHRyZWUsIHVzZXIgZG9lc24ndFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSBwZXJtaXNzaW9ucyBmb3IgdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5ydWxlcy5kcmFncnVsZXMgPSBbJ25vZGUgaW5zaWRlIHRvcG5vZGUnLCAndG9wbm9kZSBpbnNpZGUgdG9wbm9kZScsICdub2RlICogbm9kZSddO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdHJlZS5pbml0KCQoJ2Rpdi50cmVlJyksIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGFjdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgdmFyIF9vbGRBamF4ID0gJC5hamF4O1xuXG4gICAgICAgICAgICAgICAgJC5hamF4ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8ganVzdCBvdmVycmlkZSBhamF4IGZ1bmN0aW9uLCBzbyB0aGUgbG9hZGVyIG1lc3NhZ2UgZ2V0cyBkaXNwbGF5ZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gYWx3YXlzXG4gICAgICAgICAgICAgICAgICAgICQoJyNsb2FkZXItbWVzc2FnZScpLnNob3coKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBzLnN1Y2Nlc3MgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHMuc3VjY2VzcyA9IGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEsIHN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbG9hZGVyLW1lc3NhZ2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8ganVzdCBmb3IgZGVidWdpbmchIVxuICAgICAgICAgICAgICAgICAgICAvKnMuY29tcGxldGUgPSBmdW5jdGlvbiAoeGhyLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gJ2Vycm9yJyAmJiB0aGF0Lm9wdGlvbnMuc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYmVmb3JlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgICAgICAgICAgLy8gZW5kIGp1c3QgZm9yIGRlYnVnaW5nXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogYWRkIGVycm9yIHN0YXRlIVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX29sZEFqYXgocyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIC8vIGRlZmluZWQgYnV0IG5ldmVyIHVzZWRcbiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbiByZWZyZXNoKCkge1xuICAgICAgICAgICAgICAgIC8vICAgICB3aW5kb3cubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICAgICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgICAgICAvLyAvLyBkZWZpbmVkIGJ1dCBuZXZlciB1c2VkXG4gICAgICAgICAgICAgICAgLy8gZnVuY3Rpb24gcmVmcmVzaElmQ2hpbGRyZW4ocGFnZUlkKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkKCcjcGFnZV8nICsgcGFnZUlkKS5maW5kKCdsaVtpZF49cGFnZV9dJykubGVuZ3RoID9cbiAgICAgICAgICAgICAgICAvLyAgICAgcmVmcmVzaCA6XG4gICAgICAgICAgICAgICAgLy8gICAgIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH07XG4gICAgICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTG9hZHMgcmVtb3RlIGRpYWxvZyB0byBkaWFsb2dzIGRpdi5cbiAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmxcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBEYXRhIHRvIGJlIHNlbmQgb3ZlciBwb3N0XG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gbm9EaWFsb2dDYWxsYmFjayBHZXRzIGNhbGxlZCB3aGVuIHJlc3BvbnNlIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFN0YW5kYXJkIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWREaWFsb2codXJsLCBkYXRhLCBub0RpYWxvZ0NhbGxiYWNrLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJC5wb3N0KHVybCwgZGF0YSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgPT09ICcnICYmIG5vRGlhbG9nQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0RpYWxvZ0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjZGlhbG9ncycpLmVtcHR5KCkuYXBwZW5kKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbWFya19jb3B5X25vZGUoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnYS5tb3ZlLXRhcmdldCwgc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXIsIHNwYW4ubGluZScpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIGlkKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIGlkKS5wYXJlbnQoKS5wYXJlbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKCdkaXYuY29udCcpLmZpbmQoJ2EubW92ZS10YXJnZXQuZmlyc3QtY2hpbGQsIHNwYW4uc2Vjb25kJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgaWQpLnBhcmVudCgpLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oJ3VsJykuY2hpbGRyZW4oJ2xpJykuY2hpbGRyZW4oJ2Rpdi5jb250JylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCdhLm1vdmUtdGFyZ2V0LmxlZnQsIGEubW92ZS10YXJnZXQucmlnaHQsIHNwYW4uZmlyc3QsIHNwYW4uc2Vjb25kJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2NvcHknO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgLy8gbGV0J3Mgc3RhcnQgZXZlbnQgZGVsZWdhdGlvblxuICAgICAgICAgICAgICAgICQoJyNjaGFuZ2VsaXN0IGxpJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSSB3YW50IGEgbGluayB0byBjaGVjayB0aGUgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUgPT09ICdJTUcnIHx8IGUudGFyZ2V0LnRhZ05hbWUgPT09ICdTUEFOJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhcmdldCA9IGUudGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGp0YXJnZXQgPSAkKHdpbmRvdy50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlX2lkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnbW92ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmVwYXJlIHRyZWUgZm9yIG1vdmUgLyBjdXQgcGFzdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gZS50YXJnZXQuaWQuc3BsaXQoJ21vdmUtbGluay0nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZCA9IGUudGFyZ2V0LnBhcmVudE5vZGUuaWQuc3BsaXQoJ21vdmUtbGluay0nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VfaWQgPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZWxlY3RlZF9wYWdlID0gcGFnZV9pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICdtb3ZlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ3NwYW4ubW92ZS10YXJnZXQtY29udGFpbmVyLCBzcGFuLmxpbmUsIGEubW92ZS10YXJnZXQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgcGFnZV9pZCkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgcGFnZV9pZCArICcgc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ2NvcHknKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlcGFyZSB0cmVlIGZvciBjb3B5XG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IGUudGFyZ2V0LmlkLnNwbGl0KCdjb3B5LWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBlLnRhcmdldC5wYXJlbnROb2RlLmlkLnNwbGl0KCdjb3B5LWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IGlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gbWFya19jb3B5X25vZGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCd2aWV3cGFnZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmlld19wYWdlX3VybCA9ICQoJyMnICsgd2luZG93LnRhcmdldC5pZCArICctc2VsZWN0JykudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlld19wYWdlX3VybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHZpZXdfcGFnZV91cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ2FkZGxpbmsnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEvIyQvZy50ZXN0KGp0YXJnZXQuYXR0cignaHJlZicpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIHVybCBpbnN0ZWFkIG9mICMgaW5zaWRlIGhyZWYsIGZvbGxvdyB0aGlzIHVybFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZWQgaWYgdXNlciBoYXZlcyBhZGRfcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCd0cicpLnJlbW92ZUNsYXNzKCd0YXJnZXQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjaGFuZ2VsaXN0IHRhYmxlJykucmVtb3ZlQ2xhc3MoJ3RhYmxlLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlX2lkID0gd2luZG93LnRhcmdldC5pZC5zcGxpdCgnYWRkLWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IHBhZ2VfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAnYWRkJztcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ3RyJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZS1yb3ctJyArIHBhZ2VfaWQpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vdmUtdGFyZ2V0LWNvbnRhaW5lcicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2EubW92ZS10YXJnZXQsIHNwYW4ubGluZSwgI21vdmUtdGFyZ2V0LScgKyBwYWdlX2lkKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgYXNzdW1lIGFkbWluIHNpdGUgaXMgcm9vdC1sZXZlbFxuICAgICAgICAgICAgICAgICAgICAvLyBncmFiIGJhc2UgdXJsIHRvIGNvbnN0cnVjdCBmdWxsIGFic29sdXRlIFVSTHNcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkbWluX2Jhc2VfdXJsID0gZG9jdW1lbnQuVVJMLnNwbGl0KCcvY21zL3BhZ2UvJylbMF0gKyAnLyc7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VJZDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmd1YWdlO1xuICAgICAgICAgICAgICAgICAgICAvLyBpbiBuYXZpZ2F0aW9uXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCduYXZpZ2F0aW9uLWNoZWNrYm94JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZCA9IGp0YXJnZXQuYXR0cignbmFtZScpLnNwbGl0KCduYXZpZ2F0aW9uLScpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBqdGFyZ2V0LmNsb3Nlc3QoJy5jb250JykuZmluZCgnYVtsYW5nXScpLmF0dHIoJ2xhbmcnKSB8fCAnJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgSSBkb24ndCBwdXQgZGF0YSBpbiB0aGUgcG9zdCwgZGphbmdvIGRvZXNuJ3QgZ2V0IGl0XG4gICAgICAgICAgICAgICAgICAgICAgICByZWxvYWRJdGVtKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp0YXJnZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkbWluX2Jhc2VfdXJsICsgJ2Ntcy9wYWdlLycgKyBwYWdlSWQgKyAnL2NoYW5nZS1uYXZpZ2F0aW9uLz9sYW5ndWFnZT0nICsgbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAxOiAxIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBsYXp5IGxvYWQgZGVzY2VuZGFudHMgb24gdHJlZSBvcGVuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdjbG9zZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25seSBsb2FkIHRoZW0gb25jZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuZmluZCgndWwgPiBsaScpLmxlbmd0aCA9PT0gMCAmJiAhanRhcmdldC5oYXNDbGFzcygnbG9hZGluZycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8ga2VlcHMgdGhpcyBldmVudCBmcm9tIGZpcmluZyBtdWx0aXBsZSB0aW1lcyBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZG9tIGFzIGNoYW5nZWQuIGl0IHN0aWxsIG5lZWRzIHRvIHByb3BhZ2F0ZSBmb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgb3RoZXIgY2xpY2sgZXZlbnQgb24gdGhpcyBlbGVtZW50IHRvIGZpcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkID0gJChqdGFyZ2V0KS5hdHRyKCdpZCcpLnNwbGl0KCdwYWdlXycpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlID0gJChqdGFyZ2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oJ2Rpdi5jb250JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKCdkaXYuY29sMScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbignLnRpdGxlJykuYXR0cignbGFuZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRtaW5fYmFzZV91cmwgKyAnY21zL3BhZ2UvJyArIHBhZ2VJZCArICcvJyArIGxhbmd1YWdlICsgJy9kZXNjZW5kYW50cy8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp0YXJnZXQuY2hpbGRyZW4oJ3VsJykuYXBwZW5kKHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2hvdyBtb3ZlIHRhcmdldHMgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXI6dmlzaWJsZScpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LmNoaWxkcmVuKCd1bCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCdhLm1vdmUtdGFyZ2V0LCBzcGFuLm1vdmUtdGFyZ2V0LWNvbnRhaW5lciwgc3Bhbi5saW5lJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlQ2FsYygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVDYWxjKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnbW92ZS10YXJnZXQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ2xlZnQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wb3NpdGlvbiA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdyaWdodCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnBvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdsYXN0LWNoaWxkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucG9zaXRpb24gPSAnbGFzdC1jaGlsZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0X2lkID0gd2luZG93LnRhcmdldC5wYXJlbnROb2RlLmlkLnNwbGl0KCdtb3ZlLXRhcmdldC0nKVsxXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ21vdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZVRyZWVJdGVtKG51bGwsIHdpbmRvdy5zZWxlY3RlZF9wYWdlLCB3aW5kb3cudGFyZ2V0X2lkLCB3aW5kb3cucG9zaXRpb24sIHRyZWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2NvcHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNpdGUgPSAkKCcjc2l0ZS1zZWxlY3QnKVswXS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3B5VHJlZUl0ZW0od2luZG93LnNlbGVjdGVkX3BhZ2UsIHdpbmRvdy50YXJnZXRfaWQsIHdpbmRvdy5wb3NpdGlvbiwgd2luZG93LnNpdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2FkZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2l0ZSA9ICQoJyNzaXRlLXNlbGVjdCcpWzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKVswXS5zcGxpdCgnIycpWzBdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZC8/dGFyZ2V0PScgKyB3aW5kb3cudGFyZ2V0X2lkICsgJyZhbXA7cG9zaXRpb249JyArIHdpbmRvdy5wb3NpdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmYW1wO3NpdGU9JyArIHdpbmRvdy5zaXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkKCdkaXYjc2l0ZW1hcCcpLnNob3coKTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlQ2FsYygpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5zeW5jQ29scygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCByZUNhbGMpO1xuICAgICAgICAgICAgICAgIC8qIFNpdGUgU2VsZWN0b3IgKi9cbiAgICAgICAgICAgICAgICAkKCcjc2l0ZS1zZWxlY3QnKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybSA9ICQodGhpcykuY2xvc2VzdCgnZm9ybScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgY29ycmVjdCB2YWx1ZSBmb3IgY29weVxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnY29weScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaXRlLWNvcHknKS52YWwod2luZG93LnNlbGVjdGVkX3BhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHN1Ym1pdCBmb3JtXG4gICAgICAgICAgICAgICAgICAgIGZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIElmIGFuIEEgZWxlbWVudCBoYXMgYSBkYXRhLWF0dHJpYnV0ZSAnYWx0LWNsYXNzJy4gQXQgdGhpcyB0aW1lLFxuICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgb25seSB0aGUgZWRpdCBidXR0b24gaW4gdGhlIHBhZ2UtdHJlZSwgYnV0IGNvdWxkIGJlXG4gICAgICAgICAgICAgICAgLy8gbW9yZSBpbiBmdXR1cmUuIEl0IGlzIGltcG9ydGFudCB0aGF0IHRoZSBDU1MgYmUgd3JpdHRlbiBpbiBzdWNoXG4gICAgICAgICAgICAgICAgLy8gYSBtYW5uZXIgdGhhdCB0aGUgYWx0LWNsYXNzIGlzIGRlZmluZWQgYWZ0ZXIgdGhlIG5vcm1hbCBjbGFzcyxcbiAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IGl0IGNhbiBiZSBvdmVycmlkZGVuIHdoZW4gdGhlIGFsdC1rZXkgaXMgZGVwcmVzc2VkLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gTk9URTogVGhpcyAncHJldmlldycgcGFydCBvZiB0aGUgJ2FsdC1jbGljayB0byBbYWx0ZXJuYXRpdmVcbiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbl0nIGZlYXR1cmUgbWF5IG5vdCB3b3JrIGluIHNvbWUgZW52aXJvbm1lbnRzIChXaW5kb3dzXG4gICAgICAgICAgICAgICAgLy8gaW4gYSBzb21lIHZpcnR1YWwgbWFjaGluZSBlbnZpcm9ubWVudHMsIG5vdGFibHkpLCBidXQgaXMgb25seSBhXG4gICAgICAgICAgICAgICAgLy8gbmljZS0nZXh0cmEnLCBub3QgYSByZXF1aXJlbWVudCBmb3IgdGhlIGZlYXR1cmUuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5ZG93biBrZXl1cCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2dC53aGljaCA9PT0gMTgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2FbZGF0YS1hbHQtY2xhc3NdJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9nZ2xlQ2xhc3Moc2VsZi5kYXRhKCdhbHQtY2xhc3MnKSwgZXZ0LnR5cGUgPT09ICdrZXlkb3duJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgQS1lbGVtZW50IGhhcyBhIGRhdGEtYXR0cmlidXRlICdhbHQtaHJlZicsIHRoZW4gdGhpc1xuICAgICAgICAgICAgICAgIC8vIGNsaWNrLWhhbmRsZXIgdXNlcyB0aGF0IGluc3RlYWQgb2YgdGhlIG5vcm1hbCBocmVmIGF0dHJpYnV0ZSBhc1xuICAgICAgICAgICAgICAgIC8vIHRoZSBjbGljay1kZXN0aW5hdGlvbi4gQWdhaW4sIGN1cnJlbnRseSB0aGlzIGlzIG9ubHkgb24gdGhlXG4gICAgICAgICAgICAgICAgLy8gZWRpdCBidXR0b24sIGJ1dCBjb3VsZCBiZSBtb3JlIGluIGZ1dHVyZS5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICQoJ2FbZGF0YS1hbHQtaHJlZl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBocmVmO1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2dC5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaHJlZiA9ICQodGhpcykuZGF0YSgnYWx0LWhyZWYnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhyZWYgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBocmVmO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvcHlfc3BsaXRzID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJ2NvcHk9Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGNvcHlfc3BsaXRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gY29weV9zcGxpdHNbMV0uc3BsaXQoJyYnKVswXTtcbiAgICAgICAgICAgICAgICAgICAgLy8ganNoaW50IGxhdGVkZWY6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSBtYXJrX2NvcHlfbm9kZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGpzaGludCBsYXRlZGVmOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZWxlY3RlZF9wYWdlID0gaWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY29weVRyZWVJdGVtKGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHNpdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5zZXR0aW5ncy5wZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9hZERpYWxvZygnLi8nICsgaXRlbV9pZCArICcvZGlhbG9nL2NvcHkvJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldF9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXRlOiBzaXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAkLmNhbGxiYWNrUmVnaXN0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdfY29weVRyZWVJdGVtJywgX2NvcHlUcmVlSXRlbSwgaXRlbV9pZCwgdGFyZ2V0X2lkLCBwb3NpdGlvbiwgc2l0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29weVRyZWVJdGVtKGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHNpdGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF9jb3B5VHJlZUl0ZW0oaXRlbV9pZCwgdGFyZ2V0X2lkLCBwb3NpdGlvbiwgc2l0ZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0X2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l0ZTogc2l0ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJC5leHRlbmQoZGF0YSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJC5wb3N0KCcuLycgKyBpdGVtX2lkICsgJy9jb3B5LXBhZ2UvJywgZGF0YSwgZnVuY3Rpb24gKGRlY29kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGRlY29kZWQuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBkZWNvZGVkLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbG9hZCB0cmVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubW92ZUVycm9yKCQoJyNwYWdlXycgKyBpdGVtX2lkICsgJyBkaXYuY29sMTplcSgwKScpLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFJlbG9hZHMgdHJlZSBpdGVtIChvbmUgbGluZSkuIElmIHNvbWUgZmlsdGVyaW5nIGlzIGZvdW5kLCBhZGRzXG4gICAgICAgICAgICAgICAgICogZmlsdGVyZWQgdmFyaWFibGUgaW50byBwb3N0ZWQgZGF0YS5cbiAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsIEFueSBjaGlsZCBlbGVtZW50IG9mIHRyZWUgaXRlbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgUmVxdWVzdGVkIHVybFxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIE9wdGlvbmFsIHBvc3RlZCBkYXRhXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgT3B0aW9uYWwgY2FsYmFjayBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbG9hZEl0ZW0oZWwsIHVybCwgZGF0YSwgY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKC9cXC9cXD8vaWcudGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByb2JhYmx5IHNvbWUgZmlsdGVyIGhlcmUsIHRlbGwgYmFja2VuZCwgd2UgbmVlZCBhIGZpbHRlcmVkXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB2ZXJzaW9uIG9mIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZml0bGVyZWQgPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKHJlc3BvbnNlLCB0ZXh0U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBjYWxsYmFjayhyZXNwb25zZSwgdGV4dFN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC9wYWdlX1xcZCsvLnRlc3QoJChlbCkuYXR0cignaWQnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25lIGxldmVsIGhpZ2hlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKGVsKS5maW5kKCdkaXYuY29udDpmaXJzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9ICQoZWwpLnBhcmVudHMoJ2Rpdi5jb250OmZpcnN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRhcmdldC5wYXJlbnQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0aGUgZWxlbWVudCBpZiBzb21ldGhpbmcgd2VudCB3cm9uZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gJ05vdEZvdW5kJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSAkKCcubWVzc2FnZWxpc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQucmVwbGFjZShyZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAkKHBhcmVudCkuZmluZCgnLm1lc3NhZ2VsaXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW4ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzLmluc2VydEFmdGVyKCcuYnJlYWRjcnVtYnMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmZpbmQoJ2Rpdi5jb250OmZpcnN0JykueWZ0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnN1cmUgYWZ0ZXIgcmVtb3ZhbCBldmVyeXRoaW5nIGlzIGFsaWduZWQgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF0YSc6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXJyb3JDYWxsYmFjayBpcyBwYXNzZWQgdGhyb3VnaCB0aGUgcmVsb2FkSXRlbSBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soWE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3hocic6ICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbW92ZVRyZWVJdGVtKGp0YXJnZXQsIGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHRyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkSXRlbShcbiAgICAgICAgICAgICAgICAgICAgICAgIGp0YXJnZXQsICcuLycgKyBpdGVtX2lkICsgJy9tb3ZlLXBhZ2UvJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgeyBwb3NpdGlvbjogcG9zaXRpb24sIHRhcmdldDogdGFyZ2V0X2lkIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uIHN1Y2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkZWNvZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZGVjb2RlZC5jb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBkZWNvZGVkLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmVlX3BvcyA9IHsgJ2xlZnQnOiAnYmVmb3JlJywgJ3JpZ2h0JzogJ2FmdGVyJyB9W3Bvc2l0aW9uXSB8fCAnaW5zaWRlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWUubW92ZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyNwYWdlXycgKyBpdGVtX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwYWdlXycgKyB0YXJnZXRfaWQgKyAnIGEudGl0bGUnKVswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlX3BvcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3ZlU3VjY2VzcygkKCcjcGFnZV8nICsgaXRlbV9pZCArICcgZGl2LmNvbDE6ZXEoMCknKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3ZlRXJyb3IoJCgnI3BhZ2VfJyArIGl0ZW1faWQgKyAnIGRpdi5jb2wxOmVxKDApJyksIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdW5kb3MgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZFVuZG8obm9kZSwgdGFyZ2V0LCBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB1bmRvcy5wdXNoKHsgbm9kZTogbm9kZSwgdGFyZ2V0OiB0YXJnZXQsIHBvc2l0aW9uOiBwb3NpdGlvbiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZWZyZXNoQ29sdW1uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoJ2Rpdi5jb2wyJykuY2hpbGRyZW4oJ2RpdicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIG1pbl93aWR0aCA9IDEwMDAwMDtcbiAgICAgICAgICAgICAgICB2YXIgbWF4X2NvbDJfd2lkdGggPSAwO1xuICAgICAgICAgICAgICAgIHZhciBtYXhfY29sMiA9IG51bGw7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnQgPSAkKHRoaXMpLmNoaWxkcmVuKCdkaXYuY29udCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnQuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sMSA9IGNvbnQuY2hpbGRyZW4oJ2Rpdi5jb2wxJykuZmluZCgnLnRpdGxlIHNwYW4nKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbDIgPSBjb250LmNoaWxkcmVuKCdkaXYuY29sMicpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29sMV93aWR0aCA9IGNvbDEub3V0ZXJXaWR0aCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbDJfd2lkdGggPSBjb2wyLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbF93aWR0aCA9IGNvbnQub3V0ZXJXaWR0aCh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGlmID0gdG90YWxfd2lkdGggLSBjb2wxX3dpZHRoO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlmIDwgbWluX3dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5fd2lkdGggPSBkaWY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbDJfd2lkdGggPiBtYXhfY29sMl93aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2NvbDJfd2lkdGggPSBjb2wyX3dpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2NvbDIgPSBjb2wyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gNTA7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBoaWRkZW5fY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBtYXhfcmVhY2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChtYXhfY29sMikge1xuICAgICAgICAgICAgICAgICAgICBtYXhfY29sMi5jaGlsZHJlbignZGl2JykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1heF9yZWFjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdyArPSAkKHRoaXMpLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXhfcmVhY2hlZCB8fCB3ID4gKG1pbl93aWR0aCAtIG9mZnNldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW5fY291bnQgPSBoaWRkZW5fY291bnQgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF9yZWFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZGRlbl9jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdkaXYuY29udCcpLmNoaWxkcmVuKCdkaXYuY29sMicpLmNoaWxkcmVuKCdkaXYnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoLWhpZGRlbl9jb3VudCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdkaXYjc2l0ZW1hcCB1bC5oZWFkZXIgZGl2LmNvbDInKS5jaGlsZHJlbigpLnNsaWNlKC1oaWRkZW5fY291bnQpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG59KShDTVMuJCk7XG4iLCIvLyBhbGwsIGJ1dCB3aXRob3V0IGpxdWVyeSAhISAobW9kaWZpZWQgYnkgUGV0ZXIgQ2ljbWFuKVxuXG4vLyBjc3MuanNcblxuZnVuY3Rpb24gZ2V0X2NzcyhydWxlX25hbWUsc3R5bGVzaGVldCxkZWxldGVfZmxhZyl7aWYoIWRvY3VtZW50LnN0eWxlU2hlZXRzKXJldHVybiBmYWxzZTtydWxlX25hbWU9cnVsZV9uYW1lLnRvTG93ZXJDYXNlKCk7c3R5bGVzaGVldD1zdHlsZXNoZWV0fHwwO2Zvcih2YXIgaT1zdHlsZXNoZWV0O2k8ZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoO2krKyl7dmFyIHN0eWxlU2hlZXQ9ZG9jdW1lbnQuc3R5bGVTaGVldHNbaV07Y3NzX3J1bGVzPWRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmNzc1J1bGVzfHxkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5ydWxlcztpZighY3NzX3J1bGVzKWNvbnRpbnVlO3ZhciBqPTA7ZG97aWYoY3NzX3J1bGVzW2pdLnNlbGVjdG9yVGV4dC50b0xvd2VyQ2FzZSgpPT1ydWxlX25hbWUpe2lmKGRlbGV0ZV9mbGFnPT10cnVlKXtpZihkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5yZW1vdmVSdWxlKWRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLnJlbW92ZVJ1bGUoaik7aWYoZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uZGVsZXRlUnVsZSlkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5kZWxldGVSdWxlKGopO3JldHVybiB0cnVlO31cbmVsc2UgcmV0dXJuIGNzc19ydWxlc1tqXTt9fVxud2hpbGUoY3NzX3J1bGVzWysral0pO31cbnJldHVybiBmYWxzZTt9XG5mdW5jdGlvbiBhZGRfY3NzKHJ1bGVfbmFtZSxzdHlsZXNoZWV0KXtydWxlX25hbWU9cnVsZV9uYW1lLnRvTG93ZXJDYXNlKCk7c3R5bGVzaGVldD1zdHlsZXNoZWV0fHwwO2lmKCFkb2N1bWVudC5zdHlsZVNoZWV0c3x8Z2V0X2NzcyhydWxlX25hbWUsc3R5bGVzaGVldCkpcmV0dXJuIGZhbHNlOyhkb2N1bWVudC5zdHlsZVNoZWV0c1tzdHlsZXNoZWV0XS5hZGRSdWxlKT9kb2N1bWVudC5zdHlsZVNoZWV0c1tzdHlsZXNoZWV0XS5hZGRSdWxlKHJ1bGVfbmFtZSxudWxsLDApOmRvY3VtZW50LnN0eWxlU2hlZXRzW3N0eWxlc2hlZXRdLmluc2VydFJ1bGUocnVsZV9uYW1lKycgeyB9JywwKTtyZXR1cm4gZ2V0X2NzcyhydWxlX25hbWUpO31cbmZ1bmN0aW9uIGdldF9zaGVldF9udW0oaHJlZl9uYW1lKXtpZighZG9jdW1lbnQuc3R5bGVTaGVldHMpcmV0dXJuIGZhbHNlO2Zvcih2YXIgaT0wO2k8ZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoO2krKyl7aWYoZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uaHJlZiYmZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uaHJlZi50b1N0cmluZygpLm1hdGNoKGhyZWZfbmFtZSkpcmV0dXJuIGk7fVxucmV0dXJuIGZhbHNlO31cbmZ1bmN0aW9uIHJlbW92ZV9jc3MocnVsZV9uYW1lLHN0eWxlc2hlZXQpe3JldHVybiBnZXRfY3NzKHJ1bGVfbmFtZSxzdHlsZXNoZWV0LHRydWUpO31cbmZ1bmN0aW9uIGFkZF9zaGVldCh1cmwpe2lmKGRvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQpe2RvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQodXJsKTt9XG5lbHNle3ZhciBzdHlsZXM9XCJAaW1wb3J0IHVybCgnIFwiK3VybCtcIiAnKTtcIjt2YXIgbmV3U1M9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpO25ld1NTLnJlbD0nc3R5bGVzaGVldCc7bmV3U1MuaHJlZj0nZGF0YTp0ZXh0L2NzcywnK2VzY2FwZShzdHlsZXMpO2RvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXS5hcHBlbmRDaGlsZChuZXdTUyk7fX1cblxuLy8ganF1ZXJ5Lmxpc3Rlbi5qc1xuOyhmdW5jdGlvbigkKXt2YXIgYT0naW5kZXhlcicsaD0kLmV2ZW50LGo9aC5zcGVjaWFsLGs9JC5saXN0ZW49ZnVuY3Rpb24oYyxkLGUsZil7aWYodHlwZW9mIGQhPSdvYmplY3QnKXtmPWU7ZT1kO2Q9ZG9jdW1lbnR9byhjLnNwbGl0KC9cXHMrLyksZnVuY3Rpb24oYSl7YT1rLmZpeGVzW2FdfHxhO3ZhciBiPW0oZCxhKXx8bShkLGEsbmV3IG4oYSxkKSk7Yi5hcHBlbmQoZSxmKTtiLnN0YXJ0KCl9KX0sbT1mdW5jdGlvbihiLGMsZCl7cmV0dXJuICQuZGF0YShiLGMrJy4nK2EsZCl9OyQuZm5bYV09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXNbMF0mJm0odGhpc1swXSxhKXx8bnVsbH07JFthXT1mdW5jdGlvbihhKXtyZXR1cm4gbShkb2N1bWVudCxhKX07JC5leHRlbmQoayx7cmVnZXg6L14oKD86XFx3Kj98XFwqKSkoPzooWyMuXSkoW1xcdy1dKykpPyQvLGZpeGVzOntmb2N1czonZm9jdXNpbicsYmx1cjonZm9jdXNvdXQnfSxjYWNoZTpmdW5jdGlvbihhKXt0aGlzLmNhY2hpbmc9YX19KTskLmVhY2goay5maXhlcyxmdW5jdGlvbihhLGIpe2pbYl09e3NldHVwOmZ1bmN0aW9uKCl7aWYoJC5icm93c2VyLm1zaWUpcmV0dXJuITE7dGhpcy5hZGRFdmVudExpc3RlbmVyKGEsaltiXS5oYW5kbGVyLCEwKX0sdGVhcmRvd246ZnVuY3Rpb24oKXtpZigkLmJyb3dzZXIubXNpZSlyZXR1cm4hMTt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSxqW2JdLmhhbmRsZXIsITApfSxoYW5kbGVyOmZ1bmN0aW9uKGUpe2FyZ3VtZW50c1swXT1lPWguZml4KGUpO2UudHlwZT1iO3JldHVybiBoLmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fX0pOyQuZm4ubGlzdGVuPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ayhhLHRoaXMsYixjKX0pfTtmdW5jdGlvbiBuKGEsYil7JC5leHRlbmQodGhpcyx7aWRzOnt9LHRhZ3M6e30sbGlzdGVuZXI6YixldmVudDphfSk7dGhpcy5pZD1uLmluc3RhbmNlcy5wdXNoKHRoaXMpfTtuLmluc3RhbmNlcz1bXTtuLnByb3RvdHlwZT17Y29uc3RydWN0b3I6bixoYW5kbGU6ZnVuY3Rpb24oZSl7dmFyIGE9ZS5zdG9wUHJvcGFnYXRpb247ZS5zdG9wUHJvcGFnYXRpb249ZnVuY3Rpb24oKXtlLnN0b3BwZWQ9MTthLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07bSh0aGlzLGUudHlwZSkucGFyc2UoZSk7ZS5zdG9wUHJvcGFnYXRpb249YTthPWUuZGF0YT1udWxsfSxvbjowLGJ1YmJsZXM6MCxzdGFydDpmdW5jdGlvbigpe3ZhciBhPXRoaXM7aWYoIWEub24pe2guYWRkKGEubGlzdGVuZXIsYS5ldmVudCxhLmhhbmRsZSk7YS5vbj0xfX0sc3RvcDpmdW5jdGlvbigpe3ZhciBhPXRoaXM7aWYoYS5vbil7aC5yZW1vdmUoYS5saXN0ZW5lcixhLmV2ZW50LGEuaGFuZGxlKTthLm9uPTB9fSxjYWNoZTpmdW5jdGlvbihhLGIpe3JldHVybiAkLmRhdGEoYSwnbGlzdGVuQ2FjaGVfJyt0aGlzLmlkLGIpfSxwYXJzZTpmdW5jdGlvbihlKXt2YXIgej10aGlzLGM9ZS5kYXRhfHxlLnRhcmdldCxkPWFyZ3VtZW50cyxmO2lmKCFrLmNhY2hpbmd8fCEoZj16LmNhY2hlKGMpKSl7Zj1bXTtpZihjLmlkJiZ6Lmlkc1tjLmlkXSlwKGYsei5pZHNbYy5pZF0pO28oW2Mubm9kZU5hbWUsJyonXSxmdW5jdGlvbihhKXt2YXIgYj16LnRhZ3NbYV07aWYoYilvKChjLmNsYXNzTmFtZSsnIConKS5zcGxpdCgnICcpLGZ1bmN0aW9uKGEpe2lmKGEmJmJbYV0pcChmLGJbYV0pfSl9KTtpZihrLmNhY2hpbmcpei5jYWNoZShjLGYpfWlmKGZbMF0pe28oZixmdW5jdGlvbihhKXtpZihhLmFwcGx5KGMsZCk9PT0hMSl7ZS5wcmV2ZW50RGVmYXVsdCgpO2Uuc3RvcFByb3BhZ2F0aW9uKCl9fSl9aWYoIWUuc3RvcHBlZCYmKGM9Yy5wYXJlbnROb2RlKSYmKGMubm9kZU5hbWU9PSdBJ3x8ei5idWJibGVzJiZjIT16Lmxpc3RlbmVyKSl7ZS5kYXRhPWM7ei5wYXJzZShlKX1mPWQ9Yz1udWxsfSxhcHBlbmQ6ZnVuY3Rpb24oZixnKXt2YXIgej10aGlzO28oZi5zcGxpdCgvXFxzKixcXHMqLyksZnVuY3Rpb24oYSl7dmFyIGI9ay5yZWdleC5leGVjKGEpO2lmKCFiKXRocm93JyQubGlzdGVuID4gXCInK2ErJ1wiIGlzIG5vdCBhIHN1cHBvcnRlZCBzZWxlY3Rvci4nO3ZhciBjPWJbMl09PScjJyYmYlszXSxkPWJbMV0udG9VcHBlckNhc2UoKXx8JyonLGU9YlszXXx8JyonO2lmKGMpKHouaWRzW2NdfHwoei5pZHNbY109W10pKS5wdXNoKGcpO2Vsc2UgaWYoZCl7ZD16LnRhZ3NbZF09ei50YWdzW2RdfHx7fTsoZFtlXXx8KGRbZV09W10pKS5wdXNoKGcpfX0pfX07ZnVuY3Rpb24gbyhhLGIsYyl7Zm9yKHZhciBpPTAsbD1hLmxlbmd0aDtpPGw7aSsrKWIuY2FsbChjLGFbaV0saSl9O2Z1bmN0aW9uIHAoYSxiKXthLnB1c2guYXBwbHkoYSxiKTtyZXR1cm4gYX07JCh3aW5kb3cpLnVubG9hZChmdW5jdGlvbigpe2lmKHR5cGVvZiBuPT0nZnVuY3Rpb24nKW8obi5pbnN0YW5jZXMsZnVuY3Rpb24oYil7Yi5zdG9wKCk7JC5yZW1vdmVEYXRhKGIubGlzdGVuZXIsYi5ldmVudCsnLicrYSk7Yi5pZHM9Yi5uYW1lcz1iLmxpc3RlbmVyPW51bGx9KX0pfSkoalF1ZXJ5KTtcblxuLy8gc2FyaXNzYS5qc1xuXG5mdW5jdGlvbiBTYXJpc3NhKCl7fVxuU2FyaXNzYS5WRVJTSU9OPVwiMC45LjkuNFwiO1Nhcmlzc2EuUEFSU0VEX09LPVwiRG9jdW1lbnQgY29udGFpbnMgbm8gcGFyc2luZyBlcnJvcnNcIjtTYXJpc3NhLlBBUlNFRF9FTVBUWT1cIkRvY3VtZW50IGlzIGVtcHR5XCI7U2FyaXNzYS5QQVJTRURfVU5LTk9XTl9FUlJPUj1cIk5vdCB3ZWxsLWZvcm1lZCBvciBvdGhlciBlcnJvclwiO1Nhcmlzc2EuSVNfRU5BQkxFRF9UUkFOU0ZPUk1fTk9ERT1mYWxzZTtTYXJpc3NhLlJFTU9URV9DQUxMX0ZMQUc9XCJnci5hYmlzcy5zYXJpc3NhLlJFTU9URV9DQUxMX0ZMQUdcIjtTYXJpc3NhLl9sYXN0VW5pcXVlU3VmZml4PTA7U2FyaXNzYS5fZ2V0VW5pcXVlU3VmZml4PWZ1bmN0aW9uKCl7cmV0dXJuIFNhcmlzc2EuX2xhc3RVbmlxdWVTdWZmaXgrKzt9O1Nhcmlzc2EuX1NBUklTU0FfSUVQUkVGSVg0WFNMUEFSQU09XCJcIjtTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fSU1QTEVNRU5UQVRJT049ZG9jdW1lbnQuaW1wbGVtZW50YXRpb24mJnRydWU7U2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0NSRUFURV9ET0NVTUVOVD1TYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fSU1QTEVNRU5UQVRJT04mJmRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50O1Nhcmlzc2EuX1NBUklTU0FfSEFTX0RPTV9GRUFUVVJFPVNhcmlzc2EuX1NBUklTU0FfSEFTX0RPTV9JTVBMRU1FTlRBVElPTiYmZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZTtTYXJpc3NhLl9TQVJJU1NBX0lTX01PWj1TYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fQ1JFQVRFX0RPQ1VNRU5UJiZTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fRkVBVFVSRTtTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSST1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcInNhZmFyaVwiKSE9LTF8fG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwia29ucXVlcm9yXCIpIT0tMTtTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSSV9PTEQ9U2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUkkmJihwYXJzZUludCgobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvQXBwbGVXZWJLaXRcXC8oXFxkKykvKXx8e30pWzFdLDEwKTw0MjApO1Nhcmlzc2EuX1NBUklTU0FfSVNfSUU9ZG9jdW1lbnQuYWxsJiZ3aW5kb3cuQWN0aXZlWE9iamVjdCYmbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJtc2llXCIpPi0xJiZuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIm9wZXJhXCIpPT0tMTtTYXJpc3NhLl9TQVJJU1NBX0lTX09QRVJBPW5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwib3BlcmFcIikhPS0xO2lmKCF3aW5kb3cuTm9kZXx8IU5vZGUuRUxFTUVOVF9OT0RFKXtOb2RlPXtFTEVNRU5UX05PREU6MSxBVFRSSUJVVEVfTk9ERToyLFRFWFRfTk9ERTozLENEQVRBX1NFQ1RJT05fTk9ERTo0LEVOVElUWV9SRUZFUkVOQ0VfTk9ERTo1LEVOVElUWV9OT0RFOjYsUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOjcsQ09NTUVOVF9OT0RFOjgsRE9DVU1FTlRfTk9ERTo5LERPQ1VNRU5UX1RZUEVfTk9ERToxMCxET0NVTUVOVF9GUkFHTUVOVF9OT0RFOjExLE5PVEFUSU9OX05PREU6MTJ9O31cbmlmKFNhcmlzc2EuX1NBUklTU0FfSVNfU0FGQVJJX09MRCl7SFRNTEh0bWxFbGVtZW50PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJodG1sXCIpLmNvbnN0cnVjdG9yO05vZGU9SFRNTEVsZW1lbnQ9e307SFRNTEVsZW1lbnQucHJvdG90eXBlPUhUTUxIdG1sRWxlbWVudC5fX3Byb3RvX18uX19wcm90b19fO0hUTUxEb2N1bWVudD1Eb2N1bWVudD1kb2N1bWVudC5jb25zdHJ1Y3Rvcjt2YXIgeD1uZXcgRE9NUGFyc2VyKCk7WE1MRG9jdW1lbnQ9eC5jb25zdHJ1Y3RvcjtFbGVtZW50PXgucGFyc2VGcm9tU3RyaW5nKFwiPFNpbmdsZSAvPlwiLFwidGV4dC94bWxcIikuZG9jdW1lbnRFbGVtZW50LmNvbnN0cnVjdG9yO3g9bnVsbDt9XG5pZih0eXBlb2YgWE1MRG9jdW1lbnQ9PVwidW5kZWZpbmVkXCImJnR5cGVvZiBEb2N1bWVudCE9XCJ1bmRlZmluZWRcIil7WE1MRG9jdW1lbnQ9RG9jdW1lbnQ7fVxuaWYoU2FyaXNzYS5fU0FSSVNTQV9JU19JRSl7U2FyaXNzYS5fU0FSSVNTQV9JRVBSRUZJWDRYU0xQQVJBTT1cInhzbDpcIjt2YXIgX1NBUklTU0FfRE9NX1BST0dJRD1cIlwiO3ZhciBfU0FSSVNTQV9YTUxIVFRQX1BST0dJRD1cIlwiO3ZhciBfU0FSSVNTQV9ET01fWE1MV1JJVEVSPVwiXCI7U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEPWZ1bmN0aW9uKGlkTGlzdCl7dmFyIGJGb3VuZD1mYWxzZSxlO3ZhciBvMlN0b3JlO2Zvcih2YXIgaT0wO2k8aWRMaXN0Lmxlbmd0aCYmIWJGb3VuZDtpKyspe3RyeXt2YXIgb0RvYz1uZXcgQWN0aXZlWE9iamVjdChpZExpc3RbaV0pO28yU3RvcmU9aWRMaXN0W2ldO2JGb3VuZD10cnVlO31jYXRjaChvYmpFeGNlcHRpb24pe2U9b2JqRXhjZXB0aW9uO319XG5pZighYkZvdW5kKXt0aHJvd1wiQ291bGQgbm90IHJldHJpZXZlIGEgdmFsaWQgcHJvZ0lEIG9mIENsYXNzOiBcIitpZExpc3RbaWRMaXN0Lmxlbmd0aC0xXStcIi4gKG9yaWdpbmFsIGV4Y2VwdGlvbjogXCIrZStcIilcIjt9XG5pZExpc3Q9bnVsbDtyZXR1cm4gbzJTdG9yZTt9O19TQVJJU1NBX0RPTV9QUk9HSUQ9bnVsbDtfU0FSSVNTQV9USFJFQURFRERPTV9QUk9HSUQ9bnVsbDtfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQ9bnVsbDtfU0FSSVNTQV9YTUxIVFRQX1BST0dJRD1udWxsO1hNTEh0dHBSZXF1ZXN0PWZ1bmN0aW9uKCl7aWYoIV9TQVJJU1NBX1hNTEhUVFBfUFJPR0lEKXtfU0FSSVNTQV9YTUxIVFRQX1BST0dJRD1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTXN4bWwyLlhNTEhUVFAuNi4wXCIsXCJNU1hNTDIuWE1MSFRUUC4zLjBcIixcIk1TWE1MMi5YTUxIVFRQXCIsXCJNaWNyb3NvZnQuWE1MSFRUUFwiXSk7fVxucmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX1hNTEhUVFBfUFJPR0lEKTt9O1Nhcmlzc2EuZ2V0RG9tRG9jdW1lbnQ9ZnVuY3Rpb24oc1VyaSxzTmFtZSl7aWYoIV9TQVJJU1NBX0RPTV9QUk9HSUQpe19TQVJJU1NBX0RPTV9QUk9HSUQ9U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEKFtcIk1zeG1sMi5ET01Eb2N1bWVudC42LjBcIixcIk1zeG1sMi5ET01Eb2N1bWVudC4zLjBcIixcIk1TWE1MMi5ET01Eb2N1bWVudFwiLFwiTVNYTUwuRE9NRG9jdW1lbnRcIixcIk1pY3Jvc29mdC5YTUxET01cIl0pO31cbnZhciBvRG9jPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX0RPTV9QUk9HSUQpO2lmKHNOYW1lKXt2YXIgcHJlZml4PVwiXCI7aWYoc1VyaSl7aWYoc05hbWUuaW5kZXhPZihcIjpcIik+MSl7cHJlZml4PXNOYW1lLnN1YnN0cmluZygwLHNOYW1lLmluZGV4T2YoXCI6XCIpKTtzTmFtZT1zTmFtZS5zdWJzdHJpbmcoc05hbWUuaW5kZXhPZihcIjpcIikrMSk7fWVsc2V7cHJlZml4PVwiYVwiK1Nhcmlzc2EuX2dldFVuaXF1ZVN1ZmZpeCgpO319XG5pZihzVXJpKXtvRG9jLmxvYWRYTUwoJzwnK3ByZWZpeCsnOicrc05hbWUrXCIgeG1sbnM6XCIrcHJlZml4K1wiPVxcXCJcIitzVXJpK1wiXFxcIlwiK1wiIC8+XCIpO31lbHNle29Eb2MubG9hZFhNTCgnPCcrc05hbWUrXCIgLz5cIik7fX1cbnJldHVybiBvRG9jO307U2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dD1mdW5jdGlvbihvRG9jKXt2YXIgcGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfT0s7aWYob0RvYyYmb0RvYy5wYXJzZUVycm9yJiZvRG9jLnBhcnNlRXJyb3IuZXJyb3JDb2RlJiZvRG9jLnBhcnNlRXJyb3IuZXJyb3JDb2RlIT0wKXtwYXJzZUVycm9yVGV4dD1cIlhNTCBQYXJzaW5nIEVycm9yOiBcIitvRG9jLnBhcnNlRXJyb3IucmVhc29uK1wiXFxuTG9jYXRpb246IFwiK29Eb2MucGFyc2VFcnJvci51cmwrXCJcXG5MaW5lIE51bWJlciBcIitvRG9jLnBhcnNlRXJyb3IubGluZStcIiwgQ29sdW1uIFwiK1xub0RvYy5wYXJzZUVycm9yLmxpbmVwb3MrXCI6XFxuXCIrb0RvYy5wYXJzZUVycm9yLnNyY1RleHQrXCJcXG5cIjtmb3IodmFyIGk9MDtpPG9Eb2MucGFyc2VFcnJvci5saW5lcG9zO2krKyl7cGFyc2VFcnJvclRleHQrPVwiLVwiO31cbnBhcnNlRXJyb3JUZXh0Kz1cIl5cXG5cIjt9XG5lbHNlIGlmKG9Eb2MuZG9jdW1lbnRFbGVtZW50PT09bnVsbCl7cGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfRU1QVFk7fVxucmV0dXJuIHBhcnNlRXJyb3JUZXh0O307U2FyaXNzYS5zZXRYcGF0aE5hbWVzcGFjZXM9ZnVuY3Rpb24ob0RvYyxzTnNTZXQpe29Eb2Muc2V0UHJvcGVydHkoXCJTZWxlY3Rpb25MYW5ndWFnZVwiLFwiWFBhdGhcIik7b0RvYy5zZXRQcm9wZXJ0eShcIlNlbGVjdGlvbk5hbWVzcGFjZXNcIixzTnNTZXQpO307WFNMVFByb2Nlc3Nvcj1mdW5jdGlvbigpe2lmKCFfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQpe19TQVJJU1NBX1hTTFRFTVBMQVRFX1BST0dJRD1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTXN4bWwyLlhTTFRlbXBsYXRlLjYuMFwiLFwiTVNYTUwyLlhTTFRlbXBsYXRlLjMuMFwiXSk7fVxudGhpcy50ZW1wbGF0ZT1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQpO3RoaXMucHJvY2Vzc29yPW51bGw7fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS5pbXBvcnRTdHlsZXNoZWV0PWZ1bmN0aW9uKHhzbERvYyl7aWYoIV9TQVJJU1NBX1RIUkVBREVERE9NX1BST0dJRCl7X1NBUklTU0FfVEhSRUFERURET01fUFJPR0lEPVNhcmlzc2EucGlja1JlY2VudFByb2dJRChbXCJNU1hNTDIuRnJlZVRocmVhZGVkRE9NRG9jdW1lbnQuNi4wXCIsXCJNU1hNTDIuRnJlZVRocmVhZGVkRE9NRG9jdW1lbnQuMy4wXCJdKTt9XG54c2xEb2Muc2V0UHJvcGVydHkoXCJTZWxlY3Rpb25MYW5ndWFnZVwiLFwiWFBhdGhcIik7eHNsRG9jLnNldFByb3BlcnR5KFwiU2VsZWN0aW9uTmFtZXNwYWNlc1wiLFwieG1sbnM6eHNsPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0nXCIpO3ZhciBjb252ZXJ0ZWQ9bmV3IEFjdGl2ZVhPYmplY3QoX1NBUklTU0FfVEhSRUFERURET01fUFJPR0lEKTt0cnl7Y29udmVydGVkLnJlc29sdmVFeHRlcm5hbHM9dHJ1ZTtjb252ZXJ0ZWQuc2V0UHJvcGVydHkoXCJBbGxvd0RvY3VtZW50RnVuY3Rpb25cIix0cnVlKTt9XG5jYXRjaChlKXt9XG5pZih4c2xEb2MudXJsJiZ4c2xEb2Muc2VsZWN0U2luZ2xlTm9kZShcIi8veHNsOipbbG9jYWwtbmFtZSgpID0gJ2ltcG9ydCcgb3IgbG9jYWwtbmFtZSgpID0gJ2luY2x1ZGUnXVwiKSE9bnVsbCl7Y29udmVydGVkLmFzeW5jPWZhbHNlO2NvbnZlcnRlZC5sb2FkKHhzbERvYy51cmwpO31cbmVsc2V7Y29udmVydGVkLmxvYWRYTUwoeHNsRG9jLnhtbCk7fVxuY29udmVydGVkLnNldFByb3BlcnR5KFwiU2VsZWN0aW9uTmFtZXNwYWNlc1wiLFwieG1sbnM6eHNsPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0nXCIpO3ZhciBvdXRwdXQ9Y29udmVydGVkLnNlbGVjdFNpbmdsZU5vZGUoXCIvL3hzbDpvdXRwdXRcIik7aWYob3V0cHV0KXt0aGlzLm91dHB1dE1ldGhvZD1vdXRwdXQuZ2V0QXR0cmlidXRlKFwibWV0aG9kXCIpO31cbmVsc2V7ZGVsZXRlIHRoaXMub3V0cHV0TWV0aG9kO31cbnRoaXMudGVtcGxhdGUuc3R5bGVzaGVldD1jb252ZXJ0ZWQ7dGhpcy5wcm9jZXNzb3I9dGhpcy50ZW1wbGF0ZS5jcmVhdGVQcm9jZXNzb3IoKTt0aGlzLnBhcmFtc1NldD1bXTt9O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLnRyYW5zZm9ybVRvRG9jdW1lbnQ9ZnVuY3Rpb24oc291cmNlRG9jKXt2YXIgb3V0RG9jO2lmKF9TQVJJU1NBX1RIUkVBREVERE9NX1BST0dJRCl7dGhpcy5wcm9jZXNzb3IuaW5wdXQ9c291cmNlRG9jO291dERvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fUFJPR0lEKTt0aGlzLnByb2Nlc3Nvci5vdXRwdXQ9b3V0RG9jO3RoaXMucHJvY2Vzc29yLnRyYW5zZm9ybSgpO3JldHVybiBvdXREb2M7fVxuZWxzZXtpZighX1NBUklTU0FfRE9NX1hNTFdSSVRFUil7X1NBUklTU0FfRE9NX1hNTFdSSVRFUj1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTXN4bWwyLk1YWE1MV3JpdGVyLjYuMFwiLFwiTXN4bWwyLk1YWE1MV3JpdGVyLjMuMFwiLFwiTVNYTUwyLk1YWE1MV3JpdGVyXCIsXCJNU1hNTC5NWFhNTFdyaXRlclwiLFwiTWljcm9zb2Z0LlhNTERPTVwiXSk7fVxudGhpcy5wcm9jZXNzb3IuaW5wdXQ9c291cmNlRG9jO291dERvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fWE1MV1JJVEVSKTt0aGlzLnByb2Nlc3Nvci5vdXRwdXQ9b3V0RG9jO3RoaXMucHJvY2Vzc29yLnRyYW5zZm9ybSgpO3ZhciBvRG9jPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX0RPTV9QUk9HSUQpO29Eb2MubG9hZFhNTChvdXREb2Mub3V0cHV0K1wiXCIpO3JldHVybiBvRG9jO319O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLnRyYW5zZm9ybVRvRnJhZ21lbnQ9ZnVuY3Rpb24oc291cmNlRG9jLG93bmVyRG9jKXt0aGlzLnByb2Nlc3Nvci5pbnB1dD1zb3VyY2VEb2M7dGhpcy5wcm9jZXNzb3IudHJhbnNmb3JtKCk7dmFyIHM9dGhpcy5wcm9jZXNzb3Iub3V0cHV0O3ZhciBmPW93bmVyRG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTt2YXIgY29udGFpbmVyO2lmKHRoaXMub3V0cHV0TWV0aG9kPT0ndGV4dCcpe2YuYXBwZW5kQ2hpbGQob3duZXJEb2MuY3JlYXRlVGV4dE5vZGUocykpO31lbHNlIGlmKG93bmVyRG9jLmJvZHkmJm93bmVyRG9jLmJvZHkuaW5uZXJIVE1MKXtjb250YWluZXI9b3duZXJEb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Y29udGFpbmVyLmlubmVySFRNTD1zO3doaWxlKGNvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpe2YuYXBwZW5kQ2hpbGQoY29udGFpbmVyLmZpcnN0Q2hpbGQpO319XG5lbHNle3ZhciBvRG9jPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX0RPTV9QUk9HSUQpO2lmKHMuc3Vic3RyaW5nKDAsNSk9PSc8P3htbCcpe3M9cy5zdWJzdHJpbmcocy5pbmRleE9mKCc/PicpKzIpO31cbnZhciB4bWw9JycuY29uY2F0KCc8bXk+JyxzLCc8L215PicpO29Eb2MubG9hZFhNTCh4bWwpO2NvbnRhaW5lcj1vRG9jLmRvY3VtZW50RWxlbWVudDt3aGlsZShjb250YWluZXIuaGFzQ2hpbGROb2RlcygpKXtmLmFwcGVuZENoaWxkKGNvbnRhaW5lci5maXJzdENoaWxkKTt9fVxucmV0dXJuIGY7fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS5zZXRQYXJhbWV0ZXI9ZnVuY3Rpb24obnNVUkksbmFtZSx2YWx1ZSl7dmFsdWU9dmFsdWU/dmFsdWU6XCJcIjtpZihuc1VSSSl7dGhpcy5wcm9jZXNzb3IuYWRkUGFyYW1ldGVyKG5hbWUsdmFsdWUsbnNVUkkpO31lbHNle3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLHZhbHVlKTt9XG5uc1VSST1cIlwiKyhuc1VSSXx8XCJcIik7aWYoIXRoaXMucGFyYW1zU2V0W25zVVJJXSl7dGhpcy5wYXJhbXNTZXRbbnNVUkldPVtdO31cbnRoaXMucGFyYW1zU2V0W25zVVJJXVtuYW1lXT12YWx1ZTt9O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLmdldFBhcmFtZXRlcj1mdW5jdGlvbihuc1VSSSxuYW1lKXtuc1VSST1cIlwiKyhuc1VSSXx8XCJcIik7aWYodGhpcy5wYXJhbXNTZXRbbnNVUkldJiZ0aGlzLnBhcmFtc1NldFtuc1VSSV1bbmFtZV0pe3JldHVybiB0aGlzLnBhcmFtc1NldFtuc1VSSV1bbmFtZV07fWVsc2V7cmV0dXJuIG51bGw7fX07WFNMVFByb2Nlc3Nvci5wcm90b3R5cGUuY2xlYXJQYXJhbWV0ZXJzPWZ1bmN0aW9uKCl7Zm9yKHZhciBuc1VSSSBpbiB0aGlzLnBhcmFtc1NldCl7Zm9yKHZhciBuYW1lIGluIHRoaXMucGFyYW1zU2V0W25zVVJJXSl7aWYobnNVUkkhPVwiXCIpe3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLFwiXCIsbnNVUkkpO31lbHNle3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLFwiXCIpO319fVxudGhpcy5wYXJhbXNTZXQ9W107fTt9ZWxzZXtpZihTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fQ1JFQVRFX0RPQ1VNRU5UKXtTYXJpc3NhLl9faGFuZGxlTG9hZF9fPWZ1bmN0aW9uKG9Eb2Mpe1Nhcmlzc2EuX19zZXRSZWFkeVN0YXRlX18ob0RvYyw0KTt9O19zYXJpc3NhX1hNTERvY3VtZW50X29ubG9hZD1mdW5jdGlvbigpe1Nhcmlzc2EuX19oYW5kbGVMb2FkX18odGhpcyk7fTtTYXJpc3NhLl9fc2V0UmVhZHlTdGF0ZV9fPWZ1bmN0aW9uKG9Eb2MsaVJlYWR5U3RhdGUpe29Eb2MucmVhZHlTdGF0ZT1pUmVhZHlTdGF0ZTtvRG9jLnJlYWR5c3RhdGU9aVJlYWR5U3RhdGU7aWYob0RvYy5vbnJlYWR5c3RhdGVjaGFuZ2UhPW51bGwmJnR5cGVvZiBvRG9jLm9ucmVhZHlzdGF0ZWNoYW5nZT09XCJmdW5jdGlvblwiKXtvRG9jLm9ucmVhZHlzdGF0ZWNoYW5nZSgpO319O1Nhcmlzc2EuZ2V0RG9tRG9jdW1lbnQ9ZnVuY3Rpb24oc1VyaSxzTmFtZSl7dmFyIG9Eb2M9ZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnQoc1VyaT9zVXJpOm51bGwsc05hbWU/c05hbWU6bnVsbCxudWxsKTtpZighb0RvYy5vbnJlYWR5c3RhdGVjaGFuZ2Upe29Eb2Mub25yZWFkeXN0YXRlY2hhbmdlPW51bGw7fVxuaWYoIW9Eb2MucmVhZHlTdGF0ZSl7b0RvYy5yZWFkeVN0YXRlPTA7fVxub0RvYy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLF9zYXJpc3NhX1hNTERvY3VtZW50X29ubG9hZCxmYWxzZSk7cmV0dXJuIG9Eb2M7fTtpZih3aW5kb3cuWE1MRG9jdW1lbnQpe31cbmVsc2UgaWYoU2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0ZFQVRVUkUmJndpbmRvdy5Eb2N1bWVudCYmIURvY3VtZW50LnByb3RvdHlwZS5sb2FkJiZkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5oYXNGZWF0dXJlKCdMUycsJzMuMCcpKXtTYXJpc3NhLmdldERvbURvY3VtZW50PWZ1bmN0aW9uKHNVcmksc05hbWUpe3ZhciBvRG9jPWRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50KHNVcmk/c1VyaTpudWxsLHNOYW1lP3NOYW1lOm51bGwsbnVsbCk7cmV0dXJuIG9Eb2M7fTt9XG5lbHNle1Nhcmlzc2EuZ2V0RG9tRG9jdW1lbnQ9ZnVuY3Rpb24oc1VyaSxzTmFtZSl7dmFyIG9Eb2M9ZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnQoc1VyaT9zVXJpOm51bGwsc05hbWU/c05hbWU6bnVsbCxudWxsKTtpZihvRG9jJiYoc1VyaXx8c05hbWUpJiYhb0RvYy5kb2N1bWVudEVsZW1lbnQpe29Eb2MuYXBwZW5kQ2hpbGQob0RvYy5jcmVhdGVFbGVtZW50TlMoc1VyaSxzTmFtZSkpO31cbnJldHVybiBvRG9jO307fX19XG5pZighd2luZG93LkRPTVBhcnNlcil7aWYoU2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUkkpe0RPTVBhcnNlcj1mdW5jdGlvbigpe307RE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmc9ZnVuY3Rpb24oc1htbCxjb250ZW50VHlwZSl7dmFyIHhtbGh0dHA9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7eG1saHR0cC5vcGVuKFwiR0VUXCIsXCJkYXRhOnRleHQveG1sO2NoYXJzZXQ9dXRmLTgsXCIrZW5jb2RlVVJJQ29tcG9uZW50KHNYbWwpLGZhbHNlKTt4bWxodHRwLnNlbmQobnVsbCk7cmV0dXJuIHhtbGh0dHAucmVzcG9uc2VYTUw7fTt9ZWxzZSBpZihTYXJpc3NhLmdldERvbURvY3VtZW50JiZTYXJpc3NhLmdldERvbURvY3VtZW50KCkmJlNhcmlzc2EuZ2V0RG9tRG9jdW1lbnQobnVsbCxcImJhclwiKS54bWwpe0RPTVBhcnNlcj1mdW5jdGlvbigpe307RE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmc9ZnVuY3Rpb24oc1htbCxjb250ZW50VHlwZSl7dmFyIGRvYz1TYXJpc3NhLmdldERvbURvY3VtZW50KCk7ZG9jLmxvYWRYTUwoc1htbCk7cmV0dXJuIGRvYzt9O319XG5pZigodHlwZW9mKGRvY3VtZW50LmltcG9ydE5vZGUpPT1cInVuZGVmaW5lZFwiKSYmU2FyaXNzYS5fU0FSSVNTQV9JU19JRSl7dHJ5e2RvY3VtZW50LmltcG9ydE5vZGU9ZnVuY3Rpb24ob05vZGUsYkNoaWxkcmVuKXt2YXIgdG1wO2lmKG9Ob2RlLm5vZGVOYW1lPT0nI3RleHQnKXtyZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUob05vZGUuZGF0YSk7fVxuZWxzZXtpZihvTm9kZS5ub2RlTmFtZT09XCJ0Ym9keVwifHxvTm9kZS5ub2RlTmFtZT09XCJ0clwiKXt0bXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO31cbmVsc2UgaWYob05vZGUubm9kZU5hbWU9PVwidGRcIil7dG1wPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTt9XG5lbHNlIGlmKG9Ob2RlLm5vZGVOYW1lPT1cIm9wdGlvblwiKXt0bXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTt9XG5lbHNle3RtcD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO31cbmlmKGJDaGlsZHJlbil7dG1wLmlubmVySFRNTD1vTm9kZS54bWw/b05vZGUueG1sOm9Ob2RlLm91dGVySFRNTDt9ZWxzZXt0bXAuaW5uZXJIVE1MPW9Ob2RlLnhtbD9vTm9kZS5jbG9uZU5vZGUoZmFsc2UpLnhtbDpvTm9kZS5jbG9uZU5vZGUoZmFsc2UpLm91dGVySFRNTDt9XG5yZXR1cm4gdG1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKVswXTt9fTt9Y2F0Y2goZSl7fX1cbmlmKCFTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KXtTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0PWZ1bmN0aW9uKG9Eb2Mpe3ZhciBwYXJzZUVycm9yVGV4dD1TYXJpc3NhLlBBUlNFRF9PSztpZigoIW9Eb2MpfHwoIW9Eb2MuZG9jdW1lbnRFbGVtZW50KSl7cGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfRU1QVFk7fWVsc2UgaWYob0RvYy5kb2N1bWVudEVsZW1lbnQudGFnTmFtZT09XCJwYXJzZXJlcnJvclwiKXtwYXJzZUVycm9yVGV4dD1vRG9jLmRvY3VtZW50RWxlbWVudC5maXJzdENoaWxkLmRhdGE7cGFyc2VFcnJvclRleHQrPVwiXFxuXCIrb0RvYy5kb2N1bWVudEVsZW1lbnQuZmlyc3RDaGlsZC5uZXh0U2libGluZy5maXJzdENoaWxkLmRhdGE7fWVsc2UgaWYob0RvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInBhcnNlcmVycm9yXCIpLmxlbmd0aD4wKXt2YXIgcGFyc2VyZXJyb3I9b0RvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInBhcnNlcmVycm9yXCIpWzBdO3BhcnNlRXJyb3JUZXh0PVNhcmlzc2EuZ2V0VGV4dChwYXJzZXJlcnJvcix0cnVlKStcIlxcblwiO31lbHNlIGlmKG9Eb2MucGFyc2VFcnJvciYmb0RvYy5wYXJzZUVycm9yLmVycm9yQ29kZSE9MCl7cGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfVU5LTk9XTl9FUlJPUjt9XG5yZXR1cm4gcGFyc2VFcnJvclRleHQ7fTt9XG5TYXJpc3NhLmdldFRleHQ9ZnVuY3Rpb24ob05vZGUsZGVlcCl7dmFyIHM9XCJcIjt2YXIgbm9kZXM9b05vZGUuY2hpbGROb2Rlcztmb3IodmFyIGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe3ZhciBub2RlPW5vZGVzW2ldO3ZhciBub2RlVHlwZT1ub2RlLm5vZGVUeXBlO2lmKG5vZGVUeXBlPT1Ob2RlLlRFWFRfTk9ERXx8bm9kZVR5cGU9PU5vZGUuQ0RBVEFfU0VDVElPTl9OT0RFKXtzKz1ub2RlLmRhdGE7fWVsc2UgaWYoZGVlcD09PXRydWUmJihub2RlVHlwZT09Tm9kZS5FTEVNRU5UX05PREV8fG5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREV8fG5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX0ZSQUdNRU5UX05PREUpKXtzKz1TYXJpc3NhLmdldFRleHQobm9kZSx0cnVlKTt9fVxucmV0dXJuIHM7fTtpZighd2luZG93LlhNTFNlcmlhbGl6ZXImJlNhcmlzc2EuZ2V0RG9tRG9jdW1lbnQmJlNhcmlzc2EuZ2V0RG9tRG9jdW1lbnQoXCJcIixcImZvb1wiLG51bGwpLnhtbCl7WE1MU2VyaWFsaXplcj1mdW5jdGlvbigpe307WE1MU2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplVG9TdHJpbmc9ZnVuY3Rpb24ob05vZGUpe3JldHVybiBvTm9kZS54bWw7fTt9XG5TYXJpc3NhLnN0cmlwVGFncz1mdW5jdGlvbihzKXtyZXR1cm4gcz9zLnJlcGxhY2UoLzxbXj5dKz4vZyxcIlwiKTpzO307U2FyaXNzYS5jbGVhckNoaWxkTm9kZXM9ZnVuY3Rpb24ob05vZGUpe3doaWxlKG9Ob2RlLmZpcnN0Q2hpbGQpe29Ob2RlLnJlbW92ZUNoaWxkKG9Ob2RlLmZpcnN0Q2hpbGQpO319O1Nhcmlzc2EuY29weUNoaWxkTm9kZXM9ZnVuY3Rpb24obm9kZUZyb20sbm9kZVRvLGJQcmVzZXJ2ZUV4aXN0aW5nKXtpZihTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSSSYmbm9kZVRvLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREUpe25vZGVUbz1ub2RlVG8uZG9jdW1lbnRFbGVtZW50O31cbmlmKCghbm9kZUZyb20pfHwoIW5vZGVUbykpe3Rocm93XCJCb3RoIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gbm9kZXMgbXVzdCBiZSBwcm92aWRlZFwiO31cbmlmKCFiUHJlc2VydmVFeGlzdGluZyl7U2FyaXNzYS5jbGVhckNoaWxkTm9kZXMobm9kZVRvKTt9XG52YXIgb3duZXJEb2M9bm9kZVRvLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREU/bm9kZVRvOm5vZGVUby5vd25lckRvY3VtZW50O3ZhciBub2Rlcz1ub2RlRnJvbS5jaGlsZE5vZGVzO3ZhciBpO2lmKHR5cGVvZihvd25lckRvYy5pbXBvcnROb2RlKSE9XCJ1bmRlZmluZWRcIil7Zm9yKGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe25vZGVUby5hcHBlbmRDaGlsZChvd25lckRvYy5pbXBvcnROb2RlKG5vZGVzW2ldLHRydWUpKTt9fWVsc2V7Zm9yKGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe25vZGVUby5hcHBlbmRDaGlsZChub2Rlc1tpXS5jbG9uZU5vZGUodHJ1ZSkpO319fTtTYXJpc3NhLm1vdmVDaGlsZE5vZGVzPWZ1bmN0aW9uKG5vZGVGcm9tLG5vZGVUbyxiUHJlc2VydmVFeGlzdGluZyl7aWYoKCFub2RlRnJvbSl8fCghbm9kZVRvKSl7dGhyb3dcIkJvdGggc291cmNlIGFuZCBkZXN0aW5hdGlvbiBub2RlcyBtdXN0IGJlIHByb3ZpZGVkXCI7fVxuaWYoIWJQcmVzZXJ2ZUV4aXN0aW5nKXtTYXJpc3NhLmNsZWFyQ2hpbGROb2Rlcyhub2RlVG8pO31cbnZhciBub2Rlcz1ub2RlRnJvbS5jaGlsZE5vZGVzO2lmKG5vZGVGcm9tLm93bmVyRG9jdW1lbnQ9PW5vZGVUby5vd25lckRvY3VtZW50KXt3aGlsZShub2RlRnJvbS5maXJzdENoaWxkKXtub2RlVG8uYXBwZW5kQ2hpbGQobm9kZUZyb20uZmlyc3RDaGlsZCk7fX1lbHNle3ZhciBvd25lckRvYz1ub2RlVG8ubm9kZVR5cGU9PU5vZGUuRE9DVU1FTlRfTk9ERT9ub2RlVG86bm9kZVRvLm93bmVyRG9jdW1lbnQ7dmFyIGk7aWYodHlwZW9mKG93bmVyRG9jLmltcG9ydE5vZGUpIT1cInVuZGVmaW5lZFwiKXtmb3IoaT0wO2k8bm9kZXMubGVuZ3RoO2krKyl7bm9kZVRvLmFwcGVuZENoaWxkKG93bmVyRG9jLmltcG9ydE5vZGUobm9kZXNbaV0sdHJ1ZSkpO319ZWxzZXtmb3IoaT0wO2k8bm9kZXMubGVuZ3RoO2krKyl7bm9kZVRvLmFwcGVuZENoaWxkKG5vZGVzW2ldLmNsb25lTm9kZSh0cnVlKSk7fX1cblNhcmlzc2EuY2xlYXJDaGlsZE5vZGVzKG5vZGVGcm9tKTt9fTtTYXJpc3NhLnhtbGl6ZT1mdW5jdGlvbihhbnlPYmplY3Qsb2JqZWN0TmFtZSxpbmRlbnRTcGFjZSl7aW5kZW50U3BhY2U9aW5kZW50U3BhY2U/aW5kZW50U3BhY2U6Jyc7dmFyIHM9aW5kZW50U3BhY2UrJzwnK29iamVjdE5hbWUrJz4nO3ZhciBpc0xlYWY9ZmFsc2U7aWYoIShhbnlPYmplY3QgaW5zdGFuY2VvZiBPYmplY3QpfHxhbnlPYmplY3QgaW5zdGFuY2VvZiBOdW1iZXJ8fGFueU9iamVjdCBpbnN0YW5jZW9mIFN0cmluZ3x8YW55T2JqZWN0IGluc3RhbmNlb2YgQm9vbGVhbnx8YW55T2JqZWN0IGluc3RhbmNlb2YgRGF0ZSl7cys9U2FyaXNzYS5lc2NhcGUoXCJcIithbnlPYmplY3QpO2lzTGVhZj10cnVlO31lbHNle3MrPVwiXFxuXCI7dmFyIGlzQXJyYXlJdGVtPWFueU9iamVjdCBpbnN0YW5jZW9mIEFycmF5O2Zvcih2YXIgbmFtZSBpbiBhbnlPYmplY3Qpe3MrPVNhcmlzc2EueG1saXplKGFueU9iamVjdFtuYW1lXSwoaXNBcnJheUl0ZW0/XCJhcnJheS1pdGVtIGtleT1cXFwiXCIrbmFtZStcIlxcXCJcIjpuYW1lKSxpbmRlbnRTcGFjZStcIiAgIFwiKTt9XG5zKz1pbmRlbnRTcGFjZTt9XG5yZXR1cm4ocys9KG9iamVjdE5hbWUuaW5kZXhPZignICcpIT0tMT9cIjwvYXJyYXktaXRlbT5cXG5cIjpcIjwvXCIrb2JqZWN0TmFtZStcIj5cXG5cIikpO307U2FyaXNzYS5lc2NhcGU9ZnVuY3Rpb24oc1htbCl7cmV0dXJuIHNYbWwucmVwbGFjZSgvJi9nLFwiJmFtcDtcIikucmVwbGFjZSgvPC9nLFwiJmx0O1wiKS5yZXBsYWNlKC8+L2csXCImZ3Q7XCIpLnJlcGxhY2UoL1wiL2csXCImcXVvdDtcIikucmVwbGFjZSgvJy9nLFwiJmFwb3M7XCIpO307U2FyaXNzYS51bmVzY2FwZT1mdW5jdGlvbihzWG1sKXtyZXR1cm4gc1htbC5yZXBsYWNlKC8mYXBvczsvZyxcIidcIikucmVwbGFjZSgvJnF1b3Q7L2csXCJcXFwiXCIpLnJlcGxhY2UoLyZndDsvZyxcIj5cIikucmVwbGFjZSgvJmx0Oy9nLFwiPFwiKS5yZXBsYWNlKC8mYW1wOy9nLFwiJlwiKTt9O1Nhcmlzc2EudXBkYXRlQ3Vyc29yPWZ1bmN0aW9uKG9UYXJnZXRFbGVtZW50LHNWYWx1ZSl7aWYob1RhcmdldEVsZW1lbnQmJm9UYXJnZXRFbGVtZW50LnN0eWxlJiZvVGFyZ2V0RWxlbWVudC5zdHlsZS5jdXJzb3IhPXVuZGVmaW5lZCl7b1RhcmdldEVsZW1lbnQuc3R5bGUuY3Vyc29yPXNWYWx1ZTt9fTtTYXJpc3NhLnVwZGF0ZUNvbnRlbnRGcm9tVVJJPWZ1bmN0aW9uKHNGcm9tVXJsLG9UYXJnZXRFbGVtZW50LHhzbHRwcm9jLGNhbGxiYWNrLHNraXBDYWNoZSl7dHJ5e1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwid2FpdFwiKTt2YXIgeG1saHR0cD1uZXcgWE1MSHR0cFJlcXVlc3QoKTt4bWxodHRwLm9wZW4oXCJHRVRcIixzRnJvbVVybCx0cnVlKTt4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2lmKHhtbGh0dHAucmVhZHlTdGF0ZT09NCl7dHJ5e3ZhciBvRG9tRG9jPXhtbGh0dHAucmVzcG9uc2VYTUw7aWYob0RvbURvYyYmU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvRG9tRG9jKT09U2FyaXNzYS5QQVJTRURfT0spe1Nhcmlzc2EudXBkYXRlQ29udGVudEZyb21Ob2RlKHhtbGh0dHAucmVzcG9uc2VYTUwsb1RhcmdldEVsZW1lbnQseHNsdHByb2MpO2lmKGNhbGxiYWNrKXtjYWxsYmFjayhzRnJvbVVybCxvVGFyZ2V0RWxlbWVudCk7fX1cbmVsc2V7dGhyb3cgU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvRG9tRG9jKTt9fVxuY2F0Y2goZSl7aWYoY2FsbGJhY2spe2NhbGxiYWNrKHNGcm9tVXJsLG9UYXJnZXRFbGVtZW50LGUpO31cbmVsc2V7dGhyb3cgZTt9fX19O2lmKHNraXBDYWNoZSl7dmFyIG9sZGFnZT1cIlNhdCwgMSBKYW4gMjAwMCAwMDowMDowMCBHTVRcIjt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJJZi1Nb2RpZmllZC1TaW5jZVwiLG9sZGFnZSk7fVxueG1saHR0cC5zZW5kKFwiXCIpO31cbmNhdGNoKGUpe1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwiYXV0b1wiKTtpZihjYWxsYmFjayl7Y2FsbGJhY2soc0Zyb21Vcmwsb1RhcmdldEVsZW1lbnQsZSk7fVxuZWxzZXt0aHJvdyBlO319fTtTYXJpc3NhLnVwZGF0ZUNvbnRlbnRGcm9tTm9kZT1mdW5jdGlvbihvTm9kZSxvVGFyZ2V0RWxlbWVudCx4c2x0cHJvYyl7dHJ5e1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwid2FpdFwiKTtTYXJpc3NhLmNsZWFyQ2hpbGROb2RlcyhvVGFyZ2V0RWxlbWVudCk7dmFyIG93bmVyRG9jPW9Ob2RlLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREU/b05vZGU6b05vZGUub3duZXJEb2N1bWVudDtpZihvd25lckRvYy5wYXJzZUVycm9yJiZvd25lckRvYy5wYXJzZUVycm9yLmVycm9yQ29kZSE9MCl7dmFyIHByZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO3ByZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KG93bmVyRG9jKSkpO29UYXJnZXRFbGVtZW50LmFwcGVuZENoaWxkKHByZSk7fVxuZWxzZXtpZih4c2x0cHJvYyl7b05vZGU9eHNsdHByb2MudHJhbnNmb3JtVG9Eb2N1bWVudChvTm9kZSk7fVxuaWYob1RhcmdldEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpPT1cInRleHRhcmVhXCJ8fG9UYXJnZXRFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKT09XCJpbnB1dFwiKXtvVGFyZ2V0RWxlbWVudC52YWx1ZT1uZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKG9Ob2RlKTt9XG5lbHNle3RyeXtvVGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChvVGFyZ2V0RWxlbWVudC5vd25lckRvY3VtZW50LmltcG9ydE5vZGUob05vZGUsdHJ1ZSkpO31cbmNhdGNoKGUpe29UYXJnZXRFbGVtZW50LmlubmVySFRNTD1uZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKG9Ob2RlKTt9fX19XG5jYXRjaChlKXt0aHJvdyBlO31cbmZpbmFsbHl7U2FyaXNzYS51cGRhdGVDdXJzb3Iob1RhcmdldEVsZW1lbnQsXCJhdXRvXCIpO319O1Nhcmlzc2EuZm9ybVRvUXVlcnlTdHJpbmc9ZnVuY3Rpb24ob0Zvcm0pe3ZhciBxcz1cIlwiO2Zvcih2YXIgaT0wO2k8b0Zvcm0uZWxlbWVudHMubGVuZ3RoO2krKyl7dmFyIG9GaWVsZD1vRm9ybS5lbGVtZW50c1tpXTt2YXIgc0ZpZWxkTmFtZT1vRmllbGQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKT9vRmllbGQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTpvRmllbGQuZ2V0QXR0cmlidXRlKFwiaWRcIik7aWYoc0ZpZWxkTmFtZSYmKCghb0ZpZWxkLmRpc2FibGVkKXx8b0ZpZWxkLnR5cGU9PVwiaGlkZGVuXCIpKXtzd2l0Y2gob0ZpZWxkLnR5cGUpe2Nhc2VcImhpZGRlblwiOmNhc2VcInRleHRcIjpjYXNlXCJ0ZXh0YXJlYVwiOmNhc2VcInBhc3N3b3JkXCI6cXMrPXNGaWVsZE5hbWUrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KG9GaWVsZC52YWx1ZSkrXCImXCI7YnJlYWs7Y2FzZVwic2VsZWN0LW9uZVwiOnFzKz1zRmllbGROYW1lK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChvRmllbGQub3B0aW9uc1tvRmllbGQuc2VsZWN0ZWRJbmRleF0udmFsdWUpK1wiJlwiO2JyZWFrO2Nhc2VcInNlbGVjdC1tdWx0aXBsZVwiOmZvcih2YXIgaj0wO2o8b0ZpZWxkLmxlbmd0aDtqKyspe3ZhciBvcHRFbGVtPW9GaWVsZC5vcHRpb25zW2pdO2lmKG9wdEVsZW0uc2VsZWN0ZWQ9PT10cnVlKXtxcys9c0ZpZWxkTmFtZStcIltdXCIrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KG9wdEVsZW0udmFsdWUpK1wiJlwiO319XG5icmVhaztjYXNlXCJjaGVja2JveFwiOmNhc2VcInJhZGlvXCI6aWYob0ZpZWxkLmNoZWNrZWQpe3FzKz1zRmllbGROYW1lK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChvRmllbGQudmFsdWUpK1wiJlwiO31cbmJyZWFrO319fVxucmV0dXJuIHFzLnN1YnN0cigwLHFzLmxlbmd0aC0xKTt9O1Nhcmlzc2EudXBkYXRlQ29udGVudEZyb21Gb3JtPWZ1bmN0aW9uKG9Gb3JtLG9UYXJnZXRFbGVtZW50LHhzbHRwcm9jLGNhbGxiYWNrKXt0cnl7U2FyaXNzYS51cGRhdGVDdXJzb3Iob1RhcmdldEVsZW1lbnQsXCJ3YWl0XCIpO3ZhciBwYXJhbXM9U2FyaXNzYS5mb3JtVG9RdWVyeVN0cmluZyhvRm9ybSkrXCImXCIrU2FyaXNzYS5SRU1PVEVfQ0FMTF9GTEFHK1wiPXRydWVcIjt2YXIgeG1saHR0cD1uZXcgWE1MSHR0cFJlcXVlc3QoKTt2YXIgYlVzZUdldD1vRm9ybS5nZXRBdHRyaWJ1dGUoXCJtZXRob2RcIikmJm9Gb3JtLmdldEF0dHJpYnV0ZShcIm1ldGhvZFwiKS50b0xvd2VyQ2FzZSgpPT1cImdldFwiO2lmKGJVc2VHZXQpe3htbGh0dHAub3BlbihcIkdFVFwiLG9Gb3JtLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKStcIj9cIitwYXJhbXMsdHJ1ZSk7fVxuZWxzZXt4bWxodHRwLm9wZW4oJ1BPU1QnLG9Gb3JtLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKSx0cnVlKTt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LXR5cGVcIixcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKTt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LWxlbmd0aFwiLHBhcmFtcy5sZW5ndGgpO3htbGh0dHAuc2V0UmVxdWVzdEhlYWRlcihcIkNvbm5lY3Rpb25cIixcImNsb3NlXCIpO31cbnhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7dHJ5e2lmKHhtbGh0dHAucmVhZHlTdGF0ZT09NCl7dmFyIG9Eb21Eb2M9eG1saHR0cC5yZXNwb25zZVhNTDtpZihvRG9tRG9jJiZTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KG9Eb21Eb2MpPT1TYXJpc3NhLlBBUlNFRF9PSyl7U2FyaXNzYS51cGRhdGVDb250ZW50RnJvbU5vZGUoeG1saHR0cC5yZXNwb25zZVhNTCxvVGFyZ2V0RWxlbWVudCx4c2x0cHJvYyk7aWYoY2FsbGJhY2spe2NhbGxiYWNrKG9Gb3JtLG9UYXJnZXRFbGVtZW50KTt9fVxuZWxzZXt0aHJvdyBTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KG9Eb21Eb2MpO319fVxuY2F0Y2goZSl7aWYoY2FsbGJhY2spe2NhbGxiYWNrKG9Gb3JtLG9UYXJnZXRFbGVtZW50LGUpO31cbmVsc2V7dGhyb3cgZTt9fX07eG1saHR0cC5zZW5kKGJVc2VHZXQ/XCJcIjpwYXJhbXMpO31cbmNhdGNoKGUpe1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwiYXV0b1wiKTtpZihjYWxsYmFjayl7Y2FsbGJhY2sob0Zvcm0sb1RhcmdldEVsZW1lbnQsZSk7fVxuZWxzZXt0aHJvdyBlO319XG5yZXR1cm4gZmFsc2U7fTtTYXJpc3NhLkZVTkNUSU9OX05BTUVfUkVHRVhQPW5ldyBSZWdFeHAoXCJcIik7U2FyaXNzYS5nZXRGdW5jdGlvbk5hbWU9ZnVuY3Rpb24ob0Z1bmMsYkZvcmNlKXt2YXIgbmFtZTtpZighbmFtZSl7aWYoYkZvcmNlKXtuYW1lPVwiU2FyaXNzYUFub255bW91c1wiK1Nhcmlzc2EuX2dldFVuaXF1ZVN1ZmZpeCgpO3dpbmRvd1tuYW1lXT1vRnVuYzt9XG5lbHNle25hbWU9bnVsbDt9fVxuaWYobmFtZSl7d2luZG93W25hbWVdPW9GdW5jO31cbnJldHVybiBuYW1lO307U2FyaXNzYS5zZXRSZW1vdGVKc29uQ2FsbGJhY2s9ZnVuY3Rpb24odXJsLGNhbGxiYWNrLGNhbGxiYWNrUGFyYW0pe2lmKCFjYWxsYmFja1BhcmFtKXtjYWxsYmFja1BhcmFtPVwiY2FsbGJhY2tcIjt9XG52YXIgY2FsbGJhY2tGdW5jdGlvbk5hbWU9U2FyaXNzYS5nZXRGdW5jdGlvbk5hbWUoY2FsbGJhY2ssdHJ1ZSk7dmFyIGlkPVwic2FyaXNzYV9qc29uX3NjcmlwdF9pZF9cIitTYXJpc3NhLl9nZXRVbmlxdWVTdWZmaXgoKTt2YXIgb0hlYWQ9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdO3ZhciBzY3JpcHRUYWc9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7c2NyaXB0VGFnLnR5cGU9J3RleHQvamF2YXNjcmlwdCc7c2NyaXB0VGFnLmlkPWlkO3NjcmlwdFRhZy5vbmxvYWQ9ZnVuY3Rpb24oKXt9O2lmKHVybC5pbmRleE9mKFwiP1wiKSE9LTEpe3VybCs9KFwiJlwiK2NhbGxiYWNrUGFyYW0rXCI9XCIrY2FsbGJhY2tGdW5jdGlvbk5hbWUpO31cbmVsc2V7dXJsKz0oXCI/XCIrY2FsbGJhY2tQYXJhbStcIj1cIitjYWxsYmFja0Z1bmN0aW9uTmFtZSk7fVxuc2NyaXB0VGFnLnNyYz11cmw7b0hlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtyZXR1cm4gaWQ7fTtcblxuLy8gc2FyaXNzYV9pZWVtdV94cGF0aC5qc1xuXG5pZihTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fRkVBVFVSRSYmZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZShcIlhQYXRoXCIsXCIzLjBcIikpe1Nhcmlzc2FOb2RlTGlzdD1mdW5jdGlvbihpKXt0aGlzLmxlbmd0aD1pO307U2FyaXNzYU5vZGVMaXN0LnByb3RvdHlwZT1bXTtTYXJpc3NhTm9kZUxpc3QucHJvdG90eXBlLmNvbnN0cnVjdG9yPUFycmF5O1Nhcmlzc2FOb2RlTGlzdC5wcm90b3R5cGUuaXRlbT1mdW5jdGlvbihpKXtyZXR1cm4oaTwwfHxpPj10aGlzLmxlbmd0aCk/bnVsbDp0aGlzW2ldO307U2FyaXNzYU5vZGVMaXN0LnByb3RvdHlwZS5leHByPVwiXCI7aWYod2luZG93LlhNTERvY3VtZW50JiYoIVhNTERvY3VtZW50LnByb3RvdHlwZS5zZXRQcm9wZXJ0eSkpe1hNTERvY3VtZW50LnByb3RvdHlwZS5zZXRQcm9wZXJ0eT1mdW5jdGlvbih4LHkpe307fVxuU2FyaXNzYS5zZXRYcGF0aE5hbWVzcGFjZXM9ZnVuY3Rpb24ob0RvYyxzTnNTZXQpe29Eb2MuX3Nhcmlzc2FfdXNlQ3VzdG9tUmVzb2x2ZXI9dHJ1ZTt2YXIgbmFtZXNwYWNlcz1zTnNTZXQuaW5kZXhPZihcIiBcIik+LTE/c05zU2V0LnNwbGl0KFwiIFwiKTpbc05zU2V0XTtvRG9jLl9zYXJpc3NhX3hwYXRoTmFtZXNwYWNlcz1bXTtmb3IodmFyIGk9MDtpPG5hbWVzcGFjZXMubGVuZ3RoO2krKyl7dmFyIG5zPW5hbWVzcGFjZXNbaV07dmFyIGNvbG9uUG9zPW5zLmluZGV4T2YoXCI6XCIpO3ZhciBhc3NpZ25Qb3M9bnMuaW5kZXhPZihcIj1cIik7aWYoY29sb25Qb3M+MCYmYXNzaWduUG9zPmNvbG9uUG9zKzEpe3ZhciBwcmVmaXg9bnMuc3Vic3RyaW5nKGNvbG9uUG9zKzEsYXNzaWduUG9zKTt2YXIgdXJpPW5zLnN1YnN0cmluZyhhc3NpZ25Qb3MrMixucy5sZW5ndGgtMSk7b0RvYy5fc2FyaXNzYV94cGF0aE5hbWVzcGFjZXNbcHJlZml4XT11cmk7fWVsc2V7dGhyb3dcIkJhZCBmb3JtYXQgb24gbmFtZXNwYWNlIGRlY2xhcmF0aW9uKHMpIGdpdmVuXCI7fX19O1hNTERvY3VtZW50LnByb3RvdHlwZS5fc2FyaXNzYV91c2VDdXN0b21SZXNvbHZlcj1mYWxzZTtYTUxEb2N1bWVudC5wcm90b3R5cGUuX3Nhcmlzc2FfeHBhdGhOYW1lc3BhY2VzPVtdO1hNTERvY3VtZW50LnByb3RvdHlwZS5zZWxlY3ROb2Rlcz1mdW5jdGlvbihzRXhwcixjb250ZXh0Tm9kZSxyZXR1cm5TaW5nbGUpe3ZhciBuc0RvYz10aGlzO3ZhciBuc3Jlc29sdmVyO2lmKHRoaXMuX3Nhcmlzc2FfdXNlQ3VzdG9tUmVzb2x2ZXIpe25zcmVzb2x2ZXI9ZnVuY3Rpb24ocHJlZml4KXt2YXIgcz1uc0RvYy5fc2FyaXNzYV94cGF0aE5hbWVzcGFjZXNbcHJlZml4XTtpZihzKXtyZXR1cm4gczt9XG5lbHNle3Rocm93XCJObyBuYW1lc3BhY2UgVVJJIGZvdW5kIGZvciBwcmVmaXg6ICdcIitwcmVmaXgrXCInXCI7fX07fVxuZWxzZXtuc3Jlc29sdmVyPXRoaXMuY3JlYXRlTlNSZXNvbHZlcih0aGlzLmRvY3VtZW50RWxlbWVudCk7fVxudmFyIHJlc3VsdD1udWxsO2lmKCFyZXR1cm5TaW5nbGUpe3ZhciBvUmVzdWx0PXRoaXMuZXZhbHVhdGUoc0V4cHIsKGNvbnRleHROb2RlP2NvbnRleHROb2RlOnRoaXMpLG5zcmVzb2x2ZXIsWFBhdGhSZXN1bHQuT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsbnVsbCk7dmFyIG5vZGVMaXN0PW5ldyBTYXJpc3NhTm9kZUxpc3Qob1Jlc3VsdC5zbmFwc2hvdExlbmd0aCk7bm9kZUxpc3QuZXhwcj1zRXhwcjtmb3IodmFyIGk9MDtpPG5vZGVMaXN0Lmxlbmd0aDtpKyspe25vZGVMaXN0W2ldPW9SZXN1bHQuc25hcHNob3RJdGVtKGkpO31cbnJlc3VsdD1ub2RlTGlzdDt9XG5lbHNle3Jlc3VsdD10aGlzLmV2YWx1YXRlKHNFeHByLChjb250ZXh0Tm9kZT9jb250ZXh0Tm9kZTp0aGlzKSxuc3Jlc29sdmVyLFhQYXRoUmVzdWx0LkZJUlNUX09SREVSRURfTk9ERV9UWVBFLG51bGwpLnNpbmdsZU5vZGVWYWx1ZTt9XG5yZXR1cm4gcmVzdWx0O307RWxlbWVudC5wcm90b3R5cGUuc2VsZWN0Tm9kZXM9ZnVuY3Rpb24oc0V4cHIpe3ZhciBkb2M9dGhpcy5vd25lckRvY3VtZW50O2lmKGRvYy5zZWxlY3ROb2Rlcyl7cmV0dXJuIGRvYy5zZWxlY3ROb2RlcyhzRXhwcix0aGlzKTt9XG5lbHNle3Rocm93XCJNZXRob2Qgc2VsZWN0Tm9kZXMgaXMgb25seSBzdXBwb3J0ZWQgYnkgWE1MIEVsZW1lbnRzXCI7fX07WE1MRG9jdW1lbnQucHJvdG90eXBlLnNlbGVjdFNpbmdsZU5vZGU9ZnVuY3Rpb24oc0V4cHIsY29udGV4dE5vZGUpe3ZhciBjdHg9Y29udGV4dE5vZGU/Y29udGV4dE5vZGU6bnVsbDtyZXR1cm4gdGhpcy5zZWxlY3ROb2RlcyhzRXhwcixjdHgsdHJ1ZSk7fTtFbGVtZW50LnByb3RvdHlwZS5zZWxlY3RTaW5nbGVOb2RlPWZ1bmN0aW9uKHNFeHByKXt2YXIgZG9jPXRoaXMub3duZXJEb2N1bWVudDtpZihkb2Muc2VsZWN0U2luZ2xlTm9kZSl7cmV0dXJuIGRvYy5zZWxlY3RTaW5nbGVOb2RlKHNFeHByLHRoaXMpO31cbmVsc2V7dGhyb3dcIk1ldGhvZCBzZWxlY3ROb2RlcyBpcyBvbmx5IHN1cHBvcnRlZCBieSBYTUwgRWxlbWVudHNcIjt9fTtTYXJpc3NhLklTX0VOQUJMRURfU0VMRUNUX05PREVTPXRydWU7fVxuXG4vLyBqcXVlcnkueHNsdC5qc1xuXG52YXIgeHNsVHJhbnNmb3JtPXt2ZXJzaW9uOjIwMDcxMjAzLGRlYnVnOmZhbHNlLGluaXQ6ZnVuY3Rpb24oKXt0cnl7cGFyc2VGbG9hdChqUXVlcnkuZm4uanF1ZXJ5KT49MTt9Y2F0Y2goZSl7YWxlcnQoJ3hzbFRyYW5zZm9ybSByZXF1aXJlcyBqUXVlcnkgMS4wLjQgb3IgZ3JlYXRlciAuLi4gcGxlYXNlIGxvYWQgaXQgcHJpb3IgdG8geHNsVHJhbnNmb3JtJyk7fVxudHJ5e1Nhcmlzc2E7fWNhdGNoKGUpe2FsZXJ0KCdNaXNzaW5nIFNhcmlzc2EgLi4uIHBsZWFzZSBsb2FkIGl0IHByaW9yIHRvIHhzbFRyYW5zZm9ybScpO31cbmlmKCFqUXVlcnkubG9nKXtqUXVlcnkubG9nPWZ1bmN0aW9uKCl7fTtqUXVlcnkuZm4uZGVidWc9ZnVuY3Rpb24oKXt9O31cbmlmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygneHNsVHJhbnNmb3JtOmluaXQoKTogdmVyc2lvbiAnK3hzbFRyYW5zZm9ybS52ZXJzaW9uKTt9LFhNTFNlcmlhbGl6ZXI6bmV3IFhNTFNlcmlhbGl6ZXIoKSxzZXJpYWxpemU6ZnVuY3Rpb24oZGF0YSl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdzZXJpYWxpemUoKTogcmVjZWl2ZWQgJyt0eXBlb2YoZGF0YSkpO2lmKHR5cGVvZihkYXRhKT09J3N0cmluZycpe3JldHVybiBkYXRhO31cbnJldHVybiB0aGlzLlhNTFNlcmlhbGl6ZXIuc2VyaWFsaXplVG9TdHJpbmcoZGF0YSk7fSxsb2FkOmZ1bmN0aW9uKHhtbCxtZXRoKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ2xvYWQoKTogcmVjZWl2ZWQgJyt0eXBlb2YoeG1sKSk7dmFyIHI7aWYodHlwZW9mKHhtbCk9PSdvYmplY3QnKXtyZXR1cm4geG1sO31cbmlmKHhtbC5zdWJzdHJpbmcoMCwxKT09JzwnKXtyPXRoaXMubG9hZFN0cmluZyh4bWwpO31lbHNle3I9dGhpcy5sb2FkRmlsZSh4bWwsbWV0aCk7fVxuaWYocil7ci5zZXRQcm9wZXJ0eSgnU2VsZWN0aW9uTmFtZXNwYWNlcycsJ3htbG5zOnhzbD1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkvWFNML1RyYW5zZm9ybVwiJyk7ci5zZXRQcm9wZXJ0eSgnU2VsZWN0aW9uTGFuZ3VhZ2UnLCdYUGF0aCcpO3JldHVybiByO31lbHNle2lmKHRoaXMuZGVidWcpJC5sb2coJ1VuYWJsZSB0byBsb2FkICcreG1sKTtyZXR1cm4gZmFsc2U7fX0sbG9hZFN0cmluZzpmdW5jdGlvbihzdHIpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZFN0cmluZygpOiAnK3N0cisnOjonK3R5cGVvZihzdHIpKTt2YXIgcD1uZXcgRE9NUGFyc2VyKCk7dmFyIHhtbD1wLnBhcnNlRnJvbVN0cmluZyhzdHIsJ3RleHQveG1sJyk7aWYoIXhtbCl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdsb2FkU3RyaW5nKCk6IHBhcnNlRnJvbVN0cmluZygpIGZhaWxlZCcpO3JldHVybiBmYWxzZTt9XG5yZXR1cm4geG1sO30sbG9hZEZpbGU6ZnVuY3Rpb24odXJsLG1ldGgpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZEZpbGUoKTogJyt1cmwrJzo6Jyt0eXBlb2YodXJsKSk7aWYoIXVybCl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdFUlJPUjogbG9hZEZpbGUoKSBtaXNzaW5nIHVybCcpO3JldHVybiBmYWxzZTt9XG52YXIgZG9jO3RoaXMueGhyc3VjY2Vzcz1mdW5jdGlvbihkYXRhLHN0cil7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdsb2FkRmlsZSgpIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgKCcrc3RyKycpJyk7ZG9jPWRhdGE7cmV0dXJuIHRydWU7fTt0aGlzLnhocmVycm9yPWZ1bmN0aW9uKHhocixlcnIpe3dpbmRvdy5ERUJVRz10cnVlO2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZEZpbGUoKSBmYWlsZWQgdG8gbG9hZCB0aGUgcmVxdWVzdGVkIGZpbGU6ICgnK2VycisnKSAtIHhtbDogJyt4aHIucmVzcG9uc2VYTUwrJyAtIHRleHQ6ICcreGhyLnJlc3BvbnNlVGV4dCk7ZG9jPW51bGw7cmV0dXJuIGZhbHNlO307aWYoIW1ldGgpbWV0aD1cIkdFVFwiOyQuYWpheCh7dHlwZTptZXRoLHVybDp1cmwsYXN5bmM6ZmFsc2Usc3VjY2Vzczp0aGlzLnhocnN1Y2Nlc3MsZXJyb3I6dGhpcy54aHJlcnJvcn0pO2lmKCFkb2Mpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnRVJST1I6IGRvY3VtZW50ICcrdXJsKycgbm90IGZvdW5kICg0MDQpLCBvciB1bmFibGUgdG8gbG9hZCcpO3JldHVybiBmYWxzZTt9XG5pZihkb2MubGVuZ3RoPT0wKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ0VSUk9SOiBkb2N1bWVudCAnK3VybCsnIGxvYWRlZCBpbiBsb2FkRmlsZSgpIGhhcyBubyBkYXRhJyk7cmV0dXJuIGZhbHNlO31cbnJldHVybiBkb2M7fSx0cmFuc2Zvcm06ZnVuY3Rpb24oeHNsLHhtbCxvcHRpb25zKXt2YXIgbG9nPXsneHNsJzp4c2wsJ3htbCc6eG1sLCdvcHRpb25zJzpvcHRpb25zfTtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ3RyYW5zZm9ybSgpOiAnK3hzbCsnOjonK3htbCsnOjonK29wdGlvbnMudG9TdHJpbmcoKSk7b3B0aW9ucz1vcHRpb25zfHx7fTt2YXIgeG1sPXsncmVxdWVzdCc6eG1sLCdkb2MnOnRoaXMubG9hZCh4bWwsb3B0aW9ucy5tZXRoKX07aWYob3B0aW9ucy54cGF0aCYmeG1sLmRvYyYmIWpRdWVyeS5icm93c2VyLm1zaWUpe3htbC5kb2M9eG1sLmRvYy5zZWxlY3RTaW5nbGVOb2RlKG9wdGlvbnMueHBhdGgudG9TdHJpbmcoKSk7aWYodGhpcy5kZWJ1ZykkLmxvZygndHJhbnNmb3JtKCk6IHhwYXRoIGhhcyBiZWVuIHJ1bi4uLnJlc3VsdGluZyBkb2M6ICcrKHRoaXMuc2VyaWFsaXplKHhtbC5kb2MpKSk7fVxudmFyIHJlc3VsdD17J3hzbCc6dGhpcy5sb2FkKHhzbCxvcHRpb25zLm1ldGgpfTtyZXN1bHQuanNvbj1mYWxzZTtpZihvcHRpb25zLmpzb24mJnhtbC5kb2Mpe3Jlc3VsdC5qc29uPXhtbC5kb2Muc2VsZWN0U2luZ2xlTm9kZShvcHRpb25zLmpzb24udG9TdHJpbmcoKSk7fVxudmFyIHByb2Nlc3Nvcj1uZXcgWFNMVFByb2Nlc3NvcigpO3Byb2Nlc3Nvci5pbXBvcnRTdHlsZXNoZWV0KHJlc3VsdC54c2wpO2lmKG9wdGlvbnMucGFyYW1zJiZwcm9jZXNzb3Ipe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygndHJhbnNmb3JtKCk6IHJlY2VpdmVkIHhzbCBwYXJhbXM6ICcrb3B0aW9ucy5wYXJhbXMudG9TdHJpbmcoKSk7Zm9yKGtleSBpbiBvcHRpb25zLnBhcmFtcyl7cHJvY2Vzc29yLnNldFBhcmFtZXRlcihudWxsLGtleS50b1N0cmluZygpLG9wdGlvbnMucGFyYW1zW2tleV0udG9TdHJpbmcoKSk7fX1cbnJlc3VsdC5kb2M9cHJvY2Vzc29yLnRyYW5zZm9ybVRvRG9jdW1lbnQoeG1sLmRvYyk7dmFyIGVycm9yVHh0PVNhcmlzc2EuZ2V0UGFyc2VFcnJvclRleHQocmVzdWx0LmRvYyk7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCd0cmFuc2Zvcm0oKTogU2FyaXNzYSBwYXJzZSB0ZXh0OiAnK2Vycm9yVHh0KTtpZihlcnJvclR4dCE9U2FyaXNzYS5QQVJTRURfT0spe3Jlc3VsdC5zdHJpbmc9U2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChyZXN1bHQuZG9jKSsnIDo6IHVzaW5nICcreHNsKycgPT4gJyt4bWwucmVxdWVzdDtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ3RyYW5zZm9ybSgpOiBlcnJvciBpbiB0cmFuc2Zvcm1hdGlvbjogJytTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KHJlc3VsdC5kb2MpKTtyZXR1cm4gcmVzdWx0O31cbnJlc3VsdC5zdHJpbmc9dGhpcy5zZXJpYWxpemUocmVzdWx0LmRvYyk7cmVzdWx0LnNjcmlwdHM9alF1ZXJ5KCdzY3JpcHQnLHJlc3VsdC5kb2MpLnRleHQoKTtyZXR1cm4gcmVzdWx0O319O3hzbFRyYW5zZm9ybS5pbml0KCk7alF1ZXJ5LmZuLmdldFRyYW5zZm9ybT1mdW5jdGlvbih4c2wseG1sLG9wdGlvbnMpe3ZhciBzZXR0aW5ncz17YXBwZW5kOmZhbHNlLHBhcmFtczp7fSx4cGF0aDonJyxldmFsOnRydWUsY2FsbGJhY2s6JycsanNvbjpmYWxzZSxtZXRoOlwiR0VUXCJ9O2pRdWVyeS5leHRlbmQoc2V0dGluZ3Msb3B0aW9ucyk7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ2dldFRyYW5zZm9ybTogJyt4c2wrJzo6Jyt4bWwrJzo6JytzZXR0aW5ncy50b1N0cmluZygpKTtpZigheHNsfHwheG1sKXtpZih4c2xUcmFuc2Zvcm0uZGVidWcpalF1ZXJ5LmxvZygnZ2V0VHJhbnNmb3JtOiBtaXNzaW5nIHhzbCBvciB4bWwnKTtyZXR1cm47fVxucmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0cmFucz14c2xUcmFuc2Zvcm0udHJhbnNmb3JtKHhzbCx4bWwsc2V0dGluZ3MpO3ZhciByZT10cmFucy5zdHJpbmcubWF0Y2goLzxcXD94bWwuKj9cXD8+Lyk7aWYocmUpe3RyYW5zLnN0cmluZz10cmFucy5zdHJpbmcucmVwbGFjZShyZSwnJyk7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ2dldFRyYW5zZm9ybSgpOiBmb3VuZCBhbiB4bWwgZGVjbGFyYXRpb24gYW5kIHJlbW92ZWQgaXQnKTt9XG50cnl7aWYoc2V0dGluZ3MuYXBwZW5kKSQodGhpcykuYXBwZW5kKHRyYW5zLnN0cmluZyk7ZWxzZSBpZihzZXR0aW5ncy5yZXBsKSQodGhpcykucmVwbGFjZVdpdGgodHJhbnMuc3RyaW5nKTtlbHNlICQodGhpcykuaHRtbCh0cmFucy5zdHJpbmcpO31jYXRjaChlKXtpZih4c2xUcmFuc2Zvcm0uZGVidWcpJC5sb2coJ2dldFRyYW5zZm9ybTogZXJyb3IgcGxhY2luZyByZXN1bHRzIG9mIHRyYW5zZm9ybSBpbnRvIGVsZW1lbnQsIGZhbGxpbmcgYmFjayB0byBpbm5lckhUTUw6ICcrZS50b1N0cmluZygpKTskKHRoaXMpWzBdLmlubmVySFRNTD10cmFucy5zdHJpbmc7fVxuaWYoc2V0dGluZ3MuZXZhbCYmdHJhbnMuc2NyaXB0cyl7aWYodHJhbnMuc2NyaXB0cy5sZW5ndGg+MCl7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ0ZvdW5kIHRleHQvamF2YXNjcmlwdCBpbiB0cmFuc2Zvcm1lZCByZXN1bHQnKTtldmFsLmNhbGwod2luZG93LHRyYW5zLnNjcmlwdHMpO319XG5pZihzZXR0aW5ncy5jYWxsYmFjayYmalF1ZXJ5LmlzRnVuY3Rpb24oc2V0dGluZ3MuY2FsbGJhY2spKXt2YXIganNvbj1mYWxzZTtpZihzZXR0aW5ncy5qc29uJiZ0cmFucy5qc29uKWV2YWwoXCJqc29uID0gXCIrdHJhbnMuanNvbi5maXJzdENoaWxkLmRhdGEpO3NldHRpbmdzLmNhbGxiYWNrLmFwcGx5KHdpbmRvdyxbdHJhbnMuc3RyaW5nLGpzb25dKTt9fSk7fTtcblxuLy8ganF1ZXJ5Lm1ldGFkYXRhLmpzXG5cbihmdW5jdGlvbigkKXskLmV4dGVuZCh7bWV0YWRhdGE6e2RlZmF1bHRzOnt0eXBlOidjbGFzcycsbmFtZTonbWV0YWRhdGEnLGNyZTovKHsuKn0pLyxzaW5nbGU6J21ldGFkYXRhJ30sc2V0VHlwZTpmdW5jdGlvbih0eXBlLG5hbWUpe3RoaXMuZGVmYXVsdHMudHlwZT10eXBlO3RoaXMuZGVmYXVsdHMubmFtZT1uYW1lO30sZ2V0OmZ1bmN0aW9uKGVsZW0sb3B0cyl7dmFyIHNldHRpbmdzPSQuZXh0ZW5kKHt9LHRoaXMuZGVmYXVsdHMsb3B0cyk7aWYoIXNldHRpbmdzLnNpbmdsZS5sZW5ndGgpc2V0dGluZ3Muc2luZ2xlPSdtZXRhZGF0YSc7dmFyIGRhdGE9JC5kYXRhKGVsZW0sc2V0dGluZ3Muc2luZ2xlKTtpZihkYXRhKXJldHVybiBkYXRhO2RhdGE9XCJ7fVwiO2lmKHNldHRpbmdzLnR5cGU9PVwiY2xhc3NcIil7dmFyIG09c2V0dGluZ3MuY3JlLmV4ZWMoZWxlbS5jbGFzc05hbWUpO2lmKG0pXG5kYXRhPW1bMV07fWVsc2UgaWYoc2V0dGluZ3MudHlwZT09XCJlbGVtXCIpe2lmKCFlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKVxucmV0dXJuIHVuZGVmaW5lZDt2YXIgZT1lbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKHNldHRpbmdzLm5hbWUpO2lmKGUubGVuZ3RoKVxuZGF0YT0kLnRyaW0oZVswXS5pbm5lckhUTUwpO31lbHNlIGlmKGVsZW0uZ2V0QXR0cmlidXRlIT11bmRlZmluZWQpe3ZhciBhdHRyPWVsZW0uZ2V0QXR0cmlidXRlKHNldHRpbmdzLm5hbWUpO2lmKGF0dHIpXG5kYXRhPWF0dHI7fVxuaWYoZGF0YS5pbmRleE9mKCd7Jyk8MClcbmRhdGE9XCJ7XCIrZGF0YStcIn1cIjtkYXRhPWV2YWwoXCIoXCIrZGF0YStcIilcIik7JC5kYXRhKGVsZW0sc2V0dGluZ3Muc2luZ2xlLGRhdGEpO3JldHVybiBkYXRhO319fSk7JC5mbi5tZXRhZGF0YT1mdW5jdGlvbihvcHRzKXtyZXR1cm4gJC5tZXRhZGF0YS5nZXQodGhpc1swXSxvcHRzKTt9O30pKGpRdWVyeSk7XG5cbi8vIGpxdWVyeS5jb29raWUuanNcblxualF1ZXJ5LmNvb2tpZT1mdW5jdGlvbihuYW1lLHZhbHVlLG9wdGlvbnMpe2lmKHR5cGVvZiB2YWx1ZSE9J3VuZGVmaW5lZCcpe29wdGlvbnM9b3B0aW9uc3x8e307aWYodmFsdWU9PT1udWxsKXt2YWx1ZT0nJztvcHRpb25zLmV4cGlyZXM9LTE7fVxudmFyIGV4cGlyZXM9Jyc7aWYob3B0aW9ucy5leHBpcmVzJiYodHlwZW9mIG9wdGlvbnMuZXhwaXJlcz09J251bWJlcid8fG9wdGlvbnMuZXhwaXJlcy50b1VUQ1N0cmluZykpe3ZhciBkYXRlO2lmKHR5cGVvZiBvcHRpb25zLmV4cGlyZXM9PSdudW1iZXInKXtkYXRlPW5ldyBEYXRlKCk7ZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpKyhvcHRpb25zLmV4cGlyZXMqMjQqNjAqNjAqMTAwMCkpO31lbHNle2RhdGU9b3B0aW9ucy5leHBpcmVzO31cbmV4cGlyZXM9JzsgZXhwaXJlcz0nK2RhdGUudG9VVENTdHJpbmcoKTt9XG52YXIgcGF0aD1vcHRpb25zLnBhdGg/JzsgcGF0aD0nKyhvcHRpb25zLnBhdGgpOicnO3ZhciBkb21haW49b3B0aW9ucy5kb21haW4/JzsgZG9tYWluPScrKG9wdGlvbnMuZG9tYWluKTonJzt2YXIgc2VjdXJlPW9wdGlvbnMuc2VjdXJlPyc7IHNlY3VyZSc6Jyc7ZG9jdW1lbnQuY29va2llPVtuYW1lLCc9JyxlbmNvZGVVUklDb21wb25lbnQodmFsdWUpLGV4cGlyZXMscGF0aCxkb21haW4sc2VjdXJlXS5qb2luKCcnKTt9ZWxzZXt2YXIgY29va2llVmFsdWU9bnVsbDtpZihkb2N1bWVudC5jb29raWUmJmRvY3VtZW50LmNvb2tpZSE9Jycpe3ZhciBjb29raWVzPWRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpO2Zvcih2YXIgaT0wO2k8Y29va2llcy5sZW5ndGg7aSsrKXt2YXIgY29va2llPWpRdWVyeS50cmltKGNvb2tpZXNbaV0pO2lmKGNvb2tpZS5zdWJzdHJpbmcoMCxuYW1lLmxlbmd0aCsxKT09KG5hbWUrJz0nKSl7Y29va2llVmFsdWU9ZGVjb2RlVVJJQ29tcG9uZW50KGNvb2tpZS5zdWJzdHJpbmcobmFtZS5sZW5ndGgrMSkpO2JyZWFrO319fVxucmV0dXJuIGNvb2tpZVZhbHVlO319OyIsIi8qXG4gKiBqc1RyZWUgMC45LjVcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMDggSXZhbiBCb3poYW5vdiAodmFrYXRhLmNvbSlcbiAqXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlczpcbiAqICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAqICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC5odG1sXG4gKlxuICogRGF0ZTogMjAwOS0wMS0wM1xuICpcbiAqL1xuLy9qc2hpbnQgaWdub3JlOnN0YXJ0XG4vL2pzY3M6ZGlzYWJsZVxuXG4vLyBicm93c2VyIGZpeFxuKGZ1bmN0aW9uICgkKSB7XG4gICAgJC5icm93c2VyID0ge307XG4gICAgJC5icm93c2VyLm1vemlsbGEgPSAvbW96aWxsYS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICEvd2Via2l0Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG4gICAgJC5icm93c2VyLndlYmtpdCA9IC93ZWJraXQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKTtcbiAgICAkLmJyb3dzZXIub3BlcmEgPSAvb3BlcmEvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKTtcbiAgICAkLmJyb3dzZXIubXNpZSA9IC9tc2llLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG5cbiAgICAvLyBqUXVlcnkgcGx1Z2luXG4gICAgJC5mbi50cmVlID0gZnVuY3Rpb24gKG9wdHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50Lmluc3QgJiYgdHJlZV9jb21wb25lbnQuaW5zdFskKHRoaXMpLmF0dHIoJ2lkJyldKSB7XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuaW5zdFskKHRoaXMpLmF0dHIoJ2lkJyldLmRlc3Ryb3koKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG9wdHMgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRtcCA9IG5ldyB0cmVlX2NvbXBvbmVudCgpO1xuICAgICAgICAgICAgICAgIHRtcC5pbml0KHRoaXMsIG9wdHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8vIGNvcmVcbiAgICB3aW5kb3cudHJlZV9jb21wb25lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIGluc3RhbmNlIG1hbmFnZXJcbiAgICAgICAgaWYodHlwZW9mIHRyZWVfY29tcG9uZW50Lmluc3QgPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuY250ciA9IDA7XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0ID0gW107XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5kcm9wID0gW107XG5cbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmZvY3VzSW5zdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJlZV9jb21wb25lbnQuaW5zdFt0cmVlX2NvbXBvbmVudC5mb2N1c2VkXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50Lm1vdXNlZG93biA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLmF0dHIoJ2RhdGEtdG91Y2gtYWN0aW9uJywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0cmVlX2NvbXBvbmVudC5mb2N1c0luc3QoKTtcbiAgICAgICAgICAgICAgICBpZighX3RoaXMpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIHZhciB0bXAgPSAkKGV2ZW50LnRhcmdldCk7XG4gICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuZHJvcC5sZW5ndGggJiYgdG1wLmlzKFwiLlwiICsgdHJlZV9jb21wb25lbnQuZHJvcC5qb2luKFwiLCAuXCIpKSApIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZyA9ICQoXCI8bGkgaWQ9J2RyYWdnZWQnIGNsYXNzPSdkcmFnZ2VkIGZvcmVpZ24gXCIgKyBldmVudC50YXJnZXQuY2xhc3NOYW1lICsgXCInPjxhIGhyZWY9JyMnPlwiICsgdG1wLnRleHQoKSArIFwiPC9hPjwvbGk+XCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZHJhZyA9IF90aGlzLmRyYWc7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmlzZG93biAgICA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmZvcmVpZ24gICAgPSB0bXA7XG4gICAgICAgICAgICAgICAgICAgIHRtcC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50Lm1vdXNldXAgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVBdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicpO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRyZWVfY29tcG9uZW50LmZvY3VzSW5zdCgpO1xuICAgICAgICAgICAgICAgIGlmKCFfdGhpcykgcmV0dXJuO1xuXG5cbiAgICAgICAgICAgICAgICAvLyBDTEVBUiBUSU1FT1VUIEZPUiBPUEVOSU5HIEhPVkVSRUQgTk9ERVMgV0hJTEUgRFJBR0dJTkdcbiAgICAgICAgICAgICAgICBpZih0cmVlX2NvbXBvbmVudC50bykgICAgY2xlYXJUaW1lb3V0KHRyZWVfY29tcG9uZW50LnRvKTtcbiAgICAgICAgICAgICAgICBpZih0cmVlX2NvbXBvbmVudC5zdG8pICAgIGNsZWFyVGltZW91dCh0cmVlX2NvbXBvbmVudC5zdG8pO1xuICAgICAgICAgICAgICAgIGlmKF90aGlzLmZvcmVpZ24gPT09IGZhbHNlICYmIF90aGlzLmRyYWcgJiYgX3RoaXMuZHJhZy5wYXJlbnROb2RlICYmIF90aGlzLmRyYWcucGFyZW50Tm9kZSA9PSAkKF90aGlzLmNvbnRhaW5lcikuY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5nZXQoMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgJChfdGhpcy5kcmFnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ0FMTCBGVU5DVElPTiBGT1IgQ09NUExFVElORyBNT1ZFXG4gICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLm1vdmVUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdHJlZV9jb21wb25lbnQuaW5zdFskKF90aGlzLm1vdmVSZWYpLnBhcmVudHMoXCIudHJlZTplcSgwKVwiKS5hdHRyKFwiaWRcIildO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodG1wKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm1vdmVkKF90aGlzLmNvbnRhaW5lci5maW5kKFwibGkuZHJhZ2dlZFwiKSwgX3RoaXMubW92ZVJlZiwgX3RoaXMubW92ZVR5cGUsIGZhbHNlLCAoX3RoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ19jb3B5ID09IFwib25cIiB8fCAoX3RoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ19jb3B5ID09IFwiY3RybFwiICYmIGV2ZW50LmN0cmxLZXkpICkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKF90aGlzLmRyYWcgJiYgX3RoaXMuZm9yZWlnbiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgJChfdGhpcy5kcmFnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMubW92ZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSB0cmVlX2NvbXBvbmVudC5pbnN0WyQoX3RoaXMubW92ZVJlZikucGFyZW50cyhcIi50cmVlOmVxKDApXCIpLmF0dHIoXCJpZFwiKV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0bXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuc2V0dGluZ3MuY2FsbGJhY2sub25kcm9wLmNhbGwobnVsbCwgX3RoaXMuZm9yZWlnbi5nZXQoMCksIF90aGlzLmdldF9ub2RlKCBfdGhpcy5tb3ZlUmVmKS5nZXQoMCksIF90aGlzLm1vdmVUeXBlLCBfdGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZm9yZWlnbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFJFU0VUIEVWRVJZVEhJTkdcbiAgICAgICAgICAgICAgICAkKFwiI21hcmtlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2RyYWcgICAgICAgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgX3RoaXMuZHJhZyAgICAgICAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpcy5pc2Rvd24gICAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpcy5hcHBlbmRlZCAgICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5maW5kKFwibGkuZHJhZ2dlZFwiKS5yZW1vdmVDbGFzcyhcImRyYWdnZWRcIik7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdHJlZV9jb21wb25lbnQubW91c2Vtb3ZlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0cmVlX2NvbXBvbmVudC5mb2N1c0luc3QoKTtcbiAgICAgICAgICAgICAgICBpZighX3RoaXMpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIGlmKF90aGlzLmxvY2tlZCkgcmV0dXJuIF90aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKF90aGlzLmlzZG93bikge1xuICAgICAgICAgICAgICAgICAgICAvLyBDTEVBUiBUSU1FT1VUIEZPUiBPUEVOSU5HIEhPVkVSRUQgTk9ERVMgV0hJTEUgRFJBR0dJTkdcbiAgICAgICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQudG8pIGNsZWFyVGltZW91dCh0cmVlX2NvbXBvbmVudC50byk7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFfdGhpcy5hcHBlbmRlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuYXBwZW5kKF90aGlzLmRyYWcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9ICQoX3RoaXMuZHJhZykub2Zmc2V0UGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0bXAuaXMoXCJodG1sXCIpKSB0bXAgPSAkKFwiYm9keVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBvID0gdG1wLm9mZnNldCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuYXBwZW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykuY3NzKHsgXCJsZWZ0XCIgOiAoZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWCAtIF90aGlzLnBvLmxlZnQgLSAoX3RoaXMuc2V0dGluZ3MudWkucnRsID8gJChfdGhpcy5kcmFnKS53aWR0aCgpIDogLTUgKSApLCBcInRvcFwiIDogKGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVkgLSBfdGhpcy5wby50b3AgICsgKCQuYnJvd3Nlci5vcGVyYSA/IF90aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSA6IDApICsgMTUpIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LnRhcmdldC50YWdOYW1lID09IFwiSU1HXCIgJiYgZXZlbnQudGFyZ2V0LmlkID09IFwibWFya2VyXCIpIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgY250ID0gJChldmVudC50YXJnZXQpLnBhcmVudHMoXCIudHJlZTplcSgwKVwiKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBub3QgbW92aW5nIG92ZXIgYSB0cmVlXG4gICAgICAgICAgICAgICAgICAgIGlmKGNudC5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuc3RvKSBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQuc3RvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQoX3RoaXMuZHJhZykuY2hpbGRyZW4oXCJJTUdcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKF90aGlzLmRyYWcpLmFwcGVuZChcIjxpbWcgY2xhc3M9J3JlbW92ZWljb24nIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTsgXCIgKyAoX3RoaXMuc2V0dGluZ3MudWkucnRsID8gXCJyaWdodFwiIDogXCJsZWZ0XCIgKSArIFwiOjRweDsgdG9wOjBweDsnIHNyYz0nXCIgKyBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L3JlbW92ZS5naWYnIC8+XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVSZWYgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI21hcmtlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W2NudC5hdHRyKFwiaWRcIildLm9mZl9oZWlnaHQoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBtb3Zpbmcgb3ZlciBhbm90aGVyIHRyZWUgYW5kIG11bHRpdHJlZSBpcyBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiggX3RoaXMuZm9yZWlnbiA9PT0gZmFsc2UgJiYgY250LmdldCgwKSAhPSBfdGhpcy5jb250YWluZXIuZ2V0KDApICYmICghX3RoaXMuc2V0dGluZ3MucnVsZXMubXVsdGl0cmVlIHx8ICF0cmVlX2NvbXBvbmVudC5pbnN0W2NudC5hdHRyKFwiaWRcIildLnNldHRpbmdzLnJ1bGVzLm11bHRpdHJlZSkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkKF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiSU1HXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChfdGhpcy5kcmFnKS5hcHBlbmQoXCI8aW1nIGNsYXNzPSdyZW1vdmVpY29uJyBzdHlsZT0ncG9zaXRpb246YWJzb2x1dGU7IFwiICsgKF90aGlzLnNldHRpbmdzLnVpLnJ0bCA/IFwicmlnaHRcIiA6IFwibGVmdFwiICkgKyBcIjo0cHg7IHRvcDowcHg7JyBzcmM9J1wiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9yZW1vdmUuZ2lmJyAvPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVUeXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuc3RvKSBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQuc3RvKTtcbiAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuc3RvID0gc2V0VGltZW91dCggZnVuY3Rpb24oKSB7IHRyZWVfY29tcG9uZW50Lmluc3RbY250LmF0dHIoXCJpZFwiKV0uc2Nyb2xsQ2hlY2soZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWCxldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZKTsgfSwgNTApO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBtb3YgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ID0gY250LnNjcm9sbFRvcCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LnRhcmdldC50YWdOYW1lID09IFwiQVwiICYmIGV2ZW50LnRhcmdldC5jbGFzc05hbWU9PVwidGl0bGVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8ganVzdCBpbiBjYXNlIGlmIGhvdmVyIGlzIG92ZXIgdGhlIGRyYWdnYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJChldmVudC50YXJnZXQpLmlzKFwiI2RyYWdnZWRcIikpIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdvVG8gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeCA6ICgkKGV2ZW50LnRhcmdldCkub2Zmc2V0KCkubGVmdCAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHkgOiAoZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSAtIHRyZWVfY29tcG9uZW50Lmluc3RbY250LmF0dHIoXCJpZFwiKV0ub2Zmc2V0LnRvcClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNudC5oYXNDbGFzcyhcInJ0bFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvVG8ueCArPSAkKGV2ZW50LnRhcmdldCkud2lkdGgoKSAtIDg7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiggKGdvVG8ueSArIHN0KSVfdGhpcy5saV9oZWlnaHQgPCBfdGhpcy5saV9oZWlnaHQvMyArIDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ID0gXCJiZWZvcmVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnkgPSBldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gKGdvVG8ueSArIHN0KSVfdGhpcy5saV9oZWlnaHQgLSAyIDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoKGdvVG8ueSArIHN0KSVfdGhpcy5saV9oZWlnaHQgPiBfdGhpcy5saV9oZWlnaHQqMi8zIC0gMSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3YgPSBcImFmdGVyXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ29Uby55ID0gZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSAtIChnb1RvLnkgKyBzdCklX3RoaXMubGlfaGVpZ2h0ICsgX3RoaXMubGlfaGVpZ2h0IC0gMiA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3YgPSBcImluc2lkZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvVG8ueCAtPSAyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNudC5oYXNDbGFzcyhcInJ0bFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnggKz0gMzY7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvVG8ueSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVkgLSAoZ29Uby55ICsgc3QpJV90aGlzLmxpX2hlaWdodCArIE1hdGguZmxvb3IoX3RoaXMubGlfaGVpZ2h0LzIpIC0gMiA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuZ2V0X25vZGUoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcyhcImNsb3NlZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC50byA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHsgX3RoaXMub3Blbl9icmFuY2goX3RoaXMuZ2V0X25vZGUoZXZlbnQudGFyZ2V0KSk7IH0sIDUwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0cmVlX2NvbXBvbmVudC5pbnN0W2NudC5hdHRyKFwiaWRcIildLmNoZWNrTW92ZShfdGhpcy5jb250YWluZXIuZmluZChcImxpLmRyYWdnZWRcIiksICQoZXZlbnQudGFyZ2V0KSwgbW92KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1vdiA9PSBcImluc2lkZVwiKSAgICAkKFwiI21hcmtlclwiKS5hdHRyKFwic3JjXCIsIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcGx1cy5naWZcIikud2lkdGgoMTQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjbnQuaGFzQ2xhc3MoXCJydGxcIikpICAgIHsgJChcIiNtYXJrZXJcIikuYXR0cihcInNyY1wiLCBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L21hcmtlcl9ydGwuZ2lmXCIpLndpZHRoKDQwKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICB7ICQoXCIjbWFya2VyXCIpLmF0dHIoXCJzcmNcIiwgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9tYXJrZXIuZ2lmXCIpLndpZHRoKDQwKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSAgICA9IG1vdjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmICAgID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykuY2hpbGRyZW4oXCJJTUdcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuY3NzKHsgXCJsZWZ0XCIgOiBnb1RvLngtMSAsIFwidG9wXCIgOiBnb1RvLnktMiB9KS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkKF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiSU1HXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykuYXBwZW5kKFwiPGltZyBjbGFzcz0ncmVtb3ZlaWNvbicgc3R5bGU9J3Bvc2l0aW9uOmFic29sdXRlOyBcIiArIChfdGhpcy5zZXR0aW5ncy51aS5ydGwgPyBcInJpZ2h0OjBweDtcIiA6IFwibGVmdDo0cHg7XCIgKSArIFwiIHRvcDowcHg7JyBzcmM9J1wiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9yZW1vdmUuZ2lmJyAvPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJChfdGhpcy5kcmFnKS5jaGlsZHJlbihcIklNR1wiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykuYXBwZW5kKFwiPGltZyBjbGFzcz0ncmVtb3ZlaWNvbicgc3R5bGU9J3Bvc2l0aW9uOmFic29sdXRlOyBcIiArIChfdGhpcy5zZXR0aW5ncy51aS5ydGwgPyBcInJpZ2h0OjBweDtcIiA6IFwibGVmdDo0cHg7XCIgKSArIFwiIHRvcDowcHg7JyBzcmM9J1wiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9yZW1vdmUuZ2lmJyAvPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVUeXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI21hcmtlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjbnRyIDogdHJlZV9jb21wb25lbnQuY250ciArKyxcbiAgICAgICAgICAgIHNldHRpbmdzIDoge1xuICAgICAgICAgICAgICAgIGRhdGEgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGUgICAgOiBcInByZWRlZmluZWRcIiwgICAgLy8gRU5VTSBbanNvbiwgeG1sX2ZsYXQsIHhtbF9uZXN0ZWQsIHByZWRlZmluZWRdXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZCAgICA6IFwiR0VUXCIsICAgICAgICAvLyBIT1cgVE8gUkVRVUVTVCBGSUxFU1xuICAgICAgICAgICAgICAgICAgICBhc3luYyAgICA6IGZhbHNlLCAgICAgICAgLy8gQk9PTCAtIGFzeW5jIGxvYWRpbmcgb25vcGVuXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jX2RhdGEgOiBmdW5jdGlvbiAoTk9ERSkgeyByZXR1cm4geyBpZCA6ICQoTk9ERSkuYXR0cihcImlkXCIpIHx8IDAgfSB9LCAvLyBQQVJBTUVURVJTIFBBU1NFRCBUTyBTRVJWRVJcbiAgICAgICAgICAgICAgICAgICAgdXJsICAgICAgICA6IGZhbHNlLCAgICAgICAgLy8gRkFMU0Ugb3IgU1RSSU5HIC0gdXJsIHRvIGRvY3VtZW50IHRvIGJlIHVzZWQgKGFzeW5jIG9yIG5vdClcbiAgICAgICAgICAgICAgICAgICAganNvbiAgICA6IGZhbHNlICAgICAgICAgICAgLy8gRkFMU0Ugb3IgT0JKRUNUIGlmIHR5cGUgaXMgSlNPTiBhbmQgYXN5bmMgaXMgZmFsc2UgLSB0aGUgdHJlZSBkdW1wIGFzIGpzb25cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkICAgIDogZmFsc2UsICAgICAgICAvLyBGQUxTRSBvciBTVFJJTkcgb3IgQVJSQVlcbiAgICAgICAgICAgICAgICBvcGVuZWQgICAgICAgIDogW10sICAgICAgICAgICAgLy8gQVJSQVkgT0YgSU5JVElBTExZIE9QRU5FRCBOT0RFU1xuICAgICAgICAgICAgICAgIGxhbmd1YWdlcyAgICA6IFtdLCAgICAgICAgICAgIC8vIEFSUkFZIG9mIHN0cmluZyB2YWx1ZXMgKHdoaWNoIHdpbGwgYmUgdXNlZCBhcyBDU1MgY2xhc3NlcyAtIHNpIHRoZXkgbXVzdCBiZSB2YWxpZClcbiAgICAgICAgICAgICAgICBwYXRoICAgICAgICA6IGZhbHNlLCAgICAgICAgLy8gRkFMU0Ugb3IgU1RSSU5HIChpZiBmYWxzZSAtIHdpbGwgYmUgYXV0b2RldGVjdGVkKVxuICAgICAgICAgICAgICAgIGNvb2tpZXMgICAgICAgIDogZmFsc2UsICAgICAgICAvLyBGQUxTRSBvciBPQkpFQ1QgKHByZWZpeCwgb3B0cyAtIGZyb20ganFDb29raWUgLSBleHBpcmVzLCBwYXRoLCBkb21haW4sIHNlY3VyZSlcbiAgICAgICAgICAgICAgICB1aSAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgIGRvdHMgICAgICAgIDogdHJ1ZSwgICAgICAgIC8vIEJPT0wgLSBkb3RzIG9yIG5vIGRvdHNcbiAgICAgICAgICAgICAgICAgICAgcnRsICAgICAgICAgICAgOiBmYWxzZSwgICAgLy8gQk9PTCAtIGlzIHRoZSB0cmVlIHJpZ2h0LXRvLWxlZnRcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uICAgIDogMCwgICAgICAgIC8vIElOVCAtIGR1cmF0aW9uIG9mIG9wZW4vY2xvc2UgYW5pbWF0aW9ucyBpbiBtaWxpc2Vjb25kc1xuICAgICAgICAgICAgICAgICAgICBob3Zlcl9tb2RlICAgIDogdHJ1ZSwgICAgICAgIC8vIFNIT1VMRCBnZXRfKiBmdW5jdGlvbnMgY2hhZ2UgZm9jdXMgb3IgY2hhbmdlIGhvdmVyZWQgaXRlbVxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxfc3BkICAgIDogNCxcbiAgICAgICAgICAgICAgICAgICAgdGhlbWVfcGF0aCAgICA6IGZhbHNlLCAgICAvLyBQYXRoIHRvIHRoZW1lc1xuICAgICAgICAgICAgICAgICAgICB0aGVtZV9uYW1lICAgIDogXCJkZWZhdWx0XCIsLy8gTmFtZSBvZiB0aGVtZVxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0ICAgICAgICA6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZCAgICAgICAgOiBcImNyZWF0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICAgIDogXCJDcmVhdGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uICAgIDogXCJjcmVhdGUucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZSAgICA6IGZ1bmN0aW9uIChOT0RFLCBUUkVFX09CSikgeyBpZihOT0RFLmxlbmd0aCAhPSAxKSByZXR1cm4gZmFsc2U7IHJldHVybiBUUkVFX09CSi5jaGVjayhcImNyZWF0YWJsZVwiLCBOT0RFKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gICAgOiBmdW5jdGlvbiAoTk9ERSwgVFJFRV9PQkopIHsgVFJFRV9PQkouY3JlYXRlKGZhbHNlLCBOT0RFKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic2VwYXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgIDogXCJyZW5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCAgICA6IFwiUmVuYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbiAgICA6IFwicmVuYW1lLnBuZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUgICAgOiBmdW5jdGlvbiAoTk9ERSwgVFJFRV9PQkopIHsgaWYoTk9ERS5sZW5ndGggIT0gMSkgcmV0dXJuIGZhbHNlOyByZXR1cm4gVFJFRV9PQkouY2hlY2soXCJyZW5hbWVhYmxlXCIsIE5PREUpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiAgICA6IGZ1bmN0aW9uIChOT0RFLCBUUkVFX09CSikgeyBUUkVFX09CSi5yZW5hbWUoKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZCAgICAgICAgOiBcImRlbGV0ZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICAgIDogXCJEZWxldGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uICAgIDogXCJyZW1vdmUuZ2lmXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlzaWJsZSAgICA6IGZ1bmN0aW9uIChOT0RFLCBUUkVFX09CSikgeyByZXR1cm4gVFJFRV9PQkouY2hlY2soXCJkZWxldGFibGVcIiwgTk9ERSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IE5PREUuZWFjaCggZnVuY3Rpb24gKCkgeyBUUkVFX09CSi5yZW1vdmUodGhpcyk7IH0pOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJ1bGVzICAgIDoge1xuICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZSAgICA6IGZhbHNlLCAgICAvLyBGQUxTRSB8IENUUkwgfCBPTiAtIG11bHRpcGxlIHNlbGVjdGlvbiBvZmYvIHdpdGggb3Igd2l0aG91dCBob2xkaW5nIEN0cmxcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEgICAgOiBmYWxzZSwgICAgLy8gRkFMU0Ugb3IgU1RSSU5HIC0gYXR0cmlidXRlIG5hbWUgKHVzZSBtZXRhZGF0YSBwbHVnaW4pXG4gICAgICAgICAgICAgICAgICAgIHR5cGVfYXR0ciAgICA6IFwicmVsXCIsICAgIC8vIFNUUklORyBhdHRyaWJ1dGUgbmFtZSAod2hlcmUgaXMgdGhlIHR5cGUgc3RvcmVkIGlmIG5vIG1ldGFkYXRhKVxuICAgICAgICAgICAgICAgICAgICBtdWx0aXRyZWUgICAgOiBmYWxzZSwgICAgLy8gQk9PTCAtIGlzIGRyYWcgbiBkcm9wIGJldHdlZW4gdHJlZXMgYWxsb3dlZFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVhdCAgICA6IFwiYm90dG9tXCIsICAgIC8vIFNUUklORyAodG9wIG9yIGJvdHRvbSkgbmV3IG5vZGVzIGdldCBpbnNlcnRlZCBhdCB0b3Agb3IgYm90dG9tXG4gICAgICAgICAgICAgICAgICAgIHVzZV9pbmxpbmUgICAgOiBmYWxzZSwgICAgLy8gQ0hFQ0sgRk9SIElOTElORSBSVUxFUyAtIFJFUVVJUkVTIE1FVEFEQVRBXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZSAgICA6IFwiYWxsXCIsICAgIC8vIHdoaWNoIG5vZGUgdHlwZXMgY2FuIHRoZSB1c2VyIHNlbGVjdCB8IGRlZmF1bHQgLSBhbGxcbiAgICAgICAgICAgICAgICAgICAgcmVuYW1lYWJsZSAgICA6IFwiYWxsXCIsICAgIC8vIHdoaWNoIG5vZGUgdHlwZXMgY2FuIHRoZSB1c2VyIHNlbGVjdCB8IGRlZmF1bHQgLSBhbGxcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRhYmxlICAgIDogXCJhbGxcIiwgICAgLy8gd2hpY2ggbm9kZSB0eXBlcyBjYW4gdGhlIHVzZXIgZGVsZXRlIHwgZGVmYXVsdCAtIGFsbFxuICAgICAgICAgICAgICAgICAgICBjcmVhdGFibGUgICAgOiBcImFsbFwiLCAgICAvLyB3aGljaCBub2RlIHR5cGVzIGNhbiB0aGUgdXNlciBjcmVhdGUgaW4gfCBkZWZhdWx0IC0gYWxsXG4gICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZSAgICA6IFwibm9uZVwiLCAgICAvLyB3aGljaCBub2RlIHR5cGVzIGNhbiB0aGUgdXNlciBtb3ZlIHwgZGVmYXVsdCAtIG5vbmUgfCBcImFsbFwiXG4gICAgICAgICAgICAgICAgICAgIGRyYWdydWxlcyAgICA6IFwiYWxsXCIsICAgIC8vIHdoYXQgbW92ZSBvcGVyYXRpb25zIGJldHdlZW4gbm9kZXMgYXJlIGFsbG93ZWQgfCBkZWZhdWx0IC0gbm9uZSB8IFwiYWxsXCJcbiAgICAgICAgICAgICAgICAgICAgZHJhZ19jb3B5ICAgIDogZmFsc2UsICAgIC8vIEZBTFNFIHwgQ1RSTCB8IE9OIC0gZHJhZyB0byBjb3B5IG9mZi8gd2l0aCBvciB3aXRob3V0IGhvbGRpbmcgQ3RybFxuICAgICAgICAgICAgICAgICAgICBkcm9wcGFibGUgICAgOiBbXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGFuZyA6IHtcbiAgICAgICAgICAgICAgICAgICAgbmV3X25vZGUgICAgOiBcIk5ldyBmb2xkZXJcIixcbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZyAgICAgICAgOiBcIkxvYWRpbmcgLi4uXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrICAgIDogeyAgICAgICAgICAgICAgICAvLyB2YXJpb3VzIGNhbGxiYWNrcyB0byBhdHRhY2ggY3VzdG9tIGxvZ2ljIHRvXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBmb2N1cyAgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBiZWZvcmVjaGFuZ2U6IGZ1bmN0aW9uKE5PREUsVFJFRV9PQkopIHsgcmV0dXJuIHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gYmVmb3JlIG1vdmUgICAtIHNob3VsZCByZXR1cm4gdHJ1ZSB8IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZW1vdmUgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7IHJldHVybiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBjcmVhdGUgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBiZWZvcmVjcmVhdGU6IGZ1bmN0aW9uKE5PREUsUkVGX05PREUsVFlQRSxUUkVFX09CSikgeyByZXR1cm4gdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICAvLyBiZWZvcmUgcmVuYW1lIC0gc2hvdWxkIHJldHVybiB0cnVlIHwgZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlcmVuYW1lOiBmdW5jdGlvbihOT0RFLExBTkcsVFJFRV9PQkopIHsgcmV0dXJuIHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gYmVmb3JlIGRlbGV0ZSAtIHNob3VsZCByZXR1cm4gdHJ1ZSB8IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIGJlZm9yZWRlbGV0ZTogZnVuY3Rpb24oTk9ERSxUUkVFX09CSikgeyByZXR1cm4gdHJ1ZSB9LFxuXG4gICAgICAgICAgICAgICAgICAgIG9uY2hhbmdlICAgIDogZnVuY3Rpb24oTk9ERSxUUkVFX09CSikgeyB9LCAgICAgICAgICAgICAgICAgICAgLy8gZm9jdXMgY2hhbmdlZFxuICAgICAgICAgICAgICAgICAgICBvbnJlbmFtZSAgICA6IGZ1bmN0aW9uKE5PREUsTEFORyxUUkVFX09CSikgeyB9LCAgICAgICAgICAgICAgICAvLyBub2RlIHJlbmFtZWQgSVNORVcgLSBUUlVFfEZBTFNFLCBjdXJyZW50IGxhbmd1YWdlXG4gICAgICAgICAgICAgICAgICAgIG9ubW92ZSAgICAgICAgOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHsgfSwgICAgLy8gbW92ZSBjb21wbGV0ZWQgKFRZUEUgaXMgQkVMT1d8QUJPVkV8SU5TSURFKVxuICAgICAgICAgICAgICAgICAgICBvbmNvcHkgICAgICAgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7IH0sICAgIC8vIGNvcHkgY29tcGxldGVkIChUWVBFIGlzIEJFTE9XfEFCT1ZFfElOU0lERSlcbiAgICAgICAgICAgICAgICAgICAgb25jcmVhdGUgICAgOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHsgfSwgICAgLy8gbm9kZSBjcmVhdGVkLCBwYXJlbnQgbm9kZSAoVFlQRSBpcyBpbnNlcnRBdClcbiAgICAgICAgICAgICAgICAgICAgb25kZWxldGUgICAgOiBmdW5jdGlvbihOT0RFLCBUUkVFX09CSikgeyB9LCAgICAgICAgICAgICAgICAgICAgLy8gbm9kZSBkZWxldGVkXG4gICAgICAgICAgICAgICAgICAgIG9ub3BlbiAgICAgICAgOiBmdW5jdGlvbihOT0RFLCBUUkVFX09CSikgeyB9LCAgICAgICAgICAgICAgICAgICAgLy8gbm9kZSBvcGVuZWRcbiAgICAgICAgICAgICAgICAgICAgb25jbG9zZSAgICAgICAgOiBmdW5jdGlvbihOT0RFLCBUUkVFX09CSikgeyB9LCAgICAgICAgICAgICAgICAgICAgLy8gbm9kZSBjbG9zZWRcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgICAgICAgIDogZnVuY3Rpb24oVEVYVCwgVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIGVycm9yIG9jY3VyZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gZG91YmxlIGNsaWNrIG9uIG5vZGUgLSBkZWZhdWx0cyB0byBvcGVuL2Nsb3NlICYgc2VsZWN0XG4gICAgICAgICAgICAgICAgICAgIG9uZGJsY2xrICAgIDogZnVuY3Rpb24oTk9ERSwgVFJFRV9PQkopIHsgVFJFRV9PQkoudG9nZ2xlX2JyYW5jaC5jYWxsKFRSRUVfT0JKLCBOT0RFKTsgVFJFRV9PQkouc2VsZWN0X2JyYW5jaC5jYWxsKFRSRUVfT0JKLCBOT0RFKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgLy8gcmlnaHQgY2xpY2sgLSB0byBwcmV2ZW50IHVzZTogRVYucHJldmVudERlZmF1bHQoKTsgRVYuc3RvcFByb3BhZ2F0aW9uKCk7IHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBvbnJndGNsayAgICA6IGZ1bmN0aW9uKE5PREUsIFRSRUVfT0JKLCBFVikgeyB9LFxuICAgICAgICAgICAgICAgICAgICBvbmxvYWQgICAgICAgIDogZnVuY3Rpb24oVFJFRV9PQkopIHsgfSxcbiAgICAgICAgICAgICAgICAgICAgb25mb2N1cyAgICAgICAgOiBmdW5jdGlvbihUUkVFX09CSikgeyB9LFxuICAgICAgICAgICAgICAgICAgICBvbmRyb3AgICAgICAgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7fVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBJTklUSUFMSVpBVElPTlxuICAgICAgICAgICAgaW5pdCA6IGZ1bmN0aW9uKGVsZW0sIG9wdHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyICAgICAgICA9ICQoZWxlbSk7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5jb250YWluZXIuc2l6ZSA9PSAwKSB7IGFsZXJ0KFwiSW52YWxpZCBjb250YWluZXIgbm9kZSFcIik7IHJldHVybiB9XG5cbiAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W3RoaXMuY250cl0gPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmKCF0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIikpIHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiLFwianN0cmVlX1wiICsgdGhpcy5jbnRyKTtcbiAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W3RoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKV0gPSB0cmVlX2NvbXBvbmVudC5pbnN0W3RoaXMuY250cl07XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuZm9jdXNlZCA9IHRoaXMuY250cjtcblxuICAgICAgICAgICAgICAgIC8vIE1FUkdFIE9QVElPTlMgV0lUSCBERUZBVUxUU1xuICAgICAgICAgICAgICAgIGlmKG9wdHMgJiYgb3B0cy5jb29raWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY29va2llcyA9ICQuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MuY29va2llcyxvcHRzLmNvb2tpZXMpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy5jb29raWVzO1xuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5zZXR0aW5ncy5jb29raWVzLm9wdHMpIHRoaXMuc2V0dGluZ3MuY29va2llcy5vcHRzID0ge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKG9wdHMgJiYgb3B0cy5jYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrID0gJC5leHRlbmQoe30sdGhpcy5zZXR0aW5ncy5jYWxsYmFjayxvcHRzLmNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMuY2FsbGJhY2s7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKG9wdHMgJiYgb3B0cy5kYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuZGF0YSA9ICQuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MuZGF0YSxvcHRzLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy5kYXRhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvcHRzICYmIG9wdHMudWkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy51aSA9ICQuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MudWksb3B0cy51aSk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLnVpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvcHRzICYmIG9wdHMucnVsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5ydWxlcyA9ICQuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MucnVsZXMsb3B0cy5ydWxlcyk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLnJ1bGVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvcHRzICYmIG9wdHMubGFuZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmxhbmcgPSAkLmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLmxhbmcsb3B0cy5sYW5nKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMubGFuZztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncyAgICAgICAgPSAkLmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLG9wdHMpO1xuXG4gICAgICAgICAgICAgICAgLy8gUEFUSCBUTyBJTUFHRVMgQU5EIFhTTFxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucGF0aCA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhdGggPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAkKFwic2NyaXB0XCIpLmVhY2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc3JjLnRvU3RyaW5nKCkubWF0Y2goL3RyZWVfY29tcG9uZW50Lio/anMuKiQvKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBhdGggPSB0aGlzLnNyYy50b1N0cmluZygpLnJlcGxhY2UoL3RyZWVfY29tcG9uZW50Lio/anMuKiQvLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5wYXRoID0gdGhpcy5zZXR0aW5ncy5wYXRoO1xuXG4gICAgICAgICAgICAgICAgLy8gREVBTCBXSVRIIExBTkdVQUdFIFZFUlNJT05TXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50X2xhbmcgICAgPSB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcyAmJiB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGggPyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1swXSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzICYmIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNuID0gZ2V0X3NoZWV0X251bShcInRyZWVfY29tcG9uZW50LmNzc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSA/IFwiI1wiICsgdGhpcy5jb250YWluZXIuYXR0cihcImlkXCIpIDogXCIudHJlZVwiO1xuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGxuID0gMDsgbG4gPCB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGg7IGxuKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ID0gYWRkX2NzcyhpZCArIFwiIC5cIiArIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2xuXSwgdGhpcy5zbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzdCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tsbl0gPT0gdGhpcy5jdXJyZW50X2xhbmcpICAgIHN0LnN0eWxlLmRpc3BsYXkgPSBcImlubGluZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRFJPUFBBQkxFU1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMuZHJvcHBhYmxlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuZHJvcC5wdXNoKHRoaXMuc2V0dGluZ3MucnVsZXMuZHJvcHBhYmxlW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmRyb3AgPSAkLnVuaXF1ZSh0cmVlX2NvbXBvbmVudC5kcm9wKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIFRIRU1FU1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCA9PT0gZmFsc2UpIHRoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCA9IHRoaXMucGF0aCArIFwidGhlbWVzL1wiO1xuICAgICAgICAgICAgICAgIHRoaXMudGhlbWUgPSB0aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9uYW1lICsgXCIvXCI7XG4gICAgICAgICAgICAgICAgYWRkX3NoZWV0KF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvc3R5bGUuY3NzXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZSAhPSBcImRlZmF1bHRcIikgYWRkX3NoZWV0KF90aGlzLnRoZW1lICsgXCJzdHlsZS5jc3NcIik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDbGFzcyhcInRyZWVcIik7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ydGwpIHRoaXMuY29udGFpbmVyLmFkZENsYXNzKFwicnRsXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUpIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuZG90cyA9PSBmYWxzZSkgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoXCJub19kb3RzXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ09OVEVYVCBNRU5VXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5jb250ZXh0ICE9IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAnPGRpdiBjbGFzcz1cImNvbnRleHRcIj4nO1xuICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXSA9PSBcInNlcGFyYXRvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiPHNwYW4gY2xhc3M9J3NlcGFyYXRvcic+Jm5ic3A7PC9zcGFuPlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljbiA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWNvbikgaWNuID0gJ2JhY2tncm91bmQtaW1hZ2U6dXJsKFxcJycgKyAoIHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5pY29uLmluZGV4T2YoXCIvXCIpID09IC0xID8gdGhpcy50aGVtZSArIHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5pY29uIDogdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmljb24gKSArICdcXCcpOyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzxhIHJlbD1cIicgKyB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWQgKyAnXCIgaHJlZj1cIiNcIiBzdHlsZT1cIicgKyBpY24gKyAnXCI+JyArIHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5sYWJlbCArICc8L2E+JztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzwvZGl2Pic7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dCA9ICQoc3RyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmFwcGVuZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBDUkVBVEUgRFVNTVkgRk9SIE1PVklOR1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ2dhYmxlICE9IFwibm9uZVwiICYmIHRoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ3J1bGVzICE9IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICQoXCI8aW1nPlwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgICA6IFwibWFya2VyXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjICAgIDogX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9tYXJrZXIuZ2lmXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgICAgICAgIDogXCI4cHhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCAgICAgICAgOiBcIjQycHhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5ICAgICAgICA6IFwiYmxvY2tcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiAgICA6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICAgICAgICA6IFwiMzBweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCAgICAgICAgICAgIDogXCIzMHB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4ICAgICAgICA6IFwiMTAwMFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5oaWRlKCkuYXBwZW5kVG8oXCJib2R5XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcbiAgICAgICAgICAgICAgICB0aGlzLmF0dGFjaEV2ZW50cygpO1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvZmZfaGVpZ2h0IDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMub2Zmc2V0ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3MoeyBwb3NpdGlvbiA6IFwicmVsYXRpdmVcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IDA7XG4gICAgICAgICAgICAgICAgICAgIHRtcCA9IHBhcnNlSW50KCQuY3NzKHRoaXMuY29udGFpbmVyLmdldCgwKSwgXCJwYWRkaW5nVG9wXCIsIHRydWUpLDEwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYodG1wKSB0aGlzLm9mZnNldC50b3AgKz0gdG1wO1xuICAgICAgICAgICAgICAgICAgICB0bXAgPSBwYXJzZUludCgkLmNzcyh0aGlzLmNvbnRhaW5lci5nZXQoMCksIFwiYm9yZGVyVG9wV2lkdGhcIiwgdHJ1ZSksMTApO1xuICAgICAgICAgICAgICAgICAgICBpZih0bXApIHRoaXMub2Zmc2V0LnRvcCArPSB0bXA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmNzcyh7IHBvc2l0aW9uIDogXCJcIiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMubGlfaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLmNvbnRhaW5lci5maW5kKFwidWwgbGk6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGlfaGVpZ2h0ID0gdG1wLmZpbmQoJy50aXRsZTpmaXJzdCcpLmhlaWdodCgpICsgMTtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMubGlfaGVpZ2h0KSB0aGlzLmxpX2hlaWdodCA9IDE4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBSRVBBSU5UIFRSRUVcbiAgICAgICAgICAgIHJlZnJlc2ggOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICAvLyBTQVZFIE9QRU5FRFxuICAgICAgICAgICAgICAgIHRoaXMub3BlbmVkID0gQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmNvb2tpZXMgJiYgJC5jb29raWUodGhpcy5zZXR0aW5ncy5jb29raWVzLnByZWZpeCArICdfb3BlbicpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAkLmNvb2tpZSh0aGlzLnNldHRpbmdzLmNvb2tpZXMucHJlZml4ICsgJ19vcGVuJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2godG1wLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5vcGVuZWQucHVzaChcIiNcIiArIHRoaXMucmVwbGFjZSgvXiMvLFwiXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Mub3BlbmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYodGhpcy5zZXR0aW5ncy5vcGVuZWQgIT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKHRoaXMuc2V0dGluZ3Mub3BlbmVkLCBmdW5jdGlvbiAoaSwgaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLm9wZW5lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImxpLm9wZW5cIikuZWFjaChmdW5jdGlvbiAoaSkgeyBfdGhpcy5vcGVuZWQucHVzaChcIiNcIiArIHRoaXMuaWQpOyB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTQVZFIFNFTEVDVEVEXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnNlbGVjdGVkID0gQXJyYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZF9hcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCh0aGlzLnNlbGVjdGVkX2FyciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHRpbmdzLnNlbGVjdGVkLnB1c2goXCIjXCIgKyB0aGlzLmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQucHVzaChcIiNcIiArIHRoaXMuc2VsZWN0ZWQuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLyplbHNlIGlmKHRoaXMuc2V0dGluZ3MuY29va2llcyAmJiBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX3NlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0bXAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHRpbmdzLnNlbGVjdGVkLnB1c2goXCIjXCIgKyB0aGlzLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0qL1xuICAgICAgICAgICAgICAgIGVsc2UgaWYodGhpcy5zZXR0aW5ncy5zZWxlY3RlZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZCkudG9Mb3dlckNhc2UoKSA9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2godGhpcy5zZXR0aW5ncy5zZWxlY3RlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5wdXNoKFwiI1wiICsgdGhpcy5yZXBsYWNlKC9eIy8sXCJcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB0bXAucHVzaChcIiNcIiArIHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQucmVwbGFjZSgvXiMvLFwiXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZCA9IHRtcDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZihvYmogJiYgdGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3BlbmVkID0gQXJyYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgICAgICBvYmouZmluZChcImxpLm9wZW5cIikuZWFjaChmdW5jdGlvbiAoaSkgeyBfdGhpcy5vcGVuZWQucHVzaChcIiNcIiArIHRoaXMuaWQpOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZV9icmFuY2gob2JqLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuaHRtbChcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub3Blbl9icmFuY2gob2JqLCB0cnVlLCBmdW5jdGlvbiAoKSB7IF90aGlzLnJlc2VsZWN0LmFwcGx5KF90aGlzKTsgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGNscyA9IFwidHJlZS1kZWZhdWx0XCI7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS50aGVtZV9uYW1lICE9IFwiZGVmYXVsdFwiKSBjbHMgKz0gXCIgdHJlZS1cIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX25hbWU7XG5cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcInhtbF9mbGF0XCIgfHwgdGhpcy5zZXR0aW5ncy5kYXRhLnR5cGUgPT0gXCJ4bWxfbmVzdGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3J0b3AgPSB0aGlzLmNvbnRhaW5lci5nZXQoMCkuc2Nyb2xsVG9wO1xuICAgICAgICAgICAgICAgICAgICB2YXIgeHNsID0gKHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwieG1sX2ZsYXRcIikgPyBcImZsYXQueHNsXCIgOiBcIm5lc3RlZC54c2xcIjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZ2V0VHJhbnNmb3JtKHRoaXMucGF0aCArIHhzbCwgdGhpcy5zZXR0aW5ncy5kYXRhLnVybCwgeyBwYXJhbXMgOiB7IHRoZW1lX25hbWUgOiBjbHMsIHRoZW1lX3BhdGggOiBfdGhpcy50aGVtZSB9LCBtZXRoIDogX3RoaXMuc2V0dGluZ3MuZGF0YS5tZXRob2QgLGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7IF90aGlzLnJlc2VsZWN0LmFwcGx5KF90aGlzKTsgfSB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwianNvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5qc29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5qc29uLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLnNldHRpbmdzLmRhdGEuanNvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gdGhpcy5wYXJzZUpTT04odGhpcy5zZXR0aW5ncy5kYXRhLmpzb25baV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBzdHIgPSB0aGlzLnBhcnNlSlNPTih0aGlzLnNldHRpbmdzLmRhdGEuanNvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5odG1sKFwiPHVsIGNsYXNzPSdcIiArIGNscyArIFwiJz5cIiArIHN0ciArIFwiPC91bD5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGk6bGFzdC1jaGlsZFwiKS5hZGRDbGFzcyhcImxhc3RcIikuZW5kKCkuZmluZChcImxpOmhhcyh1bClcIikubm90KFwiLm9wZW5cIikuYWRkQ2xhc3MoXCJjbG9zZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGlcIikubm90KFwiLm9wZW5cIikubm90KFwiLmNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS5tZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsICAgICAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEudXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jX2RhdGEoZmFsc2UpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlICAgIDogXCJqc29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyAgICAgICAgOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IF90aGlzLnBhcnNlSlNPTihkYXRhW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHN0ciA9IF90aGlzLnBhcnNlSlNPTihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmh0bWwoXCI8dWwgY2xhc3M9J1wiICsgY2xzICsgXCInPlwiICsgc3RyICsgXCI8L3VsPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmZpbmQoXCJsaTpsYXN0LWNoaWxkXCIpLmFkZENsYXNzKFwibGFzdFwiKS5lbmQoKS5maW5kKFwibGk6aGFzKHVsKVwiKS5ub3QoXCIub3BlblwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmZpbmQoXCJsaVwiKS5ub3QoXCIub3BlblwiKS5ub3QoXCIuY2xvc2VkXCIpLmFkZENsYXNzKFwibGVhZlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVzZWxlY3QuYXBwbHkoX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jaGlsZHJlbihcInVsOmVxKDApXCIpLmF0dHIoXCJjbGFzc1wiLCBjbHMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGk6bGFzdC1jaGlsZFwiKS5hZGRDbGFzcyhcImxhc3RcIikuZW5kKCkuZmluZChcImxpOmhhcyh1bClcIikubm90KFwiLm9wZW5cIikuYWRkQ2xhc3MoXCJjbG9zZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoXCJsaVwiKS5ub3QoXCIub3BlblwiKS5ub3QoXCIuY2xvc2VkXCIpLmFkZENsYXNzKFwibGVhZlwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNlbGVjdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBDT05WRVJUIEpTT04gVE8gSFRNTFxuICAgICAgICAgICAgcGFyc2VKU09OIDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICBzdHIgKz0gXCI8bGkgXCI7XG4gICAgICAgICAgICAgICAgdmFyIGNscyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGZvcihpIGluIGRhdGEuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICBpZihpID09IFwiY2xhc3NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiIGNsYXNzPSdcIiArIGRhdGEuYXR0cmlidXRlc1tpXSArIFwiIFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5zdGF0ZSA9PSBcImNsb3NlZFwiIHx8IGRhdGEuc3RhdGUgPT0gXCJvcGVuXCIpIHN0ciArPSBcIiBcIiArIGRhdGEuc3RhdGUgKyBcIiBcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSBcIicgXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Ugc3RyICs9IFwiIFwiICsgaSArIFwiPSdcIiArIGRhdGEuYXR0cmlidXRlc1tpXSArIFwiJyBcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoIWNscyAmJiAoZGF0YS5zdGF0ZSA9PSBcImNsb3NlZFwiIHx8IGRhdGEuc3RhdGUgPT0gXCJvcGVuXCIpKSBzdHIgKz0gXCIgY2xhc3M9J1wiICsgZGF0YS5zdGF0ZSArIFwiJyBcIjtcbiAgICAgICAgICAgICAgICBzdHIgKz0gXCI+XCI7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbXCJocmVmXCJdID0gXCIjXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyW1wic3R5bGVcIl0gPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltcImNsYXNzXCJdID0gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dICYmICh0eXBlb2YgZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5hdHRyaWJ1dGVzKS50b0xvd2VyQ2FzZSgpICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaiBpbiBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaiA9PSBcInN0eWxlXCIgfHwgaiA9PSBcImNsYXNzXCIpICAgIGF0dHJbal0gKz0gXCIgXCIgKyBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbal0gID0gZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5hdHRyaWJ1dGVzW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0gJiYgZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5pY29uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljbiA9IGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uaWNvbi5pbmRleE9mKFwiL1wiKSA9PSAtMSA/IHRoaXMudGhlbWUgKyBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmljb24gOiBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmljb247XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltcInN0eWxlXCJdICs9IFwiIDsgYmFja2dyb3VuZC1pbWFnZTp1cmwoJ1wiICsgaWNuICsgXCInKTsgXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCI8YVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gYXR0cikgc3RyICs9ICcgJyArIGogKyAnPVwiJyArIGF0dHJbal0gKyAnXCIgJztcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSBcIj5cIiArICggKHR5cGVvZiBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLnRpdGxlKS50b0xvd2VyQ2FzZSgpICE9IFwidW5kZWZpbmVkXCIgPyBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLnRpdGxlIDogZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXSApICsgXCI8L2E+XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRyID0gW107XG4gICAgICAgICAgICAgICAgICAgIGF0dHJbXCJocmVmXCJdID0gXCIjXCI7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJbXCJzdHlsZVwiXSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGF0dHJbXCJjbGFzc1wiXSA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgZGF0YS5kYXRhLmF0dHJpYnV0ZXMpLnRvTG93ZXJDYXNlKCkgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gZGF0YS5kYXRhLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpID09IFwic3R5bGVcIiB8fCBpID09IFwiY2xhc3NcIikgICAgYXR0cltpXSArPSBcIiBcIiArIGRhdGEuZGF0YS5hdHRyaWJ1dGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbaV0gID0gZGF0YS5kYXRhLmF0dHJpYnV0ZXNbaV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5kYXRhLmljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY24gPSBkYXRhLmRhdGEuaWNvbi5pbmRleE9mKFwiL1wiKSA9PSAtMSA/IHRoaXMudGhlbWUgKyBkYXRhLmRhdGEuaWNvbiA6IGRhdGEuZGF0YS5pY29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltcInN0eWxlXCJdICs9IFwiIDsgYmFja2dyb3VuZC1pbWFnZTp1cmwoJ1wiICsgaWNuICsgXCInKTtcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCI8YVwiO1xuICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiBhdHRyKSBzdHIgKz0gJyAnICsgaSArICc9XCInICsgYXR0cltpXSArICdcIiAnO1xuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCI+XCIgKyAoICh0eXBlb2YgZGF0YS5kYXRhLnRpdGxlKS50b0xvd2VyQ2FzZSgpICE9IFwidW5kZWZpbmVkXCIgPyBkYXRhLmRhdGEudGl0bGUgOiBkYXRhLmRhdGEgKSArIFwiPC9hPlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihkYXRhLmNoaWxkcmVuICYmIGRhdGEuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ciArPSAnPHVsPic7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gdGhpcy5wYXJzZUpTT04oZGF0YS5jaGlsZHJlbltpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3RyICs9ICc8L3VsPic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0ciArPSBcIjwvbGk+XCI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0cjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBnZXRKU09OIGZyb20gSFRNTFxuICAgICAgICAgICAgZ2V0SlNPTiA6IGZ1bmN0aW9uIChub2QsIG91dGVyX2F0dHJpYiwgaW5uZXJfYXR0cmliLCBmb3JjZSkge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYoIW5vZCB8fCAkKG5vZCkuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kID0gdGhpcy5jb250YWluZXIuY2hpbGRyZW4oXCJ1bFwiKS5jaGlsZHJlbihcImxpXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIG5vZCA9ICQobm9kKTtcblxuICAgICAgICAgICAgICAgIGlmKG5vZC5zaXplKCkgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgbm9kLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2goX3RoaXMuZ2V0SlNPTih0aGlzLCBvdXRlcl9hdHRyaWIsIGlubmVyX2F0dHJpYikpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFycjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZighb3V0ZXJfYXR0cmliKSBvdXRlcl9hdHRyaWIgPSBbIFwiaWRcIiwgXCJyZWxcIiwgXCJjbGFzc1wiIF07XG4gICAgICAgICAgICAgICAgaWYoIWlubmVyX2F0dHJpYikgaW5uZXJfYXR0cmliID0gWyBdO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB7IGF0dHJpYnV0ZXMgOiB7fSwgZGF0YSA6IGZhbHNlIH07XG4gICAgICAgICAgICAgICAgZm9yKGkgaW4gb3V0ZXJfYXR0cmliKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5hdHRyaWJ1dGVzW291dGVyX2F0dHJpYltpXV0gPSBub2QuYXR0cihvdXRlcl9hdHRyaWJbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGEgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhID0gbm9kLmNoaWxkcmVuKFwiYS5cIiArIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZvcmNlIHx8IGlubmVyX2F0dHJpYi5sZW5ndGggfHwgYS5nZXQoMCkuc3R5bGUuYmFja2dyb3VuZEltYWdlLnRvU3RyaW5nKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLnRpdGxlID0gYS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoYS5nZXQoMCkuc3R5bGUuYmFja2dyb3VuZEltYWdlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uaWNvbiA9IGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS5yZXBsYWNlKFwidXJsKFwiLFwiXCIpLnJlcGxhY2UoXCIpXCIsXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlubmVyX2F0dHJpYi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gaW5uZXJfYXR0cmliKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uYXR0cmlidXRlc1tpbm5lcl9hdHRyaWJbal1dID0gYS5hdHRyKGlubmVyX2F0dHJpYltqXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0gPSBhLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBub2QuY2hpbGRyZW4oXCJhXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZihmb3JjZSB8fCBpbm5lcl9hdHRyaWIubGVuZ3RoIHx8IGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS50b1N0cmluZygpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGEgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLnRpdGxlID0gYS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihhLmdldCgwKS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGEuaWNvbiA9IGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS5yZXBsYWNlKFwidXJsKFwiLFwiXCIpLnJlcGxhY2UoXCIpXCIsXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbm5lcl9hdHRyaWIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGEuYXR0cmlidXRlcyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqIGluIGlubmVyX2F0dHJpYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YS5hdHRyaWJ1dGVzW2lubmVyX2F0dHJpYltqXV0gPSBhLmF0dHIoaW5uZXJfYXR0cmliW2pdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YSA9IGEudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYobm9kLmNoaWxkcmVuKFwidWxcIikuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgbm9kLmNoaWxkcmVuKFwidWxcIikuY2hpbGRyZW4oXCJsaVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKF90aGlzLmdldEpTT04odGhpcywgb3V0ZXJfYXR0cmliLCBpbm5lcl9hdHRyaWIpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9jdXMgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZih0cmVlX2NvbXBvbmVudC5mb2N1c2VkICE9IHRoaXMuY250cikge1xuICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5mb2N1c2VkID0gdGhpcy5jbnRyO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uZm9jdXMuY2FsbChudWxsLCB0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd19jb250ZXh0IDogZnVuY3Rpb24gKG9iaiwgeCwgeSkge1xuICAgICAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLmNvbnRleHQuc2hvdygpLm9mZnNldFBhcmVudCgpO1xuICAgICAgICAgICAgICAgIGlmKHRtcC5pcyhcImh0bWxcIikpIHRtcCA9ICQoXCJib2R5XCIpO1xuICAgICAgICAgICAgICAgIHRtcCA9IHRtcC5vZmZzZXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQuY3NzKHsgXCJsZWZ0XCIgOiAoeCAtIHRtcC5sZWZ0IC0gKHRoaXMuc2V0dGluZ3MudWkucnRsID8gJCh0aGlzLmNvbnRleHQpLndpZHRoKCkgOiAtNSApICksIFwidG9wXCIgOiAoeSAtIHRtcC50b3AgICsgKCQuYnJvd3Nlci5vcGVyYSA/IHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCgpIDogMCkgKyAxNSkgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZV9jb250ZXh0IDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5oaWRlKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gQUxMIEVWRU5UU1xuICAgICAgICAgICAgYXR0YWNoRXZlbnRzIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgICAubGlzdGVuKFwiY2xpY2tcIiwgXCJsaVwiLCBmdW5jdGlvbihldmVudCkgeyAvLyBXSEVOIENMSUNLIElTIE9OIFRIRSBBUlJPV1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGVfYnJhbmNoLmFwcGx5KF90aGlzLCBbZXZlbnQudGFyZ2V0XSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJjbGlja1wiLCBcImEudGl0bGVcIiwgZnVuY3Rpb24gKGV2ZW50KSB7IC8vIFdIRU4gQ0xJQ0sgSVMgT04gVEhFIFRFWFQgT1IgSUNPTlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdF9icmFuY2guYXBwbHkoX3RoaXMsIFtldmVudC50YXJnZXQsIGV2ZW50LmN0cmxLZXkgfHwgX3RoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgPT0gXCJvblwiXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5pbnApIHsgX3RoaXMuaW5wLmJsdXIoKTsgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJkYmxjbGlja1wiLCBcImEudGl0bGVcIiwgZnVuY3Rpb24gKGV2ZW50KSB7IC8vIFdIRU4gRE9VQkxFQ0xJQ0sgT04gVEVYVCBPUiBJQ09OXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25kYmxjbGsuY2FsbChudWxsLCBfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpLmdldCgwKSwgX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmxpc3RlbihcImNvbnRleHRtZW51XCIsIFwiYS50aXRsZVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmxvY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25yZ3RjbGsuY2FsbChudWxsLCBfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpLmdldCgwKSwgX3RoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jb250ZXh0LmFwcGVuZCA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250YWluZXIuZmluZChcInVsOmVxKDApXCIpLmFwcGVuZChfdGhpcy5jb250ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGV4dC5hcHBlbmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiBfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldID09IFwic2VwYXJhdG9yXCIpIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnVuYyA9IF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uYWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRleHQuY2hpbGRyZW4oXCJbcmVsPVwiICsgX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5pZCArXCJdXCIpLmJpbmQoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYy5jYWxsKG51bGwsIF90aGlzLnNlbGVjdGVkX2FyciB8fCBfdGhpcy5zZWxlY3RlZCwgX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlX2NvbnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IF90aGlzLmdldF9ub2RlKGV2ZW50LnRhcmdldCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuaW5wKSB7IF90aGlzLmlucC5ibHVyKCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9iai5jaGlsZHJlbihcImE6ZXEoMClcIikuaGFzQ2xhc3MoXCJjbGlja2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RfYnJhbmNoLmFwcGx5KF90aGlzLCBbZXZlbnQudGFyZ2V0LCBldmVudC5jdHJsS2V5IHx8IF90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlID09IFwib25cIl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZXh0LmNoaWxkcmVuKFwibGlcIikuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ28gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXSA9PSBcInNlcGFyYXRvclwiKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLnZpc2libGUuY2FsbChudWxsLCBfdGhpcy5zZWxlY3RlZF9hcnIgfHwgX3RoaXMuc2VsZWN0ZWQsIF90aGlzKSkgX3RoaXMuY29udGV4dC5jaGlsZHJlbihcIltyZWw9XCIgKyBfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmlkICtcIl1cIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBnbyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZ28gPT0gdHJ1ZSkgX3RoaXMuc2hvd19jb250ZXh0KG9iaiwgZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWCwgZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJwb2ludGVyZW50ZXJcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5zZXR0aW5ncy51aS5ob3Zlcl9tb2RlICYmIF90aGlzLmhvdmVyZWQgIT09IGZhbHNlICYmIGV2ZW50LnRhcmdldC50YWdOYW1lID09IFwiQVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaG92ZXJlZC5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5ob3ZlcmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEFUVEFDSCBEUkFHICYgRFJPUCBPTkxZIElGIE5FRURFRFxuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdnYWJsZSAhPSBcIm5vbmVcIiAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlcyAhPSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub24oJ3BvaW50ZXJ1cCBwb2ludGVyZG93bicsICcuY29sMicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMuX2RyYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsIFwiYS50aXRsZVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZm9jdXMuYXBwbHkoX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU0VMRUNUIExJU1QgSVRFTSBOT0RFXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJRiBJVEVNIElTIERSQUdHQUJMRVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiBfdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID4gMSAmJiBvYmouY2hpbGRyZW4oXCJhOmVxKDApXCIpLmhhc0NsYXNzKFwiY2xpY2tlZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gX3RoaXMuc2VsZWN0ZWRfYXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuY2hlY2soXCJkcmFnZ2FibGVcIiwgX3RoaXMuc2VsZWN0ZWRfYXJyW2ldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RlZF9hcnJbaV0uYWRkQ2xhc3MoXCJkcmFnZ2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyICsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNvdW50ZXIgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuY2hlY2soXCJkcmFnZ2FibGVcIiwgb2JqKSkgICAgX3RoaXMuX2RyYWcgPSBvYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2RyYWcgPSBfdGhpcy5jb250YWluZXIuZmluZChcImxpLmRyYWdnZWQ6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNkb3duICAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnICAgICAgICA9IF90aGlzLl9kcmFnLmdldCgwKS5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZy5pZCAgICA9IFwiZHJhZ2dlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoX3RoaXMuZHJhZykuY2hpbGRyZW4oXCJhXCIpLmh0bWwoXCJNdWx0aXBsZSBzZWxlY3Rpb25cIikuZW5kKCkuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmNoZWNrKFwiZHJhZ2dhYmxlXCIsIG9iaikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZHJhZyAgICAgICAgPSBvYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZyAgICAgICAgPSBvYmouZ2V0KDApLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnLmlkICAgID0gXCJkcmFnZ2VkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNkb3duICAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5mb3JlaWduICAgID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmFkZENsYXNzKFwiZHJhZ2dlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmxpc3RlbihcInBvaW50ZXJ1cFwiLCBcImxpXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubGlzdGVuKFwicG9pbnRlcnVwXCIsIFwiYS50aXRsZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzLl9kcmFnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnaHRtbCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJwb2ludGVyZG93blwiLCAgICB0cmVlX2NvbXBvbmVudC5tb3VzZWRvd24pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJwb2ludGVydXBcIiwgICAgdHJlZV9jb21wb25lbnQubW91c2V1cClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYmluZChcInBvaW50ZXJtb3ZlXCIsICAgIHRyZWVfY29tcG9uZW50Lm1vdXNlbW92ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gRU5ESUYgT0YgRFJBRyAmIERST1AgRlVOQ1RJT05TXG4gICAgICAgICAgICAgICAgaWYoX3RoaXMuY29udGV4dCkgJCgnaHRtbCcpLmJpbmQoXCJwb2ludGVydXBcIiwgZnVuY3Rpb24oKSB7IF90aGlzLmhpZGVfY29udGV4dCgpOyB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjaGVja01vdmUgOiBmdW5jdGlvbiAoTk9ERVMsIFJFRl9OT0RFLCBUWVBFKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgLy8gT1ZFUiBTRUxGIE9SIENISUxEUkVOXG4gICAgICAgICAgICAgICAgaWYoUkVGX05PREUucGFyZW50cyhcImxpLmRyYWdnZWRcIikuc2l6ZSgpID4gMCB8fCBSRUZfTk9ERS5pcyhcIi5kcmFnZ2VkXCIpKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IE5PREUgT1ZFUiBTRUxGXCIpO1xuICAgICAgICAgICAgICAgIC8vIENIRUNLIEFHQUlOU1QgRFJBR19SVUxFU1xuICAgICAgICAgICAgICAgIGlmKE5PREVTLnNpemUoKSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBOT0RFID0gTk9ERVMuZXEoMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKE5PREUuaGFzQ2xhc3MoXCJmb3JlaWduXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZS5sZW5ndGggPT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIU5PREUuaXMoXCIuXCIgKyB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZS5qb2luKFwiLCAuXCIpKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKE5PREUuaXMoXCIuXCIgKyB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZVtpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5tZXRhZGF0YS5zZXRUeXBlKFwiYXR0clwiLCB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PREUuYXR0cih0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhLCBcInR5cGU6ICdcIiArIHRoaXMuc2V0dGluZ3MucnVsZXMuZHJvcHBhYmxlW2ldICsgXCInXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9ERS5hdHRyKHRoaXMuc2V0dGluZ3MucnVsZXMudHlwZV9hdHRyLCB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZVtpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighb2spIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5jaGVjayhcImRyYWdydWxlc1wiLCBbTk9ERSwgVFlQRSwgUkVGX05PREUucGFyZW50cyhcImxpOmVxKDApXCIpXSkpIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogQUdBSU5TVCBEUkFHIFJVTEVTXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgTk9ERVMuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZiA9IE5PREVTLmVxKCAoaSAtIDEpICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG12ID0gXCJhZnRlclwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZiA9IFJFRl9OT0RFO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtdiA9IFRZUEU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighX3RoaXMuY2hlY2suYXBwbHkoX3RoaXMsW1wiZHJhZ3J1bGVzXCIsIFskKHRoaXMpLCBtdiwgcmVmXV0pKSBvayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogQUdBSU5TVCBEUkFHIFJVTEVTXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBDSEVDSyBBR0FJTlNUIE1FVEFEQVRBXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy51c2VfaW5saW5lICYmIHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmKFRZUEUgPT0gXCJpbnNpZGVcIikgICAgbmQgPSBSRUZfTk9ERS5wYXJlbnRzKFwibGk6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgIG5kID0gUkVGX05PREUucGFyZW50cyhcImxpOmVxKDEpXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZihuZC5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZBTElEIENISUxEUkVOIENIRUNLXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgbmQubWV0YWRhdGEoKVtcInZhbGlkX2NoaWxkcmVuXCJdICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gbmQubWV0YWRhdGEoKVtcInZhbGlkX2NoaWxkcmVuXCJdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9ERVMuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkLmluQXJyYXkoX3RoaXMuZ2V0X3R5cGUodGhpcyksIHRtcCkgPT0gLTEpIG9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogTk9UIEEgVkFMSUQgQ0hJTERcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDSEVDSyBJRiBQQVJFTlQgSEFTIEZSRUUgU0xPVFMgRk9SIENISUxEUkVOXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgbmQubWV0YWRhdGEoKVtcIm1heF9jaGlsZHJlblwiXSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoKG5kLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaVwiKS5ub3QoXCIuZHJhZ2dlZFwiKS5zaXplKCkgKyBOT0RFUy5zaXplKCkpID4gbmQubWV0YWRhdGEoKS5tYXhfY2hpbGRyZW4pIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogTUFYIENISUxEUkVOIFJFQUNIRURcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDSEVDSyBGT1IgTUFYREVQVEggVVAgVEhFIENIQUlOXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5jciA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICBOT0RFUy5lYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZShpIDwgMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSB0LmNoaWxkcmVuKFwidWw6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHQuc2l6ZSgpID09IDApIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluY3IgPSBNYXRoLm1heChpLGluY3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmQucGFyZW50cyhcImxpXCIpLmVhY2goZnVuY3Rpb24oaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5tZXRhZGF0YSgpLm1heF9kZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggKGkgKyBpbmNyKSA+PSAkKHRoaXMpLm1ldGFkYXRhKCkubWF4X2RlcHRoKSBvayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogTUFYX0RFUFRIIFJFQUNIRURcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gVVNFRCBBRlRFUiBSRUZSRVNIXG4gICAgICAgICAgICByZXNlbGVjdCA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIC8vIFJFT1BFTiBCUkFOQ0hFU1xuICAgICAgICAgICAgICAgIGlmKHRoaXMub3BlbmVkICYmIHRoaXMub3BlbmVkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgb3BuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCB0aGlzLm9wZW5lZC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5nZXRfbm9kZSh0aGlzLm9wZW5lZFtqXSkuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcG4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5vcGVuZWRbal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9wZW5lZFtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuX2JyYW5jaCh0bXAsIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMucmVzZWxlY3QuYXBwbHkoX3RoaXMpOyB9IClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMub3Blbl9icmFuY2godGhpcy5vcGVuZWRbal0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luYyAmJiBvcG4pIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMub3BlbmVkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBSRVBPU0lUSU9OIFNDUk9MTFxuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2NydG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcChfdGhpcy5zY3J0b3ApO1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5zY3J0b3A7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFJFU0VMRUNUIFBSRVZJT1VTTFkgU0VMRUNURURcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnNlbGVjdGVkICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2godGhpcy5zZXR0aW5ncy5zZWxlY3RlZCwgZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdF9icmFuY2goJChfdGhpcy5zZXR0aW5ncy5zZWxlY3RlZFtpXSksIChfdGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPT0gZmFsc2UgJiYgaSA+IDApICk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25sb2FkLmNhbGwobnVsbCwgX3RoaXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIEdFVCBUSEUgRVhURU5ERUQgTEkgRUxFTUVOVFxuICAgICAgICAgICAgZ2V0X25vZGUgOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9ICQob2JqKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JqLmlzKFwibGlcIikgPyBvYmogOiBvYmoucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIEdFVCBUSEUgVFlQRSBPRiBUSEUgTk9ERVxuICAgICAgICAgICAgZ2V0X3R5cGUgOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICAgICAgb2JqID0gIW9iaiA/IHRoaXMuc2VsZWN0ZWQgOiB0aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5tZXRhZGF0YS5zZXRUeXBlKFwiYXR0clwiLCB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IG9iai5tZXRhZGF0YSgpLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRtcCkgcmV0dXJuIHRtcDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9iai5hdHRyKHRoaXMuc2V0dGluZ3MucnVsZXMudHlwZV9hdHRyKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyBTQ1JPTEwgQ09OVEFJTkVSIFdISUxFIERSQUdHSU5HXG4gICAgICAgICAgICBzY3JvbGxDaGVjayA6IGZ1bmN0aW9uICh4LHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBjbnQgPSBfdGhpcy5jb250YWluZXI7XG4gICAgICAgICAgICAgICAgdmFyIG9mZiA9IF90aGlzLm9mZnNldDtcblxuICAgICAgICAgICAgICAgIHZhciBzdCA9IGNudC5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgICAgICB2YXIgc2wgPSBjbnQuc2Nyb2xsTGVmdCgpO1xuICAgICAgICAgICAgICAgIC8vIERFVEVDVCBIT1JJWk9OVEFMIFNDUk9MTFxuICAgICAgICAgICAgICAgIHZhciBoX2NvciA9IChjbnQuZ2V0KDApLnNjcm9sbFdpZHRoID4gY250LndpZHRoKCkpID8gNDAgOiAyMDtcblxuICAgICAgICAgICAgICAgIGlmKHkgLSBvZmYudG9wIDwgMjApICAgICAgICAgICAgICAgICAgICAgICAgY250LnNjcm9sbFRvcChNYXRoLm1heCggKHN0IC0gX3RoaXMuc2V0dGluZ3MudWkuc2Nyb2xsX3NwZCkgLDApKTsgICAgLy8gTkVBUiBUT1BcbiAgICAgICAgICAgICAgICBpZihjbnQuaGVpZ2h0KCkgLSAoeSAtIG9mZi50b3ApIDwgaF9jb3IpICAgIGNudC5zY3JvbGxUb3Aoc3QgKyBfdGhpcy5zZXR0aW5ncy51aS5zY3JvbGxfc3BkKTsgICAgICAgICAgICAgICAgICAgIC8vIE5FQVIgQk9UVE9NXG4gICAgICAgICAgICAgICAgaWYoeCAtIG9mZi5sZWZ0IDwgMjApICAgICAgICAgICAgICAgICAgICAgICAgY250LnNjcm9sbExlZnQoTWF0aC5tYXgoIChzbCAtIF90aGlzLnNldHRpbmdzLnVpLnNjcm9sbF9zcGQpLDApKTsgICAgLy8gTkVBUiBMRUZUXG4gICAgICAgICAgICAgICAgaWYoY250LndpZHRoKCkgLSAoeCAtIG9mZi5sZWZ0KSA8IDQwKSAgICAgICAgY250LnNjcm9sbExlZnQoc2wgKyBfdGhpcy5zZXR0aW5ncy51aS5zY3JvbGxfc3BkKTsgICAgICAgICAgICAgICAgICAgIC8vIE5FQVIgUklHSFRcblxuICAgICAgICAgICAgICAgIGlmKGNudC5zY3JvbGxMZWZ0KCkgIT0gc2wgfHwgY250LnNjcm9sbFRvcCgpICE9IHN0KSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVUeXBlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVSZWYgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgJChcIiNtYXJrZXJcIikuaGlkZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5zdG8gPSBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsgX3RoaXMuc2Nyb2xsQ2hlY2soeCx5KTsgfSwgNTApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoZWNrIDogZnVuY3Rpb24gKHJ1bGUsIG5vZGVzKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIC8vIENIRUNLIExPQ0FMIFJVTEVTIElGIE1FVEFEQVRBXG4gICAgICAgICAgICAgICAgaWYocnVsZSAhPSBcImRyYWdydWxlc1wiICYmIHRoaXMuc2V0dGluZ3MucnVsZXMudXNlX2lubGluZSAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICQubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLmdldF9ub2RlKG5vZGVzKS5tZXRhZGF0YSgpW3J1bGVdICE9IFwidW5kZWZpbmVkXCIpIHJldHVybiB0aGlzLmdldF9ub2RlKG5vZGVzKS5tZXRhZGF0YSgpW3J1bGVdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZighdGhpcy5zZXR0aW5ncy5ydWxlc1tydWxlXSkgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlc1tydWxlXSA9PSBcIm5vbmVcIikgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXNbcnVsZV0gPT0gXCJhbGxcIikgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgaWYocnVsZSA9PSBcImRyYWdydWxlc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZHMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgbmRzWzBdID0gdGhpcy5nZXRfdHlwZShub2Rlc1swXSk7XG4gICAgICAgICAgICAgICAgICAgIG5kc1sxXSA9IG5vZGVzWzFdO1xuICAgICAgICAgICAgICAgICAgICBuZHNbMl0gPSB0aGlzLmdldF90eXBlKG5vZGVzWzJdKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ3J1bGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ3J1bGVzW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSAoci5pbmRleE9mKFwiIVwiKSA9PT0gMCkgPyBmYWxzZSA6IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZighbikgciA9IHIucmVwbGFjZShcIiFcIixcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSByLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCAzOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0bXBbal0gPT0gbmRzW2pdIHx8IHRtcFtqXSA9PSBcIipcIikgdG1wW2pdID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRtcFswXSA9PT0gdHJ1ZSAmJiB0bXBbMV0gPT09IHRydWUgJiYgdG1wWzJdID09PSB0cnVlKSByZXR1cm4gbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkLmluQXJyYXkodGhpcy5nZXRfdHlwZShub2RlcyksdGhpcy5zZXR0aW5ncy5ydWxlc1tydWxlXSkgIT0gLTEpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhvdmVyX2JyYW5jaCA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ob3Zlcl9tb2RlID09IGZhbHNlKSByZXR1cm4gdGhpcy5zZWxlY3RfYnJhbmNoKG9iaik7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gX3RoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICBpZighb2JqLnNpemUoKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJIT1ZFUjogTk9UIEEgVkFMSUQgTk9ERVwiKTtcbiAgICAgICAgICAgICAgICAvLyBDSEVDSyBBR0FJTlNUIFJVTEVTIEZPUiBTRUxFQ1RBQkxFIE5PREVTXG4gICAgICAgICAgICAgICAgaWYoIV90aGlzLmNoZWNrKFwiY2xpY2thYmxlXCIsIG9iaikpIHJldHVybiB0aGlzLmVycm9yKFwiU0VMRUNUOiBOT0RFIE5PVCBTRUxFQ1RBQkxFXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuaG92ZXJlZCkgdGhpcy5ob3ZlcmVkLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImhvdmVyXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gU0FWRSBORVdMWSBTRUxFQ1RFRFxuICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJlZCA9IG9iajtcblxuICAgICAgICAgICAgICAgIC8vIEZPQ1VTIE5FVyBOT0RFIEFORCBPUEVOIEFMTCBQQVJFTlQgTk9ERVMgSUYgQ0xPU0VEXG4gICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmVkLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImhvdmVyXCIpLmFkZENsYXNzKFwiaG92ZXJcIik7XG5cbiAgICAgICAgICAgICAgICAvLyBTQ1JPTEwgU0VMRUNURUQgTk9ERSBJTlRPIFZJRVdcbiAgICAgICAgICAgICAgICB2YXIgb2ZmX3QgPSB0aGlzLmhvdmVyZWQub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgIHZhciBiZWdfdCA9IHRoaXMuY29udGFpbmVyLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgICB2YXIgZW5kX3QgPSBiZWdfdCArIHRoaXMuY29udGFpbmVyLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIHZhciBoX2NvciA9ICh0aGlzLmNvbnRhaW5lci5nZXQoMCkuc2Nyb2xsV2lkdGggPiB0aGlzLmNvbnRhaW5lci53aWR0aCgpKSA/IDQwIDogMjA7XG4gICAgICAgICAgICAgICAgaWYob2ZmX3QgKyA1IDwgYmVnX3QpIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCh0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSAtIChiZWdfdCAtIG9mZl90ICsgNSkgKTtcbiAgICAgICAgICAgICAgICBpZihvZmZfdCArIGhfY29yID4gZW5kX3QpIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCh0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSArIChvZmZfdCArIGhfY29yIC0gZW5kX3QpICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0X2JyYW5jaCA6IGZ1bmN0aW9uIChvYmosIG11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgICAgIGlmKCFvYmogJiYgdGhpcy5ob3ZlcmVkICE9PSBmYWxzZSkgb2JqID0gdGhpcy5ob3ZlcmVkO1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgb2JqID0gX3RoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICBpZighb2JqLnNpemUoKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJTRUxFQ1Q6IE5PVCBBIFZBTElEIE5PREVcIik7XG4gICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImhvdmVyXCIpO1xuICAgICAgICAgICAgICAgIC8vIENIRUNLIEFHQUlOU1QgUlVMRVMgRk9SIFNFTEVDVEFCTEUgTk9ERVNcbiAgICAgICAgICAgICAgICBpZighX3RoaXMuY2hlY2soXCJjbGlja2FibGVcIiwgb2JqKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJTRUxFQ1Q6IE5PREUgTk9UIFNFTEVDVEFCTEVcIik7XG4gICAgICAgICAgICAgICAgaWYoX3RoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlY2hhbmdlLmNhbGwobnVsbCxvYmouZ2V0KDApLF90aGlzKSA9PT0gZmFsc2UpIHJldHVybiB0aGlzLmVycm9yKFwiU0VMRUNUOiBTVE9QUEVEIEJZIFVTRVJcIik7XG4gICAgICAgICAgICAgICAgLy8gSUYgbXVsdGlwbGUgQU5EIG9iaiBJUyBBTFJFQURZIFNFTEVDVEVEIC0gREVTRUxFQ1QgSVRcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmIG11bHRpcGxlICYmIG9iai5jaGlsZHJlbihcImEuY2xpY2tlZFwiKS5zaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlc2VsZWN0X2JyYW5jaChvYmopO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmIG11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyLnB1c2gob2JqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiAhbXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZWxlY3RlZF9hcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyW2ldLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9hcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9hcnIucHVzaChvYmopO1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkKSB0aGlzLnNlbGVjdGVkLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQpIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJBXCIpLnJlbW92ZUNsYXNzKFwiY2xpY2tlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gU0FWRSBORVdMWSBTRUxFQ1RFRFxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBvYmo7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ob3Zlcl9tb2RlICYmIHRoaXMuaG92ZXJlZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmVkLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImhvdmVyXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhvdmVyZWQgPSBvYmo7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gRk9DVVMgTkVXIE5PREUgQU5EIE9QRU4gQUxMIFBBUkVOVCBOT0RFUyBJRiBDTE9TRURcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIikuYWRkQ2xhc3MoXCJjbGlja2VkXCIpLmVuZCgpLnBhcmVudHMoXCJsaS5jbG9zZWRcIikuZWFjaCggZnVuY3Rpb24gKCkgeyBfdGhpcy5vcGVuX2JyYW5jaCh0aGlzLCB0cnVlKTsgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBTQ1JPTEwgU0VMRUNURUQgTk9ERSBJTlRPIFZJRVdcbiAgICAgICAgICAgICAgICB2YXIgb2ZmX3QgPSB0aGlzLnNlbGVjdGVkLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgICB2YXIgYmVnX3QgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgdmFyIGVuZF90ID0gYmVnX3QgKyB0aGlzLmNvbnRhaW5lci5oZWlnaHQoKTtcbiAgICAgICAgICAgICAgICB2YXIgaF9jb3IgPSAodGhpcy5jb250YWluZXIuZ2V0KDApLnNjcm9sbFdpZHRoID4gdGhpcy5jb250YWluZXIud2lkdGgoKSkgPyA0MCA6IDIwO1xuICAgICAgICAgICAgICAgIGlmKG9mZl90ICsgNSA8IGJlZ190KSB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AodGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgLSAoYmVnX3QgLSBvZmZfdCArIDUpICk7XG4gICAgICAgICAgICAgICAgaWYob2ZmX3QgKyBoX2NvciA+IGVuZF90KSB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AodGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgKyAob2ZmX3QgKyBoX2NvciAtIGVuZF90KSApO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmNoYW5nZS5jYWxsKG51bGwsIHRoaXMuc2VsZWN0ZWQuZ2V0KDApLCBfdGhpcyk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVzZWxlY3RfYnJhbmNoIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiB0aGlzLnNlbGVjdGVkX2Fyci5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoXCJhLmNsaWNrZWRcIikuZmlsdGVyKFwiOmZpcnN0LWNoaWxkXCIpLnBhcmVudCgpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VsZWN0ZWRfYXJyLnB1c2goJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZihvYmouZ2V0KDApID09IHRoaXMuc2VsZWN0ZWQuZ2V0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZF9hcnJbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9jb29raWUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSkgdGhpcy5zZWxlY3RlZF9hcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9jb29raWUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmNoYW5nZS5jYWxsKG51bGwsIHRoaXMuc2VsZWN0ZWQuZ2V0KDApLCBfdGhpcyk7XG4gICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uY2hhbmdlLmNhbGwobnVsbCwgZmFsc2UsIF90aGlzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b2dnbGVfYnJhbmNoIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcImNsb3NlZFwiKSkgICAgcmV0dXJuIHRoaXMub3Blbl9icmFuY2gob2JqKTtcbiAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJvcGVuXCIpKSAgICByZXR1cm4gdGhpcy5jbG9zZV9icmFuY2gob2JqKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcGVuX2JyYW5jaCA6IGZ1bmN0aW9uIChvYmosIGRpc2FibGVfYW5pbWF0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIGlmKCFvYmouc2l6ZSgpKSByZXR1cm4gdGhpcy5lcnJvcihcIk9QRU46IE5PIFNVQ0ggTk9ERVwiKTtcbiAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJsZWFmXCIpKSByZXR1cm4gdGhpcy5lcnJvcihcIk9QRU46IE9QRU5JTkcgTEVBRiBOT0RFXCIpO1xuXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jICYmIG9iai5maW5kKFwibGlcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikucmVtb3ZlKCkuZW5kKCkuYXBwZW5kKFwiPHVsPjxsaSBjbGFzcz0nbGFzdCc+PGEgc3R5bGU9J2JhY2tncm91bmQtaW1hZ2U6dXJsKFwiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC90aHJvYmJlci5naWYpJyBocmVmPScjJz5cIiArIChfdGhpcy5zZXR0aW5ncy5sYW5nLmxvYWRpbmcgfHwgXCJMb2FkaW5nIC4uLlwiKSArIFwiPC9hPjwvbGk+PC91bD5cIik7XG4gICAgICAgICAgICAgICAgICAgIG9iai5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5hZGRDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwieG1sX2ZsYXRcIiB8fCB0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcInhtbF9uZXN0ZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhzbCA9ICh0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcInhtbF9mbGF0XCIpID8gXCJmbGF0LnhzbFwiIDogXCJuZXN0ZWQueHNsXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gKHRoaXMuc2V0dGluZ3MuZGF0YS51cmwuaW5kZXhPZihcIj9cIikgPT0gLTEpID8gXCI/aWQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob2JqLmF0dHIoXCJpZFwiKSkgOiBcIiZpZD1cIiArIGVuY29kZVVSSUNvbXBvbmVudChvYmouYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmdldFRyYW5zZm9ybSh0aGlzLnBhdGggKyB4c2wsIHRoaXMuc2V0dGluZ3MuZGF0YS51cmwgKyBzdHIsIHsgcGFyYW1zIDogeyB0aGVtZV9wYXRoIDogX3RoaXMudGhlbWUgfSwgbWV0aCA6IHRoaXMuc2V0dGluZ3MuZGF0YS5tZXRob2QsIHJlcGwgOiB0cnVlLCBjYWxsYmFjazogZnVuY3Rpb24gKHN0ciwganNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzdHIubGVuZ3RoIDwgMTUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5yZW1vdmVDbGFzcyhcIm9wZW5cIikuYWRkQ2xhc3MoXCJsZWFmXCIpLmNoaWxkcmVuKFwidWxcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWxsYmFjaykgY2FsbGJhY2suY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9wZW5fYnJhbmNoLmFwcGx5KF90aGlzLCBbb2JqXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNhbGxiYWNrKSBjYWxsYmFjay5jYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLm1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgICAgICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS51cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmNfZGF0YShvYmopLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlICAgIDogXCJqc29uXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyAgICAgICAgOiBmdW5jdGlvbiAoZGF0YSwgdGV4dFN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighZGF0YSB8fCBkYXRhLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLmFkZENsYXNzKFwibGVhZlwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IF90aGlzLnBhcnNlSlNPTihkYXRhW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHN0ciA9IF90aGlzLnBhcnNlSlNPTihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikucmVwbGFjZVdpdGgoXCI8dWw+XCIgKyBzdHIgKyBcIjwvdWw+XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZmluZChcImxpOmxhc3QtY2hpbGRcIikuYWRkQ2xhc3MoXCJsYXN0XCIpLmVuZCgpLmZpbmQoXCJsaTpoYXModWwpXCIpLm5vdChcIi5vcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZmluZChcImxpXCIpLm5vdChcIi5vcGVuXCIpLm5vdChcIi5jbG9zZWRcIikuYWRkQ2xhc3MoXCJsZWFmXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5vcGVuX2JyYW5jaC5hcHBseShfdGhpcywgW29ial0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWxsYmFjaykgY2FsbGJhY2suY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocGFyc2VJbnQodGhpcy5zZXR0aW5ncy51aS5hbmltYXRpb24pID4gMCAmJiAhZGlzYWJsZV9hbmltYXRpb24gJiYgISgkLmJyb3dzZXIubXNpZSAmJiAkLmJyb3dzZXIudmVyc2lvbiA8IDcpICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5hZGRDbGFzcyhcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5zbGlkZURvd24ocGFyc2VJbnQodGhpcy5zZXR0aW5ncy51aS5hbmltYXRpb24pLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcImRpc3BsYXlcIixcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWxsYmFjaykgY2FsbGJhY2suY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9jb29raWUoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9ub3Blbi5jYWxsKG51bGwsIG9iai5nZXQoMCksIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xvc2VfYnJhbmNoIDogZnVuY3Rpb24gKG9iaiwgZGlzYWJsZV9hbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIGlmKHBhcnNlSW50KHRoaXMuc2V0dGluZ3MudWkuYW5pbWF0aW9uKSA+IDAgJiYgIWRpc2FibGVfYW5pbWF0aW9uICYmICEoJC5icm93c2VyLm1zaWUgJiYgJC5icm93c2VyLnZlcnNpb24gPCA3KSAmJiBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5zaXplKCkgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5zbGlkZVVwKHBhcnNlSW50KHRoaXMuc2V0dGluZ3MudWkuYW5pbWF0aW9uKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0X2Nvb2tpZShcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcyhcImRpc3BsYXlcIixcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldF9jb29raWUoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkICYmIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmZpbmQoXCJhLmNsaWNrZWRcIikuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouZmluZChcImxpOmhhcyhhLmNsaWNrZWQpXCIpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kZXNlbGVjdF9icmFuY2godGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZihvYmouY2hpbGRyZW4oXCJhLmNsaWNrZWRcIikuc2l6ZSgpID09IDApIHRoaXMuc2VsZWN0X2JyYW5jaChvYmosICh0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmIHRoaXMuc2VsZWN0ZWRfYXJyLmxlbmd0aCA+IDApICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25jbG9zZS5jYWxsKG51bGwsIG9iai5nZXQoMCksIHRoaXMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wZW5fYWxsIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIG9iaiA9IG9iaiA/ICQob2JqKSA6IHRoaXMuY29udGFpbmVyO1xuICAgICAgICAgICAgICAgIG9iai5maW5kKFwibGkuY2xvc2VkXCIpLmVhY2goIGZ1bmN0aW9uICgpIHsgdmFyIF9fdGhpcyA9IHRoaXM7IF90aGlzLm9wZW5fYnJhbmNoLmFwcGx5KF90aGlzLCBbdGhpcywgdHJ1ZSwgZnVuY3Rpb24oKSB7IF90aGlzLm9wZW5fYWxsLmFwcGx5KF90aGlzLCBbX190aGlzXSk7IH0gXSk7IH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsb3NlX2FsbCA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAkKHRoaXMuY29udGFpbmVyKS5maW5kKFwibGkub3BlblwiKS5lYWNoKCBmdW5jdGlvbiAoKSB7IF90aGlzLmNsb3NlX2JyYW5jaCh0aGlzLCB0cnVlKTsgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2hvd19sYW5nIDogZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0gPT0gdGhpcy5jdXJyZW50X2xhbmcpIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIHZhciBzdCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBpZCA9IHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSA/IFwiI1wiICsgdGhpcy5jb250YWluZXIuYXR0cihcImlkXCIpIDogXCIudHJlZVwiO1xuICAgICAgICAgICAgICAgIHN0ID0gZ2V0X2NzcyhpZCArIFwiIC5cIiArIHRoaXMuY3VycmVudF9sYW5nLCB0aGlzLnNuKTtcbiAgICAgICAgICAgICAgICBpZihzdCAhPT0gZmFsc2UpIHN0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgICAgICBzdCA9IGdldF9jc3MoaWQgKyBcIiAuXCIgKyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXSwgdGhpcy5zbik7XG4gICAgICAgICAgICAgICAgaWYoc3QgIT09IGZhbHNlKSBzdC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudF9sYW5nID0gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY3ljbGVfbGFuZyA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgaSA9ICQuaW5BcnJheSh0aGlzLmN1cnJlbnRfbGFuZywgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMpO1xuICAgICAgICAgICAgICAgIGkgKys7XG4gICAgICAgICAgICAgICAgaWYoaSA+IHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCAtIDEpIGkgPSAwO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd19sYW5nKGkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyZWF0ZSA6IGZ1bmN0aW9uICh0eXBlLCBvYmosIGRhdGEsIGljb24sIGlkICkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAvLyBOT1RISU5HIFNFTEVDVEVEXG4gICAgICAgICAgICAgICAgb2JqID0gb2JqID8gdGhpcy5nZXRfbm9kZShvYmopIDogdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBpZighb2JqIHx8ICFvYmouc2l6ZSgpKSByZXR1cm4gdGhpcy5lcnJvcihcIkNSRUFURTogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5jaGVjayhcImNyZWF0YWJsZVwiLCBvYmopKSByZXR1cm4gdGhpcy5lcnJvcihcIkNSRUFURTogQ0FOTk9UIENSRUFURSBJTiBOT0RFXCIpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHQgPSB0eXBlIHx8IHRoaXMuZ2V0X3R5cGUob2JqKSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMudXNlX2lubGluZSAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICQubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBvYmoubWV0YWRhdGEoKVtcInZhbGlkX2NoaWxkcmVuXCJdICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQuaW5BcnJheSh0LCBvYmoubWV0YWRhdGEoKVtcInZhbGlkX2NoaWxkcmVuXCJdKSA9PSAtMSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE5PREUgTk9UIEEgVkFMSUQgQ0hJTERcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIG9iai5tZXRhZGF0YSgpW1wibWF4X2NoaWxkcmVuXCJdICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCAob2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaVwiKS5zaXplKCkgKyAxKSA+IG9iai5tZXRhZGF0YSgpLm1heF9jaGlsZHJlbikgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE1BWF9DSElMRFJFTiBSRUFDSEVEXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIG9iai5wYXJlbnRzKFwibGlcIikuZWFjaChmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkKHRoaXMpLm1ldGFkYXRhKCkubWF4X2RlcHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIChpICsgMSkgPj0gJCh0aGlzKS5tZXRhZGF0YSgpLm1heF9kZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvayA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFvaykgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE1BWF9ERVBUSCBSRUFDSEVEXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJjbG9zZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub3Blbl9icmFuY2gob2JqLCB0cnVlLCBmdW5jdGlvbiAoKSB7IF90aGlzLmNyZWF0ZS5hcHBseShfdGhpcywgW3R5cGUsIG9iaiwgZGF0YSwgaWNvbiwgaWRdKTsgfSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKGlkKSAgICAkbGkgPSAkKFwiPGxpIGlkPSdcIiArIGlkICsgXCInIC8+XCIpO1xuICAgICAgICAgICAgICAgIGVsc2UgICAgJGxpID0gJChcIjxsaSAvPlwiKTtcbiAgICAgICAgICAgICAgICAvLyBORVcgTk9ERSBJUyBPRiBQQVNTRUQgVFlQRSBPUiBQQVJFTlQnUyBUWVBFXG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAkLm1ldGFkYXRhLnNldFR5cGUoXCJhdHRyXCIsIHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAkbGkuYXR0cih0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhLCBcInR5cGU6ICdcIiArIHQgKyBcIidcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkbGkuYXR0cih0aGlzLnNldHRpbmdzLnJ1bGVzLnR5cGVfYXR0ciwgdClcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgaWNuID0gXCJcIjtcbiAgICAgICAgICAgICAgICBpZigodHlwZW9mIGljb24pLnRvTG93ZXJDYXNlKCkgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgICAgICBpY24gPSBpY29uO1xuICAgICAgICAgICAgICAgICAgICBpY24gPSBpY24uaW5kZXhPZihcIi9cIikgPT0gLTEgPyB0aGlzLnRoZW1lICsgaWNuIDogaWNuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgZGF0YSkudG9Mb3dlckNhc2UoKSA9PSBcInN0cmluZ1wiKSB2YWwgPSBkYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihkYXRhICYmIGRhdGFbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBkYXRhW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNldHRpbmdzLmxhbmcubmV3X25vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIHRoaXMuc2V0dGluZ3MubGFuZy5uZXdfbm9kZSkudG9Mb3dlckNhc2UoKSAhPSBcInN0cmluZ1wiICYmIHRoaXMuc2V0dGluZ3MubGFuZy5uZXdfbm9kZVtpXSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gdGhpcy5zZXR0aW5ncy5sYW5nLm5ld19ub2RlW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gdGhpcy5zZXR0aW5ncy5sYW5nLm5ld19ub2RlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gXCJOZXcgZm9sZGVyXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIGljb24pLnRvTG93ZXJDYXNlKCkgIT0gXCJzdHJpbmdcIiAmJiBpY29uICYmIGljb25baV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY24gPSBpY29uW2ldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljbiA9IGljbi5pbmRleE9mKFwiL1wiKSA9PSAtMSA/IHRoaXMudGhlbWUgKyBpY24gOiBpY247XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAkbGkuYXBwZW5kKFwiPGEgaHJlZj0nIydcIiArICggaWNuLmxlbmd0aCA/IFwiIHN0eWxlPSdiYWNrZ3JvdW5kLWltYWdlOnVybChcXFwiXCIgKyBpY24gKyBcIlxcXCIpOycgXCIgOiBcIiBcIikgKyBcImNsYXNzPSdcIiArIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldICsgXCInPlwiICsgdmFsICsgXCI8L2E+XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgeyAkbGkuYXBwZW5kKFwiPGEgaHJlZj0nIydcIiArICggaWNuLmxlbmd0aCA/IFwiIHN0eWxlPSdiYWNrZ3JvdW5kLWltYWdlOnVybChcXFwiXCIgKyBpY24gKyBcIlxcXCIpOycgXCIgOiBcIiBcIikgKyBcIj5cIiArIChkYXRhIHx8IHRoaXMuc2V0dGluZ3MubGFuZy5uZXdfbm9kZSB8fCBcIk5ldyBmb2xkZXJcIikgKyBcIjwvYT5cIik7IH1cbiAgICAgICAgICAgICAgICAkbGkuYWRkQ2xhc3MoXCJsZWFmXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMuY3JlYXRlYXQgPT0gXCJ0b3BcIiB8fCBvYmouY2hpbGRyZW4oXCJ1bFwiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVkKCRsaSxvYmouY2hpbGRyZW4oXCJhOmVxKDApXCIpLFwiaW5zaWRlXCIsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCgkbGksb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaTpsYXN0XCIpLmNoaWxkcmVuKFwiYTplcSgwKVwiKSxcImFmdGVyXCIsdHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0X2JyYW5jaCgkbGkuY2hpbGRyZW4oXCJhOmVxKDApXCIpKTtcbiAgICAgICAgICAgICAgICBpZighZGF0YSkgdGhpcy5yZW5hbWUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGxpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlbmFtZSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5jaGVjayhcInJlbmFtZWFibGVcIiwgdGhpcy5zZWxlY3RlZCkpIHJldHVybiB0aGlzLmVycm9yKFwiUkVOQU1FOiBOT0RFIE5PVCBSRU5BTUFCTEVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZXJlbmFtZS5jYWxsKG51bGwsdGhpcy5zZWxlY3RlZC5nZXQoMCksIF90aGlzLmN1cnJlbnRfbGFuZywgX3RoaXMpKSByZXR1cm4gdGhpcy5lcnJvcihcIlJFTkFNRTogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jdXJyZW50X2xhbmcpICAgIG9iaiA9IG9iai5maW5kKFwiYS5cIiArIHRoaXMuY3VycmVudF9sYW5nKS5nZXQoMCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgIG9iaiA9IG9iai5maW5kKFwiYTpmaXJzdFwiKS5nZXQoMCk7XG4gICAgICAgICAgICAgICAgICAgIGxhc3RfdmFsdWUgPSBvYmouaW5uZXJIVE1MO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnAgPSAkKFwiPGlucHV0IHR5cGU9J3RleHQnIC8+XCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnBcbiAgICAgICAgICAgICAgICAgICAgICAgIC52YWwobGFzdF92YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcmRvd25cIiwgICAgICAgIGZ1bmN0aW9uIChldmVudCkgeyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcnVwXCIsICAgICAgICBmdW5jdGlvbiAoZXZlbnQpIHsgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuYmluZChcImNsaWNrXCIsICAgICAgICAgICAgZnVuY3Rpb24gKGV2ZW50KSB7IGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJrZXl1cFwiLCAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5ID09IDI3KSB7IHRoaXMudmFsdWUgPSBsYXN0X3ZhbHVlOyB0aGlzLmJsdXIoKTsgcmV0dXJuIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5ID09IDEzKSB7IHRoaXMuYmx1cigpOyByZXR1cm4gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnAuYmx1cihmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudmFsdWUgPT0gXCJcIikgdGhpcy52YWx1ZSA9PSBsYXN0X3ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQob2JqKS5odG1sKCAkKG9iaikucGFyZW50KCkuZmluZChcImlucHV0XCIpLmVxKDApLmF0dHIoXCJ2YWx1ZVwiKSApLmdldCgwKS5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKG9iaikucHJldkFsbChcInNwYW5cIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52YWx1ZSAhPSBsYXN0X3ZhbHVlKSBfdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbnJlbmFtZS5jYWxsKG51bGwsIF90aGlzLmdldF9ub2RlKG9iaikuZ2V0KDApLCBfdGhpcy5jdXJyZW50X2xhbmcsIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3BuID0gJChcIjxzcGFuIC8+XCIpLmFkZENsYXNzKG9iai5jbGFzc05hbWUpLmFwcGVuZChfdGhpcy5pbnApO1xuICAgICAgICAgICAgICAgICAgICBzcG4uYXR0cihcInN0eWxlXCIsICQob2JqKS5hdHRyKFwic3R5bGVcIikpO1xuICAgICAgICAgICAgICAgICAgICBvYmouc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICAkKG9iaikucGFyZW50KCkucHJlcGVuZChzcG4pO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5pbnAuZ2V0KDApLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmlucC5nZXQoMCkuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuZXJyb3IoXCJSRU5BTUU6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8gUkVNT1ZFIE5PREVTXG4gICAgICAgICAgICByZW1vdmUgOiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLnNpemUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJkZWxldGFibGVcIiwgb2JqKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJERUxFVEU6IE5PREUgTk9UIERFTEVUQUJMRVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZWRlbGV0ZS5jYWxsKG51bGwsb2JqLmdldCgwKSwgX3RoaXMpKSByZXR1cm4gdGhpcy5lcnJvcihcIkRFTEVURTogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHBhcmVudCA9IG9iai5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iaiA9IG9iai5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRwYXJlbnQuY2hpbGRyZW4oXCJsaTpsYXN0XCIpLmFkZENsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRwYXJlbnQuY2hpbGRyZW4oXCJsaVwiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaSA9ICRwYXJlbnQucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaS5yZW1vdmVDbGFzcyhcIm9wZW5cIikucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJsZWFmXCIpLmNoaWxkcmVuKFwidWxcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25kZWxldGUuY2FsbChudWxsLCBvYmosIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYodGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5jaGVjayhcImRlbGV0YWJsZVwiLCB0aGlzLnNlbGVjdGVkKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJERUxFVEU6IE5PREUgTk9UIERFTEVUQUJMRVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlZGVsZXRlLmNhbGwobnVsbCx0aGlzLnNlbGVjdGVkLmdldCgwKSwgX3RoaXMpKSByZXR1cm4gdGhpcy5lcnJvcihcIkRFTEVURTogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgICAgICAgICAkcGFyZW50ID0gdGhpcy5zZWxlY3RlZC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgPT0gZmFsc2UgfHwgdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdG9wID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSAodGhpcy5zZWxlY3RlZC5wcmV2KFwibGk6ZXEoMClcIikuc2l6ZSgpKSA/IHRoaXMuc2VsZWN0ZWQucHJldihcImxpOmVxKDApXCIpIDogdGhpcy5zZWxlY3RlZC5wYXJlbnRzKFwibGk6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmdldF9wcmV2KHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IG9iai5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgJHBhcmVudC5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZigkcGFyZW50LmNoaWxkcmVuKFwibGlcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsaSA9ICRwYXJlbnQucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxpLnJlbW92ZUNsYXNzKFwib3BlblwiKS5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy90aGlzLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25kZWxldGUuY2FsbChudWxsLCBvYmosIHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBpZihzdG9wICYmIHRtcCkgdGhpcy5zZWxlY3RfYnJhbmNoKHRtcCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgIXN0b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkX2FyciA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImEuY2xpY2tlZFwiKS5maWx0ZXIoXCI6Zmlyc3QtY2hpbGRcIikucGFyZW50KCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VsZWN0ZWRfYXJyLnB1c2goJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWRfYXJyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZF9hcnJbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHJldHVybiB0aGlzLmVycm9yKFwiREVMRVRFOiBOTyBOT0RFIFNFTEVDVEVEXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIEZPUiBFWFBMT1JFUi1MSUtFIEtFWUJPQVJEIFNIT1JUQ1VUU1xuICAgICAgICAgICAgZ2V0X25leHQgOiBmdW5jdGlvbihmb3JjZSkge1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmhvdmVyZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwib3BlblwiKSkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqLmZpbmQoXCJsaTplcSgwKVwiKSkgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmouZmluZChcImxpOmVxKDApXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZigkKG9iaikubmV4dEFsbChcImxpXCIpLnNpemUoKSA+IDApICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoubmV4dEFsbChcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5uZXh0QWxsKFwibGk6ZXEoMClcIikpO1xuICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqLnBhcmVudHMoXCJsaVwiKS5uZXh0KFwibGlcIikuZXEoMCkpIDogdGhpcy5ob3Zlcl9icmFuY2gob2JqLnBhcmVudHMoXCJsaVwiKS5uZXh0KFwibGlcIikuZXEoMCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZXRfcHJldiA6IGZ1bmN0aW9uKGZvcmNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuaG92ZXJlZCB8fCB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgICAgICBpZihvYmoucHJldihcImxpXCIpLnNpemUoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IG9iai5wcmV2KFwibGlcIikuZXEoMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZShvYmouaGFzQ2xhc3MoXCJvcGVuXCIpKSBvYmogPSBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpOmxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iaik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7IHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoucGFyZW50cyhcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5wYXJlbnRzKFwibGk6ZXEoMClcIikpOyB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldF9sZWZ0IDogZnVuY3Rpb24oZm9yY2UsIHJ0bCkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkucnRsICYmICFydGwpIHJldHVybiB0aGlzLmdldF9yaWdodChmb3JjZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuaG92ZXJlZCB8fCB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJvcGVuXCIpKSAgICB0aGlzLmNsb3NlX2JyYW5jaChvYmopO1xuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoucGFyZW50cyhcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5wYXJlbnRzKFwibGk6ZXEoMClcIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldF9yaWdodCA6IGZ1bmN0aW9uKGZvcmNlLCBydGwpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLnJ0bCAmJiAhcnRsKSByZXR1cm4gdGhpcy5nZXRfbGVmdChmb3JjZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuaG92ZXJlZCB8fCB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJjbG9zZWRcIikpICAgIHRoaXMub3Blbl9icmFuY2gob2JqKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZm9yY2UgPyB0aGlzLnNlbGVjdF9icmFuY2gob2JqLmZpbmQoXCJsaTplcSgwKVwiKSkgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmouZmluZChcImxpOmVxKDApXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b2dnbGVEb3RzIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnRvZ2dsZUNsYXNzKFwibm9fZG90c1wiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXRfY29va2llIDogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmNvb2tpZXMgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLypjYXNlIFwic2VsZWN0ZWRcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSBBcnJheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5lYWNoKHRoaXMuc2VsZWN0ZWRfYXJyLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5wdXNoKHRoaXMuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSB2YWwuam9pbihcIixcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHZhciB2YWwgPSB0aGlzLnNlbGVjdGVkID8gdGhpcy5zZWxlY3RlZC5hdHRyKFwiaWRcIikgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeS5jb29raWUodGhpcy5zZXR0aW5ncy5jb29raWVzLnByZWZpeCArICdfc2VsZWN0ZWQnLHZhbCx0aGlzLnNldHRpbmdzLmNvb2tpZXMub3B0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsqL1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwib3BlblwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGkub3BlblwiKS5lYWNoKGZ1bmN0aW9uIChpKSB7IHN0ciArPSB0aGlzLmlkICsgXCIsXCI7IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5jb29raWUodGhpcy5zZXR0aW5ncy5jb29raWVzLnByZWZpeCArICdfb3Blbicsc3RyLnJlcGxhY2UoLywkL2lnLFwiXCIpLHRoaXMuc2V0dGluZ3MuY29va2llcy5vcHRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtb3ZlZCA6IGZ1bmN0aW9uICh3aGF0LCB3aGVyZSwgaG93LCBpc19uZXcsIGlzX2NvcHkpIHtcbiAgICAgICAgICAgICAgICB2YXIgd2hhdCAgICA9ICQod2hhdCk7XG4gICAgICAgICAgICAgICAgdmFyICRwYXJlbnQgICAgPSAkKHdoYXQpLnBhcmVudHMoXCJ1bDplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICB2YXIgJHdoZXJlICAgID0gJCh3aGVyZSk7XG4gICAgICAgICAgICAgICAgLy8gSUYgTVVMVElQTEVcbiAgICAgICAgICAgICAgICBpZih3aGF0LnNpemUoKSA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IHRoaXMubW92ZWQod2hhdC5lcSgwKSx3aGVyZSxob3csIGZhbHNlLCBpc19jb3B5KTtcbiAgICAgICAgICAgICAgICAgICAgd2hhdC5lYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpID09IDApIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcCA9IF90aGlzLm1vdmVkKHRoaXMsIHRtcC5jaGlsZHJlbihcImE6ZXEoMClcIiksIFwiYWZ0ZXJcIiwgZmFsc2UsIGlzX2NvcHkpO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKGlzX2NvcHkpIHtcbiAgICAgICAgICAgICAgICAgICAgd2hhdCA9IHdoYXQuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgd2hhdC5lYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gdGhpcy5pZCArIFwiX2NvcHlcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcImxpXCIpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaWQgPSB0aGlzLmlkICsgXCJfY29weVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcImEuY2xpY2tlZFwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihpc19uZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlY3JlYXRlLmNhbGwobnVsbCx0aGlzLmdldF9ub2RlKHdoYXQpLmdldCgwKSwgdGhpcy5nZXRfbm9kZSh3aGVyZSkuZ2V0KDApLGhvdyx0aGlzKSkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlbW92ZS5jYWxsKG51bGwsdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSxob3csdGhpcykpIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZighaXNfbmV3KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSAkKHdoYXQpLnBhcmVudHMoXCIudHJlZTplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgZGlmZmVyZW50IHRyZWVzXG4gICAgICAgICAgICAgICAgICAgIGlmKHRtcC5nZXQoMCkgIT0gdGhpcy5jb250YWluZXIuZ2V0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSB0cmVlX2NvbXBvbmVudC5pbnN0W3RtcC5hdHRyKFwiaWRcIildO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgYXJlIGxhbmd1YWdlcyAtIG90aGVyd2lzZSAtIG5vIGNsZWFudXAgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0bXAuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBuZXcgdHJlZSBoYXMgbm8gbGFuZ3VhZ2VzIC0gdXNlIGN1cnJlbnQgdmlzaWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCA9PSAwKSByZXMucHVzaChcIi5cIiArIHRtcC5jdXJyZW50X2xhbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gdG1wLnNldHRpbmdzLmxhbmd1YWdlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldID09IHRtcC5zZXR0aW5ncy5sYW5ndWFnZXNbal0pIHJlcy5wdXNoKFwiLlwiICsgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlcy5sZW5ndGggPT0gMCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJNT1ZFOiBOTyBDT01NT04gTEFOR1VBR0VTXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoYXQuZmluZChcImFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpLm5vdChyZXMuam9pbihcIixcIikpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQUREIE5PREUgVE8gTkVXIFBMQUNFXG4gICAgICAgICAgICAgICAgc3dpdGNoKGhvdykge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiYmVmb3JlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGkubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmJlZm9yZSh3aGF0LnJlbW92ZUNsYXNzKFwibGFzdFwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFmdGVyXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGkubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmFmdGVyKHdoYXQucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR3aGVyZS5wYXJlbnRzKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaTpsYXN0XCIpLmFkZENsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiaW5zaWRlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXRfbm9kZSgkd2hlcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcImNsb3NlZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuX2JyYW5jaChvYmosIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMubW92ZWQuYXBwbHkoX3RoaXMsIFt3aGF0LCB3aGVyZSwgaG93LCBpc19uZXcsIGlzX2NvcHldKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmNoaWxkcmVuKFwidWw6Zmlyc3RcIikuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5jcmVhdGVhdCA9PSBcInRvcFwiKSAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmNoaWxkcmVuKFwidWw6Zmlyc3RcIikucHJlcGVuZCh3aGF0LnJlbW92ZUNsYXNzKFwibGFzdFwiKSkuY2hpbGRyZW4oXCJsaTpsYXN0XCIpLmFkZENsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3aGVyZS5wYXJlbnRzKFwibGk6ZXEoMClcIikuY2hpbGRyZW4oXCJ1bDpmaXJzdFwiKS5jaGlsZHJlbihcIi5sYXN0XCIpLnJlbW92ZUNsYXNzKFwibGFzdFwiKS5lbmQoKS5hcHBlbmQod2hhdC5yZW1vdmVDbGFzcyhcImxhc3RcIikpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGF0LmFkZENsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmFwcGVuZChcIjx1bC8+XCIpLnJlbW92ZUNsYXNzKFwibGVhZlwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmNoaWxkcmVuKFwidWw6Zmlyc3RcIikucHJlcGVuZCh3aGF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5fYnJhbmNoKCR3aGVyZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBDTEVBTlVQIE9MRCBQQVJFTlRcbiAgICAgICAgICAgICAgICBpZigkcGFyZW50LmZpbmQoXCJsaVwiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgJGxpID0gJHBhcmVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgJGxpLnJlbW92ZUNsYXNzKFwib3BlblwiKS5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgJGxpLnBhcmVudHMoXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpLmxhc3RcIikucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpLmVuZCgpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkcGFyZW50LmNoaWxkcmVuKFwibGkubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICRwYXJlbnQuY2hpbGRyZW4oXCJsaTpsYXN0XCIpLmFkZENsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoaXNfbmV3ICYmIGhvdyAhPSBcImluc2lkZVwiKSB3aGVyZSA9IHRoaXMuZ2V0X25vZGUod2hlcmUpLnBhcmVudHMoXCJsaTplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICBpZihpc19jb3B5KSAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmNvcHkuY2FsbChudWxsLCB0aGlzLmdldF9ub2RlKHdoYXQpLmdldCgwKSwgdGhpcy5nZXRfbm9kZSh3aGVyZSkuZ2V0KDApLCBob3csIHRoaXMpXG4gICAgICAgICAgICAgICAgZWxzZSBpZihpc19uZXcpICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25jcmVhdGUuY2FsbChudWxsLCB0aGlzLmdldF9ub2RlKHdoYXQpLmdldCgwKSwgdGhpcy5nZXRfbm9kZSh3aGVyZSkuZ2V0KDApLCB0aGlzLnNldHRpbmdzLmluc2VydEF0LCB0aGlzKTtcbiAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbm1vdmUuY2FsbChudWxsLCB0aGlzLmdldF9ub2RlKHdoYXQpLmdldCgwKSwgdGhpcy5nZXRfbm9kZSh3aGVyZSkuZ2V0KDApLCBob3csIHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB3aGF0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yIDogZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmVycm9yLmNhbGwobnVsbCxjb2RlLHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2NrIDogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2NrZWQgPSBzdGF0ZTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgICAgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoXCJsb2NrZWRcIik7XG4gICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNsYXNzKFwibG9ja2VkXCIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGN1dCA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWQpIHJldHVybiB0aGlzLmVycm9yKFwiQ1VUOiBOTyBOT0RFIFNFTEVDVEVEXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29weV9ub2RlcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuY3V0X25vZGVzID0gdGhpcy5jb250YWluZXIuZmluZChcImEuY2xpY2tlZFwiKS5maWx0ZXIoXCI6Zmlyc3QtY2hpbGRcIikucGFyZW50KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29weSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWQpIHJldHVybiB0aGlzLmVycm9yKFwiQ09QWTogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvcHlfbm9kZXMgPSB0aGlzLmNvbnRhaW5lci5maW5kKFwiYS5jbGlja2VkXCIpLmZpbHRlcihcIjpmaXJzdC1jaGlsZFwiKS5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1dF9ub2RlcyA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhc3RlIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5zZWxlY3RlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJQQVNURTogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5jb3B5X25vZGVzICYmICF0aGlzLmN1dF9ub2RlcykgcmV0dXJuIHRoaXMuZXJyb3IoXCJQQVNURTogTk9USElORyBUTyBET1wiKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLmNvcHlfbm9kZXMgJiYgdGhpcy5jb3B5X25vZGVzLnNpemUoKSkge1xuICAgICAgICAgICAgICAgICAgICBpZighdGhpcy5jaGVja01vdmUodGhpcy5jb3B5X25vZGVzLCB0aGlzLnNlbGVjdGVkLmNoaWxkcmVuKFwiYTplcSgwKVwiKSwgXCJpbnNpZGVcIikpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCh0aGlzLmNvcHlfbm9kZXMsIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJhOmVxKDApXCIpLCBcImluc2lkZVwiLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29weV9ub2RlcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLmN1dF9ub2RlcyAmJiB0aGlzLmN1dF9ub2Rlcy5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2tNb3ZlKHRoaXMuY3V0X25vZGVzLCB0aGlzLnNlbGVjdGVkLmNoaWxkcmVuKFwiYTplcSgwKVwiKSwgXCJpbnNpZGVcIikpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCh0aGlzLmN1dF9ub2RlcywgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcImE6ZXEoMClcIiksIFwiaW5zaWRlXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1dF9ub2RlcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWFyY2ggOiBmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgICAgIGlmKCFzdHIgfHwgKHRoaXMuc3JjaCAmJiBzdHIgIT0gdGhpcy5zcmNoKSApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcmNoID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zcmNoX29wbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwiYS5zZWFyY2hcIikucmVtb3ZlQ2xhc3MoXCJzZWFyY2hcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc3JjaCA9IHN0cjtcbiAgICAgICAgICAgICAgICBpZighc3RyKSByZXR1cm47XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNyY2hfb3BuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGQgPSAkLmV4dGVuZCggeyBcInNlYXJjaFwiIDogc3RyIH0gLCB0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmNfZGF0YShmYWxzZSkgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEubWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCAgICAgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLnVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhICAgICAgICA6IGRkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlICAgIDogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyAgICAgICAgOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zcmNoX29wbiA9ICQudW5pcXVlKGRhdGEuc3BsaXQoXCIsXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoLmFwcGx5KF90aGlzLFtzdHJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKHRoaXMuc3JjaF9vcG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNyY2hfb3BuICYmIHRoaXMuc3JjaF9vcG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9wbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCB0aGlzLnNyY2hfb3BuLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2V0X25vZGUoXCIjXCIgKyB0aGlzLnNyY2hfb3BuW2pdKS5zaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcG4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IFwiI1wiICsgdGhpcy5zcmNoX29wbltqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNyY2hfb3BuW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuX2JyYW5jaCh0bXAsIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMuc2VhcmNoLmFwcGx5KF90aGlzLFtzdHJdKTsgfSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvcG4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zcmNoX29wbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoLmFwcGx5KF90aGlzLFtzdHJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0b3IgPSBcImFcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElGIExBTkdVQUdFIFZFUlNJT05TXG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHNlbGVjdG9yICs9IFwiLlwiICsgdGhpcy5jdXJyZW50X2xhbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKHNlbGVjdG9yICsgXCI6Y29udGFpbnMoJ1wiICsgc3RyICsgXCInKVwiKS5hZGRDbGFzcyhcInNlYXJjaFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3JjaF9vcG4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gXCJhXCI7XG4gICAgICAgICAgICAgICAgICAgIC8vIElGIExBTkdVQUdFIFZFUlNJT05TXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkgc2VsZWN0b3IgKz0gXCIuXCIgKyB0aGlzLmN1cnJlbnRfbGFuZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChzZWxlY3RvciArIFwiOmNvbnRhaW5zKCdcIiArIHN0ciArIFwiJylcIikuYWRkQ2xhc3MoXCJzZWFyY2hcIikucGFyZW50cyhcImxpLmNsb3NlZFwiKS5lYWNoKCBmdW5jdGlvbiAoKSB7IF90aGlzLm9wZW5fYnJhbmNoKHRoaXMsIHRydWUpOyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBkZXN0cm95IDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV2dHMgPSBbXCJjbGlja1wiLFwiZGJsY2xpY2tcIixcImNvbnRleHRtZW51XCIsXCJwb2ludGVyb3ZlclwiLFwicG9pbnRlcmRvd25cIl07XG4gICAgICAgICAgICAgICAgICAgIGZvcihpIGluIGV2dHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHhlciA9IHRoaXMuY29udGFpbmVyLmluZGV4ZXIoZXZ0c1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZHhlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLnJlbW92ZURhdGEoIGlkeGVyLmxpc3RlbmVyLCBpZHhlci5ldmVudCArICcuaW5kZXhlcicgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2goZXJyKSB7IH1cbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci51bmJpbmQoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNsYXNzKFwidHJlZVwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZUNsYXNzKFwidHJlZS1cIiArIHRoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZSkuZmluZChcImxpXCIpLnJlbW92ZUNsYXNzKFwibGVhZlwiKS5yZW1vdmVDbGFzcyhcIm9wZW5cIikucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG5cbiAgICAgICAgICAgICAgICBpZih0aGlzLmNudHIgPT0gdHJlZV9jb21wb25lbnQuZm9jdXNlZCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiB0cmVlX2NvbXBvbmVudC5pbnN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpICE9IHRoaXMuY250ciAmJiBpICE9IHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWVfY29tcG9uZW50Lmluc3RbaV0uZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWxldGUgdHJlZV9jb21wb25lbnQuaW5zdFt0aGlzLmNudHJdO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSB0cmVlX2NvbXBvbmVudC5pbnN0W3RoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKV07XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuY250ciAtLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59KENNUy4kKSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=