/*! jQuery UI - v1.10.3 - 2013-12-06
* http://jqueryui.com
* Includes: 
* jquery.ui.core.js, 
* jquery.ui.widget.js, 
* jquery.ui.mouse.js, 
* jquery.ui.draggable.js, 
* jquery.ui.droppable.js, 
* jquery.ui.sortable.js, 
* jquery.ui.effect.js, 
* jquery.ui.effect-highlight.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */

(function(e,t){function i(t,i){var s,n,r,o=t.nodeName.toLowerCase();return"area"===o?(s=t.parentNode,n=s.name,t.href&&n&&"map"===s.nodeName.toLowerCase()?(r=e("img[usemap=#"+n+"]")[0],!!r&&a(r)):!1):(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||i:i)&&a(t)}function a(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var s=0,n=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,a){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),a&&a.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var a,s,n=e(this[0]);n.length&&n[0]!==document;){if(a=n.css("position"),("absolute"===a||"relative"===a||"fixed"===a)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){n.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,a){return!!e.data(t,a[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var a=e.attr(t,"tabindex"),s=isNaN(a);return(s||a>=0)&&i(t,!s)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,a){function s(t,i,a,s){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,a&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===a?["Left","Right"]:["Top","Bottom"],r=a.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+a]=function(i){return i===t?o["inner"+a].call(this):this.each(function(){e(this).css(r,s(this,i)+"px")})},e.fn["outer"+a]=function(t,i){return"number"!=typeof t?o["outer"+a].call(this,t):this.each(function(){e(this).css(r,s(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,a){var s,n=e.ui[t].prototype;for(s in a)n.plugins[s]=n.plugins[s]||[],n.plugins[s].push([i,a[s]])},call:function(e,t,i){var a,s=e.plugins[t];if(s&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(a=0;s.length>a;a++)e.options[s[a][0]]&&s[a][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var a=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return t[a]>0?!0:(t[a]=1,s=t[a]>0,t[a]=0,s)}})})(jQuery);(function(e,t){var i=0,s=Array.prototype.slice,a=e.cleanData;e.cleanData=function(t){for(var i,s=0;null!=(i=t[s]);s++)try{e(i).triggerHandler("remove")}catch(n){}a(t)},e.widget=function(i,s,a){var n,r,o,h,l={},u=i.split(".")[0];i=i.split(".")[1],n=u+"-"+i,a||(a=s,s=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[u]=e[u]||{},r=e[u][i],o=e[u][i]=function(e,i){return this._createWidget?(arguments.length&&this._createWidget(e,i),t):new o(e,i)},e.extend(o,r,{version:a.version,_proto:e.extend({},a),_childConstructors:[]}),h=new s,h.options=e.widget.extend({},h.options),e.each(a,function(i,a){return e.isFunction(a)?(l[i]=function(){var e=function(){return s.prototype[i].apply(this,arguments)},t=function(e){return s.prototype[i].apply(this,e)};return function(){var i,s=this._super,n=this._superApply;return this._super=e,this._superApply=t,i=a.apply(this,arguments),this._super=s,this._superApply=n,i}}(),t):(l[i]=a,t)}),o.prototype=e.widget.extend(h,{widgetEventPrefix:r?h.widgetEventPrefix:i},l,{constructor:o,namespace:u,widgetName:i,widgetFullName:n}),r?(e.each(r._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete r._childConstructors):s._childConstructors.push(o),e.widget.bridge(i,o)},e.widget.extend=function(i){for(var a,n,r=s.call(arguments,1),o=0,h=r.length;h>o;o++)for(a in r[o])n=r[o][a],r[o].hasOwnProperty(a)&&n!==t&&(i[a]=e.isPlainObject(n)?e.isPlainObject(i[a])?e.widget.extend({},i[a],n):e.widget.extend({},n):n);return i},e.widget.bridge=function(i,a){var n=a.prototype.widgetFullName||i;e.fn[i]=function(r){var o="string"==typeof r,h=s.call(arguments,1),l=this;return r=!o&&h.length?e.widget.extend.apply(null,[r].concat(h)):r,o?this.each(function(){var s,a=e.data(this,n);return a?e.isFunction(a[r])&&"_"!==r.charAt(0)?(s=a[r].apply(a,h),s!==a&&s!==t?(l=s&&s.jquery?l.pushStack(s.get()):s,!1):t):e.error("no such method '"+r+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+r+"'")}):this.each(function(){var t=e.data(this,n);t?t.option(r||{})._init():e.data(this,n,new a(r,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,s){s=e(s||this.defaultElement||this)[0],this.element=e(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),s!==this&&(e.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===s&&this.destroy()}}),this.document=e(s.style?s.ownerDocument:s.document||s),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,s){var a,n,r,o=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(o={},a=i.split("."),i=a.shift(),a.length){for(n=o[i]=e.widget.extend({},this.options[i]),r=0;a.length-1>r;r++)n[a[r]]=n[a[r]]||{},n=n[a[r]];if(i=a.pop(),s===t)return n[i]===t?null:n[i];n[i]=s}else{if(s===t)return this.options[i]===t?null:this.options[i];o[i]=s}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,s,a){var n,r=this;"boolean"!=typeof i&&(a=s,s=i,i=!1),a?(s=n=e(s),this.bindings=this.bindings.add(s)):(a=s,s=this.element,n=this.widget()),e.each(a,function(a,o){function h(){return i||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):t}"string"!=typeof o&&(h.guid=o.guid=o.guid||h.guid||e.guid++);var l=a.match(/^(\w+)\s*(.*)$/),u=l[1]+r.eventNamespace,c=l[2];c?n.delegate(c,u,h):s.bind(u,h)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var a,n,r=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(a in n)a in i||(i[a]=n[a]);return this.element.trigger(i,s),!(e.isFunction(r)&&r.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,a,n){"string"==typeof a&&(a={effect:a});var r,o=a?a===!0||"number"==typeof a?i:a.effect||i:t;a=a||{},"number"==typeof a&&(a={duration:a}),r=!e.isEmptyObject(a),a.complete=n,a.delay&&s.delay(a.delay),r&&e.effects&&e.effects.effect[o]?s[t](a):o!==t&&s[o]?s[o](a.duration,a.easing,n):s.queue(function(i){e(this)[t](),n&&n.call(s[0]),i()})}})})(jQuery);(function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,a=1===i.which,n="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return a&&!n&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return s._mouseMove(e)},this._mouseUpDelegate=function(e){return s._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);(function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var a=this._uiHash();if(this._trigger("drag",t,a)===!1)return this._mouseUp({}),!1;this.position=a.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,a=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(a=e.ui.ddmanager.drop(this,t)),this.dropped&&(a=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!a||"valid"===this.options.revert&&a||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,a)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var i=this.options,a=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return a.parents("body").length||a.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),a[0]===this.element[0]||/(fixed|absolute)/.test(a.css("position"))||a.css("position","absolute"),a},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,a,s=this.options;return s.containment?"window"===s.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===s.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):s.containment.constructor===Array?(this.containment=s.containment,undefined):("parent"===s.containment&&(s.containment=this.helper[0].parentNode),i=e(s.containment),a=i[0],a&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(a.scrollWidth,a.offsetWidth):a.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(a.scrollHeight,a.offsetHeight):a.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),undefined):(this.containment=null,undefined)},_convertPositionTo:function(t,i){i||(i=this.position);var a="absolute"===t?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),{top:i.top+this.offset.relative.top*a+this.offset.parent.top*a-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*a,left:i.left+this.offset.relative.left*a+this.offset.parent.left*a-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*a}},_generatePosition:function(t){var i,a,s,n,r=this.options,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,h=t.pageY;return this.offset.scroll||(this.offset.scroll={top:o.scrollTop(),left:o.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(a=this.relative_container.offset(),i=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),r.grid&&(s=r.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,h=i?s-this.offset.click.top>=i[1]||s-this.offset.click.top>i[3]?s:s-this.offset.click.top>=i[1]?s-r.grid[1]:s+r.grid[1]:s,n=r.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,l=i?n-this.offset.click.left>=i[0]||n-this.offset.click.left>i[2]?n:n-this.offset.click.left>=i[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,a){return a=a||this._uiHash(),e.ui.plugin.call(this,t,[i,a]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,a)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var a=e(this).data("ui-draggable"),s=a.options,n=e.extend({},i,{item:a.element});a.sortables=[],e(s.connectToSortable).each(function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(a.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i){var a=e(this).data("ui-draggable"),s=e.extend({},i,{item:a.element});e.each(a.sortables,function(){this.instance.isOver?(this.instance.isOver=0,a.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===a.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,s))})},drag:function(t,i){var a=e(this).data("ui-draggable"),s=this;e.each(a.sortables,function(){var n=!1,r=this;this.instance.positionAbs=a.positionAbs,this.instance.helperProportions=a.helperProportions,this.instance.offset.click=a.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(n=!0,e.each(a.sortables,function(){return this.instance.positionAbs=a.positionAbs,this.instance.helperProportions=a.helperProportions,this.instance.offset.click=a.offset.click,this!==r&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(r.instance.element[0],this.instance.element[0])&&(n=!1),n})),n?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=a.offset.click.top,this.instance.offset.click.left=a.offset.click.left,this.instance.offset.parent.left-=a.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=a.offset.parent.top-this.instance.offset.parent.top,a._trigger("toSortable",t),a.dropped=this.instance.element,a.currentItem=a.element,this.instance.fromOutside=a),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),a._trigger("fromSortable",t),a.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var a=e(i.helper),s=e(this).data("ui-draggable").options;a.css("opacity")&&(s._opacity=a.css("opacity")),a.css("opacity",s.opacity)},stop:function(t,i){var a=e(this).data("ui-draggable").options;a._opacity&&e(i.helper).css("opacity",a._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),a=i.options,s=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(a.axis&&"x"===a.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<a.scrollSensitivity?i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop+a.scrollSpeed:t.pageY-i.overflowOffset.top<a.scrollSensitivity&&(i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop-a.scrollSpeed)),a.axis&&"y"===a.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<a.scrollSensitivity?i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft+a.scrollSpeed:t.pageX-i.overflowOffset.left<a.scrollSensitivity&&(i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft-a.scrollSpeed))):(a.axis&&"x"===a.axis||(t.pageY-e(document).scrollTop()<a.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-a.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<a.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+a.scrollSpeed))),a.axis&&"y"===a.axis||(t.pageX-e(document).scrollLeft()<a.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-a.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<a.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+a.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!a.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=e(this),a=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:a.top,left:a.left})})},drag:function(t,i){var a,s,n,r,o,l,h,u,d,c,p=e(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=i.offset.left,v=g+p.helperProportions.width,y=i.offset.top,b=y+p.helperProportions.height;for(d=p.snapElements.length-1;d>=0;d--)o=p.snapElements[d].left,l=o+p.snapElements[d].width,h=p.snapElements[d].top,u=h+p.snapElements[d].height,o-m>v||g>l+m||h-m>b||y>u+m||!e.contains(p.snapElements[d].item.ownerDocument,p.snapElements[d].item)?(p.snapElements[d].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(a=m>=Math.abs(h-b),s=m>=Math.abs(u-y),n=m>=Math.abs(o-v),r=m>=Math.abs(l-g),a&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),s&&(i.position.top=p._convertPositionTo("relative",{top:u,left:0}).top-p.margins.top),n&&(i.position.left=p._convertPositionTo("relative",{top:0,left:o-p.helperProportions.width}).left-p.margins.left),r&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),c=a||s||n||r,"outer"!==f.snapMode&&(a=m>=Math.abs(h-y),s=m>=Math.abs(u-b),n=m>=Math.abs(o-g),r=m>=Math.abs(l-v),a&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),s&&(i.position.top=p._convertPositionTo("relative",{top:u-p.helperProportions.height,left:0}).top-p.margins.top),n&&(i.position.left=p._convertPositionTo("relative",{top:0,left:o}).left-p.margins.left),r&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[d].snapping&&(a||s||n||r||c)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[d].item})),p.snapElements[d].snapping=a||s||n||r||c)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,a=e.makeArray(e(i.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});a.length&&(t=parseInt(e(a[0]).css("zIndex"),10)||0,e(a).each(function(i){e(this).css("zIndex",t+i)}),this.css("zIndex",t+a.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var a=e(i.helper),s=e(this).data("ui-draggable").options;a.css("zIndex")&&(s._zIndex=a.css("zIndex")),a.css("zIndex",s.zIndex)},stop:function(t,i){var a=e(this).data("ui-draggable").options;a._zIndex&&e(i.helper).css("zIndex",a._zIndex)}})})(jQuery);(function(e){function t(e,t,i){return e>t&&t+i>e}e.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,i=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,i=e.ui.ddmanager.droppables[this.options.scope];i.length>t;t++)i[t]===this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"===t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var a=i||e.ui.ddmanager.current,s=!1;return a&&(a.currentItem||a.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===a.options.scope&&t.accept.call(t.element[0],a.currentItem||a.element)&&e.ui.intersect(a,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(s=!0,!1):undefined}),s?!1:this.accept.call(this.element[0],a.currentItem||a.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(a)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,i,a){if(!i.offset)return!1;var s,n,r=(e.positionAbs||e.position.absolute).left,o=r+e.helperProportions.width,l=(e.positionAbs||e.position.absolute).top,h=l+e.helperProportions.height,u=i.offset.left,d=u+i.proportions.width,c=i.offset.top,p=c+i.proportions.height;switch(a){case"fit":return r>=u&&d>=o&&l>=c&&p>=h;case"intersect":return r+e.helperProportions.width/2>u&&d>o-e.helperProportions.width/2&&l+e.helperProportions.height/2>c&&p>h-e.helperProportions.height/2;case"pointer":return s=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,n=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(n,c,i.proportions.height)&&t(s,u,i.proportions.width);case"touch":return(l>=c&&p>=l||h>=c&&p>=h||c>l&&h>p)&&(r>=u&&d>=r||o>=u&&d>=o||u>r&&o>d);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var a,s,n=e.ui.ddmanager.droppables[t.options.scope]||[],r=i?i.type:null,o=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(a=0;n.length>a;a++)if(!(n[a].options.disabled||t&&!n[a].accept.call(n[a].element[0],t.currentItem||t.element))){for(s=0;o.length>s;s++)if(o[s]===n[a].element[0]){n[a].proportions.height=0;continue e}n[a].visible="none"!==n[a].element.css("display"),n[a].visible&&("mousedown"===r&&n[a]._activate.call(n[a],i),n[a].offset=n[a].element.offset(),n[a].proportions={width:n[a].element[0].offsetWidth,height:n[a].element[0].offsetHeight})}},drop:function(t,i){var a=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(a=this._drop.call(this,i)||a),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),a},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var a,s,n,r=e.ui.intersect(t,this,this.options.tolerance),o=!r&&this.isover?"isout":r&&!this.isover?"isover":null;o&&(this.options.greedy&&(s=this.options.scope,n=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===s}),n.length&&(a=e.data(n[0],"ui-droppable"),a.greedyChild="isover"===o)),a&&"isover"===o&&(a.isover=!1,a.isout=!0,a._out.call(a,i)),this[o]=!0,this["isout"===o?"isover":"isout"]=!1,this["isover"===o?"_over":"_out"].call(this,i),a&&"isout"===o&&(a.isout=!1,a.isover=!0,a._over.call(a,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}})(jQuery);(function(e){function t(e,t,i){return e>t&&t+i>e}function i(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var s=null,a=!1,n=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")===n?(s=e(this),!1):undefined}),e.data(t.target,n.widgetName+"-item")===n&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(a=!0)}),a)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var a,n,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",r.cursor),this.storedStylesheet=e("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(n)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(a=this.containers.length-1;a>=0;a--)this.containers[a]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,a,n,r=this.options,o=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=o=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=o=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(t.pageY-e(document).scrollTop()<r.scrollSensitivity?o=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(o=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed)),t.pageX-e(document).scrollLeft()<r.scrollSensitivity?o=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(o=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))),o!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],a=s.item[0],n=this._intersectsWithPointer(s),n&&s.instance===this.currentContainer&&a!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==a&&!e.contains(this.placeholder[0],a)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],a):!0)){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,a=this.placeholder.offset(),n=this.options.axis,r={};n&&"x"!==n||(r.left=a.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(r.top=a.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,a=s+this.helperProportions.height,n=e.left,r=n+e.width,o=e.top,h=o+e.height,l=this.offset.click.top,u=this.offset.click.left,c="x"===this.options.axis||s+l>o&&h>s+l,d="y"===this.options.axis||t+u>n&&r>t+u,p=c&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>n&&r>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>o&&h>a-this.helperProportions.height/2},_intersectsWithPointer:function(e){var i="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),s="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),a=i&&s,n=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return a?this.floating?r&&"right"===r||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var i=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),s=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),a=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&s||"left"===n&&!s:a&&("down"===a&&i||"up"===a&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,s,a,n,r=[],o=[],h=this._connectWith();if(h&&t)for(i=h.length-1;i>=0;i--)for(a=e(h[i]),s=a.length-1;s>=0;s--)n=e.data(a[s],this.widgetFullName),n&&n!==this&&!n.options.disabled&&o.push([e.isFunction(n.options.items)?n.options.items.call(n.element):e(n.options.items,n.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),n]);for(o.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=o.length-1;i>=0;i--)o[i][0].each(function(){r.push(this)});return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,a,n,r,o,h,l,u=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(a=e(d[i]),s=a.length-1;s>=0;s--)n=e.data(a[s],this.widgetFullName),n&&n!==this&&!n.options.disabled&&(c.push([e.isFunction(n.options.items)?n.options.items.call(n.element[0],t,{item:this.currentItem}):e(n.options.items,n.element),n]),this.containers.push(n));for(i=c.length-1;i>=0;i--)for(r=c[i][1],o=c[i][0],s=0,l=o.length;l>s;s++)h=e(o[s]),h.data(this.widgetName+"-item",r),u.push({item:h,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,a,n;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(a=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=a.outerWidth(),s.height=a.outerHeight()),n=a.offset(),s.left=n.left,s.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),a=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(a)}):"img"===s&&a.attr("src",t.currentItem.attr("src")),i||a.css("visibility","hidden"),a},update:function(e,a){(!i||s.forcePlaceholderSize)&&(a.height()||a.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),a.width()||a.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_contactContainers:function(s){var a,n,r,o,h,l,u,c,d,p,f=null,m=null;for(a=this.containers.length-1;a>=0;a--)if(!e.contains(this.currentItem[0],this.containers[a].element[0]))if(this._intersectsWith(this.containers[a].containerCache)){if(f&&e.contains(this.containers[a].element[0],f.element[0]))continue;f=this.containers[a],m=a}else this.containers[a].containerCache.over&&(this.containers[a]._trigger("out",s,this._uiHash(this)),this.containers[a].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",s,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(r=1e4,o=null,p=f.floating||i(this.currentItem),h=p?"left":"top",l=p?"width":"height",u=this.positionAbs[h]+this.offset.click[h],n=this.items.length-1;n>=0;n--)e.contains(this.containers[m].element[0],this.items[n].item[0])&&this.items[n].item[0]!==this.currentItem[0]&&(!p||t(this.positionAbs.top+this.offset.click.top,this.items[n].top,this.items[n].height))&&(c=this.items[n].item.offset()[h],d=!1,Math.abs(c-u)>Math.abs(c+this.items[n][l]-u)&&(d=!0,c+=this.items[n][l]),r>Math.abs(c-u)&&(r=Math.abs(c-u),o=this.items[n],this.direction=d?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;o?this._rearrange(s,o,null,!0):this._rearrange(s,null,this.containers[m].element,!0),this._trigger("change",s,this._uiHash()),this.containers[m]._trigger("change",s,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",s,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,a=this.options;"parent"===a.containment&&(a.containment=this.helper[0].parentNode),("document"===a.containment||"window"===a.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===a.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===a.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(a.containment)||(t=e(a.containment)[0],i=e(a.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(a[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:a.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:a.scrollLeft())*s}},_generatePosition:function(t){var i,s,a=this.options,n=t.pageX,r=t.pageY,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(o[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),a.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/a.grid[1])*a.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-a.grid[1]:i+a.grid[1]:i,s=this.originalPageX+Math.round((n-this.originalPageX)/a.grid[0])*a.grid[0],n=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-a.grid[0]:s+a.grid[0]:s)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:o.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:o.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var a=this.counter;this._delay(function(){a===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){this.reverting=!1;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&s.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||s.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(s.push(function(e){this._trigger("remove",e,this._uiHash())}),s.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||s.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(s.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;s.length>i;i++)s[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;s.length>i;i++)s[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})})(jQuery);(function(e,t){var i="ui-effects-";e.effects={effect:{}},function(e,t){function i(e,t,i){var s=c[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),a=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,n){var r,o=n.re.exec(i),h=o&&n.parse(o),l=n.space||"rgba";return h?(r=s[l](h),s[u[l].cache]=r[u[l].cache],a=s._rgba=r._rgba,!1):t}),a.length?("0,0,0,0"===a.join()&&e.extend(a,n.transparent),s):n[i]}function a(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var n,r="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",o=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,a){return new e.Color.fn.parse(t,i,s,a)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(a,r,o,h){if(a===t)return this._rgba=[null,null,null,null],this;(a.jquery||a.nodeType)&&(a=e(a).css(r),r=t);var c=this,d=e.type(a),p=this._rgba=[];return r!==t&&(a=[a,r,o,h],d="array"),"string"===d?this.parse(s(a)||n._default):"array"===d?(f(u.rgba.props,function(e,t){p[t.idx]=i(a[t.idx],t)}),this):"object"===d?(a instanceof l?f(u,function(e,t){a[t.cache]&&(c[t.cache]=a[t.cache].slice())}):f(u,function(t,s){var n=s.cache;f(s.props,function(e,t){if(!c[n]&&s.to){if("alpha"===e||null==a[e])return;c[n]=s.to(c._rgba)}c[n][t.idx]=i(a[e],t,!0)}),c[n]&&0>e.inArray(null,c[n].slice(0,3))&&(c[n][3]=1,s.from&&(c._rgba=s.from(c[n])))}),this):t},is:function(e){var i=l(e),s=!0,a=this;return f(u,function(e,n){var r,o=i[n.cache];return o&&(r=a[n.cache]||n.to&&n.to(a._rgba)||[],f(n.props,function(e,i){return null!=o[i.idx]?s=o[i.idx]===r[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),a=s._space(),n=u[a],r=0===this.alpha()?l("transparent"):this,o=r[n.cache]||n.to(r._rgba),h=o.slice();return s=s[n.cache],f(n.props,function(e,a){var n=a.idx,r=o[n],l=s[n],u=c[a.type]||{};null!==l&&(null===r?h[n]=l:(u.mod&&(l-r>u.mod/2?r+=u.mod:r-l>u.mod/2&&(r-=u.mod)),h[n]=i((l-r)*t+r,a)))}),this[a](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),a=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*a[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,a=e[1]/255,n=e[2]/255,r=e[3],o=Math.max(s,a,n),h=Math.min(s,a,n),l=o-h,u=o+h,c=.5*u;return t=h===o?0:s===o?60*(a-n)/l+360:a===o?60*(n-s)/l+120:60*(s-a)/l+240,i=0===l?0:.5>=c?l/u:l/(2-u),[Math.round(t)%360,i,c,null==r?1:r]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],n=e[3],r=.5>=s?s*(1+i):s+i-s*i,o=2*s-r;return[Math.round(255*a(o,r,t+1/3)),Math.round(255*a(o,r,t)),Math.round(255*a(o,r,t-1/3)),n]},f(u,function(s,a){var n=a.props,r=a.cache,h=a.to,u=a.from;l.fn[s]=function(s){if(h&&!this[r]&&(this[r]=h(this._rgba)),s===t)return this[r].slice();var a,o=e.type(s),c="array"===o||"object"===o?s:arguments,d=this[r].slice();return f(n,function(e,t){var s=c["object"===o?e:t.idx];null==s&&(s=d[t.idx]),d[t.idx]=i(s,t)}),u?(a=l(u(d)),a[r]=d,a):l(d)},f(n,function(t,i){l.fn[t]||(l.fn[t]=function(a){var n,r=e.type(a),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===r?u:("function"===r&&(a=a.call(this,u),r=e.type(a)),null==a&&i.empty?this:("string"===r&&(n=o.exec(a),n&&(a=u+parseFloat(n[2])*("+"===n[1]?1:-1))),l[i.idx]=a,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,a){var n,r,o="";if("transparent"!==a&&("string"!==e.type(a)||(n=s(a)))){if(a=l(n||a),!d.rgba&&1!==a._rgba[3]){for(r="backgroundColor"===i?t.parentNode:t;(""===o||"transparent"===o)&&r&&r.style;)try{o=e.css(r,"backgroundColor"),r=r.parentNode}catch(h){}a=a.blend(o&&"transparent"!==o?o:"_default")}a=a.toRgbaString()}try{t.style[i]=a}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(r),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},n=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(t){var i,s,a=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,n={};if(a&&a.length&&a[0]&&a[a[0]])for(s=a.length;s--;)i=a[s],"string"==typeof a[i]&&(n[e.camelCase(i)]=a[i]);else for(i in a)"string"==typeof a[i]&&(n[i]=a[i]);return n}function s(t,i){var s,a,r={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(r[s]=a));return r}var a=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,n,r,o){var h=e.speed(n,r,o);return this.queue(function(){var n,r=e(this),o=r.attr("class")||"",l=h.children?r.find("*").addBack():r;l=l.map(function(){var t=e(this);return{el:t,start:i(this)}}),n=function(){e.each(a,function(e,i){t[i]&&r[i+"Class"](t[i])})},n(),l=l.map(function(){return this.end=i(this.el[0]),this.diff=s(this.start,this.end),this}),r.attr("class",o),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){n(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(r[0])})})},e.fn.extend({addClass:function(t){return function(i,s,a,n){return s?e.effects.animateClass.call(this,{add:i},s,a,n):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,a,n){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,a,n):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(i){return function(s,a,n,r,o){return"boolean"==typeof a||a===t?n?e.effects.animateClass.call(this,a?{add:s}:{remove:s},n,r,o):i.apply(this,arguments):e.effects.animateClass.call(this,{toggle:s},a,n,r)}}(e.fn.toggleClass),switchClass:function(t,i,s,a,n){return e.effects.animateClass.call(this,{add:i,remove:t},s,a,n)}})}(),function(){function s(t,i,s,a){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(a=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(a=s,s=i,i={}),e.isFunction(s)&&(a=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=a||i.complete,t}function a(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.3",save:function(e,t){for(var s=0;t.length>s;s++)null!==t[s]&&e.data(i+t[s],e[0].style[t[s]])},restore:function(e,s){var a,n;for(n=0;s.length>n;n++)null!==s[n]&&(a=e.data(i+s[n]),a===t&&(a=""),e.css(s[n],a))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),a={width:t.width(),height:t.height()},n=document.activeElement;try{n.id}catch(r){n=document.body}return t.wrap(s),(t[0]===n||e.contains(t[0],n))&&e(n).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(a),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,a){return a=a||{},e.each(i,function(e,i){var n=t.cssUnit(i);n[0]>0&&(a[i]=n[0]*s+n[1])}),a}}),e.fn.extend({effect:function(){function t(t){function s(){e.isFunction(n)&&n.call(a[0]),e.isFunction(t)&&t()}var a=e(this),n=i.complete,o=i.mode;(a.is(":hidden")?"hide"===o:"show"===o)?(a[o](),s()):r.call(a[0],i,s)}var i=s.apply(this,arguments),a=i.mode,n=i.queue,r=e.effects.effect[i.effect];return e.fx.off||!r?a?this[a](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):n===!1?this.each(t):this.queue(n||"fx",t)},show:function(e){return function(t){if(a(t))return e.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(e.fn.show),hide:function(e){return function(t){if(a(t))return e.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(e.fn.hide),toggle:function(e){return function(t){if(a(t)||"boolean"==typeof t)return e.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}()})(jQuery);(function(e){e.effects.effect.highlight=function(t,i){var s=e(this),a=["backgroundImage","backgroundColor","opacity"],n=e.effects.setMode(s,t.mode||"show"),r={backgroundColor:s.css("backgroundColor")};"hide"===n&&(r.opacity=0),e.effects.save(s,a),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(r,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===n&&s.hide(),e.effects.restore(s,a),i()}})}})(jQuery);
//##################################################################################################################
// #CHANGELIST#
/* global CMS, tree_component */

(function ($) {
    'use strict';
    // CMS.$ will be passed for $
    $(document).ready(function () {

        /*!
         * TreeManager
         * Handles treeview
         * TODO this will be refactored in 3.2
         */
        CMS.TreeManager = new CMS.Class({

            options: {
                'lang': {}
            },

            initialize: function (options) {
                this.options = $.extend(true, {}, this.options, options);

                // load internal functions
                if (!this.options.settings.filtered) {
                    this.setupFunctions();
                    this.setupTreePublishing();
                    this.setupUIHacks();
                    this.setupGlobals();
                    this.setupTree();

                    // init tree component
                    window.initTree();
                } else {
                    // when filtered is active, prevent tree actions
                    this.setupFunctions();
                    this.setupUIHacks();
                    $.syncCols();
                }
            },

            setupFunctions: function () {
                var that = this;

                $.syncCols = function () {
                    $('#sitemap .col-softroot').syncWidth(0);
                    $('#sitemap .col-apphook').syncWidth(0);
                    $('#sitemap .col-language').syncWidth(0);
                    $('#sitemap .col-navigation').syncWidth(0);
                    $('#sitemap .col-actions').syncWidth(0);
                    $('#sitemap .col-info').syncWidth(0);

                    that.refreshColumns.call($('ul.tree-default li'));
                };

                /* Colums width sync */
                $.fn.syncWidth = function (max) {
                    var visible = false;

                    $(this).each(function () {
                        if ($(this).is(':visible')) {
                            visible = true;
                            var val = $(this).width();
                            if (val > max) {
                                max = val;
                            }
                        }
                    });
                    if (visible && max > 0) {
                        $(this).each(function () {
                            $(this).css('width', max);
                        });
                    }
                };

                // jquery.functional
                $.curry = function (fn) {
                    if (arguments.length < 2) {
                        return fn;
                    }
                    var args = $.makeArray(arguments).slice(1, arguments.length);
                    return function () {
                        return fn.apply(this, args.concat($.makeArray(arguments)));
                    };
                };

                $.__callbackPool = {};

                $.callbackRegister = function (name, fn /*, arg0, arg1, ..*/) {
                    if (arguments.length > 2) {
                        // create curried function
                        fn = $.curry.apply(this, $.makeArray(arguments).slice(1, arguments.length));
                    }
                    $.__callbackPool[name] = fn;
                    return name;
                };

                $.callbackCall = function (name/*, extra arg0, extra arg1, ..*/) {
                    if (!name || !(name in $.__callbackPool)) {
                        throw 'No callback registered with name: ' + name;
                    }
                    $.__callbackPool[name].apply(this, $.makeArray(arguments).slice(1, arguments.length));
                    $.callbackRemove(name);
                    return name;
                };

                $.callbackRemove = function (name) {
                    delete $.__callbackPool[name];
                };

                // very simple yellow fade plugin..
                $.fn.yft = function () {
                    this.effect('highlight', {}, 1000);
                };

                // jquery replace plugin :)
                $.fn.replace = function (o) {
                    return this.after(o).remove().end();
                };

            },

            setupTreePublishing: function () {
                // ADD DIRECT PUBLISHING
                var that = this;
                var tree = $('.tree');
                var langTrigger = '.col-language .trigger-tooltip span';
                var langTooltips = '.language-tooltip';
                var langTimer = function () {};
                var langDelay = 100;
                var langFadeDuration = 200;
                // workaround for the publishing tooltip on touch devices
                var touchUsedNode;

                // show the tooltip
                tree.delegate(langTrigger, 'pointerover touchstart', function (e) {
                    var el = $(this).closest('.col-language').find('.language-tooltip');
                    var anchors = el.find('a');
                    var span = $(this);

                    // clear timer
                    clearTimeout(langTimer);

                    // cancel if tooltip already visible
                    if (el.is(':visible') && !touchUsedNode) {
                        return false;
                    }

                    // set correct position
                    el.css('right', 20 + $(this).position().left);

                    // figure out what should be shown
                    anchors.hide();
                    if (span.hasClass('unpublished') || span.hasClass('unpublishedparent')) {
                        anchors.eq(1).show();
                    }
                    if (span.hasClass('published')) {
                        anchors.eq(0).show();
                    }
                    if (span.hasClass('dirty')) {
                        anchors.show().parent().addClass('language-tooltip-multiple');
                    }

                    // hide all elements
                    $(langTooltips).fadeOut(langDelay);

                    if (e.type === 'touchstart') {
                        e.preventDefault();
                        touchUsedNode = touchUsedNode === e.target ? false : e.target;
                        if (touchUsedNode) {
                            return;
                        }
                    }

                    // use a timeout to display the tooltip
                    langTimer = setTimeout(function () {
                        el.stop(true, true).fadeIn(langFadeDuration);
                    }, langDelay);
                });
                // hide the tooltip when leaving the area
                tree.delegate(langTrigger, 'pointerout', function () {
                    if (touchUsedNode) {
                        return;
                    }
                    // clear timer
                    clearTimeout(langTimer);
                    // hide all elements
                    langTimer = setTimeout(function () {
                        $(langTooltips).fadeOut(langFadeDuration);
                    }, langDelay * 2);
                });
                // reset hiding when entering the tooltip itself
                tree.delegate(langTooltips, 'pointerover', function () {
                    // clear timer
                    clearTimeout(langTimer);
                });
                tree.delegate(langTooltips, 'pointerout', function () {
                    // hide all elements
                    langTimer = setTimeout(function () {
                        $(langTooltips).fadeOut(langFadeDuration);
                    }, langDelay * 2);
                });
                // attach double check event if publish or unpublish should be triggered
                tree.delegate('.language-tooltip a', 'click', function (e) {
                    e.preventDefault();

                    // cancel if not confirmed
                    if (!confirm(that.options.lang.publish.replace('', $(this).text().toLowerCase()))) {
                        return false;
                    }

                    // send post request to prevent xss attacks
                    $.ajax({
                        type: 'post',
                        url: $(this).prop('href'),
                        success: function () {
                            CMS.API.Helpers.reloadBrowser();
                        },
                        error: function (request) {
                            throw new Error(request);
                        }
                    });
                });
            },

            setupUIHacks: function () {
                // enables tab click on title entry to open in new window
                $('.tree').on('click', '.col1 .title', function (e) {
                    if (!e.metaKey) {
                        window.top.location.href = $(this).attr('href');
                    } else {
                        window.open($(this).attr('href'), '_blank');
                    }
                });

                // adds functionality to the filter
                $('#changelist-filter-button').bind('click', function () {
                    $('#changelist-filter').toggle();
                });

                // set correct active entry
                if (window.parent && window.parent.CMS && window.parent.CMS.config) {
                    var page_id = window.parent.CMS.config.request.page_id;

                    $('div[data-page_id="' + page_id + '"]').addClass('cont-active');
                }
            },

            setupGlobals: function () {
                var that = this;
                var msg = '';
                var parent = null;

                window.moveSuccess = function (node) {
                    $.syncCols();

                    msg = $('<span class="success">' + that.options.lang.success + '</span>');
                    parent = window.parent;

                    node.after(msg);
                    node.parent().find('.col2').hide();
                    msg.fadeOut(1000, function () {
                        node.parent().find('.col2').show();
                    });
                    // check for reload changes
                    if (window.self !== window.top) {
                        window.parent.CMS.API.Helpers.reloadBrowser(false, false, true);
                        window.parent.CMS.API.Toolbar.openMessage(that.options.lang.changes, false, 0);
                    }
                };

                window.moveError = function (node, message) {
                    if (message && message !== 'error') {
                        msg = $('<span class="success">' + message + '</span>');
                    } else {
                        msg = $('<span class="success">' + that.options.lang.error + '</span>');
                    }
                    node.parent().find('.col2').hide();
                    node.after(msg);
                };

            },

            setupTree: function () {
                var that = this;
                var tree;
                var origin = window.location.protocol + '//' + window.location.hostname +
                    (window.location.port ? ':' + window.location.port : '');
                // global initTree function
                window.initTree = function () {
                    // jshint newcap: false
                    // jscs:disable requireCapitalizedConstructors
                    tree = new tree_component();
                    // jscs:enable requireCapitalizedConstructors
                    // jshint newcap: true
                    var options = {
                        rules: {
                            clickable: 'all',
                            renameable: 'none',
                            deletable: 'all',
                            creatable: 'all',
                            draggable: 'all',
                            dragrules: 'all',
                            droppable: 'all',
                            metadata : 'mdata',
                            use_inline: true
                            //droppable : ['tree_drop']
                        },
                        // has to be absolute full path
                        path: origin + that.options.settings.staticPath + 'cms/js/jstree/',
                        ui: {
                            dots: true,
                            rtl: false,
                            animation: 0,
                            hover_mode: true,
                            //theme_path: script_url_path() + '/../jstree/themes/',
                            a_class: 'title',
                            context: false
                        },
                        cookies : {
                            prefix: 'djangocms_nodes'
                        },
                        callback: {
                            beforemove  : function (what, where, position) {
                                window.item_id = what.id.split('page_')[1];
                                window.target_id = where.id.split('page_')[1];
                                window.old_node = what;

                                if ($(what).parent().children('li').length > 1) {
                                    if ($(what).next('li').length) {
                                        window.old_target = $(what).next('li')[0];
                                        window.old_position = 'right';
                                    }
                                    if ($(what).prev('li').length) {
                                        window.old_target = $(what).prev('li')[0];
                                        window.old_position = 'left';
                                    }
                                } else {
                                    if ($(what).attr('rel') !== 'topnode') {
                                        window.old_target = $(what).parent().parent()[0];
                                        window.old_position = 'inside';
                                    }
                                }

                                addUndo(what, where, position);
                                return true;
                            },
                            onmove: function (what, where, position) {
                                window.item_id = what.id.split('page_')[1];
                                window.target_id = where.id.split('page_')[1];

                                if (position === 'before') {
                                    position = 'left';
                                } else if (position === 'after') {
                                    position = 'right';
                                } else if (position === 'inside') {
                                    position = 'last-child';
                                }
                                moveTreeItem(what, window.item_id, window.target_id, position, false);
                            },

                            onload: function () {
                                setTimeout(function () {
                                    reCalc();
                                }, 250);
                            }

                        }
                    };

                    if (!$($('div.tree').get(0)).hasClass('root_allow_children')) {
                        // disalow possibility for adding subnodes to main tree, user doesn't
                        // have permissions for this
                        options.rules.dragrules = ['node inside topnode', 'topnode inside topnode', 'node * node'];
                    }

                    tree.init($('div.tree'), options);
                };

                window.selected_page = false;
                action = false;

                var _oldAjax = $.ajax;

                $.ajax = function (s) {
                    // just override ajax function, so the loader message gets displayed
                    // always
                    $('#loader-message').show();

                    var callback = s.success || false;
                    s.success = function (data, status) {
                        if (callback) {
                            callback(data, status);
                        }
                        $('#loader-message').hide();
                    };

                    // just for debuging!!
                    /*s.complete = function (xhr, status) {
                        if (status == 'error' && that.options.settings.debug) {
                            $('body').before(xhr.responseText);
                        }
                    }*/
                    // end just for debuging

                    // TODO: add error state!
                    return _oldAjax(s);
                };

                // // defined but never used
                // function refresh() {
                //     window.location = window.location.href;
                // }

                // // defined but never used
                // function refreshIfChildren(pageId) {
                //     return $('#page_' + pageId).find('li[id^=page_]').length ?
                //     refresh :
                //     function () { return true; };
                // }

                /**
                 * Loads remote dialog to dialogs div.
                 *
                 * @param {String} url
                 * @param {Object} data Data to be send over post
                 * @param {Function} noDialogCallback Gets called when response is empty.
                 * @param {Function} callback Standard callback function.
                 */
                function loadDialog(url, data, noDialogCallback, callback) {
                    if (data === undefined) {
                        data = {};
                    }
                    $.post(url, data, function (response) {
                        if (response === '' && noDialogCallback) {
                            noDialogCallback();
                        }
                        $('#dialogs').empty().append(response);
                        if (callback) {
                            callback(response);
                        }
                    });
                }

                function mark_copy_node(id) {
                    $('a.move-target, span.move-target-container, span.line').show();
                    $('#page_' + id).addClass('selected');
                    $('#page_' + id).parent().parent()
                        .children('div.cont').find('a.move-target.first-child, span.second').hide();
                    $('#page_' + id).parent().parent()
                        .children('ul').children('li').children('div.cont')
                        .find('a.move-target.left, a.move-target.right, span.first, span.second').hide();
                    return 'copy';
                }


                // let's start event delegation
                $('#changelist li').on('click', function (e) {
                    // I want a link to check the class
                    if (e.target.tagName === 'IMG' || e.target.tagName === 'SPAN') {
                        window.target = e.target.parentNode;
                    } else {
                        window.target = e.target;
                    }
                    var jtarget = $(window.target);
                    var id;
                    var page_id;
                    if (jtarget.hasClass('move')) {
                        // prepare tree for move / cut paste
                        id = e.target.id.split('move-link-')[1];
                        if (!id) {
                            id = e.target.parentNode.id.split('move-link-')[1];
                        }
                        page_id = id;
                        window.selected_page = page_id;
                        action = 'move';
                        $('span.move-target-container, span.line, a.move-target').show();
                        $('#page_' + page_id).addClass('selected');
                        $('#page_' + page_id + ' span.move-target-container').hide();
                        e.stopPropagation();
                        return false;
                    }

                    if (jtarget.hasClass('copy')) {
                        // prepare tree for copy
                        id = e.target.id.split('copy-link-')[1];
                        if (!id) {
                            id = e.target.parentNode.id.split('copy-link-')[1];
                        }
                        window.selected_page = id;
                        action = mark_copy_node(id);
                        e.stopPropagation();
                        return false;
                    }

                    if (jtarget.hasClass('viewpage')) {
                        var view_page_url = $('#' + window.target.id + '-select').val();
                        if (view_page_url) {
                            window.open(view_page_url);
                        }
                    }

                    if (jtarget.hasClass('addlink')) {
                        if (!/#$/g.test(jtarget.attr('href'))) {
                            // if there is url instead of # inside href, follow this url
                            // used if user haves add_page
                            return true;
                        }

                        $('tr').removeClass('target');
                        $('#changelist table').removeClass('table-selected');
                        page_id = window.target.id.split('add-link-')[1];
                        window.selected_page = page_id;
                        action = 'add';
                        $('tr').removeClass('selected');
                        $('#page-row-' + page_id).addClass('selected');
                        $('.move-target-container').hide();
                        $('a.move-target, span.line, #move-target-' + page_id).show();
                        e.stopPropagation();
                        return false;
                    }

                    // don't assume admin site is root-level
                    // grab base url to construct full absolute URLs
                    window.admin_base_url = document.URL.split('/cms/page/')[0] + '/';

                    var pageId;
                    var language;
                    // in navigation
                    if (jtarget.hasClass('navigation-checkbox')) {
                        e.stopPropagation();

                        pageId = jtarget.attr('name').split('navigation-')[1];
                        language = jtarget.closest('.cont').find('a[lang]').attr('lang') || '';

                        // if I don't put data in the post, django doesn't get it
                        reloadItem(
                            jtarget,
                            window.admin_base_url + 'cms/page/' + pageId + '/change-navigation/?language=' + language,
                            { 1: 1 }
                        );
                    }

                    // lazy load descendants on tree open
                    if (jtarget.hasClass('closed')) {
                        // only load them once
                        if (jtarget.find('ul > li').length === 0 && !jtarget.hasClass('loading')) {
                            // keeps this event from firing multiple times before
                            // the dom as changed. it still needs to propagate for
                            // the other click event on this element to fire
                            jtarget.addClass('loading');
                            pageId = $(jtarget).attr('id').split('page_')[1];
                            language = $(jtarget)
                                .children('div.cont')
                                .children('div.col1')
                                .children('.title').attr('lang');
                            $.get(
                                window.admin_base_url + 'cms/page/' + pageId + '/' + language + '/descendants/',
                                {},
                                function (r) {
                                    jtarget.children('ul').append(r);
                                    // show move targets if needed
                                    if ($('span.move-target-container:visible').length > 0) {
                                        jtarget.children('ul')
                                            .find('a.move-target, span.move-target-container, span.line')
                                            .show();
                                    }
                                    reCalc();
                                }
                            );
                        } else {
                            reCalc();
                        }
                    }

                    if (jtarget.hasClass('move-target')) {
                        if (jtarget.hasClass('left')) {
                            window.position = 'left';
                        }
                        if (jtarget.hasClass('right')) {
                            window.position = 'right';
                        }
                        if (jtarget.hasClass('last-child')) {
                            window.position = 'last-child';
                        }
                        window.target_id = window.target.parentNode.id.split('move-target-')[1];

                        if (action === 'move') {
                            moveTreeItem(null, window.selected_page, window.target_id, window.position, tree);
                            $('.move-target-container').hide();
                        } else if (action === 'copy') {
                            window.site = $('#site-select')[0].value;
                            copyTreeItem(window.selected_page, window.target_id, window.position, window.site);
                            $('.move-target-container').hide();
                        } else if (action === 'add') {
                            window.site = $('#site-select')[0].value;
                            window.location.href = window.location.href.split('?')[0].split('#')[0] +
                                'add/?target=' + window.target_id + '&amp;position=' + window.position +
                                '&amp;site=' + window.site;
                        }
                        e.stopPropagation();
                        return false;
                    }
                    return true;
                });
                $('div#sitemap').show();

                function reCalc() {
                    $.syncCols();
                }

                $(window).bind('resize', reCalc);
                /* Site Selector */
                $('#site-select').change(function () {
                    var form = $(this).closest('form');
                    // add correct value for copy
                    if (action === 'copy') {
                        $('#site-copy').val(window.selected_page);
                    }
                    // submit form
                    form.submit();
                });

                //
                // If an A element has a data-attribute 'alt-class'. At this time,
                // this is only the edit button in the page-tree, but could be
                // more in future. It is important that the CSS be written in such
                // a manner that the alt-class is defined after the normal class,
                // so that it can be overridden when the alt-key is depressed.
                //
                // NOTE: This 'preview' part of the 'alt-click to [alternative
                // function]' feature may not work in some environments (Windows
                // in a some virtual machine environments, notably), but is only a
                // nice-'extra', not a requirement for the feature.
                //
                $(document).on('keydown keyup', function (evt) {
                    if (evt.which === 18) {
                        $('a[data-alt-class]').each(function () {
                            var self = $(this);
                            self.toggleClass(self.data('alt-class'), evt.type === 'keydown');
                        });
                    }
                });

                //
                // If the A-element has a data-attribute 'alt-href', then this
                // click-handler uses that instead of the normal href attribute as
                // the click-destination. Again, currently this is only on the
                // edit button, but could be more in future.
                //
                $('a[data-alt-href]').on('click', function (evt) {
                    var href;
                    evt.preventDefault();
                    if (evt.shiftKey) {
                        href = $(this).data('alt-href');
                    } else {
                        href = $(this).attr('href');
                    }
                    window.location = href;
                });

                var copy_splits = window.location.href.split('copy=');
                if (copy_splits.length > 1) {
                    var id = copy_splits[1].split('&')[0];
                    // jshint latedef: false
                    var action = mark_copy_node(id);
                    // jshint latedef: true
                    window.selected_page = id;
                }

                function copyTreeItem(item_id, target_id, position, site) {
                    if (that.options.settings.permission) {
                        return loadDialog('./' + item_id + '/dialog/copy/', {
                            position: position,
                            target: target_id,
                            site: site,
                            callback: $.callbackRegister(
                                '_copyTreeItem', _copyTreeItem, item_id, target_id, position, site
                            )
                        });
                    }
                    return _copyTreeItem(item_id, target_id, position, site);
                }

                function _copyTreeItem(item_id, target_id, position, site, options) {
                    var data = {
                        position: position,
                        target: target_id,
                        site: site
                    };
                    data = $.extend(data, options);

                    $.post('./' + item_id + '/copy-page/', data, function (decoded) {
                        var response = decoded.content;
                        var status = decoded.status;
                        if (status === 200) {
                            // reload tree
                            window.location = window.location.href;
                        } else {
                            alert(response);
                            window.moveError($('#page_' + item_id + ' div.col1:eq(0)'), response);
                        }
                    });
                }

                /**
                 * Reloads tree item (one line). If some filtering is found, adds
                 * filtered variable into posted data.
                 *
                 * @param {HTMLElement} el Any child element of tree item
                 * @param {String} url Requested url
                 * @param {Object} data Optional posted data
                 * @param {Function} callback Optional calback function
                 */
                function reloadItem(el, url, data, callback, errorCallback) {
                    if (data === undefined) {
                        data = {};
                    }

                    if (/\/\?/ig.test(window.location.href)) {
                        // probably some filter here, tell backend, we need a filtered
                        // version of item
                        data.fitlered = 1;
                    }

                    function onSuccess(response, textStatus) {
                        var status = true;
                        var target = null;

                        if (callback) {
                            status = callback(response, textStatus);
                        }
                        if (status) {
                            if (/page_\d+/.test($(el).attr('id'))) {
                                // one level higher
                                target = $(el).find('div.cont:first');
                            } else {
                                target = $(el).parents('div.cont:first');
                            }

                            var parent = target.parent();

                            // remove the element if something went wrong
                            if (response === 'NotFound') {
                                return parent.remove();
                            }

                            var origin = $('.messagelist');
                            target.replace(response);

                            var messages = $(parent).find('.messagelist');
                            if (messages.length) {
                                origin.remove();
                                messages.insertAfter('.breadcrumbs');
                            }
                            parent.find('div.cont:first').yft();

                            // ensure after removal everything is aligned again
                            $(window).trigger('resize');
                        }
                    }

                    $.ajax({
                        'type': 'POST',
                        'data': data,
                        'url': url,
                        'success': onSuccess,
                        'error': function (XMLHttpRequest, textStatus, errorThrown) {
                            // errorCallback is passed through the reloadItem function
                            if (errorCallback) {
                                errorCallback(XMLHttpRequest, textStatus, errorThrown);
                            }
                        },
                        'xhr': (window.ActiveXObject) ?
                            function () {
                                try {
                                    return new window.ActiveXObject('Microsoft.XMLHTTP');
                                } catch (e) {}
                            } :
                            function () {
                                return new window.XMLHttpRequest();
                            }
                    });
                }

                function moveTreeItem(jtarget, item_id, target_id, position, tree) {
                    reloadItem(
                        jtarget, './' + item_id + '/move-page/',

                        { position: position, target: target_id },

                        // on success
                        function (decoded) {
                            var response = decoded.content;
                            var status = decoded.status;
                            if (status === 200) {
                                if (tree) {
                                    var tree_pos = { 'left': 'before', 'right': 'after' }[position] || 'inside';
                                    tree.moved(
                                        '#page_' + item_id,
                                        $('#page_' + target_id + ' a.title')[0],
                                        tree_pos,
                                        false,
                                        false
                                    );
                                } else {
                                    window.moveSuccess($('#page_' + item_id + ' div.col1:eq(0)'));
                                }
                                return false;
                            } else {
                                window.moveError($('#page_' + item_id + ' div.col1:eq(0)'), response);
                                return false;
                            }
                        }
                    );
                }

                var undos = [];

                function addUndo(node, target, position) {
                    undos.push({ node: node, target: target, position: position });
                }
            },

            refreshColumns: function () {
                $('div.col2').children('div').each(function (index, item) {
                    $(item).css('display', 'block');
                });
                var min_width = 100000;
                var max_col2_width = 0;
                var max_col2 = null;
                $(this).each(function () {
                    var cont = $(this).children('div.cont');
                    if (!cont.is(':visible')) {
                        return;
                    }
                    var col1 = cont.children('div.col1').find('.title span');
                    var col2 = cont.children('div.col2');
                    var col1_width = col1.outerWidth(true);
                    var col2_width = col2.outerWidth(true);
                    var total_width = cont.outerWidth(true);

                    var dif = total_width - col1_width;
                    if (dif < min_width) {
                        min_width = dif;
                    }
                    if (col2_width > max_col2_width) {
                        max_col2_width = col2_width;
                        max_col2 = col2;
                    }
                });

                var offset = 50;
                var w = 0;
                var hidden_count = 0;
                var max_reached = false;
                if (max_col2) {
                    max_col2.children('div').each(function () {
                        if (!max_reached) {
                            w += $(this).outerWidth(true);
                        }

                        if (max_reached || w > (min_width - offset)) {
                            hidden_count = hidden_count + 1;
                            max_reached = true;
                        }
                    });

                    if (hidden_count) {
                        $(this).each(function () {
                            $(this).children('div.cont').children('div.col2').children('div')
                                .slice(-hidden_count).each(function () {
                                    $(this).css('display', 'none');
                                });
                        });
                        $('div#sitemap ul.header div.col2').children().slice(-hidden_count).each(function () {
                            $(this).css('display', 'none');
                        });
                    }
                }
            }

        });

    });
})(CMS.$);

// all, but without jquery !! (modified by Peter Cicman)

// css.js

function get_css(rule_name,stylesheet,delete_flag){if(!document.styleSheets)return false;rule_name=rule_name.toLowerCase();stylesheet=stylesheet||0;for(var i=stylesheet;i<document.styleSheets.length;i++){var styleSheet=document.styleSheets[i];css_rules=document.styleSheets[i].cssRules||document.styleSheets[i].rules;if(!css_rules)continue;var j=0;do{if(css_rules[j].selectorText.toLowerCase()==rule_name){if(delete_flag==true){if(document.styleSheets[i].removeRule)document.styleSheets[i].removeRule(j);if(document.styleSheets[i].deleteRule)document.styleSheets[i].deleteRule(j);return true;}
else return css_rules[j];}}
while(css_rules[++j]);}
return false;}
function add_css(rule_name,stylesheet){rule_name=rule_name.toLowerCase();stylesheet=stylesheet||0;if(!document.styleSheets||get_css(rule_name,stylesheet))return false;(document.styleSheets[stylesheet].addRule)?document.styleSheets[stylesheet].addRule(rule_name,null,0):document.styleSheets[stylesheet].insertRule(rule_name+' { }',0);return get_css(rule_name);}
function get_sheet_num(href_name){if(!document.styleSheets)return false;for(var i=0;i<document.styleSheets.length;i++){if(document.styleSheets[i].href&&document.styleSheets[i].href.toString().match(href_name))return i;}
return false;}
function remove_css(rule_name,stylesheet){return get_css(rule_name,stylesheet,true);}
function add_sheet(url){if(document.createStyleSheet){document.createStyleSheet(url);}
else{var styles="@import url(' "+url+" ');";var newSS=document.createElement('link');newSS.rel='stylesheet';newSS.href='data:text/css,'+escape(styles);document.getElementsByTagName("head")[0].appendChild(newSS);}}

// jquery.listen.js
;(function($){var a='indexer',h=$.event,j=h.special,k=$.listen=function(c,d,e,f){if(typeof d!='object'){f=e;e=d;d=document}o(c.split(/\s+/),function(a){a=k.fixes[a]||a;var b=m(d,a)||m(d,a,new n(a,d));b.append(e,f);b.start()})},m=function(b,c,d){return $.data(b,c+'.'+a,d)};$.fn[a]=function(a){return this[0]&&m(this[0],a)||null};$[a]=function(a){return m(document,a)};$.extend(k,{regex:/^((?:\w*?|\*))(?:([#.])([\w-]+))?$/,fixes:{focus:'focusin',blur:'focusout'},cache:function(a){this.caching=a}});$.each(k.fixes,function(a,b){j[b]={setup:function(){if($.browser.msie)return!1;this.addEventListener(a,j[b].handler,!0)},teardown:function(){if($.browser.msie)return!1;this.removeEventListener(a,j[b].handler,!0)},handler:function(e){arguments[0]=e=h.fix(e);e.type=b;return h.handle.apply(this,arguments)}}});$.fn.listen=function(a,b,c){return this.each(function(){k(a,this,b,c)})};function n(a,b){$.extend(this,{ids:{},tags:{},listener:b,event:a});this.id=n.instances.push(this)};n.instances=[];n.prototype={constructor:n,handle:function(e){var a=e.stopPropagation;e.stopPropagation=function(){e.stopped=1;a.apply(this,arguments)};m(this,e.type).parse(e);e.stopPropagation=a;a=e.data=null},on:0,bubbles:0,start:function(){var a=this;if(!a.on){h.add(a.listener,a.event,a.handle);a.on=1}},stop:function(){var a=this;if(a.on){h.remove(a.listener,a.event,a.handle);a.on=0}},cache:function(a,b){return $.data(a,'listenCache_'+this.id,b)},parse:function(e){var z=this,c=e.data||e.target,d=arguments,f;if(!k.caching||!(f=z.cache(c))){f=[];if(c.id&&z.ids[c.id])p(f,z.ids[c.id]);o([c.nodeName,'*'],function(a){var b=z.tags[a];if(b)o((c.className+' *').split(' '),function(a){if(a&&b[a])p(f,b[a])})});if(k.caching)z.cache(c,f)}if(f[0]){o(f,function(a){if(a.apply(c,d)===!1){e.preventDefault();e.stopPropagation()}})}if(!e.stopped&&(c=c.parentNode)&&(c.nodeName=='A'||z.bubbles&&c!=z.listener)){e.data=c;z.parse(e)}f=d=c=null},append:function(f,g){var z=this;o(f.split(/\s*,\s*/),function(a){var b=k.regex.exec(a);if(!b)throw'$.listen > "'+a+'" is not a supported selector.';var c=b[2]=='#'&&b[3],d=b[1].toUpperCase()||'*',e=b[3]||'*';if(c)(z.ids[c]||(z.ids[c]=[])).push(g);else if(d){d=z.tags[d]=z.tags[d]||{};(d[e]||(d[e]=[])).push(g)}})}};function o(a,b,c){for(var i=0,l=a.length;i<l;i++)b.call(c,a[i],i)};function p(a,b){a.push.apply(a,b);return a};$(window).unload(function(){if(typeof n=='function')o(n.instances,function(b){b.stop();$.removeData(b.listener,b.event+'.'+a);b.ids=b.names=b.listener=null})})})(jQuery);

// sarissa.js

function Sarissa(){}
Sarissa.VERSION="0.9.9.4";Sarissa.PARSED_OK="Document contains no parsing errors";Sarissa.PARSED_EMPTY="Document is empty";Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error";Sarissa.IS_ENABLED_TRANSFORM_NODE=false;Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG";Sarissa._lastUniqueSuffix=0;Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++;};Sarissa._SARISSA_IEPREFIX4XSLPARAM="";Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&true;Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument;Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature;Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE;Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1;Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&(parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420);Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1;Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE){Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};}
if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor;Node=HTMLElement={};HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__;HTMLDocument=Document=document.constructor;var x=new DOMParser();XMLDocument=x.constructor;Element=x.parseFromString("<Single />","text/xml").documentElement.constructor;x=null;}
if(typeof XMLDocument=="undefined"&&typeof Document!="undefined"){XMLDocument=Document;}
if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="";var _SARISSA_XMLHTTP_PROGID="";var _SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(idList){var bFound=false,e;var o2Store;for(var i=0;i<idList.length&&!bFound;i++){try{var oDoc=new ActiveXObject(idList[i]);o2Store=idList[i];bFound=true;}catch(objException){e=objException;}}
if(!bFound){throw"Could not retrieve a valid progID of Class: "+idList[idList.length-1]+". (original exception: "+e+")";}
idList=null;return o2Store;};_SARISSA_DOM_PROGID=null;_SARISSA_THREADEDDOM_PROGID=null;_SARISSA_XSLTEMPLATE_PROGID=null;_SARISSA_XMLHTTP_PROGID=null;XMLHttpRequest=function(){if(!_SARISSA_XMLHTTP_PROGID){_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"]);}
return new ActiveXObject(_SARISSA_XMLHTTP_PROGID);};Sarissa.getDomDocument=function(sUri,sName){if(!_SARISSA_DOM_PROGID){_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]);}
var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(sName){var prefix="";if(sUri){if(sName.indexOf(":")>1){prefix=sName.substring(0,sName.indexOf(":"));sName=sName.substring(sName.indexOf(":")+1);}else{prefix="a"+Sarissa._getUniqueSuffix();}}
if(sUri){oDoc.loadXML('<'+prefix+':'+sName+" xmlns:"+prefix+"=\""+sUri+"\""+" />");}else{oDoc.loadXML('<'+sName+" />");}}
return oDoc;};Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if(oDoc&&oDoc.parseError&&oDoc.parseError.errorCode&&oDoc.parseError.errorCode!=0){parseErrorText="XML Parsing Error: "+oDoc.parseError.reason+"\nLocation: "+oDoc.parseError.url+"\nLine Number "+oDoc.parseError.line+", Column "+
oDoc.parseError.linepos+":\n"+oDoc.parseError.srcText+"\n";for(var i=0;i<oDoc.parseError.linepos;i++){parseErrorText+="-";}
parseErrorText+="^\n";}
else if(oDoc.documentElement===null){parseErrorText=Sarissa.PARSED_EMPTY;}
return parseErrorText;};Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc.setProperty("SelectionLanguage","XPath");oDoc.setProperty("SelectionNamespaces",sNsSet);};XSLTProcessor=function(){if(!_SARISSA_XSLTEMPLATE_PROGID){_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"]);}
this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID);this.processor=null;};XSLTProcessor.prototype.importStylesheet=function(xslDoc){if(!_SARISSA_THREADEDDOM_PROGID){_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"]);}
xslDoc.setProperty("SelectionLanguage","XPath");xslDoc.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var converted=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{converted.resolveExternals=true;converted.setProperty("AllowDocumentFunction",true);}
catch(e){}
if(xslDoc.url&&xslDoc.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null){converted.async=false;converted.load(xslDoc.url);}
else{converted.loadXML(xslDoc.xml);}
converted.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var output=converted.selectSingleNode("//xsl:output");if(output){this.outputMethod=output.getAttribute("method");}
else{delete this.outputMethod;}
this.template.stylesheet=converted;this.processor=this.template.createProcessor();this.paramsSet=[];};XSLTProcessor.prototype.transformToDocument=function(sourceDoc){var outDoc;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_PROGID);this.processor.output=outDoc;this.processor.transform();return outDoc;}
else{if(!_SARISSA_DOM_XMLWRITER){_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"]);}
this.processor.input=sourceDoc;outDoc=new ActiveXObject(_SARISSA_DOM_XMLWRITER);this.processor.output=outDoc;this.processor.transform();var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);oDoc.loadXML(outDoc.output+"");return oDoc;}};XSLTProcessor.prototype.transformToFragment=function(sourceDoc,ownerDoc){this.processor.input=sourceDoc;this.processor.transform();var s=this.processor.output;var f=ownerDoc.createDocumentFragment();var container;if(this.outputMethod=='text'){f.appendChild(ownerDoc.createTextNode(s));}else if(ownerDoc.body&&ownerDoc.body.innerHTML){container=ownerDoc.createElement('div');container.innerHTML=s;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}
else{var oDoc=new ActiveXObject(_SARISSA_DOM_PROGID);if(s.substring(0,5)=='<?xml'){s=s.substring(s.indexOf('?>')+2);}
var xml=''.concat('<my>',s,'</my>');oDoc.loadXML(xml);container=oDoc.documentElement;while(container.hasChildNodes()){f.appendChild(container.firstChild);}}
return f;};XSLTProcessor.prototype.setParameter=function(nsURI,name,value){value=value?value:"";if(nsURI){this.processor.addParameter(name,value,nsURI);}else{this.processor.addParameter(name,value);}
nsURI=""+(nsURI||"");if(!this.paramsSet[nsURI]){this.paramsSet[nsURI]=[];}
this.paramsSet[nsURI][name]=value;};XSLTProcessor.prototype.getParameter=function(nsURI,name){nsURI=""+(nsURI||"");if(this.paramsSet[nsURI]&&this.paramsSet[nsURI][name]){return this.paramsSet[nsURI][name];}else{return null;}};XSLTProcessor.prototype.clearParameters=function(){for(var nsURI in this.paramsSet){for(var name in this.paramsSet[nsURI]){if(nsURI!=""){this.processor.addParameter(name,"",nsURI);}else{this.processor.addParameter(name,"");}}}
this.paramsSet=[];};}else{if(Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT){Sarissa.__handleLoad__=function(oDoc){Sarissa.__setReadyState__(oDoc,4);};_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this);};Sarissa.__setReadyState__=function(oDoc,iReadyState){oDoc.readyState=iReadyState;oDoc.readystate=iReadyState;if(oDoc.onreadystatechange!=null&&typeof oDoc.onreadystatechange=="function"){oDoc.onreadystatechange();}};Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(!oDoc.onreadystatechange){oDoc.onreadystatechange=null;}
if(!oDoc.readyState){oDoc.readyState=0;}
oDoc.addEventListener("load",_sarissa_XMLDocument_onload,false);return oDoc;};if(window.XMLDocument){}
else if(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature('LS','3.0')){Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);return oDoc;};}
else{Sarissa.getDomDocument=function(sUri,sName){var oDoc=document.implementation.createDocument(sUri?sUri:null,sName?sName:null,null);if(oDoc&&(sUri||sName)&&!oDoc.documentElement){oDoc.appendChild(oDoc.createElementNS(sUri,sName));}
return oDoc;};}}}
if(!window.DOMParser){if(Sarissa._SARISSA_IS_SAFARI){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(sXml),false);xmlhttp.send(null);return xmlhttp.responseXML;};}else if(Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml){DOMParser=function(){};DOMParser.prototype.parseFromString=function(sXml,contentType){var doc=Sarissa.getDomDocument();doc.loadXML(sXml);return doc;};}}
if((typeof(document.importNode)=="undefined")&&Sarissa._SARISSA_IS_IE){try{document.importNode=function(oNode,bChildren){var tmp;if(oNode.nodeName=='#text'){return document.createTextNode(oNode.data);}
else{if(oNode.nodeName=="tbody"||oNode.nodeName=="tr"){tmp=document.createElement("table");}
else if(oNode.nodeName=="td"){tmp=document.createElement("tr");}
else if(oNode.nodeName=="option"){tmp=document.createElement("select");}
else{tmp=document.createElement("div");}
if(bChildren){tmp.innerHTML=oNode.xml?oNode.xml:oNode.outerHTML;}else{tmp.innerHTML=oNode.xml?oNode.cloneNode(false).xml:oNode.cloneNode(false).outerHTML;}
return tmp.getElementsByTagName("*")[0];}};}catch(e){}}
if(!Sarissa.getParseErrorText){Sarissa.getParseErrorText=function(oDoc){var parseErrorText=Sarissa.PARSED_OK;if((!oDoc)||(!oDoc.documentElement)){parseErrorText=Sarissa.PARSED_EMPTY;}else if(oDoc.documentElement.tagName=="parsererror"){parseErrorText=oDoc.documentElement.firstChild.data;parseErrorText+="\n"+oDoc.documentElement.firstChild.nextSibling.firstChild.data;}else if(oDoc.getElementsByTagName("parsererror").length>0){var parsererror=oDoc.getElementsByTagName("parsererror")[0];parseErrorText=Sarissa.getText(parsererror,true)+"\n";}else if(oDoc.parseError&&oDoc.parseError.errorCode!=0){parseErrorText=Sarissa.PARSED_UNKNOWN_ERROR;}
return parseErrorText;};}
Sarissa.getText=function(oNode,deep){var s="";var nodes=oNode.childNodes;for(var i=0;i<nodes.length;i++){var node=nodes[i];var nodeType=node.nodeType;if(nodeType==Node.TEXT_NODE||nodeType==Node.CDATA_SECTION_NODE){s+=node.data;}else if(deep===true&&(nodeType==Node.ELEMENT_NODE||nodeType==Node.DOCUMENT_NODE||nodeType==Node.DOCUMENT_FRAGMENT_NODE)){s+=Sarissa.getText(node,true);}}
return s;};if(!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml){XMLSerializer=function(){};XMLSerializer.prototype.serializeToString=function(oNode){return oNode.xml;};}
Sarissa.stripTags=function(s){return s?s.replace(/<[^>]+>/g,""):s;};Sarissa.clearChildNodes=function(oNode){while(oNode.firstChild){oNode.removeChild(oNode.firstChild);}};Sarissa.copyChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if(Sarissa._SARISSA_IS_SAFARI&&nodeTo.nodeType==Node.DOCUMENT_NODE){nodeTo=nodeTo.documentElement;}
if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}
if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}
var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var nodes=nodeFrom.childNodes;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}};Sarissa.moveChildNodes=function(nodeFrom,nodeTo,bPreserveExisting){if((!nodeFrom)||(!nodeTo)){throw"Both source and destination nodes must be provided";}
if(!bPreserveExisting){Sarissa.clearChildNodes(nodeTo);}
var nodes=nodeFrom.childNodes;if(nodeFrom.ownerDocument==nodeTo.ownerDocument){while(nodeFrom.firstChild){nodeTo.appendChild(nodeFrom.firstChild);}}else{var ownerDoc=nodeTo.nodeType==Node.DOCUMENT_NODE?nodeTo:nodeTo.ownerDocument;var i;if(typeof(ownerDoc.importNode)!="undefined"){for(i=0;i<nodes.length;i++){nodeTo.appendChild(ownerDoc.importNode(nodes[i],true));}}else{for(i=0;i<nodes.length;i++){nodeTo.appendChild(nodes[i].cloneNode(true));}}
Sarissa.clearChildNodes(nodeFrom);}};Sarissa.xmlize=function(anyObject,objectName,indentSpace){indentSpace=indentSpace?indentSpace:'';var s=indentSpace+'<'+objectName+'>';var isLeaf=false;if(!(anyObject instanceof Object)||anyObject instanceof Number||anyObject instanceof String||anyObject instanceof Boolean||anyObject instanceof Date){s+=Sarissa.escape(""+anyObject);isLeaf=true;}else{s+="\n";var isArrayItem=anyObject instanceof Array;for(var name in anyObject){s+=Sarissa.xmlize(anyObject[name],(isArrayItem?"array-item key=\""+name+"\"":name),indentSpace+"   ");}
s+=indentSpace;}
return(s+=(objectName.indexOf(' ')!=-1?"</array-item>\n":"</"+objectName+">\n"));};Sarissa.escape=function(sXml){return sXml.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");};Sarissa.unescape=function(sXml){return sXml.replace(/&apos;/g,"'").replace(/&quot;/g,"\"").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");};Sarissa.updateCursor=function(oTargetElement,sValue){if(oTargetElement&&oTargetElement.style&&oTargetElement.style.cursor!=undefined){oTargetElement.style.cursor=sValue;}};Sarissa.updateContentFromURI=function(sFromUrl,oTargetElement,xsltproc,callback,skipCache){try{Sarissa.updateCursor(oTargetElement,"wait");var xmlhttp=new XMLHttpRequest();xmlhttp.open("GET",sFromUrl,true);xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){try{var oDomDoc=xmlhttp.responseXML;if(oDomDoc&&Sarissa.getParseErrorText(oDomDoc)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(xmlhttp.responseXML,oTargetElement,xsltproc);if(callback){callback(sFromUrl,oTargetElement);}}
else{throw Sarissa.getParseErrorText(oDomDoc);}}
catch(e){if(callback){callback(sFromUrl,oTargetElement,e);}
else{throw e;}}}};if(skipCache){var oldage="Sat, 1 Jan 2000 00:00:00 GMT";xmlhttp.setRequestHeader("If-Modified-Since",oldage);}
xmlhttp.send("");}
catch(e){Sarissa.updateCursor(oTargetElement,"auto");if(callback){callback(sFromUrl,oTargetElement,e);}
else{throw e;}}};Sarissa.updateContentFromNode=function(oNode,oTargetElement,xsltproc){try{Sarissa.updateCursor(oTargetElement,"wait");Sarissa.clearChildNodes(oTargetElement);var ownerDoc=oNode.nodeType==Node.DOCUMENT_NODE?oNode:oNode.ownerDocument;if(ownerDoc.parseError&&ownerDoc.parseError.errorCode!=0){var pre=document.createElement("pre");pre.appendChild(document.createTextNode(Sarissa.getParseErrorText(ownerDoc)));oTargetElement.appendChild(pre);}
else{if(xsltproc){oNode=xsltproc.transformToDocument(oNode);}
if(oTargetElement.tagName.toLowerCase()=="textarea"||oTargetElement.tagName.toLowerCase()=="input"){oTargetElement.value=new XMLSerializer().serializeToString(oNode);}
else{try{oTargetElement.appendChild(oTargetElement.ownerDocument.importNode(oNode,true));}
catch(e){oTargetElement.innerHTML=new XMLSerializer().serializeToString(oNode);}}}}
catch(e){throw e;}
finally{Sarissa.updateCursor(oTargetElement,"auto");}};Sarissa.formToQueryString=function(oForm){var qs="";for(var i=0;i<oForm.elements.length;i++){var oField=oForm.elements[i];var sFieldName=oField.getAttribute("name")?oField.getAttribute("name"):oField.getAttribute("id");if(sFieldName&&((!oField.disabled)||oField.type=="hidden")){switch(oField.type){case"hidden":case"text":case"textarea":case"password":qs+=sFieldName+"="+encodeURIComponent(oField.value)+"&";break;case"select-one":qs+=sFieldName+"="+encodeURIComponent(oField.options[oField.selectedIndex].value)+"&";break;case"select-multiple":for(var j=0;j<oField.length;j++){var optElem=oField.options[j];if(optElem.selected===true){qs+=sFieldName+"[]"+"="+encodeURIComponent(optElem.value)+"&";}}
break;case"checkbox":case"radio":if(oField.checked){qs+=sFieldName+"="+encodeURIComponent(oField.value)+"&";}
break;}}}
return qs.substr(0,qs.length-1);};Sarissa.updateContentFromForm=function(oForm,oTargetElement,xsltproc,callback){try{Sarissa.updateCursor(oTargetElement,"wait");var params=Sarissa.formToQueryString(oForm)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true";var xmlhttp=new XMLHttpRequest();var bUseGet=oForm.getAttribute("method")&&oForm.getAttribute("method").toLowerCase()=="get";if(bUseGet){xmlhttp.open("GET",oForm.getAttribute("action")+"?"+params,true);}
else{xmlhttp.open('POST',oForm.getAttribute("action"),true);xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlhttp.setRequestHeader("Content-length",params.length);xmlhttp.setRequestHeader("Connection","close");}
xmlhttp.onreadystatechange=function(){try{if(xmlhttp.readyState==4){var oDomDoc=xmlhttp.responseXML;if(oDomDoc&&Sarissa.getParseErrorText(oDomDoc)==Sarissa.PARSED_OK){Sarissa.updateContentFromNode(xmlhttp.responseXML,oTargetElement,xsltproc);if(callback){callback(oForm,oTargetElement);}}
else{throw Sarissa.getParseErrorText(oDomDoc);}}}
catch(e){if(callback){callback(oForm,oTargetElement,e);}
else{throw e;}}};xmlhttp.send(bUseGet?"":params);}
catch(e){Sarissa.updateCursor(oTargetElement,"auto");if(callback){callback(oForm,oTargetElement,e);}
else{throw e;}}
return false;};Sarissa.FUNCTION_NAME_REGEXP=new RegExp("");Sarissa.getFunctionName=function(oFunc,bForce){var name;if(!name){if(bForce){name="SarissaAnonymous"+Sarissa._getUniqueSuffix();window[name]=oFunc;}
else{name=null;}}
if(name){window[name]=oFunc;}
return name;};Sarissa.setRemoteJsonCallback=function(url,callback,callbackParam){if(!callbackParam){callbackParam="callback";}
var callbackFunctionName=Sarissa.getFunctionName(callback,true);var id="sarissa_json_script_id_"+Sarissa._getUniqueSuffix();var oHead=document.getElementsByTagName("head")[0];var scriptTag=document.createElement('script');scriptTag.type='text/javascript';scriptTag.id=id;scriptTag.onload=function(){};if(url.indexOf("?")!=-1){url+=("&"+callbackParam+"="+callbackFunctionName);}
else{url+=("?"+callbackParam+"="+callbackFunctionName);}
scriptTag.src=url;oHead.appendChild(scriptTag);return id;};

// sarissa_ieemu_xpath.js

if(Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")){SarissaNodeList=function(i){this.length=i;};SarissaNodeList.prototype=[];SarissaNodeList.prototype.constructor=Array;SarissaNodeList.prototype.item=function(i){return(i<0||i>=this.length)?null:this[i];};SarissaNodeList.prototype.expr="";if(window.XMLDocument&&(!XMLDocument.prototype.setProperty)){XMLDocument.prototype.setProperty=function(x,y){};}
Sarissa.setXpathNamespaces=function(oDoc,sNsSet){oDoc._sarissa_useCustomResolver=true;var namespaces=sNsSet.indexOf(" ")>-1?sNsSet.split(" "):[sNsSet];oDoc._sarissa_xpathNamespaces=[];for(var i=0;i<namespaces.length;i++){var ns=namespaces[i];var colonPos=ns.indexOf(":");var assignPos=ns.indexOf("=");if(colonPos>0&&assignPos>colonPos+1){var prefix=ns.substring(colonPos+1,assignPos);var uri=ns.substring(assignPos+2,ns.length-1);oDoc._sarissa_xpathNamespaces[prefix]=uri;}else{throw"Bad format on namespace declaration(s) given";}}};XMLDocument.prototype._sarissa_useCustomResolver=false;XMLDocument.prototype._sarissa_xpathNamespaces=[];XMLDocument.prototype.selectNodes=function(sExpr,contextNode,returnSingle){var nsDoc=this;var nsresolver;if(this._sarissa_useCustomResolver){nsresolver=function(prefix){var s=nsDoc._sarissa_xpathNamespaces[prefix];if(s){return s;}
else{throw"No namespace URI found for prefix: '"+prefix+"'";}};}
else{nsresolver=this.createNSResolver(this.documentElement);}
var result=null;if(!returnSingle){var oResult=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var nodeList=new SarissaNodeList(oResult.snapshotLength);nodeList.expr=sExpr;for(var i=0;i<nodeList.length;i++){nodeList[i]=oResult.snapshotItem(i);}
result=nodeList;}
else{result=this.evaluate(sExpr,(contextNode?contextNode:this),nsresolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;}
return result;};Element.prototype.selectNodes=function(sExpr){var doc=this.ownerDocument;if(doc.selectNodes){return doc.selectNodes(sExpr,this);}
else{throw"Method selectNodes is only supported by XML Elements";}};XMLDocument.prototype.selectSingleNode=function(sExpr,contextNode){var ctx=contextNode?contextNode:null;return this.selectNodes(sExpr,ctx,true);};Element.prototype.selectSingleNode=function(sExpr){var doc=this.ownerDocument;if(doc.selectSingleNode){return doc.selectSingleNode(sExpr,this);}
else{throw"Method selectNodes is only supported by XML Elements";}};Sarissa.IS_ENABLED_SELECT_NODES=true;}

// jquery.xslt.js

var xslTransform={version:20071203,debug:false,init:function(){try{parseFloat(jQuery.fn.jquery)>=1;}catch(e){alert('xslTransform requires jQuery 1.0.4 or greater ... please load it prior to xslTransform');}
try{Sarissa;}catch(e){alert('Missing Sarissa ... please load it prior to xslTransform');}
if(!jQuery.log){jQuery.log=function(){};jQuery.fn.debug=function(){};}
if(this.debug)jQuery.log('xslTransform:init(): version '+xslTransform.version);},XMLSerializer:new XMLSerializer(),serialize:function(data){if(this.debug)jQuery.log('serialize(): received '+typeof(data));if(typeof(data)=='string'){return data;}
return this.XMLSerializer.serializeToString(data);},load:function(xml,meth){if(this.debug)jQuery.log('load(): received '+typeof(xml));var r;if(typeof(xml)=='object'){return xml;}
if(xml.substring(0,1)=='<'){r=this.loadString(xml);}else{r=this.loadFile(xml,meth);}
if(r){r.setProperty('SelectionNamespaces','xmlns:xsl="http://www.w3.org/1999/XSL/Transform"');r.setProperty('SelectionLanguage','XPath');return r;}else{if(this.debug)$.log('Unable to load '+xml);return false;}},loadString:function(str){if(this.debug)jQuery.log('loadString(): '+str+'::'+typeof(str));var p=new DOMParser();var xml=p.parseFromString(str,'text/xml');if(!xml){if(this.debug)jQuery.log('loadString(): parseFromString() failed');return false;}
return xml;},loadFile:function(url,meth){if(this.debug)jQuery.log('loadFile(): '+url+'::'+typeof(url));if(!url){if(this.debug)jQuery.log('ERROR: loadFile() missing url');return false;}
var doc;this.xhrsuccess=function(data,str){if(this.debug)jQuery.log('loadFile() completed successfully ('+str+')');doc=data;return true;};this.xhrerror=function(xhr,err){window.DEBUG=true;if(this.debug)jQuery.log('loadFile() failed to load the requested file: ('+err+') - xml: '+xhr.responseXML+' - text: '+xhr.responseText);doc=null;return false;};if(!meth)meth="GET";$.ajax({type:meth,url:url,async:false,success:this.xhrsuccess,error:this.xhrerror});if(!doc){if(this.debug)jQuery.log('ERROR: document '+url+' not found (404), or unable to load');return false;}
if(doc.length==0){if(this.debug)jQuery.log('ERROR: document '+url+' loaded in loadFile() has no data');return false;}
return doc;},transform:function(xsl,xml,options){var log={'xsl':xsl,'xml':xml,'options':options};if(this.debug)jQuery.log('transform(): '+xsl+'::'+xml+'::'+options.toString());options=options||{};var xml={'request':xml,'doc':this.load(xml,options.meth)};if(options.xpath&&xml.doc&&!jQuery.browser.msie){xml.doc=xml.doc.selectSingleNode(options.xpath.toString());if(this.debug)$.log('transform(): xpath has been run...resulting doc: '+(this.serialize(xml.doc)));}
var result={'xsl':this.load(xsl,options.meth)};result.json=false;if(options.json&&xml.doc){result.json=xml.doc.selectSingleNode(options.json.toString());}
var processor=new XSLTProcessor();processor.importStylesheet(result.xsl);if(options.params&&processor){if(this.debug)jQuery.log('transform(): received xsl params: '+options.params.toString());for(key in options.params){processor.setParameter(null,key.toString(),options.params[key].toString());}}
result.doc=processor.transformToDocument(xml.doc);var errorTxt=Sarissa.getParseErrorText(result.doc);if(this.debug)jQuery.log('transform(): Sarissa parse text: '+errorTxt);if(errorTxt!=Sarissa.PARSED_OK){result.string=Sarissa.getParseErrorText(result.doc)+' :: using '+xsl+' => '+xml.request;if(this.debug)jQuery.log('transform(): error in transformation: '+Sarissa.getParseErrorText(result.doc));return result;}
result.string=this.serialize(result.doc);result.scripts=jQuery('script',result.doc).text();return result;}};xslTransform.init();jQuery.fn.getTransform=function(xsl,xml,options){var settings={append:false,params:{},xpath:'',eval:true,callback:'',json:false,meth:"GET"};jQuery.extend(settings,options);if(xslTransform.debug)jQuery.log('getTransform: '+xsl+'::'+xml+'::'+settings.toString());if(!xsl||!xml){if(xslTransform.debug)jQuery.log('getTransform: missing xsl or xml');return;}
return this.each(function(){var trans=xslTransform.transform(xsl,xml,settings);var re=trans.string.match(/<\?xml.*?\?>/);if(re){trans.string=trans.string.replace(re,'');if(xslTransform.debug)jQuery.log('getTransform(): found an xml declaration and removed it');}
try{if(settings.append)$(this).append(trans.string);else if(settings.repl)$(this).replaceWith(trans.string);else $(this).html(trans.string);}catch(e){if(xslTransform.debug)$.log('getTransform: error placing results of transform into element, falling back to innerHTML: '+e.toString());$(this)[0].innerHTML=trans.string;}
if(settings.eval&&trans.scripts){if(trans.scripts.length>0){if(xslTransform.debug)jQuery.log('Found text/javascript in transformed result');eval.call(window,trans.scripts);}}
if(settings.callback&&jQuery.isFunction(settings.callback)){var json=false;if(settings.json&&trans.json)eval("json = "+trans.json.firstChild.data);settings.callback.apply(window,[trans.string,json]);}});};

// jquery.metadata.js

(function($){$.extend({metadata:{defaults:{type:'class',name:'metadata',cre:/({.*})/,single:'metadata'},setType:function(type,name){this.defaults.type=type;this.defaults.name=name;},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length)settings.single='metadata';var data=$.data(elem,settings.single);if(data)return data;data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m)
data=m[1];}else if(settings.type=="elem"){if(!elem.getElementsByTagName)
return undefined;var e=elem.getElementsByTagName(settings.name);if(e.length)
data=$.trim(e[0].innerHTML);}else if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr)
data=attr;}
if(data.indexOf('{')<0)
data="{"+data+"}";data=eval("("+data+")");$.data(elem,settings.single,data);return data;}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts);};})(jQuery);

// jquery.cookie.js

jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}
return cookieValue;}};
/*
 * jsTree 0.9.5
 *
 * Copyright (c) 2008 Ivan Bozhanov (vakata.com)
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Date: 2009-01-03
 *
 */
//jshint ignore:start
//jscs:disable

// browser fix
jQuery.browser = {};
jQuery.browser.mozilla = /mozilla/.test(navigator.userAgent.toLowerCase()) && !/webkit/.test(navigator.userAgent.toLowerCase());
jQuery.browser.webkit = /webkit/.test(navigator.userAgent.toLowerCase());
jQuery.browser.opera = /opera/.test(navigator.userAgent.toLowerCase());
jQuery.browser.msie = /msie/.test(navigator.userAgent.toLowerCase());

// jQuery plugin
jQuery.fn.tree = function (opts) {
    return this.each(function() {
        if(tree_component.inst && tree_component.inst[jQuery(this).attr('id')]) {
            tree_component.inst[jQuery(this).attr('id')].destroy();
        }
        if(opts !== false) {
            var tmp = new tree_component();
            tmp.init(this, opts);
        }
    });
};

// core
function tree_component () {
    // instance manager
    if(typeof tree_component.inst == "undefined") {
        tree_component.cntr = 0;
        tree_component.inst = [];
        tree_component.drop = [];

        tree_component.focusInst = function () {
            return tree_component.inst[tree_component.focused];
        }
        tree_component.mousedown = function(event) {
            $('html').attr('data-touch-action', 'none');
            var _this = tree_component.focusInst();
            if(!_this) return;

            var tmp = jQuery(event.target);
            if(tree_component.drop.length && tmp.is("." + tree_component.drop.join(", .")) ) {
                _this.drag = jQuery("<li id='dragged' class='dragged foreign " + event.target.className + "'><a href='#'>" + tmp.text() + "</a></li>");
                _this._drag = _this.drag;
                _this.isdown    = true;
                _this.foreign    = tmp;
                tmp.blur();
                event.preventDefault();
                event.stopPropagation();
                return false;
            }
            event.stopPropagation();
            return true;
        };
        tree_component.mouseup = function(event) {
            $('html').removeAttr('data-touch-action');
            var _this = tree_component.focusInst();
            if(!_this) return;


            // CLEAR TIMEOUT FOR OPENING HOVERED NODES WHILE DRAGGING
            if(tree_component.to)    clearTimeout(tree_component.to);
            if(tree_component.sto)    clearTimeout(tree_component.sto);
            if(_this.foreign === false && _this.drag && _this.drag.parentNode && _this.drag.parentNode == jQuery(_this.container).children("ul:eq(0)").get(0)) {
                jQuery(_this.drag).remove();
                // CALL FUNCTION FOR COMPLETING MOVE
                if(_this.moveType) {
                    var tmp = tree_component.inst[jQuery(_this.moveRef).parents(".tree:eq(0)").attr("id")];
                    if(tmp) {
                        tmp.moved(_this.container.find("li.dragged"), _this.moveRef, _this.moveType, false, (_this.settings.rules.drag_copy == "on" || (_this.settings.rules.drag_copy == "ctrl" && event.ctrlKey) ) );
                    }
                }
                _this.moveType = false;
                _this.moveRef = false;
            }
            if(_this.drag && _this.foreign !== false) {
                jQuery(_this.drag).remove();
                if(_this.moveType) {
                    var tmp = tree_component.inst[jQuery(_this.moveRef).parents(".tree:eq(0)").attr("id")];
                    if(tmp) {
                        tmp.settings.callback.ondrop.call(null, _this.foreign.get(0), _this.get_node( _this.moveRef).get(0), _this.moveType, _this);
                    }
                }
                _this.foreign = false;
                _this.moveType = false;
                _this.moveRef = false;
            }
            // RESET EVERYTHING
            jQuery("#marker").hide();
            _this._drag        = false;
            _this.drag        = false;
            _this.isdown    = false;
            _this.appended    = false;
            _this.container.find("li.dragged").removeClass("dragged");
            event.preventDefault();
            event.stopPropagation();
            return false;
        };
        tree_component.mousemove = function(event) {
            var _this = tree_component.focusInst();
            if(!_this) return;

            if(_this.locked) return _this.error("LOCKED");
            if(_this.isdown) {
                // CLEAR TIMEOUT FOR OPENING HOVERED NODES WHILE DRAGGING
                if(tree_component.to) clearTimeout(tree_component.to);
                if(!_this.appended) {
                    _this.container.children("ul:eq(0)").append(_this.drag);
                    var tmp = jQuery(_this.drag).offsetParent();
                    if(tmp.is("html")) tmp = jQuery("body");
                    _this.po = tmp.offset();
                    _this.appended = true;
                }
                jQuery(_this.drag).css({ "left" : (event.originalEvent.pageX - _this.po.left - (_this.settings.ui.rtl ? jQuery(_this.drag).width() : -5 ) ), "top" : (event.originalEvent.pageY - _this.po.top  + (jQuery.browser.opera ? _this.container.scrollTop() : 0) + 15) });

                if(event.target.tagName == "IMG" && event.target.id == "marker") return false;

                var cnt = jQuery(event.target).parents(".tree:eq(0)");

                // if not moving over a tree
                if(cnt.size() == 0) {
                    if(tree_component.sto) clearTimeout(tree_component.sto);
                    if(jQuery(_this.drag).children("IMG").size() == 0) {
                        jQuery(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right" : "left" ) + ":4px; top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                    }
                    _this.moveType = false;
                    _this.moveRef  = false;
                    jQuery("#marker").hide();
                    return false;
                }

                tree_component.inst[cnt.attr("id")].off_height();

                // if moving over another tree and multitree is false
                if( _this.foreign === false && cnt.get(0) != _this.container.get(0) && (!_this.settings.rules.multitree || !tree_component.inst[cnt.attr("id")].settings.rules.multitree) ) {
                    if(jQuery(_this.drag).children("IMG").size() == 0) {
                        jQuery(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right" : "left" ) + ":4px; top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                    }
                    _this.moveType = false;
                    _this.moveRef  = false;
                    jQuery("#marker").hide();
                    return false;
                }

                if(tree_component.sto) clearTimeout(tree_component.sto);
                tree_component.sto = setTimeout( function() { tree_component.inst[cnt.attr("id")].scrollCheck(event.originalEvent.pageX,event.originalEvent.pageY); }, 50);

                var mov = false;
                var st = cnt.scrollTop();

                if(event.target.tagName == "A" && event.target.className=="title") {
                    // just in case if hover is over the draggable
                    if(jQuery(event.target).is("#dragged")) return false;

                    var goTo = {
                        x : (jQuery(event.target).offset().left - 1),
                        y : (event.originalEvent.pageY - tree_component.inst[cnt.attr("id")].offset.top)
                    }
                    if(cnt.hasClass("rtl")) {
                        goTo.x += jQuery(event.target).width() - 8;
                    }
                    if( (goTo.y + st)%_this.li_height < _this.li_height/3 + 1 ) {
                        mov = "before";
                        goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height - 2 ;
                    }
                    else if((goTo.y + st)%_this.li_height > _this.li_height*2/3 - 1 ) {
                        mov = "after";
                        goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height + _this.li_height - 2 ;
                    }
                    else {
                        mov = "inside";
                        goTo.x -= 2;
                        if(cnt.hasClass("rtl")) {
                            goTo.x += 36;
                        }
                        goTo.y = event.originalEvent.pageY - (goTo.y + st)%_this.li_height + Math.floor(_this.li_height/2) - 2 ;
                        if(_this.get_node(event.target).hasClass("closed")) {
                            tree_component.to = setTimeout( function () { _this.open_branch(_this.get_node(event.target)); }, 500);
                        }
                    }

                    if(tree_component.inst[cnt.attr("id")].checkMove(_this.container.find("li.dragged"), jQuery(event.target), mov)) {
                        if(mov == "inside")    jQuery("#marker").attr("src", _this.settings.ui.theme_path + "default/plus.gif").width(14);
                        else {
                            if(cnt.hasClass("rtl"))    { jQuery("#marker").attr("src", _this.settings.ui.theme_path + "default/marker_rtl.gif").width(40); }
                            else                    { jQuery("#marker").attr("src", _this.settings.ui.theme_path + "default/marker.gif").width(40); }
                        }
                        _this.moveType    = mov;
                        _this.moveRef    = event.target;
                        jQuery(_this.drag).children("IMG").remove();
                        jQuery("#marker").css({ "left" : goTo.x-1 , "top" : goTo.y-2 }).show();
                    }
                    else {
                        if(jQuery(_this.drag).children("IMG").size() == 0) {
                            jQuery(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right:0px;" : "left:4px;" ) + " top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                        }
                        _this.moveType = false;
                        _this.moveRef = false;
                        jQuery("#marker").hide();
                    }
                }
                else {
                    if(jQuery(_this.drag).children("IMG").size() == 0) {
                        jQuery(_this.drag).append("<img class='removeicon' style='position:absolute; " + (_this.settings.ui.rtl ? "right:0px;" : "left:4px;" ) + " top:0px;' src='" + _this.settings.ui.theme_path + "default/remove.gif' />");
                    }
                    _this.moveType = false;
                    _this.moveRef = false;
                    jQuery("#marker").hide();
                }
                event.preventDefault();
                event.stopPropagation();
                return false;
            }
            return true;
        };
    }
    return {
        cntr : tree_component.cntr ++,
        settings : {
            data    : {
                type    : "predefined",    // ENUM [json, xml_flat, xml_nested, predefined]
                method    : "GET",        // HOW TO REQUEST FILES
                async    : false,        // BOOL - async loading onopen
                async_data : function (NODE) { return { id : jQuery(NODE).attr("id") || 0 } }, // PARAMETERS PASSED TO SERVER
                url        : false,        // FALSE or STRING - url to document to be used (async or not)
                json    : false            // FALSE or OBJECT if type is JSON and async is false - the tree dump as json
            },
            selected    : false,        // FALSE or STRING or ARRAY
            opened        : [],            // ARRAY OF INITIALLY OPENED NODES
            languages    : [],            // ARRAY of string values (which will be used as CSS classes - si they must be valid)
            path        : false,        // FALSE or STRING (if false - will be autodetected)
            cookies        : false,        // FALSE or OBJECT (prefix, opts - from jqCookie - expires, path, domain, secure)
            ui        : {
                dots        : true,        // BOOL - dots or no dots
                rtl            : false,    // BOOL - is the tree right-to-left
                animation    : 0,        // INT - duration of open/close animations in miliseconds
                hover_mode    : true,        // SHOULD get_* functions chage focus or change hovered item
                scroll_spd    : 4,
                theme_path    : false,    // Path to themes
                theme_name    : "default",// Name of theme
                context        : [
                    {
                        id        : "create",
                        label    : "Create",
                        icon    : "create.png",
                        visible    : function (NODE, TREE_OBJ) { if(NODE.length != 1) return false; return TREE_OBJ.check("creatable", NODE); },
                        action    : function (NODE, TREE_OBJ) { TREE_OBJ.create(false, NODE); }
                    },
                    "separator",
                    {
                        id        : "rename",
                        label    : "Rename",
                        icon    : "rename.png",
                        visible    : function (NODE, TREE_OBJ) { if(NODE.length != 1) return false; return TREE_OBJ.check("renameable", NODE); },
                        action    : function (NODE, TREE_OBJ) { TREE_OBJ.rename(); }
                    },
                    {
                        id        : "delete",
                        label    : "Delete",
                        icon    : "remove.gif",
                        visible    : function (NODE, TREE_OBJ) { return TREE_OBJ.check("deletable", NODE); },
                        action    : function (NODE, TREE_OBJ) { NODE.each( function () { TREE_OBJ.remove(this); }); }
                    }
                ]
            },
            rules    : {
                multiple    : false,    // FALSE | CTRL | ON - multiple selection off/ with or without holding Ctrl
                metadata    : false,    // FALSE or STRING - attribute name (use metadata plugin)
                type_attr    : "rel",    // STRING attribute name (where is the type stored if no metadata)
                multitree    : false,    // BOOL - is drag n drop between trees allowed
                createat    : "bottom",    // STRING (top or bottom) new nodes get inserted at top or bottom
                use_inline    : false,    // CHECK FOR INLINE RULES - REQUIRES METADATA
                clickable    : "all",    // which node types can the user select | default - all
                renameable    : "all",    // which node types can the user select | default - all
                deletable    : "all",    // which node types can the user delete | default - all
                creatable    : "all",    // which node types can the user create in | default - all
                draggable    : "none",    // which node types can the user move | default - none | "all"
                dragrules    : "all",    // what move operations between nodes are allowed | default - none | "all"
                drag_copy    : false,    // FALSE | CTRL | ON - drag to copy off/ with or without holding Ctrl
                droppable    : []
            },
            lang : {
                new_node    : "New folder",
                loading        : "Loading ..."
            },
            callback    : {                // various callbacks to attach custom logic to
                // before focus  - should return true | false
                beforechange: function(NODE,TREE_OBJ) { return true },
                // before move   - should return true | false
                beforemove  : function(NODE,REF_NODE,TYPE,TREE_OBJ) { return true },
                // before create - should return true | false
                beforecreate: function(NODE,REF_NODE,TYPE,TREE_OBJ) { return true },
                // before rename - should return true | false
                beforerename: function(NODE,LANG,TREE_OBJ) { return true },
                // before delete - should return true | false
                beforedelete: function(NODE,TREE_OBJ) { return true },

                onchange    : function(NODE,TREE_OBJ) { },                    // focus changed
                onrename    : function(NODE,LANG,TREE_OBJ) { },                // node renamed ISNEW - TRUE|FALSE, current language
                onmove        : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // move completed (TYPE is BELOW|ABOVE|INSIDE)
                oncopy        : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // copy completed (TYPE is BELOW|ABOVE|INSIDE)
                oncreate    : function(NODE,REF_NODE,TYPE,TREE_OBJ) { },    // node created, parent node (TYPE is insertAt)
                ondelete    : function(NODE, TREE_OBJ) { },                    // node deleted
                onopen        : function(NODE, TREE_OBJ) { },                    // node opened
                onclose        : function(NODE, TREE_OBJ) { },                    // node closed
                error        : function(TEXT, TREE_OBJ) { },                    // error occured
                // double click on node - defaults to open/close & select
                ondblclk    : function(NODE, TREE_OBJ) { TREE_OBJ.toggle_branch.call(TREE_OBJ, NODE); TREE_OBJ.select_branch.call(TREE_OBJ, NODE); },
                // right click - to prevent use: EV.preventDefault(); EV.stopPropagation(); return false
                onrgtclk    : function(NODE, TREE_OBJ, EV) { },
                onload        : function(TREE_OBJ) { },
                onfocus        : function(TREE_OBJ) { },
                ondrop        : function(NODE,REF_NODE,TYPE,TREE_OBJ) {}
            }
        },
        // INITIALIZATION
        init : function(elem, opts) {
            var _this = this;
            this.container        = jQuery(elem);
            if(this.container.size == 0) { alert("Invalid container node!"); return }

            tree_component.inst[this.cntr] = this;
            if(!this.container.attr("id")) this.container.attr("id","jstree_" + this.cntr);
            tree_component.inst[this.container.attr("id")] = tree_component.inst[this.cntr];
            tree_component.focused = this.cntr;

            // MERGE OPTIONS WITH DEFAULTS
            if(opts && opts.cookies) {
                this.settings.cookies = jQuery.extend({},this.settings.cookies,opts.cookies);
                delete opts.cookies;
                if(!this.settings.cookies.opts) this.settings.cookies.opts = {};
            }
            if(opts && opts.callback) {
                this.settings.callback = jQuery.extend({},this.settings.callback,opts.callback);
                delete opts.callback;
            }
            if(opts && opts.data) {
                this.settings.data = jQuery.extend({},this.settings.data,opts.data);
                delete opts.data;
            }
            if(opts && opts.ui) {
                this.settings.ui = jQuery.extend({},this.settings.ui,opts.ui);
                delete opts.ui;
            }
            if(opts && opts.rules) {
                this.settings.rules = jQuery.extend({},this.settings.rules,opts.rules);
                delete opts.rules;
            }
            if(opts && opts.lang) {
                this.settings.lang = jQuery.extend({},this.settings.lang,opts.lang);
                delete opts.lang;
            }
            this.settings        = jQuery.extend({},this.settings,opts);

            // PATH TO IMAGES AND XSL
            if(this.settings.path == false) {
                this.path = "";
                jQuery("script").each( function () {
                    if(this.src.toString().match(/tree_component.*?js.*$/)) {
                        _this.path = this.src.toString().replace(/tree_component.*?js.*$/, "");
                    }
                });
            }
            else this.path = this.settings.path;

            // DEAL WITH LANGUAGE VERSIONS
            this.current_lang    = this.settings.languages && this.settings.languages.length ? this.settings.languages[0] : false;
            if(this.settings.languages && this.settings.languages.length) {
                this.sn = get_sheet_num("tree_component.css");
                var st = false;
                var id = this.container.attr("id") ? "#" + this.container.attr("id") : ".tree";
                for(var ln = 0; ln < this.settings.languages.length; ln++) {
                    st = add_css(id + " ." + this.settings.languages[ln], this.sn);
                    if(st !== false) {
                        if(this.settings.languages[ln] == this.current_lang)    st.style.display = "inline";
                        else                                                    st.style.display = "none";
                    }
                }
            }

            // DROPPABLES
            if(this.settings.rules.droppable.length) {
                for(i in this.settings.rules.droppable) {
                    tree_component.drop.push(this.settings.rules.droppable[i]);
                    tree_component.drop = jQuery.unique(tree_component.drop);
                }
            }

            // THEMES
            if(this.settings.ui.theme_path === false) this.settings.ui.theme_path = this.path + "themes/";
            this.theme = this.settings.ui.theme_path + _this.settings.ui.theme_name + "/";
            add_sheet(_this.settings.ui.theme_path + "default/style.css");
            if(this.settings.ui.theme_name != "default") add_sheet(_this.theme + "style.css");

            this.container.addClass("tree");
            if(this.settings.ui.rtl) this.container.addClass("rtl");
            if(this.settings.rules.multiple) this.selected_arr = [];
            this.offset = false;

            if(this.settings.ui.dots == false) this.container.addClass("no_dots");

            // CONTEXT MENU
            this.context = false;
            if(this.settings.ui.context != false) {
                var str = '<div class="context">';
                for(i in this.settings.ui.context) {
                    if(this.settings.ui.context[i] == "separator") {
                        str += "<span class='separator'>&nbsp;</span>";
                        continue;
                    }
                    var icn = "";
                    if(this.settings.ui.context[i].icon) icn = 'background-image:url(\'' + ( this.settings.ui.context[i].icon.indexOf("/") == -1 ? this.theme + this.settings.ui.context[i].icon : this.settings.ui.context[i].icon ) + '\');';
                    str += '<a rel="' + this.settings.ui.context[i].id + '" href="#" style="' + icn + '">' + this.settings.ui.context[i].label + '</a>';
                }
                str += '</div>';
                this.context = jQuery(str);
                this.context.hide();
                this.context.append = false;
            }

            this.hovered = false;
            this.locked = false;

            // CREATE DUMMY FOR MOVING
            if(this.settings.rules.draggable != "none" && this.settings.rules.dragrules != "none") {
                var _this = this;
                jQuery("<img>")
                    .attr({
                        id        : "marker",
                        src    : _this.settings.ui.theme_path + "default/marker.gif"
                    })
                    .css({
                        height        : "8px",
                        width        : "42px",
                        display        : "block",
                        position    : "absolute",
                        left        : "30px",
                        top            : "30px",
                        zIndex        : "1000"
                    }).hide().appendTo("body");
            }
            this.refresh();
            this.attachEvents();
            this.focus();
        },
        off_height : function () {
            if(this.offset === false) {
                this.container.css({ position : "relative" });
                this.offset = this.container.offset();
                var tmp = 0;
                tmp = parseInt(jQuery.css(this.container.get(0), "paddingTop", true),10);
                if(tmp) this.offset.top += tmp;
                tmp = parseInt(jQuery.css(this.container.get(0), "borderTopWidth", true),10);
                if(tmp) this.offset.top += tmp;
                this.container.css({ position : "" });
            }
            if(!this.li_height) {
                var tmp = this.container.find("ul li:eq(0)");
                this.li_height = tmp.find('.title:first').height() + 1;
                if(!this.li_height) this.li_height = 18;
            }
        },
        // REPAINT TREE
        refresh : function (obj) {
            if(this.locked) return this.error("LOCKED");
            var _this = this;

            // SAVE OPENED
            this.opened = Array();
            if(this.settings.cookies && jQuery.cookie(this.settings.cookies.prefix + '_open')) {
                var str = jQuery.cookie(this.settings.cookies.prefix + '_open');
                var tmp = str.split(",");
                jQuery.each(tmp, function () {
                    _this.opened.push("#" + this.replace(/^#/,""));
                });
                this.settings.opened = false;
            }
            else if(this.settings.opened != false) {
                jQuery.each(this.settings.opened, function (i, item) {
                    _this.opened.push("#" + this.replace(/^#/,""));
                });
                this.settings.opened = false;
            }
            else {
                this.container.find("li.open").each(function (i) { _this.opened.push("#" + this.id); });
            }

            // SAVE SELECTED
            if(this.selected) {
                this.settings.selected = Array();
                if(this.selected_arr) {
                    jQuery.each(this.selected_arr, function () {
                        _this.settings.selected.push("#" + this.attr("id"));
                    });
                }
                else this.settings.selected.push("#" + this.selected.attr("id"));
            }
            /*else if(this.settings.cookies && jQuery.cookie(this.settings.cookies.prefix + '_selected')) {
                this.settings.selected = Array();
                var str = jQuery.cookie(this.settings.cookies.prefix + '_selected');
                var tmp = str.split(",");
                jQuery.each(tmp, function () {
                    _this.settings.selected.push("#" + this.replace(/^#/,""));
                });
            }*/
            else if(this.settings.selected !== false) {
                var tmp = Array();
                if((typeof this.settings.selected).toLowerCase() == "object") {
                    jQuery.each(this.settings.selected, function () {
                        tmp.push("#" + this.replace(/^#/,""));
                    });
                }
                else tmp.push("#" + this.settings.selected.replace(/^#/,""));
                this.settings.selected = tmp;
            }

            if(obj && this.settings.data.async) {
                this.opened = Array();
                obj = this.get_node(obj);
                obj.find("li.open").each(function (i) { _this.opened.push("#" + this.id); });
                this.close_branch(obj, true);
                obj.children("ul:eq(0)").html("");
                return this.open_branch(obj, true, function () { _this.reselect.apply(_this); });
            }

            var cls = "tree-default";
            if(this.settings.ui.theme_name != "default") cls += " tree-" + _this.settings.ui.theme_name;

            if(this.settings.data.type == "xml_flat" || this.settings.data.type == "xml_nested") {
                this.scrtop = this.container.get(0).scrollTop;
                var xsl = (this.settings.data.type == "xml_flat") ? "flat.xsl" : "nested.xsl";
                this.container.getTransform(this.path + xsl, this.settings.data.url, { params : { theme_name : cls, theme_path : _this.theme }, meth : _this.settings.data.method ,callback: function () { _this.reselect.apply(_this); } });
                return;
            }
            else if(this.settings.data.type == "json") {
                if(this.settings.data.json) {
                    var str = "";
                    if(this.settings.data.json.length) {
                        for(var i = 0; i < this.settings.data.json.length; i++) {
                            str += this.parseJSON(this.settings.data.json[i]);
                        }
                    } else str = this.parseJSON(this.settings.data.json);
                    this.container.html("<ul class='" + cls + "'>" + str + "</ul>");
                    this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                    this.container.find("li").not(".open").not(".closed").addClass("leaf");
                    this.reselect();
                }
                else {
                    var _this = this;
                    jQuery.ajax({
                        type        : this.settings.data.method,
                        url            : this.settings.data.url,
                        data        : this.settings.data.async_data(false),
                        dataType    : "json",
                        success        : function (data) {
                            var str = "";
                            if(data.length) {
                                for(var i = 0; i < data.length; i++) {
                                    str += _this.parseJSON(data[i]);
                                }
                            } else str = _this.parseJSON(data);
                            _this.container.html("<ul class='" + cls + "'>" + str + "</ul>");
                            _this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                            _this.container.find("li").not(".open").not(".closed").addClass("leaf");
                            _this.reselect.apply(_this);
                        }
                    });
                }
            }
            else {
                this.container.children("ul:eq(0)").attr("class", cls);
                this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                this.container.find("li").not(".open").not(".closed").addClass("leaf");
                this.reselect();
            }
        },
        // CONVERT JSON TO HTML
        parseJSON : function (data) {
            var str = "";
            str += "<li ";
            var cls = false;
            for(i in data.attributes) {
                if(i == "class") {
                    str += " class='" + data.attributes[i] + " ";
                    if(data.state == "closed" || data.state == "open") str += " " + data.state + " ";
                    str += "' ";
                    cls = true;
                }
                else str += " " + i + "='" + data.attributes[i] + "' ";
            }
            if(!cls && (data.state == "closed" || data.state == "open")) str += " class='" + data.state + "' ";
            str += ">";
            if(this.settings.languages.length) {
                for(var i = 0; i < this.settings.languages.length; i++) {
                    var attr = [];
                    attr["href"] = "#";
                    attr["style"] = "";
                    attr["class"] = this.settings.languages[i];
                    if(data.data[this.settings.languages[i]] && (typeof data.data[this.settings.languages[i]].attributes).toLowerCase() != "undefined") {
                        for(j in data.data[this.settings.languages[i]].attributes) {
                            if(j == "style" || j == "class")    attr[j] += " " + data.data[this.settings.languages[i]].attributes[j];
                            else                                attr[j]  = data.data[this.settings.languages[i]].attributes[j];
                        }
                    }
                    if(data.data[this.settings.languages[i]] && data.data[this.settings.languages[i]].icon) {
                        var icn = data.data[this.settings.languages[i]].icon.indexOf("/") == -1 ? this.theme + data.data[this.settings.languages[i]].icon : data.data[this.settings.languages[i]].icon;
                        attr["style"] += " ; background-image:url('" + icn + "'); ";
                    }
                    str += "<a";
                    for(j in attr) str += ' ' + j + '="' + attr[j] + '" ';
                    str += ">" + ( (typeof data.data[this.settings.languages[i]].title).toLowerCase() != "undefined" ? data.data[this.settings.languages[i]].title : data.data[this.settings.languages[i]] ) + "</a>";
                }
            }
            else {
                var attr = [];
                attr["href"] = "#";
                attr["style"] = "";
                attr["class"] = "";
                if((typeof data.data.attributes).toLowerCase() != "undefined") {
                    for(i in data.data.attributes) {
                        if(i == "style" || i == "class")    attr[i] += " " + data.data.attributes[i];
                        else                                attr[i]  = data.data.attributes[i];
                    }
                }
                if(data.data.icon) {
                    var icn = data.data.icon.indexOf("/") == -1 ? this.theme + data.data.icon : data.data.icon;
                    attr["style"] += " ; background-image:url('" + icn + "');";
                }
                str += "<a";
                for(i in attr) str += ' ' + i + '="' + attr[i] + '" ';
                str += ">" + ( (typeof data.data.title).toLowerCase() != "undefined" ? data.data.title : data.data ) + "</a>";
            }
            if(data.children && data.children.length) {
                str += '<ul>';
                for(var i = 0; i < data.children.length; i++) {
                    str += this.parseJSON(data.children[i]);
                }
                str += '</ul>';
            }
            str += "</li>";
            return str;
        },
        // getJSON from HTML
        getJSON : function (nod, outer_attrib, inner_attrib, force) {
            var _this = this;
            if(!nod || jQuery(nod).size() == 0) {
                nod = this.container.children("ul").children("li");
            }
            else nod = jQuery(nod);

            if(nod.size() > 1) {
                var arr = [];
                nod.each(function () {
                    arr.push(_this.getJSON(this, outer_attrib, inner_attrib));
                });
                return arr;
            }

            if(!outer_attrib) outer_attrib = [ "id", "rel", "class" ];
            if(!inner_attrib) inner_attrib = [ ];
            var obj = { attributes : {}, data : false };
            for(i in outer_attrib) {
                obj.attributes[outer_attrib[i]] = nod.attr(outer_attrib[i]);
            }
            if(this.settings.languages.length) {
                obj.data = {};
                for(i in this.settings.languages) {
                    var a = nod.children("a." + this.settings.languages[i]);
                    if(force || inner_attrib.length || a.get(0).style.backgroundImage.toString().length) {
                        obj.data[this.settings.languages[i]] = {};
                        obj.data[this.settings.languages[i]].title = a.text();
                        if(a.get(0).style.backgroundImage.length) {
                            obj.data[this.settings.languages[i]].icon = a.get(0).style.backgroundImage.replace("url(","").replace(")","");
                        }
                        if(inner_attrib.length) {
                            obj.data[this.settings.languages[i]].attributes = {};
                            for(j in inner_attrib) {
                                obj.data[this.settings.languages[i]].attributes[inner_attrib[j]] = a.attr(inner_attrib[j]);
                            }
                        }
                    }
                    else {
                        obj.data[this.settings.languages[i]] = a.text();
                    }
                }
            }
            else {
                var a = nod.children("a");
                if(force || inner_attrib.length || a.get(0).style.backgroundImage.toString().length) {
                    obj.data = {};
                    obj.data.title = a.text();
                    if(a.get(0).style.backgroundImage.length) {
                        obj.data.icon = a.get(0).style.backgroundImage.replace("url(","").replace(")","");
                    }
                    if(inner_attrib.length) {
                        obj.data.attributes = {};
                        for(j in inner_attrib) {
                            obj.data.attributes[inner_attrib[j]] = a.attr(inner_attrib[j]);
                        }
                    }
                }
                else {
                    obj.data = a.text();
                }
            }

            if(nod.children("ul").size() > 0) {
                obj.children = [];
                nod.children("ul").children("li").each(function () {
                    obj.children.push(_this.getJSON(this, outer_attrib, inner_attrib));
                });
            }
            return obj;
        },
        focus : function () {
            if(this.locked) return false;
            if(tree_component.focused != this.cntr) {
                tree_component.focused = this.cntr;
                this.settings.callback.onfocus.call(null, this);
            }
        },
        show_context : function (obj, x, y) {
            var tmp = this.context.show().offsetParent();
            if(tmp.is("html")) tmp = jQuery("body");
            tmp = tmp.offset();
            this.context.css({ "left" : (x - tmp.left - (this.settings.ui.rtl ? jQuery(this.context).width() : -5 ) ), "top" : (y - tmp.top  + (jQuery.browser.opera ? this.container.scrollTop() : 0) + 15) });
        },
        hide_context : function () {
            this.context.hide();
        },
        // ALL EVENTS
        attachEvents : function () {
            var _this = this;

            this.container
                .listen("click", "li", function(event) { // WHEN CLICK IS ON THE ARROW
                    event.stopPropagation();
                    _this.toggle_branch.apply(_this, [event.target]);
                })
                .listen("click", "a.title", function (event) { // WHEN CLICK IS ON THE TEXT OR ICON
                    if(_this.locked) {
                        event.preventDefault();
                        event.target.blur();
                        return _this.error("LOCKED");
                    }
                    _this.select_branch.apply(_this, [event.target, event.ctrlKey || _this.settings.rules.multiple == "on"]);
                    if(_this.inp) { _this.inp.blur(); }
                    event.preventDefault();
                    event.target.blur();
                    return false;
                })
                .listen("dblclick", "a.title", function (event) { // WHEN DOUBLECLICK ON TEXT OR ICON
                    if(_this.locked) {
                        event.preventDefault();
                        event.stopPropagation();
                        event.target.blur();
                        return _this.error("LOCKED");
                    }
                    _this.settings.callback.ondblclk.call(null, _this.get_node(event.target).get(0), _this);
                    event.preventDefault();
                    event.stopPropagation();
                    event.target.blur();
                })
                .listen("contextmenu", "a.title", function (event) {
                    if(_this.locked) {
                        event.target.blur();
                        return _this.error("LOCKED");
                    }
                    _this.settings.callback.onrgtclk.call(null, _this.get_node(event.target).get(0), _this, event);
                    if(_this.context) {
                        if(_this.context.append == false) {
                            _this.container.find("ul:eq(0)").append(_this.context);
                            _this.context.append = true;
                            for(i in _this.settings.ui.context) {
                                if(_this.settings.ui.context[i] == "separator") continue;
                                (function () {
                                    var func = _this.settings.ui.context[i].action;
                                    _this.context.children("[rel=" + _this.settings.ui.context[i].id +"]").bind("click", function (event) {
                                        func.call(null, _this.selected_arr || _this.selected, _this);
                                        _this.hide_context();
                                        event.stopPropagation();
                                        event.preventDefault();
                                        return false;
                                    });
                                })();
                            }
                        }
                        var obj = _this.get_node(event.target);
                        if(_this.inp) { _this.inp.blur(); }
                        if(obj) {
                            if(!obj.children("a:eq(0)").hasClass("clicked")) {
                                _this.select_branch.apply(_this, [event.target, event.ctrlKey || _this.settings.rules.multiple == "on"]);
                                event.target.blur();
                            }
                            _this.context.children("li").show();
                            var go = false;
                            for(i in _this.settings.ui.context) {
                                if(_this.settings.ui.context[i] == "separator") continue;
                                if(!_this.settings.ui.context[i].visible.call(null, _this.selected_arr || _this.selected, _this)) _this.context.children("[rel=" + _this.settings.ui.context[i].id +"]").hide();
                                else go = true;
                            }
                            if(go == true) _this.show_context(obj, event.originalEvent.pageX, event.originalEvent.pageY);
                            event.preventDefault();
                            event.stopPropagation();
                            return false;
                        }
                    }
                    return true;
                })
                .listen("pointerenter", "a.title", function (event) {
                    if(_this.locked) {
                        event.preventDefault();
                        event.stopPropagation();
                        return _this.error("LOCKED");
                    }
                    if(_this.settings.ui.hover_mode && _this.hovered !== false && event.target.tagName == "A") {
                        _this.hovered.children("a").removeClass("hover");
                        _this.hovered = false;
                    }
                });

                // ATTACH DRAG & DROP ONLY IF NEEDED
                if(this.settings.rules.draggable != "none" && this.settings.rules.dragrules != "none") {
                    this.container
                        .on('pointerup pointerdown', '.col2', function (e) {
                            if (!_this._drag) {
                                e.stopPropagation();
                            }
                        })
                        .on("pointerdown", "a.title", function (event) {
                            _this.focus.apply(_this);
                            if(_this.locked) return _this.error("LOCKED");
                            // SELECT LIST ITEM NODE
                            var obj = _this.get_node(event.target);
                            // IF ITEM IS DRAGGABLE
                            if(_this.settings.rules.multiple != false && _this.selected_arr.length > 1 && obj.children("a:eq(0)").hasClass("clicked")) {
                                var counter = 0;
                                for(i in _this.selected_arr) {
                                    if(_this.check("draggable", _this.selected_arr[i])) {
                                        _this.selected_arr[i].addClass("dragged");
                                        counter ++;
                                    }
                                }
                                if(counter > 0) {
                                    if(_this.check("draggable", obj))    _this._drag = obj;
                                    else                                _this._drag = _this.container.find("li.dragged:eq(0)");
                                    _this.isdown    = true;
                                    _this.drag        = _this._drag.get(0).cloneNode(true);
                                    _this.drag.id    = "dragged";
                                    jQuery(_this.drag).children("a").html("Multiple selection").end().children("ul").remove();
                                }
                            }
                            else {
                                if(_this.check("draggable", obj)) {
                                    _this._drag        = obj;
                                    _this.drag        = obj.get(0).cloneNode(true);
                                    _this.drag.id    = "dragged";
                                    _this.isdown    = true;
                                    _this.foreign    = false;
                                    obj.addClass("dragged");
                                }
                            }
                            obj.blur();
                            event.preventDefault();
                            event.stopPropagation();
                            return false;
                        })
                        .listen("pointerup", "li", function (e) {
                            e.stopPropagation();
                        })
                        .listen("pointerup", "a.title", function (e) {
                            if (!_this._drag) {
                                e.stopPropagation();
                            }
                        })

                    jQuery('html')
                        .bind("pointerdown",    tree_component.mousedown)
                        .bind("pointerup",    tree_component.mouseup)
                        .bind("pointermove",    tree_component.mousemove);
                }
                // ENDIF OF DRAG & DROP FUNCTIONS
            if(_this.context) jQuery('html').bind("pointerup", function() { _this.hide_context(); });
        },
        checkMove : function (NODES, REF_NODE, TYPE) {
            if(this.locked) return this.error("LOCKED");
            var _this = this;
            // OVER SELF OR CHILDREN
            if(REF_NODE.parents("li.dragged").size() > 0 || REF_NODE.is(".dragged")) return this.error("MOVE: NODE OVER SELF");
            // CHECK AGAINST DRAG_RULES
            if(NODES.size() == 1) {
                var NODE = NODES.eq(0);
                if(NODE.hasClass("foreign")) {
                    if(this.settings.rules.droppable.length == 0) return false;
                    if(!NODE.is("." + this.settings.rules.droppable.join(", ."))) return false;
                    var ok = false;
                    for(i in this.settings.rules.droppable) {
                        if(NODE.is("." + this.settings.rules.droppable[i])) {
                            if(this.settings.rules.metadata) {
                                jQuery.metadata.setType("attr", this.settings.rules.metadata);
                                NODE.attr(this.settings.rules.metadata, "type: '" + this.settings.rules.droppable[i] + "'");
                            }
                            else {
                                NODE.attr(this.settings.rules.type_attr, this.settings.rules.droppable[i]);
                            }
                            ok = true;
                            break;
                        }
                    }
                    if(!ok) return false;
                }
                if(!this.check("dragrules", [NODE, TYPE, REF_NODE.parents("li:eq(0)")])) return this.error("MOVE: AGAINST DRAG RULES");
            }
            else {
                var ok = true;
                NODES.each(function (i) {
                    if(ok == false) return false;
                    if(i > 0) {
                        var ref = NODES.eq( (i - 1) );
                        var mv = "after";
                    }
                    else {
                        var ref = REF_NODE;
                        var mv = TYPE;
                    }
                    if(!_this.check.apply(_this,["dragrules", [jQuery(this), mv, ref]])) ok = false;
                });
                if(ok == false) return this.error("MOVE: AGAINST DRAG RULES");
            }
            // CHECK AGAINST METADATA
            if(this.settings.rules.use_inline && this.settings.rules.metadata) {
                var nd = false;
                if(TYPE == "inside")    nd = REF_NODE.parents("li:eq(0)");
                else                    nd = REF_NODE.parents("li:eq(1)");
                if(nd.size()) {
                    // VALID CHILDREN CHECK
                    if(typeof nd.metadata()["valid_children"] != "undefined") {
                        var tmp = nd.metadata()["valid_children"];
                        var ok = true;
                        NODES.each(function (i) {
                            if(ok == false) return false;
                            if(jQuery.inArray(_this.get_type(this), tmp) == -1) ok = false;
                        });
                        if(ok == false) return this.error("MOVE: NOT A VALID CHILD");
                    }
                    // CHECK IF PARENT HAS FREE SLOTS FOR CHILDREN
                    if(typeof nd.metadata()["max_children"] != "undefined") {
                        if((nd.children("ul:eq(0)").children("li").not(".dragged").size() + NODES.size()) > nd.metadata().max_children) return this.error("MOVE: MAX CHILDREN REACHED");
                    }
                    // CHECK FOR MAXDEPTH UP THE CHAIN
                    var incr = 0;
                    NODES.each(function (i) {
                        var i = 1;
                        var t = jQuery(this);
                        while(i < 100) {
                            t = t.children("ul:eq(0)");
                            if(t.size() == 0) break;
                            i ++
                        }
                        incr = Math.max(i,incr);
                    });
                    var ok = true;
                    nd.parents("li").each(function(i) {
                        if(ok == false) return false;
                        if(jQuery(this).metadata().max_depth) {
                            if( (i + incr) >= jQuery(this).metadata().max_depth) ok = false;
                        }
                    });
                    if(ok == false) return this.error("MOVE: MAX_DEPTH REACHED");
                }
            }
            return true;
        },
        // USED AFTER REFRESH
        reselect : function () {
            var _this = this;
            // REOPEN BRANCHES
            if(this.opened && this.opened.length) {
                var opn = false;
                for(var j = 0; j < this.opened.length; j++) {
                    if(this.settings.data.async) {
                        if(this.get_node(this.opened[j]).size() > 0) {
                            opn = true;
                            var tmp = this.opened[j];
                            delete this.opened[j];
                            this.open_branch(tmp, true, function () { _this.reselect.apply(_this); } )
                        }
                    }
                    else this.open_branch(this.opened[j], true);
                }
                if(this.settings.data.async && opn) return;
                delete this.opened;
            }
            // REPOSITION SCROLL
            if(this.scrtop) {
                this.container.scrollTop(_this.scrtop);
                delete this.scrtop;
            }
            // RESELECT PREVIOUSLY SELECTED
            if(this.settings.selected !== false) {
                jQuery.each(this.settings.selected, function (i) {
                    _this.select_branch(jQuery(_this.settings.selected[i]), (_this.settings.rules.multiple !== false && i > 0) );
                });
                this.settings.selected = false;
            }
            this.settings.callback.onload.call(null, _this);
        },
        // GET THE EXTENDED LI ELEMENT
        get_node : function (obj) {
            var obj = jQuery(obj);
            return obj.is("li") ? obj : obj.parents("li:eq(0)");
        },
        // GET THE TYPE OF THE NODE
        get_type : function (obj) {
            obj = !obj ? this.selected : this.get_node(obj);
            if(!obj) return;
            if(this.settings.rules.metadata) {
                jQuery.metadata.setType("attr", this.settings.rules.metadata);
                var tmp = obj.metadata().type;
                if(tmp) return tmp;
            }
            return obj.attr(this.settings.rules.type_attr);
        },
        // SCROLL CONTAINER WHILE DRAGGING
        scrollCheck : function (x,y) {
            var _this = this;
            var cnt = _this.container;
            var off = _this.offset;

            var st = cnt.scrollTop();
            var sl = cnt.scrollLeft();
            // DETECT HORIZONTAL SCROLL
            var h_cor = (cnt.get(0).scrollWidth > cnt.width()) ? 40 : 20;

            if(y - off.top < 20)                        cnt.scrollTop(Math.max( (st - _this.settings.ui.scroll_spd) ,0));    // NEAR TOP
            if(cnt.height() - (y - off.top) < h_cor)    cnt.scrollTop(st + _this.settings.ui.scroll_spd);                    // NEAR BOTTOM
            if(x - off.left < 20)                        cnt.scrollLeft(Math.max( (sl - _this.settings.ui.scroll_spd),0));    // NEAR LEFT
            if(cnt.width() - (x - off.left) < 40)        cnt.scrollLeft(sl + _this.settings.ui.scroll_spd);                    // NEAR RIGHT

            if(cnt.scrollLeft() != sl || cnt.scrollTop() != st) {
                _this.moveType = false;
                _this.moveRef = false;
                jQuery("#marker").hide();
            }
            tree_component.sto = setTimeout( function() { _this.scrollCheck(x,y); }, 50);
        },
        check : function (rule, nodes) {
            if(this.locked) return this.error("LOCKED");
            // CHECK LOCAL RULES IF METADATA
            if(rule != "dragrules" && this.settings.rules.use_inline && this.settings.rules.metadata) {
                jQuery.metadata.setType("attr", this.settings.rules.metadata);
                if(typeof this.get_node(nodes).metadata()[rule] != "undefined") return this.get_node(nodes).metadata()[rule];
            }
            if(!this.settings.rules[rule])            return false;
            if(this.settings.rules[rule] == "none")    return false;
            if(this.settings.rules[rule] == "all")    return true;
            if(rule == "dragrules") {
                var nds = new Array();
                nds[0] = this.get_type(nodes[0]);
                nds[1] = nodes[1];
                nds[2] = this.get_type(nodes[2]);
                for(var i = 0; i < this.settings.rules.dragrules.length; i++) {
                    var r = this.settings.rules.dragrules[i];
                    var n = (r.indexOf("!") === 0) ? false : true;
                    if(!n) r = r.replace("!","");
                    var tmp = r.split(" ");
                    for(var j = 0; j < 3; j++) {
                        if(tmp[j] == nds[j] || tmp[j] == "*") tmp[j] = true;
                    }
                    if(tmp[0] === true && tmp[1] === true && tmp[2] === true) return n;
                }
                return false;
            }
            else
                return (jQuery.inArray(this.get_type(nodes),this.settings.rules[rule]) != -1) ? true : false;
        },
        hover_branch : function (obj) {
            if(this.locked) return this.error("LOCKED");
            if(this.settings.ui.hover_mode == false) return this.select_branch(obj);
            var _this = this;
            var obj = _this.get_node(obj);
            if(!obj.size()) return this.error("HOVER: NOT A VALID NODE");
            // CHECK AGAINST RULES FOR SELECTABLE NODES
            if(!_this.check("clickable", obj)) return this.error("SELECT: NODE NOT SELECTABLE");
            if(this.hovered) this.hovered.children("A").removeClass("hover");

            // SAVE NEWLY SELECTED
            this.hovered = obj;

            // FOCUS NEW NODE AND OPEN ALL PARENT NODES IF CLOSED
            this.hovered.children("a").removeClass("hover").addClass("hover");

            // SCROLL SELECTED NODE INTO VIEW
            var off_t = this.hovered.offset().top;
            var beg_t = this.container.offset().top;
            var end_t = beg_t + this.container.height();
            var h_cor = (this.container.get(0).scrollWidth > this.container.width()) ? 40 : 20;
            if(off_t + 5 < beg_t) this.container.scrollTop(this.container.scrollTop() - (beg_t - off_t + 5) );
            if(off_t + h_cor > end_t) this.container.scrollTop(this.container.scrollTop() + (off_t + h_cor - end_t) );
        },
        select_branch : function (obj, multiple) {
            if(this.locked) return this.error("LOCKED");
            if(!obj && this.hovered !== false) obj = this.hovered;
            var _this = this;
            obj = _this.get_node(obj);
            if(!obj.size()) return this.error("SELECT: NOT A VALID NODE");
            obj.children("a").removeClass("hover");
            // CHECK AGAINST RULES FOR SELECTABLE NODES
            if(!_this.check("clickable", obj)) return this.error("SELECT: NODE NOT SELECTABLE");
            if(_this.settings.callback.beforechange.call(null,obj.get(0),_this) === false) return this.error("SELECT: STOPPED BY USER");
            // IF multiple AND obj IS ALREADY SELECTED - DESELECT IT
            if(this.settings.rules.multiple != false && multiple && obj.children("a.clicked").size() > 0) {
                return this.deselect_branch(obj);
            }
            if(this.settings.rules.multiple != false && multiple) {
                this.selected_arr.push(obj);
            }
            if(this.settings.rules.multiple != false && !multiple) {
                for(i in this.selected_arr) {
                    this.selected_arr[i].children("A").removeClass("clicked");
                }
                this.selected_arr = [];
                this.selected_arr.push(obj);
                if(this.selected) this.selected.children("A").removeClass("clicked");
            }
            if(!this.settings.rules.multiple) {
                if(this.selected) this.selected.children("A").removeClass("clicked");
            }
            // SAVE NEWLY SELECTED
            this.selected = obj;
            if(this.settings.ui.hover_mode && this.hovered !== false) {
                this.hovered.children("A").removeClass("hover");
                this.hovered = obj;
            }

            // FOCUS NEW NODE AND OPEN ALL PARENT NODES IF CLOSED
            this.selected.children("a").removeClass("clicked").addClass("clicked").end().parents("li.closed").each( function () { _this.open_branch(this, true); });

            // SCROLL SELECTED NODE INTO VIEW
            var off_t = this.selected.offset().top;
            var beg_t = this.container.offset().top;
            var end_t = beg_t + this.container.height();
            var h_cor = (this.container.get(0).scrollWidth > this.container.width()) ? 40 : 20;
            if(off_t + 5 < beg_t) this.container.scrollTop(this.container.scrollTop() - (beg_t - off_t + 5) );
            if(off_t + h_cor > end_t) this.container.scrollTop(this.container.scrollTop() + (off_t + h_cor - end_t) );

            this.set_cookie("selected");
            this.settings.callback.onchange.call(null, this.selected.get(0), _this);
        },
        deselect_branch : function (obj) {
            if(this.locked) return this.error("LOCKED");
            var _this = this;
            var obj = this.get_node(obj);
            obj.children("a").removeClass("clicked");
            if(this.settings.rules.multiple != false && this.selected_arr.length > 1) {
                this.selected_arr = [];
                this.container.find("a.clicked").filter(":first-child").parent().each(function () {
                    _this.selected_arr.push(jQuery(this));
                });
                if(obj.get(0) == this.selected.get(0)) {
                    this.selected = this.selected_arr[0];
                    this.set_cookie("selected");
                }
            }
            else {
                if(this.settings.rules.multiple != false) this.selected_arr = [];
                this.selected = false;
                this.set_cookie("selected");
            }
            if(this.selected)    this.settings.callback.onchange.call(null, this.selected.get(0), _this);
            else                this.settings.callback.onchange.call(null, false, _this);
        },
        toggle_branch : function (obj) {
            if(this.locked) return this.error("LOCKED");
            var obj = this.get_node(obj);
            if(obj.hasClass("closed"))    return this.open_branch(obj);
            if(obj.hasClass("open"))    return this.close_branch(obj);
        },
        open_branch : function (obj, disable_animation, callback) {
            if(this.locked) return this.error("LOCKED");
            var obj = this.get_node(obj);
            if(!obj.size()) return this.error("OPEN: NO SUCH NODE");
            if(obj.hasClass("leaf")) return this.error("OPEN: OPENING LEAF NODE");

            if(this.settings.data.async && obj.find("li").size() == 0) {
                var _this = this;
                obj.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a style='background-image:url(" + _this.settings.ui.theme_path + "default/throbber.gif)' href='#'>" + (_this.settings.lang.loading || "Loading ...") + "</a></li></ul>");
                obj.removeClass("closed").addClass("open");
                if(this.settings.data.type == "xml_flat" || this.settings.data.type == "xml_nested") {
                    var xsl = (this.settings.data.type == "xml_flat") ? "flat.xsl" : "nested.xsl";
                    var str = (this.settings.data.url.indexOf("?") == -1) ? "?id=" + encodeURIComponent(obj.attr("id")) : "&id=" + encodeURIComponent(obj.attr("id"));
                    obj.children("ul:eq(0)").getTransform(this.path + xsl, this.settings.data.url + str, { params : { theme_path : _this.theme }, meth : this.settings.data.method, repl : true, callback: function (str, json) {
                            if(str.length < 15) {
                                obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();
                                if(callback) callback.call();
                                return;
                            }
                            _this.open_branch.apply(_this, [obj]);
                            if(callback) callback.call();
                        }
                    });
                }
                else {
                    jQuery.ajax({
                        type        : this.settings.data.method,
                        url            : this.settings.data.url,
                        data        : this.settings.data.async_data(obj),
                        dataType    : "json",
                        success        : function (data, textStatus) {
                            if(!data || data.length == 0) {
                                obj.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();
                                if(callback) callback.call();
                                return;
                            }
                            var str = "";
                            if(data.length) {
                                for(var i = 0; i < data.length; i++) {
                                    str += _this.parseJSON(data[i]);
                                }
                            }
                            else str = _this.parseJSON(data);
                            obj.children("ul:eq(0)").replaceWith("<ul>" + str + "</ul>");
                            obj.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");
                            obj.find("li").not(".open").not(".closed").addClass("leaf");
                            _this.open_branch.apply(_this, [obj]);
                            if(callback) callback.call();
                        }
                    });
                }
                return true;
            }
            else {
                if(parseInt(this.settings.ui.animation) > 0 && !disable_animation && !(jQuery.browser.msie && jQuery.browser.version < 7) ) {
                    obj.children("ul:eq(0)").css("display","none");
                    obj.removeClass("closed").addClass("open");
                    obj.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation), function() {
                        jQuery(this).css("display","");
                        if(callback) callback.call();
                    });
                } else {
                    obj.removeClass("closed").addClass("open");
                    if(callback) callback.call();
                }
                this.set_cookie("open");
                this.settings.callback.onopen.call(null, obj.get(0), this);
                return true;
            }
        },
        close_branch : function (obj, disable_animation) {
            if(this.locked) return this.error("LOCKED");
            var _this = this;
            var obj = this.get_node(obj);
            if(parseInt(this.settings.ui.animation) > 0 && !disable_animation && !(jQuery.browser.msie && jQuery.browser.version < 7) && obj.children("ul:eq(0)").size() == 1) {
                obj.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation), function() {
                    obj.removeClass("open").addClass("closed");
                    _this.set_cookie("open");
                    jQuery(this).css("display","");
                });
            }
            else {
                obj.removeClass("open").addClass("closed");
                this.set_cookie("open");
            }
            if(this.selected && obj.children("ul:eq(0)").find("a.clicked").size() > 0) {
                obj.find("li:has(a.clicked)").each(function() {
                    _this.deselect_branch(this);
                });
                if(obj.children("a.clicked").size() == 0) this.select_branch(obj, (this.settings.rules.multiple != false && this.selected_arr.length > 0) );
            }
            this.settings.callback.onclose.call(null, obj.get(0), this);
        },
        open_all : function (obj) {
            if(this.locked) return this.error("LOCKED");
            var _this = this;
            obj = obj ? jQuery(obj) : this.container;
            obj.find("li.closed").each( function () { var __this = this; _this.open_branch.apply(_this, [this, true, function() { _this.open_all.apply(_this, [__this]); } ]); });
        },
        close_all : function () {
            if(this.locked) return this.error("LOCKED");
            var _this = this;
            jQuery(this.container).find("li.open").each( function () { _this.close_branch(this, true); });
        },
        show_lang : function (i) {
            if(this.locked) return this.error("LOCKED");
            if(this.settings.languages[i] == this.current_lang) return true;
            var st = false;
            var id = this.container.attr("id") ? "#" + this.container.attr("id") : ".tree";
            st = get_css(id + " ." + this.current_lang, this.sn);
            if(st !== false) st.style.display = "none";
            st = get_css(id + " ." + this.settings.languages[i], this.sn);
            if(st !== false) st.style.display = "block";
            this.current_lang = this.settings.languages[i];
            return true;
        },
        cycle_lang : function() {
            if(this.locked) return this.error("LOCKED");
            var i = jQuery.inArray(this.current_lang, this.settings.languages);
            i ++;
            if(i > this.settings.languages.length - 1) i = 0;
            this.show_lang(i);
        },
        create : function (type, obj, data, icon, id ) {
            if(this.locked) return this.error("LOCKED");
            // NOTHING SELECTED
            obj = obj ? this.get_node(obj) : this.selected;
            if(!obj || !obj.size()) return this.error("CREATE: NO NODE SELECTED");
            if(!this.check("creatable", obj)) return this.error("CREATE: CANNOT CREATE IN NODE");

            var t = type || this.get_type(obj) || "";
            if(this.settings.rules.use_inline && this.settings.rules.metadata) {
                jQuery.metadata.setType("attr", this.settings.rules.metadata);
                if(typeof obj.metadata()["valid_children"] != "undefined") {
                    if(jQuery.inArray(t, obj.metadata()["valid_children"]) == -1) return this.error("CREATE: NODE NOT A VALID CHILD");
                }
                if(typeof obj.metadata()["max_children"] != "undefined") {
                    if( (obj.children("ul:eq(0)").children("li").size() + 1) > obj.metadata().max_children) return this.error("CREATE: MAX_CHILDREN REACHED");
                }
                var ok = true;
                obj.parents("li").each(function(i) {
                    if(jQuery(this).metadata().max_depth) {
                        if( (i + 1) >= jQuery(this).metadata().max_depth) {
                            ok = false;
                        }
                    }
                });
                if(!ok) return this.error("CREATE: MAX_DEPTH REACHED");
            }
            if(obj.hasClass("closed")) {
                var _this = this;
                return this.open_branch(obj, true, function () { _this.create.apply(_this, [type, obj, data, icon, id]); } );
            }

            if(id)    $li = jQuery("<li id='" + id + "' />");
            else    $li = jQuery("<li />");
            // NEW NODE IS OF PASSED TYPE OR PARENT'S TYPE
            if(this.settings.rules.metadata) {
                jQuery.metadata.setType("attr", this.settings.rules.metadata);
                $li.attr(this.settings.rules.metadata, "type: '" + t + "'");
            }
            else {
                $li.attr(this.settings.rules.type_attr, t)
            }

            var icn = "";
            if((typeof icon).toLowerCase() == "string") {
                icn = icon;
                icn = icn.indexOf("/") == -1 ? this.theme + icn : icn;
            }
            if(this.settings.languages.length) {
                for(i = 0; i < this.settings.languages.length; i++) {
                    if((typeof data).toLowerCase() == "string") val = data;
                    else if(data && data[i]) {
                        val = data[i];
                    }
                    else if(this.settings.lang.new_node) {
                        if((typeof this.settings.lang.new_node).toLowerCase() != "string" && this.settings.lang.new_node[i])
                            val = this.settings.lang.new_node[i];
                        else
                            val = this.settings.lang.new_node;
                    }
                    else {
                        val = "New folder";
                    }
                    if((typeof icon).toLowerCase() != "string" && icon && icon[i]) {
                        icn = icon[i];
                        icn = icn.indexOf("/") == -1 ? this.theme + icn : icn;
                    }
                    $li.append("<a href='#'" + ( icn.length ? " style='background-image:url(\"" + icn + "\");' " : " ") + "class='" + this.settings.languages[i] + "'>" + val + "</a>");
                }
            }
            else { $li.append("<a href='#'" + ( icn.length ? " style='background-image:url(\"" + icn + "\");' " : " ") + ">" + (data || this.settings.lang.new_node || "New folder") + "</a>"); }
            $li.addClass("leaf");
            if(this.settings.rules.createat == "top" || obj.children("ul").size() == 0) {
                this.moved($li,obj.children("a:eq(0)"),"inside", true);
            }
            else {
                this.moved($li,obj.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",true);
            }
            this.select_branch($li.children("a:eq(0)"));
            if(!data) this.rename();
            return $li;
        },
        rename : function () {
            if(this.locked) return this.error("LOCKED");
            if(this.selected) {
                var _this = this;
                if(!this.check("renameable", this.selected)) return this.error("RENAME: NODE NOT RENAMABLE");
                if(!this.settings.callback.beforerename.call(null,this.selected.get(0), _this.current_lang, _this)) return this.error("RENAME: STOPPED BY USER");
                var obj = this.selected;
                if(this.current_lang)    obj = obj.find("a." + this.current_lang).get(0);
                else                    obj = obj.find("a:first").get(0);
                last_value = obj.innerHTML;
                _this.inp = jQuery("<input type='text' />");
                _this.inp
                    .val(last_value)
                    .bind("pointerdown",        function (event) { event.stopPropagation(); })
                    .bind("pointerup",        function (event) { event.stopPropagation(); })
                    .bind("click",            function (event) { event.stopPropagation(); })
                    .bind("keyup",            function (event) {
                            var key = event.keyCode || event.which;
                            if(key == 27) { this.value = last_value; this.blur(); return }
                            if(key == 13) { this.blur(); return }
                        });
                _this.inp.blur(function(event) {
                        if(this.value == "") this.value == last_value;
                        jQuery(obj).html( jQuery(obj).parent().find("input").eq(0).attr("value") ).get(0).style.display = "";
                        jQuery(obj).prevAll("span").remove();
                        if(this.value != last_value) _this.settings.callback.onrename.call(null, _this.get_node(obj).get(0), _this.current_lang, _this);
                        _this.inp = false;
                    });
                var spn = jQuery("<span />").addClass(obj.className).append(_this.inp);
                spn.attr("style", jQuery(obj).attr("style"));
                obj.style.display = "none";
                jQuery(obj).parent().prepend(spn);
                _this.inp.get(0).focus();
                _this.inp.get(0).select();
            }
            else return this.error("RENAME: NO NODE SELECTED");
        },
        // REMOVE NODES
        remove : function(obj) {
            if(this.locked) return this.error("LOCKED");
            if(obj) {
                obj = this.get_node(obj);
                if(obj.size()) {
                    if(!this.check("deletable", obj)) return this.error("DELETE: NODE NOT DELETABLE");
                    if(!this.settings.callback.beforedelete.call(null,obj.get(0), _this)) return this.error("DELETE: STOPPED BY USER");
                    $parent = obj.parent();
                    obj = obj.remove();
                    $parent.children("li:last").addClass("last");
                    if($parent.children("li").size() == 0) {
                        $li = $parent.parents("li:eq(0)");
                        $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                        this.set_cookie("open");
                    }
                    this.settings.callback.ondelete.call(null, obj, this);
                }
            }
            else if(this.selected) {
                if(!this.check("deletable", this.selected)) return this.error("DELETE: NODE NOT DELETABLE");
                if(!this.settings.callback.beforedelete.call(null,this.selected.get(0), _this)) return this.error("DELETE: STOPPED BY USER");
                $parent = this.selected.parent();
                var obj = this.selected;
                if(this.settings.rules.multiple == false || this.selected_arr.length == 1) {
                    var stop = true;
                    var tmp = (this.selected.prev("li:eq(0)").size()) ? this.selected.prev("li:eq(0)") : this.selected.parents("li:eq(0)");
                    // this.get_prev(true);
                }
                obj = obj.remove();
                $parent.children("li:last").addClass("last");
                if($parent.children("li").size() == 0) {
                    $li = $parent.parents("li:eq(0)");
                    $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                    this.set_cookie("open");
                }
                //this.selected = false;
                this.settings.callback.ondelete.call(null, obj, this);
                if(stop && tmp) this.select_branch(tmp);
                if(this.settings.rules.multiple != false && !stop) {
                    var _this = this;
                    this.selected_arr = [];
                    this.container.find("a.clicked").filter(":first-child").parent().each(function () {
                        _this.selected_arr.push(jQuery(this));
                    });
                    if(this.selected_arr.length > 0) {
                        this.selected = this.selected_arr[0];
                        this.remove();
                    }
                }
            }
            else return this.error("DELETE: NO NODE SELECTED");
        },
        // FOR EXPLORER-LIKE KEYBOARD SHORTCUTS
        get_next : function(force) {
            var obj = this.hovered || this.selected;
            if(obj) {
                if(obj.hasClass("open"))                        return force ? this.select_branch(obj.find("li:eq(0)")) : this.hover_branch(obj.find("li:eq(0)"));
                else if(jQuery(obj).nextAll("li").size() > 0)    return force ? this.select_branch(obj.nextAll("li:eq(0)")) : this.hover_branch(obj.nextAll("li:eq(0)"));
                else                                            return force ? this.select_branch(obj.parents("li").next("li").eq(0)) : this.hover_branch(obj.parents("li").next("li").eq(0));
            }
        },
        get_prev : function(force) {
            var obj = this.hovered || this.selected;
            if(obj) {
                if(obj.prev("li").size()) {
                    var obj = obj.prev("li").eq(0);
                    while(obj.hasClass("open")) obj = obj.children("ul:eq(0)").children("li:last");
                    return force ? this.select_branch(obj) : this.hover_branch(obj);
                }
                else { return force ? this.select_branch(obj.parents("li:eq(0)")) : this.hover_branch(obj.parents("li:eq(0)")); }
            }
        },
        get_left : function(force, rtl) {
            if(this.settings.ui.rtl && !rtl) return this.get_right(force, true);
            var obj = this.hovered || this.selected;
            if(obj) {
                if(obj.hasClass("open"))    this.close_branch(obj);
                else {
                    return force ? this.select_branch(obj.parents("li:eq(0)")) : this.hover_branch(obj.parents("li:eq(0)"));
                }
            }
        },
        get_right : function(force, rtl) {
            if(this.settings.ui.rtl && !rtl) return this.get_left(force, true);
            var obj = this.hovered || this.selected;
            if(obj) {
                if(obj.hasClass("closed"))    this.open_branch(obj);
                else {
                    return force ? this.select_branch(obj.find("li:eq(0)")) : this.hover_branch(obj.find("li:eq(0)"));
                }
            }
        },
        toggleDots : function () {
            this.container.toggleClass("no_dots");
        },
        set_cookie : function (type) {
            if(this.settings.cookies === false) return false;
            switch(type) {
                /*case "selected":
                    if(this.settings.rules.multiple != false && this.selected_arr.length > 1) {
                        var val = Array();
                        jQuery.each(this.selected_arr, function () {
                            val.push(this.attr("id"));
                        });
                        val = val.join(",");
                    }
                    else var val = this.selected ? this.selected.attr("id") : false;
                    jQuery.cookie(this.settings.cookies.prefix + '_selected',val,this.settings.cookies.opts);
                    break;*/
                case "open":
                    var str = "";
                    this.container.find("li.open").each(function (i) { str += this.id + ","; });
                    jQuery.cookie(this.settings.cookies.prefix + '_open',str.replace(/,$/ig,""),this.settings.cookies.opts);
                    break;
            }
        },
        moved : function (what, where, how, is_new, is_copy) {
            var what    = jQuery(what);
            var $parent    = jQuery(what).parents("ul:eq(0)");
            var $where    = jQuery(where);
            // IF MULTIPLE
            if(what.size() > 1) {
                var _this = this;
                var tmp = this.moved(what.eq(0),where,how, false, is_copy);
                what.each(function (i) {
                    if(i == 0) return;
                    tmp = _this.moved(this, tmp.children("a:eq(0)"), "after", false, is_copy);
                })
                return;
            }
            if(is_copy) {
                what = what.clone();
                what.each(function (i) {
                    this.id = this.id + "_copy";
                    jQuery(this).find("li").each(function () {
                        this.id = this.id + "_copy";
                    })
                    jQuery(this).find("a.clicked").removeClass("clicked");
                });
            }
            if(is_new) {
                if(!this.settings.callback.beforecreate.call(null,this.get_node(what).get(0), this.get_node(where).get(0),how,this)) return;
            }
            else {
                if(!this.settings.callback.beforemove.call(null,this.get_node(what).get(0), this.get_node(where).get(0),how,this)) return;
            }

            if(!is_new) {
                var tmp = jQuery(what).parents(".tree:eq(0)");
                // if different trees
                if(tmp.get(0) != this.container.get(0)) {
                    tmp = tree_component.inst[tmp.attr("id")];
                    // if there are languages - otherwise - no cleanup needed
                    if(tmp.settings.languages.length) {
                        var res = [];
                        // if new tree has no languages - use current visible
                        if(this.settings.languages.length == 0) res.push("." + tmp.current_lang);
                        else {
                            for(i in this.settings.languages) {
                                for(j in tmp.settings.languages) {
                                    if(this.settings.languages[i] == tmp.settings.languages[j]) res.push("." + this.settings.languages[i]);
                                }
                            }
                        }
                        if(res.length == 0) return this.error("MOVE: NO COMMON LANGUAGES");
                        what.find("a").removeClass("clicked").not(res.join(",")).remove();
                    }
                }
            }

            // ADD NODE TO NEW PLACE
            switch(how) {
                case "before":
                    $where.parents("ul:eq(0)").children("li.last").removeClass("last");
                    $where.parents("li:eq(0)").before(what.removeClass("last"));
                    $where.parents("ul:eq(0)").children("li:last").addClass("last");
                    break;
                case "after":
                    $where.parents("ul:eq(0)").children("li.last").removeClass("last");
                    $where.parents("li:eq(0)").after(what.removeClass("last"));
                    $where.parents("ul:eq(0)").children("li:last").addClass("last");
                    break;
                case "inside":
                    if(this.settings.data.async) {
                        var obj = this.get_node($where);
                        if(obj.hasClass("closed")) {
                            var _this = this;
                            return this.open_branch(obj, true, function () { _this.moved.apply(_this, [what, where, how, is_new, is_copy]); })
                        }
                    }
                    if($where.parents("li:eq(0)").children("ul:first").size()) {
                        if(this.settings.rules.createat == "top")    $where.parents("li:eq(0)").children("ul:first").prepend(what.removeClass("last")).children("li:last").addClass("last");
                        else                                        $where.parents("li:eq(0)").children("ul:first").children(".last").removeClass("last").end().append(what.removeClass("last")).children("li:last").addClass("last");
                    }
                    else {
                        what.addClass("last");
                        $where.parents("li:eq(0)").append("<ul/>").removeClass("leaf").addClass("closed");
                        $where.parents("li:eq(0)").children("ul:first").prepend(what);
                    }
                    if(!this.settings.data.async) {
                        this.open_branch($where);
                    }
                    break;
                default:
                    break;
            }
            // CLEANUP OLD PARENT
            if($parent.find("li").size() == 0) {
                var $li = $parent.parent();
                $li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
                $li.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last");
                this.set_cookie("open");
            }
            else {
                $parent.children("li.last").removeClass("last");
                $parent.children("li:last").addClass("last");
            }
            if(is_new && how != "inside") where = this.get_node(where).parents("li:eq(0)");
            if(is_copy)        this.settings.callback.oncopy.call(null, this.get_node(what).get(0), this.get_node(where).get(0), how, this)
            else if(is_new)    this.settings.callback.oncreate.call(null, this.get_node(what).get(0), this.get_node(where).get(0), this.settings.insertAt, this);
            else            this.settings.callback.onmove.call(null, this.get_node(what).get(0), this.get_node(where).get(0), how, this);
            return what;
        },
        error : function (code) {
            this.settings.callback.error.call(null,code,this);
            return false;
        },
        lock : function (state) {
            this.locked = state;
            if(this.locked)    this.container.addClass("locked");
            else            this.container.removeClass("locked");
        },
        cut : function () {
            if(this.locked) return this.error("LOCKED");
            if(!this.selected) return this.error("CUT: NO NODE SELECTED");
            this.copy_nodes = false;
            this.cut_nodes = this.container.find("a.clicked").filter(":first-child").parent();
        },
        copy : function () {
            if(this.locked) return this.error("LOCKED");
            if(!this.selected) return this.error("COPY: NO NODE SELECTED");
            this.copy_nodes = this.container.find("a.clicked").filter(":first-child").parent();
            this.cut_nodes = false;
        },
        paste : function () {
            if(this.locked) return this.error("LOCKED");
            if(!this.selected) return this.error("PASTE: NO NODE SELECTED");
            if(!this.copy_nodes && !this.cut_nodes) return this.error("PASTE: NOTHING TO DO");
            if(this.copy_nodes && this.copy_nodes.size()) {
                if(!this.checkMove(this.copy_nodes, this.selected.children("a:eq(0)"), "inside")) return false;
                this.moved(this.copy_nodes, this.selected.children("a:eq(0)"), "inside", false, true);
                this.copy_nodes = false;
            }
            if(this.cut_nodes && this.cut_nodes.size()) {
                if(!this.checkMove(this.cut_nodes, this.selected.children("a:eq(0)"), "inside")) return false;
                this.moved(this.cut_nodes, this.selected.children("a:eq(0)"), "inside");
                this.cut_nodes = false;
            }
        },
        search : function(str) {
            var _this = this;
            if(!str || (this.srch && str != this.srch) ) {
                this.srch = "";
                this.srch_opn = false;
                this.container.find("a.search").removeClass("search");
            }
            this.srch = str;
            if(!str) return;
            if(this.settings.data.async) {
                if(!this.srch_opn) {
                    var dd = jQuery.extend( { "search" : str } , this.settings.data.async_data(false) );
                    jQuery.ajax({
                        type        : this.settings.data.method,
                        url            : this.settings.data.url,
                        data        : dd,
                        dataType    : "text",
                        success        : function (data) {
                            _this.srch_opn = jQuery.unique(data.split(","));
                            _this.search.apply(_this,[str]);
                        }
                    });
                }
                else if(this.srch_opn.length) {
                    if(this.srch_opn && this.srch_opn.length) {
                        var opn = false;
                        for(var j = 0; j < this.srch_opn.length; j++) {
                            if(this.get_node("#" + this.srch_opn[j]).size() > 0) {
                                opn = true;
                                var tmp = "#" + this.srch_opn[j];
                                delete this.srch_opn[j];
                                this.open_branch(tmp, true, function () { _this.search.apply(_this,[str]); } );
                            }
                        }
                        if(!opn) {
                            this.srch_opn = [];
                             _this.search.apply(_this,[str]);
                        }
                    }
                }
                else {
                    var selector = "a";
                    // IF LANGUAGE VERSIONS
                    if(this.settings.languages.length) selector += "." + this.current_lang;
                    this.container.find(selector + ":contains('" + str + "')").addClass("search");
                    this.srch_opn = false;
                }
            }
            else {
                var selector = "a";
                // IF LANGUAGE VERSIONS
                if(this.settings.languages.length) selector += "." + this.current_lang;
                this.container.find(selector + ":contains('" + str + "')").addClass("search").parents("li.closed").each( function () { _this.open_branch(this, true); });
            }
        },

        destroy : function() {
            try {
                var evts = ["click","dblclick","contextmenu","pointerover","pointerdown"];
                for(i in evts) {
                    var idxer = this.container.indexer(evts[i]);
                    idxer.stop();
                    jQuery.removeData( idxer.listener, idxer.event + '.indexer' );
                }
            } catch(err) { }
            this.container.unbind();

            this.container.removeClass("tree").children("ul").removeClass("tree-" + this.settings.ui.theme_name).find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked");

            if(this.cntr == tree_component.focused) {
                for(i in tree_component.inst) {
                    if(i != this.cntr && i != this.container.attr("id")) {
                        tree_component.inst[i].focus();
                        break;
                    }
                }
            }
            delete tree_component.inst[this.cntr];
            delete tree_component.inst[this.container.attr("id")];
            tree_component.cntr --;
        }
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS51aS5jdXN0b20uanMiLCJjbXMuY2hhbmdlbGlzdC5qcyIsIl9hbGwuanMiLCJ0cmVlX2NvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3QzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImJ1bmRsZS5hZG1pbi5jaGFuZ2VsaXN0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBqUXVlcnkgVUkgLSB2MS4xMC4zIC0gMjAxMy0xMi0wNlxuKiBodHRwOi8vanF1ZXJ5dWkuY29tXG4qIEluY2x1ZGVzOiBcbioganF1ZXJ5LnVpLmNvcmUuanMsIFxuKiBqcXVlcnkudWkud2lkZ2V0LmpzLCBcbioganF1ZXJ5LnVpLm1vdXNlLmpzLCBcbioganF1ZXJ5LnVpLmRyYWdnYWJsZS5qcywgXG4qIGpxdWVyeS51aS5kcm9wcGFibGUuanMsIFxuKiBqcXVlcnkudWkuc29ydGFibGUuanMsIFxuKiBqcXVlcnkudWkuZWZmZWN0LmpzLCBcbioganF1ZXJ5LnVpLmVmZmVjdC1oaWdobGlnaHQuanNcbiogQ29weXJpZ2h0IDIwMTMgalF1ZXJ5IEZvdW5kYXRpb24gYW5kIG90aGVyIGNvbnRyaWJ1dG9yczsgTGljZW5zZWQgTUlUICovXG5cbihmdW5jdGlvbihlLHQpe2Z1bmN0aW9uIGkodCxpKXt2YXIgcyxuLHIsbz10Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuXCJhcmVhXCI9PT1vPyhzPXQucGFyZW50Tm9kZSxuPXMubmFtZSx0LmhyZWYmJm4mJlwibWFwXCI9PT1zLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk/KHI9ZShcImltZ1t1c2VtYXA9I1wiK24rXCJdXCIpWzBdLCEhciYmYShyKSk6ITEpOigvaW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbnxvYmplY3QvLnRlc3Qobyk/IXQuZGlzYWJsZWQ6XCJhXCI9PT1vP3QuaHJlZnx8aTppKSYmYSh0KX1mdW5jdGlvbiBhKHQpe3JldHVybiBlLmV4cHIuZmlsdGVycy52aXNpYmxlKHQpJiYhZSh0KS5wYXJlbnRzKCkuYWRkQmFjaygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVyblwiaGlkZGVuXCI9PT1lLmNzcyh0aGlzLFwidmlzaWJpbGl0eVwiKX0pLmxlbmd0aH12YXIgcz0wLG49L151aS1pZC1cXGQrJC87ZS51aT1lLnVpfHx7fSxlLmV4dGVuZChlLnVpLHt2ZXJzaW9uOlwiMS4xMC4zXCIsa2V5Q29kZTp7QkFDS1NQQUNFOjgsQ09NTUE6MTg4LERFTEVURTo0NixET1dOOjQwLEVORDozNSxFTlRFUjoxMyxFU0NBUEU6MjcsSE9NRTozNixMRUZUOjM3LE5VTVBBRF9BREQ6MTA3LE5VTVBBRF9ERUNJTUFMOjExMCxOVU1QQURfRElWSURFOjExMSxOVU1QQURfRU5URVI6MTA4LE5VTVBBRF9NVUxUSVBMWToxMDYsTlVNUEFEX1NVQlRSQUNUOjEwOSxQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFJJR0hUOjM5LFNQQUNFOjMyLFRBQjo5LFVQOjM4fX0pLGUuZm4uZXh0ZW5kKHtmb2N1czpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSxhKXtyZXR1cm5cIm51bWJlclwiPT10eXBlb2YgaT90aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdD10aGlzO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtlKHQpLmZvY3VzKCksYSYmYS5jYWxsKHQpfSxpKX0pOnQuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oZS5mbi5mb2N1cyksc2Nyb2xsUGFyZW50OmZ1bmN0aW9uKCl7dmFyIHQ7cmV0dXJuIHQ9ZS51aS5pZSYmLyhzdGF0aWN8cmVsYXRpdmUpLy50ZXN0KHRoaXMuY3NzKFwicG9zaXRpb25cIikpfHwvYWJzb2x1dGUvLnRlc3QodGhpcy5jc3MoXCJwb3NpdGlvblwiKSk/dGhpcy5wYXJlbnRzKCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuLyhyZWxhdGl2ZXxhYnNvbHV0ZXxmaXhlZCkvLnRlc3QoZS5jc3ModGhpcyxcInBvc2l0aW9uXCIpKSYmLyhhdXRvfHNjcm9sbCkvLnRlc3QoZS5jc3ModGhpcyxcIm92ZXJmbG93XCIpK2UuY3NzKHRoaXMsXCJvdmVyZmxvdy15XCIpK2UuY3NzKHRoaXMsXCJvdmVyZmxvdy14XCIpKX0pLmVxKDApOnRoaXMucGFyZW50cygpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybi8oYXV0b3xzY3JvbGwpLy50ZXN0KGUuY3NzKHRoaXMsXCJvdmVyZmxvd1wiKStlLmNzcyh0aGlzLFwib3ZlcmZsb3cteVwiKStlLmNzcyh0aGlzLFwib3ZlcmZsb3cteFwiKSl9KS5lcSgwKSwvZml4ZWQvLnRlc3QodGhpcy5jc3MoXCJwb3NpdGlvblwiKSl8fCF0Lmxlbmd0aD9lKGRvY3VtZW50KTp0fSx6SW5kZXg6ZnVuY3Rpb24oaSl7aWYoaSE9PXQpcmV0dXJuIHRoaXMuY3NzKFwiekluZGV4XCIsaSk7aWYodGhpcy5sZW5ndGgpZm9yKHZhciBhLHMsbj1lKHRoaXNbMF0pO24ubGVuZ3RoJiZuWzBdIT09ZG9jdW1lbnQ7KXtpZihhPW4uY3NzKFwicG9zaXRpb25cIiksKFwiYWJzb2x1dGVcIj09PWF8fFwicmVsYXRpdmVcIj09PWF8fFwiZml4ZWRcIj09PWEpJiYocz1wYXJzZUludChuLmNzcyhcInpJbmRleFwiKSwxMCksIWlzTmFOKHMpJiYwIT09cykpcmV0dXJuIHM7bj1uLnBhcmVudCgpfXJldHVybiAwfSx1bmlxdWVJZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0aGlzLmlkfHwodGhpcy5pZD1cInVpLWlkLVwiKyArK3MpfSl9LHJlbW92ZVVuaXF1ZUlkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe24udGVzdCh0aGlzLmlkKSYmZSh0aGlzKS5yZW1vdmVBdHRyKFwiaWRcIil9KX19KSxlLmV4dGVuZChlLmV4cHJbXCI6XCJdLHtkYXRhOmUuZXhwci5jcmVhdGVQc2V1ZG8/ZS5leHByLmNyZWF0ZVBzZXVkbyhmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSl7cmV0dXJuISFlLmRhdGEoaSx0KX19KTpmdW5jdGlvbih0LGksYSl7cmV0dXJuISFlLmRhdGEodCxhWzNdKX0sZm9jdXNhYmxlOmZ1bmN0aW9uKHQpe3JldHVybiBpKHQsIWlzTmFOKGUuYXR0cih0LFwidGFiaW5kZXhcIikpKX0sdGFiYmFibGU6ZnVuY3Rpb24odCl7dmFyIGE9ZS5hdHRyKHQsXCJ0YWJpbmRleFwiKSxzPWlzTmFOKGEpO3JldHVybihzfHxhPj0wKSYmaSh0LCFzKX19KSxlKFwiPGE+XCIpLm91dGVyV2lkdGgoMSkuanF1ZXJ5fHxlLmVhY2goW1wiV2lkdGhcIixcIkhlaWdodFwiXSxmdW5jdGlvbihpLGEpe2Z1bmN0aW9uIHModCxpLGEscyl7cmV0dXJuIGUuZWFjaChuLGZ1bmN0aW9uKCl7aS09cGFyc2VGbG9hdChlLmNzcyh0LFwicGFkZGluZ1wiK3RoaXMpKXx8MCxhJiYoaS09cGFyc2VGbG9hdChlLmNzcyh0LFwiYm9yZGVyXCIrdGhpcytcIldpZHRoXCIpKXx8MCkscyYmKGktPXBhcnNlRmxvYXQoZS5jc3ModCxcIm1hcmdpblwiK3RoaXMpKXx8MCl9KSxpfXZhciBuPVwiV2lkdGhcIj09PWE/W1wiTGVmdFwiLFwiUmlnaHRcIl06W1wiVG9wXCIsXCJCb3R0b21cIl0scj1hLnRvTG93ZXJDYXNlKCksbz17aW5uZXJXaWR0aDplLmZuLmlubmVyV2lkdGgsaW5uZXJIZWlnaHQ6ZS5mbi5pbm5lckhlaWdodCxvdXRlcldpZHRoOmUuZm4ub3V0ZXJXaWR0aCxvdXRlckhlaWdodDplLmZuLm91dGVySGVpZ2h0fTtlLmZuW1wiaW5uZXJcIithXT1mdW5jdGlvbihpKXtyZXR1cm4gaT09PXQ/b1tcImlubmVyXCIrYV0uY2FsbCh0aGlzKTp0aGlzLmVhY2goZnVuY3Rpb24oKXtlKHRoaXMpLmNzcyhyLHModGhpcyxpKStcInB4XCIpfSl9LGUuZm5bXCJvdXRlclwiK2FdPWZ1bmN0aW9uKHQsaSl7cmV0dXJuXCJudW1iZXJcIiE9dHlwZW9mIHQ/b1tcIm91dGVyXCIrYV0uY2FsbCh0aGlzLHQpOnRoaXMuZWFjaChmdW5jdGlvbigpe2UodGhpcykuY3NzKHIscyh0aGlzLHQsITAsaSkrXCJweFwiKX0pfX0pLGUuZm4uYWRkQmFja3x8KGUuZm4uYWRkQmFjaz1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5hZGQobnVsbD09ZT90aGlzLnByZXZPYmplY3Q6dGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSl9KSxlKFwiPGE+XCIpLmRhdGEoXCJhLWJcIixcImFcIikucmVtb3ZlRGF0YShcImEtYlwiKS5kYXRhKFwiYS1iXCIpJiYoZS5mbi5yZW1vdmVEYXRhPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihpKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90LmNhbGwodGhpcyxlLmNhbWVsQ2FzZShpKSk6dC5jYWxsKHRoaXMpfX0oZS5mbi5yZW1vdmVEYXRhKSksZS51aS5pZT0hIS9tc2llIFtcXHcuXSsvLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKSxlLnN1cHBvcnQuc2VsZWN0c3RhcnQ9XCJvbnNlbGVjdHN0YXJ0XCJpbiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGUuZm4uZXh0ZW5kKHtkaXNhYmxlU2VsZWN0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYmluZCgoZS5zdXBwb3J0LnNlbGVjdHN0YXJ0P1wic2VsZWN0c3RhcnRcIjpcIm1vdXNlZG93blwiKStcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIsZnVuY3Rpb24oZSl7ZS5wcmV2ZW50RGVmYXVsdCgpfSl9LGVuYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVuYmluZChcIi51aS1kaXNhYmxlU2VsZWN0aW9uXCIpfX0pLGUuZXh0ZW5kKGUudWkse3BsdWdpbjp7YWRkOmZ1bmN0aW9uKHQsaSxhKXt2YXIgcyxuPWUudWlbdF0ucHJvdG90eXBlO2ZvcihzIGluIGEpbi5wbHVnaW5zW3NdPW4ucGx1Z2luc1tzXXx8W10sbi5wbHVnaW5zW3NdLnB1c2goW2ksYVtzXV0pfSxjYWxsOmZ1bmN0aW9uKGUsdCxpKXt2YXIgYSxzPWUucGx1Z2luc1t0XTtpZihzJiZlLmVsZW1lbnRbMF0ucGFyZW50Tm9kZSYmMTEhPT1lLmVsZW1lbnRbMF0ucGFyZW50Tm9kZS5ub2RlVHlwZSlmb3IoYT0wO3MubGVuZ3RoPmE7YSsrKWUub3B0aW9uc1tzW2FdWzBdXSYmc1thXVsxXS5hcHBseShlLmVsZW1lbnQsaSl9fSxoYXNTY3JvbGw6ZnVuY3Rpb24odCxpKXtpZihcImhpZGRlblwiPT09ZSh0KS5jc3MoXCJvdmVyZmxvd1wiKSlyZXR1cm4hMTt2YXIgYT1pJiZcImxlZnRcIj09PWk/XCJzY3JvbGxMZWZ0XCI6XCJzY3JvbGxUb3BcIixzPSExO3JldHVybiB0W2FdPjA/ITA6KHRbYV09MSxzPXRbYV0+MCx0W2FdPTAscyl9fSl9KShqUXVlcnkpOyhmdW5jdGlvbihlLHQpe3ZhciBpPTAscz1BcnJheS5wcm90b3R5cGUuc2xpY2UsYT1lLmNsZWFuRGF0YTtlLmNsZWFuRGF0YT1mdW5jdGlvbih0KXtmb3IodmFyIGkscz0wO251bGwhPShpPXRbc10pO3MrKyl0cnl7ZShpKS50cmlnZ2VySGFuZGxlcihcInJlbW92ZVwiKX1jYXRjaChuKXt9YSh0KX0sZS53aWRnZXQ9ZnVuY3Rpb24oaSxzLGEpe3ZhciBuLHIsbyxoLGw9e30sdT1pLnNwbGl0KFwiLlwiKVswXTtpPWkuc3BsaXQoXCIuXCIpWzFdLG49dStcIi1cIitpLGF8fChhPXMscz1lLldpZGdldCksZS5leHByW1wiOlwiXVtuLnRvTG93ZXJDYXNlKCldPWZ1bmN0aW9uKHQpe3JldHVybiEhZS5kYXRhKHQsbil9LGVbdV09ZVt1XXx8e30scj1lW3VdW2ldLG89ZVt1XVtpXT1mdW5jdGlvbihlLGkpe3JldHVybiB0aGlzLl9jcmVhdGVXaWRnZXQ/KGFyZ3VtZW50cy5sZW5ndGgmJnRoaXMuX2NyZWF0ZVdpZGdldChlLGkpLHQpOm5ldyBvKGUsaSl9LGUuZXh0ZW5kKG8scix7dmVyc2lvbjphLnZlcnNpb24sX3Byb3RvOmUuZXh0ZW5kKHt9LGEpLF9jaGlsZENvbnN0cnVjdG9yczpbXX0pLGg9bmV3IHMsaC5vcHRpb25zPWUud2lkZ2V0LmV4dGVuZCh7fSxoLm9wdGlvbnMpLGUuZWFjaChhLGZ1bmN0aW9uKGksYSl7cmV0dXJuIGUuaXNGdW5jdGlvbihhKT8obFtpXT1mdW5jdGlvbigpe3ZhciBlPWZ1bmN0aW9uKCl7cmV0dXJuIHMucHJvdG90eXBlW2ldLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdD1mdW5jdGlvbihlKXtyZXR1cm4gcy5wcm90b3R5cGVbaV0uYXBwbHkodGhpcyxlKX07cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGkscz10aGlzLl9zdXBlcixuPXRoaXMuX3N1cGVyQXBwbHk7cmV0dXJuIHRoaXMuX3N1cGVyPWUsdGhpcy5fc3VwZXJBcHBseT10LGk9YS5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fc3VwZXI9cyx0aGlzLl9zdXBlckFwcGx5PW4saX19KCksdCk6KGxbaV09YSx0KX0pLG8ucHJvdG90eXBlPWUud2lkZ2V0LmV4dGVuZChoLHt3aWRnZXRFdmVudFByZWZpeDpyP2gud2lkZ2V0RXZlbnRQcmVmaXg6aX0sbCx7Y29uc3RydWN0b3I6byxuYW1lc3BhY2U6dSx3aWRnZXROYW1lOmksd2lkZ2V0RnVsbE5hbWU6bn0pLHI/KGUuZWFjaChyLl9jaGlsZENvbnN0cnVjdG9ycyxmdW5jdGlvbih0LGkpe3ZhciBzPWkucHJvdG90eXBlO2Uud2lkZ2V0KHMubmFtZXNwYWNlK1wiLlwiK3Mud2lkZ2V0TmFtZSxvLGkuX3Byb3RvKX0pLGRlbGV0ZSByLl9jaGlsZENvbnN0cnVjdG9ycyk6cy5fY2hpbGRDb25zdHJ1Y3RvcnMucHVzaChvKSxlLndpZGdldC5icmlkZ2UoaSxvKX0sZS53aWRnZXQuZXh0ZW5kPWZ1bmN0aW9uKGkpe2Zvcih2YXIgYSxuLHI9cy5jYWxsKGFyZ3VtZW50cywxKSxvPTAsaD1yLmxlbmd0aDtoPm87bysrKWZvcihhIGluIHJbb10pbj1yW29dW2FdLHJbb10uaGFzT3duUHJvcGVydHkoYSkmJm4hPT10JiYoaVthXT1lLmlzUGxhaW5PYmplY3Qobik/ZS5pc1BsYWluT2JqZWN0KGlbYV0pP2Uud2lkZ2V0LmV4dGVuZCh7fSxpW2FdLG4pOmUud2lkZ2V0LmV4dGVuZCh7fSxuKTpuKTtyZXR1cm4gaX0sZS53aWRnZXQuYnJpZGdlPWZ1bmN0aW9uKGksYSl7dmFyIG49YS5wcm90b3R5cGUud2lkZ2V0RnVsbE5hbWV8fGk7ZS5mbltpXT1mdW5jdGlvbihyKXt2YXIgbz1cInN0cmluZ1wiPT10eXBlb2YgcixoPXMuY2FsbChhcmd1bWVudHMsMSksbD10aGlzO3JldHVybiByPSFvJiZoLmxlbmd0aD9lLndpZGdldC5leHRlbmQuYXBwbHkobnVsbCxbcl0uY29uY2F0KGgpKTpyLG8/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHMsYT1lLmRhdGEodGhpcyxuKTtyZXR1cm4gYT9lLmlzRnVuY3Rpb24oYVtyXSkmJlwiX1wiIT09ci5jaGFyQXQoMCk/KHM9YVtyXS5hcHBseShhLGgpLHMhPT1hJiZzIT09dD8obD1zJiZzLmpxdWVyeT9sLnB1c2hTdGFjayhzLmdldCgpKTpzLCExKTp0KTplLmVycm9yKFwibm8gc3VjaCBtZXRob2QgJ1wiK3IrXCInIGZvciBcIitpK1wiIHdpZGdldCBpbnN0YW5jZVwiKTplLmVycm9yKFwiY2Fubm90IGNhbGwgbWV0aG9kcyBvbiBcIitpK1wiIHByaW9yIHRvIGluaXRpYWxpemF0aW9uOyBcIitcImF0dGVtcHRlZCB0byBjYWxsIG1ldGhvZCAnXCIrcitcIidcIil9KTp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgdD1lLmRhdGEodGhpcyxuKTt0P3Qub3B0aW9uKHJ8fHt9KS5faW5pdCgpOmUuZGF0YSh0aGlzLG4sbmV3IGEocix0aGlzKSl9KSxsfX0sZS5XaWRnZXQ9ZnVuY3Rpb24oKXt9LGUuV2lkZ2V0Ll9jaGlsZENvbnN0cnVjdG9ycz1bXSxlLldpZGdldC5wcm90b3R5cGU9e3dpZGdldE5hbWU6XCJ3aWRnZXRcIix3aWRnZXRFdmVudFByZWZpeDpcIlwiLGRlZmF1bHRFbGVtZW50OlwiPGRpdj5cIixvcHRpb25zOntkaXNhYmxlZDohMSxjcmVhdGU6bnVsbH0sX2NyZWF0ZVdpZGdldDpmdW5jdGlvbih0LHMpe3M9ZShzfHx0aGlzLmRlZmF1bHRFbGVtZW50fHx0aGlzKVswXSx0aGlzLmVsZW1lbnQ9ZShzKSx0aGlzLnV1aWQ9aSsrLHRoaXMuZXZlbnROYW1lc3BhY2U9XCIuXCIrdGhpcy53aWRnZXROYW1lK3RoaXMudXVpZCx0aGlzLm9wdGlvbnM9ZS53aWRnZXQuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyx0aGlzLl9nZXRDcmVhdGVPcHRpb25zKCksdCksdGhpcy5iaW5kaW5ncz1lKCksdGhpcy5ob3ZlcmFibGU9ZSgpLHRoaXMuZm9jdXNhYmxlPWUoKSxzIT09dGhpcyYmKGUuZGF0YShzLHRoaXMud2lkZ2V0RnVsbE5hbWUsdGhpcyksdGhpcy5fb24oITAsdGhpcy5lbGVtZW50LHtyZW1vdmU6ZnVuY3Rpb24oZSl7ZS50YXJnZXQ9PT1zJiZ0aGlzLmRlc3Ryb3koKX19KSx0aGlzLmRvY3VtZW50PWUocy5zdHlsZT9zLm93bmVyRG9jdW1lbnQ6cy5kb2N1bWVudHx8cyksdGhpcy53aW5kb3c9ZSh0aGlzLmRvY3VtZW50WzBdLmRlZmF1bHRWaWV3fHx0aGlzLmRvY3VtZW50WzBdLnBhcmVudFdpbmRvdykpLHRoaXMuX2NyZWF0ZSgpLHRoaXMuX3RyaWdnZXIoXCJjcmVhdGVcIixudWxsLHRoaXMuX2dldENyZWF0ZUV2ZW50RGF0YSgpKSx0aGlzLl9pbml0KCl9LF9nZXRDcmVhdGVPcHRpb25zOmUubm9vcCxfZ2V0Q3JlYXRlRXZlbnREYXRhOmUubm9vcCxfY3JlYXRlOmUubm9vcCxfaW5pdDplLm5vb3AsZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuX2Rlc3Ryb3koKSx0aGlzLmVsZW1lbnQudW5iaW5kKHRoaXMuZXZlbnROYW1lc3BhY2UpLnJlbW92ZURhdGEodGhpcy53aWRnZXROYW1lKS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0RnVsbE5hbWUpLnJlbW92ZURhdGEoZS5jYW1lbENhc2UodGhpcy53aWRnZXRGdWxsTmFtZSkpLHRoaXMud2lkZ2V0KCkudW5iaW5kKHRoaXMuZXZlbnROYW1lc3BhY2UpLnJlbW92ZUF0dHIoXCJhcmlhLWRpc2FibGVkXCIpLnJlbW92ZUNsYXNzKHRoaXMud2lkZ2V0RnVsbE5hbWUrXCItZGlzYWJsZWQgXCIrXCJ1aS1zdGF0ZS1kaXNhYmxlZFwiKSx0aGlzLmJpbmRpbmdzLnVuYmluZCh0aGlzLmV2ZW50TmFtZXNwYWNlKSx0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLHRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9LF9kZXN0cm95OmUubm9vcCx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50fSxvcHRpb246ZnVuY3Rpb24oaSxzKXt2YXIgYSxuLHIsbz1pO2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKXJldHVybiBlLndpZGdldC5leHRlbmQoe30sdGhpcy5vcHRpb25zKTtpZihcInN0cmluZ1wiPT10eXBlb2YgaSlpZihvPXt9LGE9aS5zcGxpdChcIi5cIiksaT1hLnNoaWZ0KCksYS5sZW5ndGgpe2ZvcihuPW9baV09ZS53aWRnZXQuZXh0ZW5kKHt9LHRoaXMub3B0aW9uc1tpXSkscj0wO2EubGVuZ3RoLTE+cjtyKyspblthW3JdXT1uW2Fbcl1dfHx7fSxuPW5bYVtyXV07aWYoaT1hLnBvcCgpLHM9PT10KXJldHVybiBuW2ldPT09dD9udWxsOm5baV07bltpXT1zfWVsc2V7aWYocz09PXQpcmV0dXJuIHRoaXMub3B0aW9uc1tpXT09PXQ/bnVsbDp0aGlzLm9wdGlvbnNbaV07b1tpXT1zfXJldHVybiB0aGlzLl9zZXRPcHRpb25zKG8pLHRoaXN9LF9zZXRPcHRpb25zOmZ1bmN0aW9uKGUpe3ZhciB0O2Zvcih0IGluIGUpdGhpcy5fc2V0T3B0aW9uKHQsZVt0XSk7cmV0dXJuIHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5vcHRpb25zW2VdPXQsXCJkaXNhYmxlZFwiPT09ZSYmKHRoaXMud2lkZ2V0KCkudG9nZ2xlQ2xhc3ModGhpcy53aWRnZXRGdWxsTmFtZStcIi1kaXNhYmxlZCB1aS1zdGF0ZS1kaXNhYmxlZFwiLCEhdCkuYXR0cihcImFyaWEtZGlzYWJsZWRcIix0KSx0aGlzLmhvdmVyYWJsZS5yZW1vdmVDbGFzcyhcInVpLXN0YXRlLWhvdmVyXCIpLHRoaXMuZm9jdXNhYmxlLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIikpLHRoaXN9LGVuYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oXCJkaXNhYmxlZFwiLCExKX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oXCJkaXNhYmxlZFwiLCEwKX0sX29uOmZ1bmN0aW9uKGkscyxhKXt2YXIgbixyPXRoaXM7XCJib29sZWFuXCIhPXR5cGVvZiBpJiYoYT1zLHM9aSxpPSExKSxhPyhzPW49ZShzKSx0aGlzLmJpbmRpbmdzPXRoaXMuYmluZGluZ3MuYWRkKHMpKTooYT1zLHM9dGhpcy5lbGVtZW50LG49dGhpcy53aWRnZXQoKSksZS5lYWNoKGEsZnVuY3Rpb24oYSxvKXtmdW5jdGlvbiBoKCl7cmV0dXJuIGl8fHIub3B0aW9ucy5kaXNhYmxlZCE9PSEwJiYhZSh0aGlzKS5oYXNDbGFzcyhcInVpLXN0YXRlLWRpc2FibGVkXCIpPyhcInN0cmluZ1wiPT10eXBlb2Ygbz9yW29dOm8pLmFwcGx5KHIsYXJndW1lbnRzKTp0fVwic3RyaW5nXCIhPXR5cGVvZiBvJiYoaC5ndWlkPW8uZ3VpZD1vLmd1aWR8fGguZ3VpZHx8ZS5ndWlkKyspO3ZhciBsPWEubWF0Y2goL14oXFx3KylcXHMqKC4qKSQvKSx1PWxbMV0rci5ldmVudE5hbWVzcGFjZSxjPWxbMl07Yz9uLmRlbGVnYXRlKGMsdSxoKTpzLmJpbmQodSxoKX0pfSxfb2ZmOmZ1bmN0aW9uKGUsdCl7dD0odHx8XCJcIikuc3BsaXQoXCIgXCIpLmpvaW4odGhpcy5ldmVudE5hbWVzcGFjZStcIiBcIikrdGhpcy5ldmVudE5hbWVzcGFjZSxlLnVuYmluZCh0KS51bmRlbGVnYXRlKHQpfSxfZGVsYXk6ZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKCl7cmV0dXJuKFwic3RyaW5nXCI9PXR5cGVvZiBlP3NbZV06ZSkuYXBwbHkocyxhcmd1bWVudHMpfXZhciBzPXRoaXM7cmV0dXJuIHNldFRpbWVvdXQoaSx0fHwwKX0sX2hvdmVyYWJsZTpmdW5jdGlvbih0KXt0aGlzLmhvdmVyYWJsZT10aGlzLmhvdmVyYWJsZS5hZGQodCksdGhpcy5fb24odCx7bW91c2VlbnRlcjpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX0sbW91c2VsZWF2ZTpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkucmVtb3ZlQ2xhc3MoXCJ1aS1zdGF0ZS1ob3ZlclwiKX19KX0sX2ZvY3VzYWJsZTpmdW5jdGlvbih0KXt0aGlzLmZvY3VzYWJsZT10aGlzLmZvY3VzYWJsZS5hZGQodCksdGhpcy5fb24odCx7Zm9jdXNpbjpmdW5jdGlvbih0KXtlKHQuY3VycmVudFRhcmdldCkuYWRkQ2xhc3MoXCJ1aS1zdGF0ZS1mb2N1c1wiKX0sZm9jdXNvdXQ6ZnVuY3Rpb24odCl7ZSh0LmN1cnJlbnRUYXJnZXQpLnJlbW92ZUNsYXNzKFwidWktc3RhdGUtZm9jdXNcIil9fSl9LF90cmlnZ2VyOmZ1bmN0aW9uKHQsaSxzKXt2YXIgYSxuLHI9dGhpcy5vcHRpb25zW3RdO2lmKHM9c3x8e30saT1lLkV2ZW50KGkpLGkudHlwZT0odD09PXRoaXMud2lkZ2V0RXZlbnRQcmVmaXg/dDp0aGlzLndpZGdldEV2ZW50UHJlZml4K3QpLnRvTG93ZXJDYXNlKCksaS50YXJnZXQ9dGhpcy5lbGVtZW50WzBdLG49aS5vcmlnaW5hbEV2ZW50KWZvcihhIGluIG4pYSBpbiBpfHwoaVthXT1uW2FdKTtyZXR1cm4gdGhpcy5lbGVtZW50LnRyaWdnZXIoaSxzKSwhKGUuaXNGdW5jdGlvbihyKSYmci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW2ldLmNvbmNhdChzKSk9PT0hMXx8aS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fSxlLmVhY2goe3Nob3c6XCJmYWRlSW5cIixoaWRlOlwiZmFkZU91dFwifSxmdW5jdGlvbih0LGkpe2UuV2lkZ2V0LnByb3RvdHlwZVtcIl9cIit0XT1mdW5jdGlvbihzLGEsbil7XCJzdHJpbmdcIj09dHlwZW9mIGEmJihhPXtlZmZlY3Q6YX0pO3ZhciByLG89YT9hPT09ITB8fFwibnVtYmVyXCI9PXR5cGVvZiBhP2k6YS5lZmZlY3R8fGk6dDthPWF8fHt9LFwibnVtYmVyXCI9PXR5cGVvZiBhJiYoYT17ZHVyYXRpb246YX0pLHI9IWUuaXNFbXB0eU9iamVjdChhKSxhLmNvbXBsZXRlPW4sYS5kZWxheSYmcy5kZWxheShhLmRlbGF5KSxyJiZlLmVmZmVjdHMmJmUuZWZmZWN0cy5lZmZlY3Rbb10/c1t0XShhKTpvIT09dCYmc1tvXT9zW29dKGEuZHVyYXRpb24sYS5lYXNpbmcsbik6cy5xdWV1ZShmdW5jdGlvbihpKXtlKHRoaXMpW3RdKCksbiYmbi5jYWxsKHNbMF0pLGkoKX0pfX0pfSkoalF1ZXJ5KTsoZnVuY3Rpb24oZSl7dmFyIHQ9ITE7ZShkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbigpe3Q9ITF9KSxlLndpZGdldChcInVpLm1vdXNlXCIse3ZlcnNpb246XCIxLjEwLjNcIixvcHRpb25zOntjYW5jZWw6XCJpbnB1dCx0ZXh0YXJlYSxidXR0b24sc2VsZWN0LG9wdGlvblwiLGRpc3RhbmNlOjEsZGVsYXk6MH0sX21vdXNlSW5pdDpmdW5jdGlvbigpe3ZhciB0PXRoaXM7dGhpcy5lbGVtZW50LmJpbmQoXCJtb3VzZWRvd24uXCIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGUpe3JldHVybiB0Ll9tb3VzZURvd24oZSl9KS5iaW5kKFwiY2xpY2suXCIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGkpe3JldHVybiEwPT09ZS5kYXRhKGkudGFyZ2V0LHQud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKT8oZS5yZW1vdmVEYXRhKGkudGFyZ2V0LHQud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiKSxpLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLCExKTp1bmRlZmluZWR9KSx0aGlzLnN0YXJ0ZWQ9ITF9LF9tb3VzZURlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQudW5iaW5kKFwiLlwiK3RoaXMud2lkZ2V0TmFtZSksdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUmJmUoZG9jdW1lbnQpLnVuYmluZChcIm1vdXNlbW92ZS5cIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSl9LF9tb3VzZURvd246ZnVuY3Rpb24oaSl7aWYoIXQpe3RoaXMuX21vdXNlU3RhcnRlZCYmdGhpcy5fbW91c2VVcChpKSx0aGlzLl9tb3VzZURvd25FdmVudD1pO3ZhciBzPXRoaXMsYT0xPT09aS53aGljaCxuPVwic3RyaW5nXCI9PXR5cGVvZiB0aGlzLm9wdGlvbnMuY2FuY2VsJiZpLnRhcmdldC5ub2RlTmFtZT9lKGkudGFyZ2V0KS5jbG9zZXN0KHRoaXMub3B0aW9ucy5jYW5jZWwpLmxlbmd0aDohMTtyZXR1cm4gYSYmIW4mJnRoaXMuX21vdXNlQ2FwdHVyZShpKT8odGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXksdGhpcy5tb3VzZURlbGF5TWV0fHwodGhpcy5fbW91c2VEZWxheVRpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtzLm1vdXNlRGVsYXlNZXQ9ITB9LHRoaXMub3B0aW9ucy5kZWxheSkpLHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoaSkmJnRoaXMuX21vdXNlRGVsYXlNZXQoaSkmJih0aGlzLl9tb3VzZVN0YXJ0ZWQ9dGhpcy5fbW91c2VTdGFydChpKSE9PSExLCF0aGlzLl9tb3VzZVN0YXJ0ZWQpPyhpLnByZXZlbnREZWZhdWx0KCksITApOighMD09PWUuZGF0YShpLnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIikmJmUucmVtb3ZlRGF0YShpLnRhcmdldCx0aGlzLndpZGdldE5hbWUrXCIucHJldmVudENsaWNrRXZlbnRcIiksdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGU9ZnVuY3Rpb24oZSl7cmV0dXJuIHMuX21vdXNlTW92ZShlKX0sdGhpcy5fbW91c2VVcERlbGVnYXRlPWZ1bmN0aW9uKGUpe3JldHVybiBzLl9tb3VzZVVwKGUpfSxlKGRvY3VtZW50KS5iaW5kKFwibW91c2Vtb3ZlLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZU1vdmVEZWxlZ2F0ZSkuYmluZChcIm1vdXNldXAuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSksaS5wcmV2ZW50RGVmYXVsdCgpLHQ9ITAsITApKTohMH19LF9tb3VzZU1vdmU6ZnVuY3Rpb24odCl7cmV0dXJuIGUudWkuaWUmJighZG9jdW1lbnQuZG9jdW1lbnRNb2RlfHw5PmRvY3VtZW50LmRvY3VtZW50TW9kZSkmJiF0LmJ1dHRvbj90aGlzLl9tb3VzZVVwKHQpOnRoaXMuX21vdXNlU3RhcnRlZD8odGhpcy5fbW91c2VEcmFnKHQpLHQucHJldmVudERlZmF1bHQoKSk6KHRoaXMuX21vdXNlRGlzdGFuY2VNZXQodCkmJnRoaXMuX21vdXNlRGVsYXlNZXQodCkmJih0aGlzLl9tb3VzZVN0YXJ0ZWQ9dGhpcy5fbW91c2VTdGFydCh0aGlzLl9tb3VzZURvd25FdmVudCx0KSE9PSExLHRoaXMuX21vdXNlU3RhcnRlZD90aGlzLl9tb3VzZURyYWcodCk6dGhpcy5fbW91c2VVcCh0KSksIXRoaXMuX21vdXNlU3RhcnRlZCl9LF9tb3VzZVVwOmZ1bmN0aW9uKHQpe3JldHVybiBlKGRvY3VtZW50KS51bmJpbmQoXCJtb3VzZW1vdmUuXCIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS51bmJpbmQoXCJtb3VzZXVwLlwiK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpLHRoaXMuX21vdXNlU3RhcnRlZCYmKHRoaXMuX21vdXNlU3RhcnRlZD0hMSx0LnRhcmdldD09PXRoaXMuX21vdXNlRG93bkV2ZW50LnRhcmdldCYmZS5kYXRhKHQudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZStcIi5wcmV2ZW50Q2xpY2tFdmVudFwiLCEwKSx0aGlzLl9tb3VzZVN0b3AodCkpLCExfSxfbW91c2VEaXN0YW5jZU1ldDpmdW5jdGlvbihlKXtyZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVgtZS5wYWdlWCksTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVktZS5wYWdlWSkpPj10aGlzLm9wdGlvbnMuZGlzdGFuY2V9LF9tb3VzZURlbGF5TWV0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubW91c2VEZWxheU1ldH0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oKXt9LF9tb3VzZURyYWc6ZnVuY3Rpb24oKXt9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oKXt9LF9tb3VzZUNhcHR1cmU6ZnVuY3Rpb24oKXtyZXR1cm4hMH19KX0pKGpRdWVyeSk7KGZ1bmN0aW9uKGUpe2Uud2lkZ2V0KFwidWkuZHJhZ2dhYmxlXCIsZS51aS5tb3VzZSx7dmVyc2lvbjpcIjEuMTAuM1wiLHdpZGdldEV2ZW50UHJlZml4OlwiZHJhZ1wiLG9wdGlvbnM6e2FkZENsYXNzZXM6ITAsYXBwZW5kVG86XCJwYXJlbnRcIixheGlzOiExLGNvbm5lY3RUb1NvcnRhYmxlOiExLGNvbnRhaW5tZW50OiExLGN1cnNvcjpcImF1dG9cIixjdXJzb3JBdDohMSxncmlkOiExLGhhbmRsZTohMSxoZWxwZXI6XCJvcmlnaW5hbFwiLGlmcmFtZUZpeDohMSxvcGFjaXR5OiExLHJlZnJlc2hQb3NpdGlvbnM6ITEscmV2ZXJ0OiExLHJldmVydER1cmF0aW9uOjUwMCxzY29wZTpcImRlZmF1bHRcIixzY3JvbGw6ITAsc2Nyb2xsU2Vuc2l0aXZpdHk6MjAsc2Nyb2xsU3BlZWQ6MjAsc25hcDohMSxzbmFwTW9kZTpcImJvdGhcIixzbmFwVG9sZXJhbmNlOjIwLHN0YWNrOiExLHpJbmRleDohMSxkcmFnOm51bGwsc3RhcnQ6bnVsbCxzdG9wOm51bGx9LF9jcmVhdGU6ZnVuY3Rpb24oKXtcIm9yaWdpbmFsXCIhPT10aGlzLm9wdGlvbnMuaGVscGVyfHwvXig/OnJ8YXxmKS8udGVzdCh0aGlzLmVsZW1lbnQuY3NzKFwicG9zaXRpb25cIikpfHwodGhpcy5lbGVtZW50WzBdLnN0eWxlLnBvc2l0aW9uPVwicmVsYXRpdmVcIiksdGhpcy5vcHRpb25zLmFkZENsYXNzZXMmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWRyYWdnYWJsZVwiKSx0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyhcInVpLWRyYWdnYWJsZS1kaXNhYmxlZFwiKSx0aGlzLl9tb3VzZUluaXQoKX0sX2Rlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJ1aS1kcmFnZ2FibGUgdWktZHJhZ2dhYmxlLWRyYWdnaW5nIHVpLWRyYWdnYWJsZS1kaXNhYmxlZFwiKSx0aGlzLl9tb3VzZURlc3Ryb3koKX0sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbih0KXt2YXIgaT10aGlzLm9wdGlvbnM7cmV0dXJuIHRoaXMuaGVscGVyfHxpLmRpc2FibGVkfHxlKHQudGFyZ2V0KS5jbG9zZXN0KFwiLnVpLXJlc2l6YWJsZS1oYW5kbGVcIikubGVuZ3RoPjA/ITE6KHRoaXMuaGFuZGxlPXRoaXMuX2dldEhhbmRsZSh0KSx0aGlzLmhhbmRsZT8oZShpLmlmcmFtZUZpeD09PSEwP1wiaWZyYW1lXCI6aS5pZnJhbWVGaXgpLmVhY2goZnVuY3Rpb24oKXtlKFwiPGRpdiBjbGFzcz0ndWktZHJhZ2dhYmxlLWlmcmFtZUZpeCcgc3R5bGU9J2JhY2tncm91bmQ6ICNmZmY7Jz48L2Rpdj5cIikuY3NzKHt3aWR0aDp0aGlzLm9mZnNldFdpZHRoK1wicHhcIixoZWlnaHQ6dGhpcy5vZmZzZXRIZWlnaHQrXCJweFwiLHBvc2l0aW9uOlwiYWJzb2x1dGVcIixvcGFjaXR5OlwiMC4wMDFcIix6SW5kZXg6MWUzfSkuY3NzKGUodGhpcykub2Zmc2V0KCkpLmFwcGVuZFRvKFwiYm9keVwiKX0pLCEwKTohMSl9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMub3B0aW9ucztyZXR1cm4gdGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKHQpLHRoaXMuaGVscGVyLmFkZENsYXNzKFwidWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpLHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSxlLnVpLmRkbWFuYWdlciYmKGUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ9dGhpcyksdGhpcy5fY2FjaGVNYXJnaW5zKCksdGhpcy5jc3NQb3NpdGlvbj10aGlzLmhlbHBlci5jc3MoXCJwb3NpdGlvblwiKSx0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKSx0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKSx0aGlzLm9mZnNldFBhcmVudENzc1Bvc2l0aW9uPXRoaXMub2Zmc2V0UGFyZW50LmNzcyhcInBvc2l0aW9uXCIpLHRoaXMub2Zmc2V0PXRoaXMucG9zaXRpb25BYnM9dGhpcy5lbGVtZW50Lm9mZnNldCgpLHRoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fSx0aGlzLm9mZnNldC5zY3JvbGw9ITEsZS5leHRlbmQodGhpcy5vZmZzZXQse2NsaWNrOntsZWZ0OnQucGFnZVgtdGhpcy5vZmZzZXQubGVmdCx0b3A6dC5wYWdlWS10aGlzLm9mZnNldC50b3B9LHBhcmVudDp0aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSxyZWxhdGl2ZTp0aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpfSksdGhpcy5vcmlnaW5hbFBvc2l0aW9uPXRoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLm9yaWdpbmFsUGFnZVg9dC5wYWdlWCx0aGlzLm9yaWdpbmFsUGFnZVk9dC5wYWdlWSxpLmN1cnNvckF0JiZ0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKGkuY3Vyc29yQXQpLHRoaXMuX3NldENvbnRhaW5tZW50KCksdGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsdCk9PT0hMT8odGhpcy5fY2xlYXIoKSwhMSk6KHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSxlLnVpLmRkbWFuYWdlciYmIWkuZHJvcEJlaGF2aW91ciYmZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcyx0KSx0aGlzLl9tb3VzZURyYWcodCwhMCksZS51aS5kZG1hbmFnZXImJmUudWkuZGRtYW5hZ2VyLmRyYWdTdGFydCh0aGlzLHQpLCEwKX0sX21vdXNlRHJhZzpmdW5jdGlvbih0LGkpe2lmKFwiZml4ZWRcIj09PXRoaXMub2Zmc2V0UGFyZW50Q3NzUG9zaXRpb24mJih0aGlzLm9mZnNldC5wYXJlbnQ9dGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCkpLHRoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIiksIWkpe3ZhciBhPXRoaXMuX3VpSGFzaCgpO2lmKHRoaXMuX3RyaWdnZXIoXCJkcmFnXCIsdCxhKT09PSExKXJldHVybiB0aGlzLl9tb3VzZVVwKHt9KSwhMTt0aGlzLnBvc2l0aW9uPWEucG9zaXRpb259cmV0dXJuIHRoaXMub3B0aW9ucy5heGlzJiZcInlcIj09PXRoaXMub3B0aW9ucy5heGlzfHwodGhpcy5oZWxwZXJbMF0uc3R5bGUubGVmdD10aGlzLnBvc2l0aW9uLmxlZnQrXCJweFwiKSx0aGlzLm9wdGlvbnMuYXhpcyYmXCJ4XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8KHRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcD10aGlzLnBvc2l0aW9uLnRvcCtcInB4XCIpLGUudWkuZGRtYW5hZ2VyJiZlLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsdCksITF9LF9tb3VzZVN0b3A6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcyxhPSExO3JldHVybiBlLnVpLmRkbWFuYWdlciYmIXRoaXMub3B0aW9ucy5kcm9wQmVoYXZpb3VyJiYoYT1lLnVpLmRkbWFuYWdlci5kcm9wKHRoaXMsdCkpLHRoaXMuZHJvcHBlZCYmKGE9dGhpcy5kcm9wcGVkLHRoaXMuZHJvcHBlZD0hMSksXCJvcmlnaW5hbFwiIT09dGhpcy5vcHRpb25zLmhlbHBlcnx8ZS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0ub3duZXJEb2N1bWVudCx0aGlzLmVsZW1lbnRbMF0pPyhcImludmFsaWRcIj09PXRoaXMub3B0aW9ucy5yZXZlcnQmJiFhfHxcInZhbGlkXCI9PT10aGlzLm9wdGlvbnMucmV2ZXJ0JiZhfHx0aGlzLm9wdGlvbnMucmV2ZXJ0PT09ITB8fGUuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMucmV2ZXJ0KSYmdGhpcy5vcHRpb25zLnJldmVydC5jYWxsKHRoaXMuZWxlbWVudCxhKT9lKHRoaXMuaGVscGVyKS5hbmltYXRlKHRoaXMub3JpZ2luYWxQb3NpdGlvbixwYXJzZUludCh0aGlzLm9wdGlvbnMucmV2ZXJ0RHVyYXRpb24sMTApLGZ1bmN0aW9uKCl7aS5fdHJpZ2dlcihcInN0b3BcIix0KSE9PSExJiZpLl9jbGVhcigpfSk6dGhpcy5fdHJpZ2dlcihcInN0b3BcIix0KSE9PSExJiZ0aGlzLl9jbGVhcigpLCExKTohMX0sX21vdXNlVXA6ZnVuY3Rpb24odCl7cmV0dXJuIGUoXCJkaXYudWktZHJhZ2dhYmxlLWlmcmFtZUZpeFwiKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMpfSksZS51aS5kZG1hbmFnZXImJmUudWkuZGRtYW5hZ2VyLmRyYWdTdG9wKHRoaXMsdCksZS51aS5tb3VzZS5wcm90b3R5cGUuX21vdXNlVXAuY2FsbCh0aGlzLHQpfSxjYW5jZWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5oZWxwZXIuaXMoXCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpP3RoaXMuX21vdXNlVXAoe30pOnRoaXMuX2NsZWFyKCksdGhpc30sX2dldEhhbmRsZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5vcHRpb25zLmhhbmRsZT8hIWUodC50YXJnZXQpLmNsb3Nlc3QodGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLmhhbmRsZSkpLmxlbmd0aDohMH0sX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbih0KXt2YXIgaT10aGlzLm9wdGlvbnMsYT1lLmlzRnVuY3Rpb24oaS5oZWxwZXIpP2UoaS5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WzBdLFt0XSkpOlwiY2xvbmVcIj09PWkuaGVscGVyP3RoaXMuZWxlbWVudC5jbG9uZSgpLnJlbW92ZUF0dHIoXCJpZFwiKTp0aGlzLmVsZW1lbnQ7cmV0dXJuIGEucGFyZW50cyhcImJvZHlcIikubGVuZ3RofHxhLmFwcGVuZFRvKFwicGFyZW50XCI9PT1pLmFwcGVuZFRvP3RoaXMuZWxlbWVudFswXS5wYXJlbnROb2RlOmkuYXBwZW5kVG8pLGFbMF09PT10aGlzLmVsZW1lbnRbMF18fC8oZml4ZWR8YWJzb2x1dGUpLy50ZXN0KGEuY3NzKFwicG9zaXRpb25cIikpfHxhLmNzcyhcInBvc2l0aW9uXCIsXCJhYnNvbHV0ZVwiKSxhfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbih0KXtcInN0cmluZ1wiPT10eXBlb2YgdCYmKHQ9dC5zcGxpdChcIiBcIikpLGUuaXNBcnJheSh0KSYmKHQ9e2xlZnQ6K3RbMF0sdG9wOit0WzFdfHwwfSksXCJsZWZ0XCJpbiB0JiYodGhpcy5vZmZzZXQuY2xpY2subGVmdD10LmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQpLFwicmlnaHRcImluIHQmJih0aGlzLm9mZnNldC5jbGljay5sZWZ0PXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdC5yaWdodCt0aGlzLm1hcmdpbnMubGVmdCksXCJ0b3BcImluIHQmJih0aGlzLm9mZnNldC5jbGljay50b3A9dC50b3ArdGhpcy5tYXJnaW5zLnRvcCksXCJib3R0b21cImluIHQmJih0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdC5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcCl9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtyZXR1cm5cImFic29sdXRlXCI9PT10aGlzLmNzc1Bvc2l0aW9uJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9PWRvY3VtZW50JiZlLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSYmKHQubGVmdCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpLHQudG9wKz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSksKHRoaXMub2Zmc2V0UGFyZW50WzBdPT09ZG9jdW1lbnQuYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmXCJodG1sXCI9PT10aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkmJmUudWkuaWUpJiYodD17dG9wOjAsbGVmdDowfSkse3RvcDp0LnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OnQubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZihcInJlbGF0aXZlXCI9PT10aGlzLmNzc1Bvc2l0aW9uKXt2YXIgZT10aGlzLmVsZW1lbnQucG9zaXRpb24oKTtyZXR1cm57dG9wOmUudG9wLShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoXCJ0b3BcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmUubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwibGVmdFwiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKX19cmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcyhcIm1hcmdpbkxlZnRcIiksMTApfHwwLHRvcDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MCxyaWdodDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luUmlnaHRcIiksMTApfHwwLGJvdHRvbTpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKFwibWFyZ2luQm90dG9tXCIpLDEwKXx8MH19LF9jYWNoZUhlbHBlclByb3BvcnRpb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXJQcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpfX0sX3NldENvbnRhaW5tZW50OmZ1bmN0aW9uKCl7dmFyIHQsaSxhLHM9dGhpcy5vcHRpb25zO3JldHVybiBzLmNvbnRhaW5tZW50P1wid2luZG93XCI9PT1zLmNvbnRhaW5tZW50Pyh0aGlzLmNvbnRhaW5tZW50PVtlKHdpbmRvdykuc2Nyb2xsTGVmdCgpLXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsZSh3aW5kb3cpLnNjcm9sbFRvcCgpLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLGUod2luZG93KS5zY3JvbGxMZWZ0KCkrZSh3aW5kb3cpLndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCxlKHdpbmRvdykuc2Nyb2xsVG9wKCkrKGUod2luZG93KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF0sdW5kZWZpbmVkKTpcImRvY3VtZW50XCI9PT1zLmNvbnRhaW5tZW50Pyh0aGlzLmNvbnRhaW5tZW50PVswLDAsZShkb2N1bWVudCkud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChlKGRvY3VtZW50KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF0sdW5kZWZpbmVkKTpzLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yPT09QXJyYXk/KHRoaXMuY29udGFpbm1lbnQ9cy5jb250YWlubWVudCx1bmRlZmluZWQpOihcInBhcmVudFwiPT09cy5jb250YWlubWVudCYmKHMuY29udGFpbm1lbnQ9dGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSksaT1lKHMuY29udGFpbm1lbnQpLGE9aVswXSxhJiYodD1cImhpZGRlblwiIT09aS5jc3MoXCJvdmVyZmxvd1wiKSx0aGlzLmNvbnRhaW5tZW50PVsocGFyc2VJbnQoaS5jc3MoXCJib3JkZXJMZWZ0V2lkdGhcIiksMTApfHwwKSsocGFyc2VJbnQoaS5jc3MoXCJwYWRkaW5nTGVmdFwiKSwxMCl8fDApLChwYXJzZUludChpLmNzcyhcImJvcmRlclRvcFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGkuY3NzKFwicGFkZGluZ1RvcFwiKSwxMCl8fDApLCh0P01hdGgubWF4KGEuc2Nyb2xsV2lkdGgsYS5vZmZzZXRXaWR0aCk6YS5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGkuY3NzKFwiYm9yZGVyUmlnaHRXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChpLmNzcyhcInBhZGRpbmdSaWdodFwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQtdGhpcy5tYXJnaW5zLnJpZ2h0LCh0P01hdGgubWF4KGEuc2Nyb2xsSGVpZ2h0LGEub2Zmc2V0SGVpZ2h0KTphLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGkuY3NzKFwiYm9yZGVyQm90dG9tV2lkdGhcIiksMTApfHwwKS0ocGFyc2VJbnQoaS5jc3MoXCJwYWRkaW5nQm90dG9tXCIpLDEwKXx8MCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcC10aGlzLm1hcmdpbnMuYm90dG9tXSx0aGlzLnJlbGF0aXZlX2NvbnRhaW5lcj1pKSx1bmRlZmluZWQpOih0aGlzLmNvbnRhaW5tZW50PW51bGwsdW5kZWZpbmVkKX0sX2NvbnZlcnRQb3NpdGlvblRvOmZ1bmN0aW9uKHQsaSl7aXx8KGk9dGhpcy5wb3NpdGlvbik7dmFyIGE9XCJhYnNvbHV0ZVwiPT09dD8xOi0xLHM9XCJhYnNvbHV0ZVwiIT09dGhpcy5jc3NQb3NpdGlvbnx8dGhpcy5zY3JvbGxQYXJlbnRbMF0hPT1kb2N1bWVudCYmZS5jb250YWlucyh0aGlzLnNjcm9sbFBhcmVudFswXSx0aGlzLm9mZnNldFBhcmVudFswXSk/dGhpcy5zY3JvbGxQYXJlbnQ6dGhpcy5vZmZzZXRQYXJlbnQ7cmV0dXJuIHRoaXMub2Zmc2V0LnNjcm9sbHx8KHRoaXMub2Zmc2V0LnNjcm9sbD17dG9wOnMuc2Nyb2xsVG9wKCksbGVmdDpzLnNjcm9sbExlZnQoKX0pLHt0b3A6aS50b3ArdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wKmErdGhpcy5vZmZzZXQucGFyZW50LnRvcCphLShcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTp0aGlzLm9mZnNldC5zY3JvbGwudG9wKSphLGxlZnQ6aS5sZWZ0K3RoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQqYSt0aGlzLm9mZnNldC5wYXJlbnQubGVmdCphLShcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6dGhpcy5vZmZzZXQuc2Nyb2xsLmxlZnQpKmF9fSxfZ2VuZXJhdGVQb3NpdGlvbjpmdW5jdGlvbih0KXt2YXIgaSxhLHMsbixyPXRoaXMub3B0aW9ucyxvPVwiYWJzb2x1dGVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09ZG9jdW1lbnQmJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pP3RoaXMuc2Nyb2xsUGFyZW50OnRoaXMub2Zmc2V0UGFyZW50LGw9dC5wYWdlWCxoPXQucGFnZVk7cmV0dXJuIHRoaXMub2Zmc2V0LnNjcm9sbHx8KHRoaXMub2Zmc2V0LnNjcm9sbD17dG9wOm8uc2Nyb2xsVG9wKCksbGVmdDpvLnNjcm9sbExlZnQoKX0pLHRoaXMub3JpZ2luYWxQb3NpdGlvbiYmKHRoaXMuY29udGFpbm1lbnQmJih0aGlzLnJlbGF0aXZlX2NvbnRhaW5lcj8oYT10aGlzLnJlbGF0aXZlX2NvbnRhaW5lci5vZmZzZXQoKSxpPVt0aGlzLmNvbnRhaW5tZW50WzBdK2EubGVmdCx0aGlzLmNvbnRhaW5tZW50WzFdK2EudG9wLHRoaXMuY29udGFpbm1lbnRbMl0rYS5sZWZ0LHRoaXMuY29udGFpbm1lbnRbM10rYS50b3BdKTppPXRoaXMuY29udGFpbm1lbnQsdC5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PGlbMF0mJihsPWlbMF0rdGhpcy5vZmZzZXQuY2xpY2subGVmdCksdC5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8aVsxXSYmKGg9aVsxXSt0aGlzLm9mZnNldC5jbGljay50b3ApLHQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD5pWzJdJiYobD1pWzJdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLHQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPmlbM10mJihoPWlbM10rdGhpcy5vZmZzZXQuY2xpY2sudG9wKSksci5ncmlkJiYocz1yLmdyaWRbMV0/dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKGgtdGhpcy5vcmlnaW5hbFBhZ2VZKS9yLmdyaWRbMV0pKnIuZ3JpZFsxXTp0aGlzLm9yaWdpbmFsUGFnZVksaD1pP3MtdGhpcy5vZmZzZXQuY2xpY2sudG9wPj1pWzFdfHxzLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD5pWzNdP3M6cy10aGlzLm9mZnNldC5jbGljay50b3A+PWlbMV0/cy1yLmdyaWRbMV06cytyLmdyaWRbMV06cyxuPXIuZ3JpZFswXT90aGlzLm9yaWdpbmFsUGFnZVgrTWF0aC5yb3VuZCgobC10aGlzLm9yaWdpbmFsUGFnZVgpL3IuZ3JpZFswXSkqci5ncmlkWzBdOnRoaXMub3JpZ2luYWxQYWdlWCxsPWk/bi10aGlzLm9mZnNldC5jbGljay5sZWZ0Pj1pWzBdfHxuLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+aVsyXT9uOm4tdGhpcy5vZmZzZXQuY2xpY2subGVmdD49aVswXT9uLXIuZ3JpZFswXTpuK3IuZ3JpZFswXTpuKSkse3RvcDpoLXRoaXMub2Zmc2V0LmNsaWNrLnRvcC10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCsoXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6dGhpcy5vZmZzZXQuc2Nyb2xsLnRvcCksbGVmdDpsLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOnRoaXMub2Zmc2V0LnNjcm9sbC5sZWZ0KX19LF9jbGVhcjpmdW5jdGlvbigpe3RoaXMuaGVscGVyLnJlbW92ZUNsYXNzKFwidWktZHJhZ2dhYmxlLWRyYWdnaW5nXCIpLHRoaXMuaGVscGVyWzBdPT09dGhpcy5lbGVtZW50WzBdfHx0aGlzLmNhbmNlbEhlbHBlclJlbW92YWx8fHRoaXMuaGVscGVyLnJlbW92ZSgpLHRoaXMuaGVscGVyPW51bGwsdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsPSExfSxfdHJpZ2dlcjpmdW5jdGlvbih0LGksYSl7cmV0dXJuIGE9YXx8dGhpcy5fdWlIYXNoKCksZS51aS5wbHVnaW4uY2FsbCh0aGlzLHQsW2ksYV0pLFwiZHJhZ1wiPT09dCYmKHRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oXCJhYnNvbHV0ZVwiKSksZS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmNhbGwodGhpcyx0LGksYSl9LHBsdWdpbnM6e30sX3VpSGFzaDpmdW5jdGlvbigpe3JldHVybntoZWxwZXI6dGhpcy5oZWxwZXIscG9zaXRpb246dGhpcy5wb3NpdGlvbixvcmlnaW5hbFBvc2l0aW9uOnRoaXMub3JpZ2luYWxQb3NpdGlvbixvZmZzZXQ6dGhpcy5wb3NpdGlvbkFic319fSksZS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJjb25uZWN0VG9Tb3J0YWJsZVwiLHtzdGFydDpmdW5jdGlvbih0LGkpe3ZhciBhPWUodGhpcykuZGF0YShcInVpLWRyYWdnYWJsZVwiKSxzPWEub3B0aW9ucyxuPWUuZXh0ZW5kKHt9LGkse2l0ZW06YS5lbGVtZW50fSk7YS5zb3J0YWJsZXM9W10sZShzLmNvbm5lY3RUb1NvcnRhYmxlKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9ZS5kYXRhKHRoaXMsXCJ1aS1zb3J0YWJsZVwiKTtpJiYhaS5vcHRpb25zLmRpc2FibGVkJiYoYS5zb3J0YWJsZXMucHVzaCh7aW5zdGFuY2U6aSxzaG91bGRSZXZlcnQ6aS5vcHRpb25zLnJldmVydH0pLGkucmVmcmVzaFBvc2l0aW9ucygpLGkuX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLHQsbikpfSl9LHN0b3A6ZnVuY3Rpb24odCxpKXt2YXIgYT1lKHRoaXMpLmRhdGEoXCJ1aS1kcmFnZ2FibGVcIikscz1lLmV4dGVuZCh7fSxpLHtpdGVtOmEuZWxlbWVudH0pO2UuZWFjaChhLnNvcnRhYmxlcyxmdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UuaXNPdmVyPyh0aGlzLmluc3RhbmNlLmlzT3Zlcj0wLGEuY2FuY2VsSGVscGVyUmVtb3ZhbD0hMCx0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ITEsdGhpcy5zaG91bGRSZXZlcnQmJih0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0PXRoaXMuc2hvdWxkUmV2ZXJ0KSx0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AodCksdGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcj10aGlzLmluc3RhbmNlLm9wdGlvbnMuX2hlbHBlcixcIm9yaWdpbmFsXCI9PT1hLm9wdGlvbnMuaGVscGVyJiZ0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtLmNzcyh7dG9wOlwiYXV0b1wiLGxlZnQ6XCJhdXRvXCJ9KSk6KHRoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD0hMSx0aGlzLmluc3RhbmNlLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLHQscykpfSl9LGRyYWc6ZnVuY3Rpb24odCxpKXt2YXIgYT1lKHRoaXMpLmRhdGEoXCJ1aS1kcmFnZ2FibGVcIikscz10aGlzO2UuZWFjaChhLnNvcnRhYmxlcyxmdW5jdGlvbigpe3ZhciBuPSExLHI9dGhpczt0aGlzLmluc3RhbmNlLnBvc2l0aW9uQWJzPWEucG9zaXRpb25BYnMsdGhpcy5pbnN0YW5jZS5oZWxwZXJQcm9wb3J0aW9ucz1hLmhlbHBlclByb3BvcnRpb25zLHRoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrPWEub2Zmc2V0LmNsaWNrLHRoaXMuaW5zdGFuY2UuX2ludGVyc2VjdHNXaXRoKHRoaXMuaW5zdGFuY2UuY29udGFpbmVyQ2FjaGUpJiYobj0hMCxlLmVhY2goYS5zb3J0YWJsZXMsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pbnN0YW5jZS5wb3NpdGlvbkFicz1hLnBvc2l0aW9uQWJzLHRoaXMuaW5zdGFuY2UuaGVscGVyUHJvcG9ydGlvbnM9YS5oZWxwZXJQcm9wb3J0aW9ucyx0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljaz1hLm9mZnNldC5jbGljayx0aGlzIT09ciYmdGhpcy5pbnN0YW5jZS5faW50ZXJzZWN0c1dpdGgodGhpcy5pbnN0YW5jZS5jb250YWluZXJDYWNoZSkmJmUuY29udGFpbnMoci5pbnN0YW5jZS5lbGVtZW50WzBdLHRoaXMuaW5zdGFuY2UuZWxlbWVudFswXSkmJihuPSExKSxufSkpLG4/KHRoaXMuaW5zdGFuY2UuaXNPdmVyfHwodGhpcy5pbnN0YW5jZS5pc092ZXI9MSx0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtPWUocykuY2xvbmUoKS5yZW1vdmVBdHRyKFwiaWRcIikuYXBwZW5kVG8odGhpcy5pbnN0YW5jZS5lbGVtZW50KS5kYXRhKFwidWktc29ydGFibGUtaXRlbVwiLCEwKSx0aGlzLmluc3RhbmNlLm9wdGlvbnMuX2hlbHBlcj10aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyLHRoaXMuaW5zdGFuY2Uub3B0aW9ucy5oZWxwZXI9ZnVuY3Rpb24oKXtyZXR1cm4gaS5oZWxwZXJbMF19LHQudGFyZ2V0PXRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW1bMF0sdGhpcy5pbnN0YW5jZS5fbW91c2VDYXB0dXJlKHQsITApLHRoaXMuaW5zdGFuY2UuX21vdXNlU3RhcnQodCwhMCwhMCksdGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2sudG9wPWEub2Zmc2V0LmNsaWNrLnRvcCx0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljay5sZWZ0PWEub2Zmc2V0LmNsaWNrLmxlZnQsdGhpcy5pbnN0YW5jZS5vZmZzZXQucGFyZW50LmxlZnQtPWEub2Zmc2V0LnBhcmVudC5sZWZ0LXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0LHRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3AtPWEub2Zmc2V0LnBhcmVudC50b3AtdGhpcy5pbnN0YW5jZS5vZmZzZXQucGFyZW50LnRvcCxhLl90cmlnZ2VyKFwidG9Tb3J0YWJsZVwiLHQpLGEuZHJvcHBlZD10aGlzLmluc3RhbmNlLmVsZW1lbnQsYS5jdXJyZW50SXRlbT1hLmVsZW1lbnQsdGhpcy5pbnN0YW5jZS5mcm9tT3V0c2lkZT1hKSx0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtJiZ0aGlzLmluc3RhbmNlLl9tb3VzZURyYWcodCkpOnRoaXMuaW5zdGFuY2UuaXNPdmVyJiYodGhpcy5pbnN0YW5jZS5pc092ZXI9MCx0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ITAsdGhpcy5pbnN0YW5jZS5vcHRpb25zLnJldmVydD0hMSx0aGlzLmluc3RhbmNlLl90cmlnZ2VyKFwib3V0XCIsdCx0aGlzLmluc3RhbmNlLl91aUhhc2godGhpcy5pbnN0YW5jZSkpLHRoaXMuaW5zdGFuY2UuX21vdXNlU3RvcCh0LCEwKSx0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyLHRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0ucmVtb3ZlKCksdGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlciYmdGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlci5yZW1vdmUoKSxhLl90cmlnZ2VyKFwiZnJvbVNvcnRhYmxlXCIsdCksYS5kcm9wcGVkPSExKX0pfX0pLGUudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwiY3Vyc29yXCIse3N0YXJ0OmZ1bmN0aW9uKCl7dmFyIHQ9ZShcImJvZHlcIiksaT1lKHRoaXMpLmRhdGEoXCJ1aS1kcmFnZ2FibGVcIikub3B0aW9uczt0LmNzcyhcImN1cnNvclwiKSYmKGkuX2N1cnNvcj10LmNzcyhcImN1cnNvclwiKSksdC5jc3MoXCJjdXJzb3JcIixpLmN1cnNvcil9LHN0b3A6ZnVuY3Rpb24oKXt2YXIgdD1lKHRoaXMpLmRhdGEoXCJ1aS1kcmFnZ2FibGVcIikub3B0aW9uczt0Ll9jdXJzb3ImJmUoXCJib2R5XCIpLmNzcyhcImN1cnNvclwiLHQuX2N1cnNvcil9fSksZS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJvcGFjaXR5XCIse3N0YXJ0OmZ1bmN0aW9uKHQsaSl7dmFyIGE9ZShpLmhlbHBlcikscz1lKHRoaXMpLmRhdGEoXCJ1aS1kcmFnZ2FibGVcIikub3B0aW9uczthLmNzcyhcIm9wYWNpdHlcIikmJihzLl9vcGFjaXR5PWEuY3NzKFwib3BhY2l0eVwiKSksYS5jc3MoXCJvcGFjaXR5XCIscy5vcGFjaXR5KX0sc3RvcDpmdW5jdGlvbih0LGkpe3ZhciBhPWUodGhpcykuZGF0YShcInVpLWRyYWdnYWJsZVwiKS5vcHRpb25zO2EuX29wYWNpdHkmJmUoaS5oZWxwZXIpLmNzcyhcIm9wYWNpdHlcIixhLl9vcGFjaXR5KX19KSxlLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcInNjcm9sbFwiLHtzdGFydDpmdW5jdGlvbigpe3ZhciB0PWUodGhpcykuZGF0YShcInVpLWRyYWdnYWJsZVwiKTt0LnNjcm9sbFBhcmVudFswXSE9PWRvY3VtZW50JiZcIkhUTUxcIiE9PXQuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUmJih0Lm92ZXJmbG93T2Zmc2V0PXQuc2Nyb2xsUGFyZW50Lm9mZnNldCgpKX0sZHJhZzpmdW5jdGlvbih0KXt2YXIgaT1lKHRoaXMpLmRhdGEoXCJ1aS1kcmFnZ2FibGVcIiksYT1pLm9wdGlvbnMscz0hMTtpLnNjcm9sbFBhcmVudFswXSE9PWRvY3VtZW50JiZcIkhUTUxcIiE9PWkuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWU/KGEuYXhpcyYmXCJ4XCI9PT1hLmF4aXN8fChpLm92ZXJmbG93T2Zmc2V0LnRvcCtpLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQtdC5wYWdlWTxhLnNjcm9sbFNlbnNpdGl2aXR5P2kuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1zPWkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCthLnNjcm9sbFNwZWVkOnQucGFnZVktaS5vdmVyZmxvd09mZnNldC50b3A8YS5zY3JvbGxTZW5zaXRpdml0eSYmKGkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1zPWkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1hLnNjcm9sbFNwZWVkKSksYS5heGlzJiZcInlcIj09PWEuYXhpc3x8KGkub3ZlcmZsb3dPZmZzZXQubGVmdCtpLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC10LnBhZ2VYPGEuc2Nyb2xsU2Vuc2l0aXZpdHk/aS5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1zPWkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrYS5zY3JvbGxTcGVlZDp0LnBhZ2VYLWkub3ZlcmZsb3dPZmZzZXQubGVmdDxhLnNjcm9sbFNlbnNpdGl2aXR5JiYoaS5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1zPWkuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtYS5zY3JvbGxTcGVlZCkpKTooYS5heGlzJiZcInhcIj09PWEuYXhpc3x8KHQucGFnZVktZShkb2N1bWVudCkuc2Nyb2xsVG9wKCk8YS5zY3JvbGxTZW5zaXRpdml0eT9zPWUoZG9jdW1lbnQpLnNjcm9sbFRvcChlKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1hLnNjcm9sbFNwZWVkKTplKHdpbmRvdykuaGVpZ2h0KCktKHQucGFnZVktZShkb2N1bWVudCkuc2Nyb2xsVG9wKCkpPGEuc2Nyb2xsU2Vuc2l0aXZpdHkmJihzPWUoZG9jdW1lbnQpLnNjcm9sbFRvcChlKGRvY3VtZW50KS5zY3JvbGxUb3AoKSthLnNjcm9sbFNwZWVkKSkpLGEuYXhpcyYmXCJ5XCI9PT1hLmF4aXN8fCh0LnBhZ2VYLWUoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxhLnNjcm9sbFNlbnNpdGl2aXR5P3M9ZShkb2N1bWVudCkuc2Nyb2xsTGVmdChlKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktYS5zY3JvbGxTcGVlZCk6ZSh3aW5kb3cpLndpZHRoKCktKHQucGFnZVgtZShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKTxhLnNjcm9sbFNlbnNpdGl2aXR5JiYocz1lKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGUoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSthLnNjcm9sbFNwZWVkKSkpKSxzIT09ITEmJmUudWkuZGRtYW5hZ2VyJiYhYS5kcm9wQmVoYXZpb3VyJiZlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyhpLHQpfX0pLGUudWkucGx1Z2luLmFkZChcImRyYWdnYWJsZVwiLFwic25hcFwiLHtzdGFydDpmdW5jdGlvbigpe3ZhciB0PWUodGhpcykuZGF0YShcInVpLWRyYWdnYWJsZVwiKSxpPXQub3B0aW9uczt0LnNuYXBFbGVtZW50cz1bXSxlKGkuc25hcC5jb25zdHJ1Y3RvciE9PVN0cmluZz9pLnNuYXAuaXRlbXN8fFwiOmRhdGEodWktZHJhZ2dhYmxlKVwiOmkuc25hcCkuZWFjaChmdW5jdGlvbigpe3ZhciBpPWUodGhpcyksYT1pLm9mZnNldCgpO3RoaXMhPT10LmVsZW1lbnRbMF0mJnQuc25hcEVsZW1lbnRzLnB1c2goe2l0ZW06dGhpcyx3aWR0aDppLm91dGVyV2lkdGgoKSxoZWlnaHQ6aS5vdXRlckhlaWdodCgpLHRvcDphLnRvcCxsZWZ0OmEubGVmdH0pfSl9LGRyYWc6ZnVuY3Rpb24odCxpKXt2YXIgYSxzLG4scixvLGwsaCx1LGQsYyxwPWUodGhpcykuZGF0YShcInVpLWRyYWdnYWJsZVwiKSxmPXAub3B0aW9ucyxtPWYuc25hcFRvbGVyYW5jZSxnPWkub2Zmc2V0LmxlZnQsdj1nK3AuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgseT1pLm9mZnNldC50b3AsYj15K3AuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0O2ZvcihkPXAuc25hcEVsZW1lbnRzLmxlbmd0aC0xO2Q+PTA7ZC0tKW89cC5zbmFwRWxlbWVudHNbZF0ubGVmdCxsPW8rcC5zbmFwRWxlbWVudHNbZF0ud2lkdGgsaD1wLnNuYXBFbGVtZW50c1tkXS50b3AsdT1oK3Auc25hcEVsZW1lbnRzW2RdLmhlaWdodCxvLW0+dnx8Zz5sK218fGgtbT5ifHx5PnUrbXx8IWUuY29udGFpbnMocC5zbmFwRWxlbWVudHNbZF0uaXRlbS5vd25lckRvY3VtZW50LHAuc25hcEVsZW1lbnRzW2RdLml0ZW0pPyhwLnNuYXBFbGVtZW50c1tkXS5zbmFwcGluZyYmcC5vcHRpb25zLnNuYXAucmVsZWFzZSYmcC5vcHRpb25zLnNuYXAucmVsZWFzZS5jYWxsKHAuZWxlbWVudCx0LGUuZXh0ZW5kKHAuX3VpSGFzaCgpLHtzbmFwSXRlbTpwLnNuYXBFbGVtZW50c1tkXS5pdGVtfSkpLHAuc25hcEVsZW1lbnRzW2RdLnNuYXBwaW5nPSExKTooXCJpbm5lclwiIT09Zi5zbmFwTW9kZSYmKGE9bT49TWF0aC5hYnMoaC1iKSxzPW0+PU1hdGguYWJzKHUteSksbj1tPj1NYXRoLmFicyhvLXYpLHI9bT49TWF0aC5hYnMobC1nKSxhJiYoaS5wb3NpdGlvbi50b3A9cC5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6aC1wLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtcC5tYXJnaW5zLnRvcCkscyYmKGkucG9zaXRpb24udG9wPXAuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOnUsbGVmdDowfSkudG9wLXAubWFyZ2lucy50b3ApLG4mJihpLnBvc2l0aW9uLmxlZnQ9cC5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6MCxsZWZ0Om8tcC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aH0pLmxlZnQtcC5tYXJnaW5zLmxlZnQpLHImJihpLnBvc2l0aW9uLmxlZnQ9cC5fY29udmVydFBvc2l0aW9uVG8oXCJyZWxhdGl2ZVwiLHt0b3A6MCxsZWZ0Omx9KS5sZWZ0LXAubWFyZ2lucy5sZWZ0KSksYz1hfHxzfHxufHxyLFwib3V0ZXJcIiE9PWYuc25hcE1vZGUmJihhPW0+PU1hdGguYWJzKGgteSkscz1tPj1NYXRoLmFicyh1LWIpLG49bT49TWF0aC5hYnMoby1nKSxyPW0+PU1hdGguYWJzKGwtdiksYSYmKGkucG9zaXRpb24udG9wPXAuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOmgsbGVmdDowfSkudG9wLXAubWFyZ2lucy50b3ApLHMmJihpLnBvc2l0aW9uLnRvcD1wLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDp1LXAuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LGxlZnQ6MH0pLnRvcC1wLm1hcmdpbnMudG9wKSxuJiYoaS5wb3NpdGlvbi5sZWZ0PXAuX2NvbnZlcnRQb3NpdGlvblRvKFwicmVsYXRpdmVcIix7dG9wOjAsbGVmdDpvfSkubGVmdC1wLm1hcmdpbnMubGVmdCksciYmKGkucG9zaXRpb24ubGVmdD1wLl9jb252ZXJ0UG9zaXRpb25UbyhcInJlbGF0aXZlXCIse3RvcDowLGxlZnQ6bC1wLmhlbHBlclByb3BvcnRpb25zLndpZHRofSkubGVmdC1wLm1hcmdpbnMubGVmdCkpLCFwLnNuYXBFbGVtZW50c1tkXS5zbmFwcGluZyYmKGF8fHN8fG58fHJ8fGMpJiZwLm9wdGlvbnMuc25hcC5zbmFwJiZwLm9wdGlvbnMuc25hcC5zbmFwLmNhbGwocC5lbGVtZW50LHQsZS5leHRlbmQocC5fdWlIYXNoKCkse3NuYXBJdGVtOnAuc25hcEVsZW1lbnRzW2RdLml0ZW19KSkscC5zbmFwRWxlbWVudHNbZF0uc25hcHBpbmc9YXx8c3x8bnx8cnx8Yyl9fSksZS51aS5wbHVnaW4uYWRkKFwiZHJhZ2dhYmxlXCIsXCJzdGFja1wiLHtzdGFydDpmdW5jdGlvbigpe3ZhciB0LGk9dGhpcy5kYXRhKFwidWktZHJhZ2dhYmxlXCIpLm9wdGlvbnMsYT1lLm1ha2VBcnJheShlKGkuc3RhY2spKS5zb3J0KGZ1bmN0aW9uKHQsaSl7cmV0dXJuKHBhcnNlSW50KGUodCkuY3NzKFwiekluZGV4XCIpLDEwKXx8MCktKHBhcnNlSW50KGUoaSkuY3NzKFwiekluZGV4XCIpLDEwKXx8MCl9KTthLmxlbmd0aCYmKHQ9cGFyc2VJbnQoZShhWzBdKS5jc3MoXCJ6SW5kZXhcIiksMTApfHwwLGUoYSkuZWFjaChmdW5jdGlvbihpKXtlKHRoaXMpLmNzcyhcInpJbmRleFwiLHQraSl9KSx0aGlzLmNzcyhcInpJbmRleFwiLHQrYS5sZW5ndGgpKX19KSxlLnVpLnBsdWdpbi5hZGQoXCJkcmFnZ2FibGVcIixcInpJbmRleFwiLHtzdGFydDpmdW5jdGlvbih0LGkpe3ZhciBhPWUoaS5oZWxwZXIpLHM9ZSh0aGlzKS5kYXRhKFwidWktZHJhZ2dhYmxlXCIpLm9wdGlvbnM7YS5jc3MoXCJ6SW5kZXhcIikmJihzLl96SW5kZXg9YS5jc3MoXCJ6SW5kZXhcIikpLGEuY3NzKFwiekluZGV4XCIscy56SW5kZXgpfSxzdG9wOmZ1bmN0aW9uKHQsaSl7dmFyIGE9ZSh0aGlzKS5kYXRhKFwidWktZHJhZ2dhYmxlXCIpLm9wdGlvbnM7YS5fekluZGV4JiZlKGkuaGVscGVyKS5jc3MoXCJ6SW5kZXhcIixhLl96SW5kZXgpfX0pfSkoalF1ZXJ5KTsoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQsaSl7cmV0dXJuIGU+dCYmdCtpPmV9ZS53aWRnZXQoXCJ1aS5kcm9wcGFibGVcIix7dmVyc2lvbjpcIjEuMTAuM1wiLHdpZGdldEV2ZW50UHJlZml4OlwiZHJvcFwiLG9wdGlvbnM6e2FjY2VwdDpcIipcIixhY3RpdmVDbGFzczohMSxhZGRDbGFzc2VzOiEwLGdyZWVkeTohMSxob3ZlckNsYXNzOiExLHNjb3BlOlwiZGVmYXVsdFwiLHRvbGVyYW5jZTpcImludGVyc2VjdFwiLGFjdGl2YXRlOm51bGwsZGVhY3RpdmF0ZTpudWxsLGRyb3A6bnVsbCxvdXQ6bnVsbCxvdmVyOm51bGx9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLm9wdGlvbnMsaT10LmFjY2VwdDt0aGlzLmlzb3Zlcj0hMSx0aGlzLmlzb3V0PSEwLHRoaXMuYWNjZXB0PWUuaXNGdW5jdGlvbihpKT9pOmZ1bmN0aW9uKGUpe3JldHVybiBlLmlzKGkpfSx0aGlzLnByb3BvcnRpb25zPXt3aWR0aDp0aGlzLmVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsaGVpZ2h0OnRoaXMuZWxlbWVudFswXS5vZmZzZXRIZWlnaHR9LGUudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbdC5zY29wZV09ZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0LnNjb3BlXXx8W10sZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0LnNjb3BlXS5wdXNoKHRoaXMpLHQuYWRkQ2xhc3NlcyYmdGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktZHJvcHBhYmxlXCIpfSxfZGVzdHJveTpmdW5jdGlvbigpe2Zvcih2YXIgdD0wLGk9ZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0aGlzLm9wdGlvbnMuc2NvcGVdO2kubGVuZ3RoPnQ7dCsrKWlbdF09PT10aGlzJiZpLnNwbGljZSh0LDEpO3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLWRyb3BwYWJsZSB1aS1kcm9wcGFibGUtZGlzYWJsZWRcIil9LF9zZXRPcHRpb246ZnVuY3Rpb24odCxpKXtcImFjY2VwdFwiPT09dCYmKHRoaXMuYWNjZXB0PWUuaXNGdW5jdGlvbihpKT9pOmZ1bmN0aW9uKGUpe3JldHVybiBlLmlzKGkpfSksZS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfYWN0aXZhdGU6ZnVuY3Rpb24odCl7dmFyIGk9ZS51aS5kZG1hbmFnZXIuY3VycmVudDt0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpLGkmJnRoaXMuX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLHQsdGhpcy51aShpKSl9LF9kZWFjdGl2YXRlOmZ1bmN0aW9uKHQpe3ZhciBpPWUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7dGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzJiZ0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmFjdGl2ZUNsYXNzKSxpJiZ0aGlzLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLHQsdGhpcy51aShpKSl9LF9vdmVyOmZ1bmN0aW9uKHQpe3ZhciBpPWUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aSYmKGkuY3VycmVudEl0ZW18fGkuZWxlbWVudClbMF0hPT10aGlzLmVsZW1lbnRbMF0mJnRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGkuY3VycmVudEl0ZW18fGkuZWxlbWVudCkmJih0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyYmdGhpcy5lbGVtZW50LmFkZENsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKSx0aGlzLl90cmlnZ2VyKFwib3ZlclwiLHQsdGhpcy51aShpKSkpfSxfb3V0OmZ1bmN0aW9uKHQpe3ZhciBpPWUudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aSYmKGkuY3VycmVudEl0ZW18fGkuZWxlbWVudClbMF0hPT10aGlzLmVsZW1lbnRbMF0mJnRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGkuY3VycmVudEl0ZW18fGkuZWxlbWVudCkmJih0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKSx0aGlzLl90cmlnZ2VyKFwib3V0XCIsdCx0aGlzLnVpKGkpKSl9LF9kcm9wOmZ1bmN0aW9uKHQsaSl7dmFyIGE9aXx8ZS51aS5kZG1hbmFnZXIuY3VycmVudCxzPSExO3JldHVybiBhJiYoYS5jdXJyZW50SXRlbXx8YS5lbGVtZW50KVswXSE9PXRoaXMuZWxlbWVudFswXT8odGhpcy5lbGVtZW50LmZpbmQoXCI6ZGF0YSh1aS1kcm9wcGFibGUpXCIpLm5vdChcIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmdcIikuZWFjaChmdW5jdGlvbigpe3ZhciB0PWUuZGF0YSh0aGlzLFwidWktZHJvcHBhYmxlXCIpO3JldHVybiB0Lm9wdGlvbnMuZ3JlZWR5JiYhdC5vcHRpb25zLmRpc2FibGVkJiZ0Lm9wdGlvbnMuc2NvcGU9PT1hLm9wdGlvbnMuc2NvcGUmJnQuYWNjZXB0LmNhbGwodC5lbGVtZW50WzBdLGEuY3VycmVudEl0ZW18fGEuZWxlbWVudCkmJmUudWkuaW50ZXJzZWN0KGEsZS5leHRlbmQodCx7b2Zmc2V0OnQuZWxlbWVudC5vZmZzZXQoKX0pLHQub3B0aW9ucy50b2xlcmFuY2UpPyhzPSEwLCExKTp1bmRlZmluZWR9KSxzPyExOnRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGEuY3VycmVudEl0ZW18fGEuZWxlbWVudCk/KHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyksdGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyksdGhpcy5fdHJpZ2dlcihcImRyb3BcIix0LHRoaXMudWkoYSkpLHRoaXMuZWxlbWVudCk6ITEpOiExfSx1aTpmdW5jdGlvbihlKXtyZXR1cm57ZHJhZ2dhYmxlOmUuY3VycmVudEl0ZW18fGUuZWxlbWVudCxoZWxwZXI6ZS5oZWxwZXIscG9zaXRpb246ZS5wb3NpdGlvbixvZmZzZXQ6ZS5wb3NpdGlvbkFic319fSksZS51aS5pbnRlcnNlY3Q9ZnVuY3Rpb24oZSxpLGEpe2lmKCFpLm9mZnNldClyZXR1cm4hMTt2YXIgcyxuLHI9KGUucG9zaXRpb25BYnN8fGUucG9zaXRpb24uYWJzb2x1dGUpLmxlZnQsbz1yK2UuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsbD0oZS5wb3NpdGlvbkFic3x8ZS5wb3NpdGlvbi5hYnNvbHV0ZSkudG9wLGg9bCtlLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCx1PWkub2Zmc2V0LmxlZnQsZD11K2kucHJvcG9ydGlvbnMud2lkdGgsYz1pLm9mZnNldC50b3AscD1jK2kucHJvcG9ydGlvbnMuaGVpZ2h0O3N3aXRjaChhKXtjYXNlXCJmaXRcIjpyZXR1cm4gcj49dSYmZD49byYmbD49YyYmcD49aDtjYXNlXCJpbnRlcnNlY3RcIjpyZXR1cm4gcitlLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzI+dSYmZD5vLWUuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMiYmbCtlLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yPmMmJnA+aC1lLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yO2Nhc2VcInBvaW50ZXJcIjpyZXR1cm4gcz0oZS5wb3NpdGlvbkFic3x8ZS5wb3NpdGlvbi5hYnNvbHV0ZSkubGVmdCsoZS5jbGlja09mZnNldHx8ZS5vZmZzZXQuY2xpY2spLmxlZnQsbj0oZS5wb3NpdGlvbkFic3x8ZS5wb3NpdGlvbi5hYnNvbHV0ZSkudG9wKyhlLmNsaWNrT2Zmc2V0fHxlLm9mZnNldC5jbGljaykudG9wLHQobixjLGkucHJvcG9ydGlvbnMuaGVpZ2h0KSYmdChzLHUsaS5wcm9wb3J0aW9ucy53aWR0aCk7Y2FzZVwidG91Y2hcIjpyZXR1cm4obD49YyYmcD49bHx8aD49YyYmcD49aHx8Yz5sJiZoPnApJiYocj49dSYmZD49cnx8bz49dSYmZD49b3x8dT5yJiZvPmQpO2RlZmF1bHQ6cmV0dXJuITF9fSxlLnVpLmRkbWFuYWdlcj17Y3VycmVudDpudWxsLGRyb3BwYWJsZXM6e1wiZGVmYXVsdFwiOltdfSxwcmVwYXJlT2Zmc2V0czpmdW5jdGlvbih0LGkpe3ZhciBhLHMsbj1lLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW3Qub3B0aW9ucy5zY29wZV18fFtdLHI9aT9pLnR5cGU6bnVsbCxvPSh0LmN1cnJlbnRJdGVtfHx0LmVsZW1lbnQpLmZpbmQoXCI6ZGF0YSh1aS1kcm9wcGFibGUpXCIpLmFkZEJhY2soKTtlOmZvcihhPTA7bi5sZW5ndGg+YTthKyspaWYoIShuW2FdLm9wdGlvbnMuZGlzYWJsZWR8fHQmJiFuW2FdLmFjY2VwdC5jYWxsKG5bYV0uZWxlbWVudFswXSx0LmN1cnJlbnRJdGVtfHx0LmVsZW1lbnQpKSl7Zm9yKHM9MDtvLmxlbmd0aD5zO3MrKylpZihvW3NdPT09blthXS5lbGVtZW50WzBdKXtuW2FdLnByb3BvcnRpb25zLmhlaWdodD0wO2NvbnRpbnVlIGV9blthXS52aXNpYmxlPVwibm9uZVwiIT09blthXS5lbGVtZW50LmNzcyhcImRpc3BsYXlcIiksblthXS52aXNpYmxlJiYoXCJtb3VzZWRvd25cIj09PXImJm5bYV0uX2FjdGl2YXRlLmNhbGwoblthXSxpKSxuW2FdLm9mZnNldD1uW2FdLmVsZW1lbnQub2Zmc2V0KCksblthXS5wcm9wb3J0aW9ucz17d2lkdGg6blthXS5lbGVtZW50WzBdLm9mZnNldFdpZHRoLGhlaWdodDpuW2FdLmVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0fSl9fSxkcm9wOmZ1bmN0aW9uKHQsaSl7dmFyIGE9ITE7cmV0dXJuIGUuZWFjaCgoZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0Lm9wdGlvbnMuc2NvcGVdfHxbXSkuc2xpY2UoKSxmdW5jdGlvbigpe3RoaXMub3B0aW9ucyYmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMudmlzaWJsZSYmZS51aS5pbnRlcnNlY3QodCx0aGlzLHRoaXMub3B0aW9ucy50b2xlcmFuY2UpJiYoYT10aGlzLl9kcm9wLmNhbGwodGhpcyxpKXx8YSksIXRoaXMub3B0aW9ucy5kaXNhYmxlZCYmdGhpcy52aXNpYmxlJiZ0aGlzLmFjY2VwdC5jYWxsKHRoaXMuZWxlbWVudFswXSx0LmN1cnJlbnRJdGVtfHx0LmVsZW1lbnQpJiYodGhpcy5pc291dD0hMCx0aGlzLmlzb3Zlcj0hMSx0aGlzLl9kZWFjdGl2YXRlLmNhbGwodGhpcyxpKSkpfSksYX0sZHJhZ1N0YXJ0OmZ1bmN0aW9uKHQsaSl7dC5lbGVtZW50LnBhcmVudHNVbnRpbChcImJvZHlcIikuYmluZChcInNjcm9sbC5kcm9wcGFibGVcIixmdW5jdGlvbigpe3Qub3B0aW9ucy5yZWZyZXNoUG9zaXRpb25zfHxlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0LGkpfSl9LGRyYWc6ZnVuY3Rpb24odCxpKXt0Lm9wdGlvbnMucmVmcmVzaFBvc2l0aW9ucyYmZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModCxpKSxlLmVhY2goZS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0Lm9wdGlvbnMuc2NvcGVdfHxbXSxmdW5jdGlvbigpe2lmKCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJiF0aGlzLmdyZWVkeUNoaWxkJiZ0aGlzLnZpc2libGUpe3ZhciBhLHMsbixyPWUudWkuaW50ZXJzZWN0KHQsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKSxvPSFyJiZ0aGlzLmlzb3Zlcj9cImlzb3V0XCI6ciYmIXRoaXMuaXNvdmVyP1wiaXNvdmVyXCI6bnVsbDtvJiYodGhpcy5vcHRpb25zLmdyZWVkeSYmKHM9dGhpcy5vcHRpb25zLnNjb3BlLG49dGhpcy5lbGVtZW50LnBhcmVudHMoXCI6ZGF0YSh1aS1kcm9wcGFibGUpXCIpLmZpbHRlcihmdW5jdGlvbigpe3JldHVybiBlLmRhdGEodGhpcyxcInVpLWRyb3BwYWJsZVwiKS5vcHRpb25zLnNjb3BlPT09c30pLG4ubGVuZ3RoJiYoYT1lLmRhdGEoblswXSxcInVpLWRyb3BwYWJsZVwiKSxhLmdyZWVkeUNoaWxkPVwiaXNvdmVyXCI9PT1vKSksYSYmXCJpc292ZXJcIj09PW8mJihhLmlzb3Zlcj0hMSxhLmlzb3V0PSEwLGEuX291dC5jYWxsKGEsaSkpLHRoaXNbb109ITAsdGhpc1tcImlzb3V0XCI9PT1vP1wiaXNvdmVyXCI6XCJpc291dFwiXT0hMSx0aGlzW1wiaXNvdmVyXCI9PT1vP1wiX292ZXJcIjpcIl9vdXRcIl0uY2FsbCh0aGlzLGkpLGEmJlwiaXNvdXRcIj09PW8mJihhLmlzb3V0PSExLGEuaXNvdmVyPSEwLGEuX292ZXIuY2FsbChhLGkpKSl9fSl9LGRyYWdTdG9wOmZ1bmN0aW9uKHQsaSl7dC5lbGVtZW50LnBhcmVudHNVbnRpbChcImJvZHlcIikudW5iaW5kKFwic2Nyb2xsLmRyb3BwYWJsZVwiKSx0Lm9wdGlvbnMucmVmcmVzaFBvc2l0aW9uc3x8ZS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModCxpKX19fSkoalF1ZXJ5KTsoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQsaSl7cmV0dXJuIGU+dCYmdCtpPmV9ZnVuY3Rpb24gaShlKXtyZXR1cm4vbGVmdHxyaWdodC8udGVzdChlLmNzcyhcImZsb2F0XCIpKXx8L2lubGluZXx0YWJsZS1jZWxsLy50ZXN0KGUuY3NzKFwiZGlzcGxheVwiKSl9ZS53aWRnZXQoXCJ1aS5zb3J0YWJsZVwiLGUudWkubW91c2Use3ZlcnNpb246XCIxLjEwLjNcIix3aWRnZXRFdmVudFByZWZpeDpcInNvcnRcIixyZWFkeTohMSxvcHRpb25zOnthcHBlbmRUbzpcInBhcmVudFwiLGF4aXM6ITEsY29ubmVjdFdpdGg6ITEsY29udGFpbm1lbnQ6ITEsY3Vyc29yOlwiYXV0b1wiLGN1cnNvckF0OiExLGRyb3BPbkVtcHR5OiEwLGZvcmNlUGxhY2Vob2xkZXJTaXplOiExLGZvcmNlSGVscGVyU2l6ZTohMSxncmlkOiExLGhhbmRsZTohMSxoZWxwZXI6XCJvcmlnaW5hbFwiLGl0ZW1zOlwiPiAqXCIsb3BhY2l0eTohMSxwbGFjZWhvbGRlcjohMSxyZXZlcnQ6ITEsc2Nyb2xsOiEwLHNjcm9sbFNlbnNpdGl2aXR5OjIwLHNjcm9sbFNwZWVkOjIwLHNjb3BlOlwiZGVmYXVsdFwiLHRvbGVyYW5jZTpcImludGVyc2VjdFwiLHpJbmRleDoxZTMsYWN0aXZhdGU6bnVsbCxiZWZvcmVTdG9wOm51bGwsY2hhbmdlOm51bGwsZGVhY3RpdmF0ZTpudWxsLG91dDpudWxsLG92ZXI6bnVsbCxyZWNlaXZlOm51bGwscmVtb3ZlOm51bGwsc29ydDpudWxsLHN0YXJ0Om51bGwsc3RvcDpudWxsLHVwZGF0ZTpudWxsfSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcHRpb25zO3RoaXMuY29udGFpbmVyQ2FjaGU9e30sdGhpcy5lbGVtZW50LmFkZENsYXNzKFwidWktc29ydGFibGVcIiksdGhpcy5yZWZyZXNoKCksdGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD9cInhcIj09PWUuYXhpc3x8aSh0aGlzLml0ZW1zWzBdLml0ZW0pOiExLHRoaXMub2Zmc2V0PXRoaXMuZWxlbWVudC5vZmZzZXQoKSx0aGlzLl9tb3VzZUluaXQoKSx0aGlzLnJlYWR5PSEwfSxfZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlIHVpLXNvcnRhYmxlLWRpc2FibGVkXCIpLHRoaXMuX21vdXNlRGVzdHJveSgpO2Zvcih2YXIgZT10aGlzLml0ZW1zLmxlbmd0aC0xO2U+PTA7ZS0tKXRoaXMuaXRlbXNbZV0uaXRlbS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0TmFtZStcIi1pdGVtXCIpO3JldHVybiB0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKHQsaSl7XCJkaXNhYmxlZFwiPT09dD8odGhpcy5vcHRpb25zW3RdPWksdGhpcy53aWRnZXQoKS50b2dnbGVDbGFzcyhcInVpLXNvcnRhYmxlLWRpc2FibGVkXCIsISFpKSk6ZS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKHQsaSl7dmFyIHM9bnVsbCxhPSExLG49dGhpcztyZXR1cm4gdGhpcy5yZXZlcnRpbmc/ITE6dGhpcy5vcHRpb25zLmRpc2FibGVkfHxcInN0YXRpY1wiPT09dGhpcy5vcHRpb25zLnR5cGU/ITE6KHRoaXMuX3JlZnJlc2hJdGVtcyh0KSxlKHQudGFyZ2V0KS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpe3JldHVybiBlLmRhdGEodGhpcyxuLndpZGdldE5hbWUrXCItaXRlbVwiKT09PW4/KHM9ZSh0aGlzKSwhMSk6dW5kZWZpbmVkfSksZS5kYXRhKHQudGFyZ2V0LG4ud2lkZ2V0TmFtZStcIi1pdGVtXCIpPT09biYmKHM9ZSh0LnRhcmdldCkpLHM/IXRoaXMub3B0aW9ucy5oYW5kbGV8fGl8fChlKHRoaXMub3B0aW9ucy5oYW5kbGUscykuZmluZChcIipcIikuYWRkQmFjaygpLmVhY2goZnVuY3Rpb24oKXt0aGlzPT09dC50YXJnZXQmJihhPSEwKX0pLGEpPyh0aGlzLmN1cnJlbnRJdGVtPXMsdGhpcy5fcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXMoKSwhMCk6ITE6ITEpfSxfbW91c2VTdGFydDpmdW5jdGlvbih0LGkscyl7dmFyIGEsbixyPXRoaXMub3B0aW9ucztpZih0aGlzLmN1cnJlbnRDb250YWluZXI9dGhpcyx0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKSx0aGlzLmhlbHBlcj10aGlzLl9jcmVhdGVIZWxwZXIodCksdGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpLHRoaXMuX2NhY2hlTWFyZ2lucygpLHRoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpLHRoaXMub2Zmc2V0PXRoaXMuY3VycmVudEl0ZW0ub2Zmc2V0KCksdGhpcy5vZmZzZXQ9e3RvcDp0aGlzLm9mZnNldC50b3AtdGhpcy5tYXJnaW5zLnRvcCxsZWZ0OnRoaXMub2Zmc2V0LmxlZnQtdGhpcy5tYXJnaW5zLmxlZnR9LGUuZXh0ZW5kKHRoaXMub2Zmc2V0LHtjbGljazp7bGVmdDp0LnBhZ2VYLXRoaXMub2Zmc2V0LmxlZnQsdG9wOnQucGFnZVktdGhpcy5vZmZzZXQudG9wfSxwYXJlbnQ6dGhpcy5fZ2V0UGFyZW50T2Zmc2V0KCkscmVsYXRpdmU6dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKX0pLHRoaXMuaGVscGVyLmNzcyhcInBvc2l0aW9uXCIsXCJhYnNvbHV0ZVwiKSx0aGlzLmNzc1Bvc2l0aW9uPXRoaXMuaGVscGVyLmNzcyhcInBvc2l0aW9uXCIpLHRoaXMub3JpZ2luYWxQb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKHQpLHRoaXMub3JpZ2luYWxQYWdlWD10LnBhZ2VYLHRoaXMub3JpZ2luYWxQYWdlWT10LnBhZ2VZLHIuY3Vyc29yQXQmJnRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoci5jdXJzb3JBdCksdGhpcy5kb21Qb3NpdGlvbj17cHJldjp0aGlzLmN1cnJlbnRJdGVtLnByZXYoKVswXSxwYXJlbnQ6dGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKVswXX0sdGhpcy5oZWxwZXJbMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKSx0aGlzLl9jcmVhdGVQbGFjZWhvbGRlcigpLHIuY29udGFpbm1lbnQmJnRoaXMuX3NldENvbnRhaW5tZW50KCksci5jdXJzb3ImJlwiYXV0b1wiIT09ci5jdXJzb3ImJihuPXRoaXMuZG9jdW1lbnQuZmluZChcImJvZHlcIiksdGhpcy5zdG9yZWRDdXJzb3I9bi5jc3MoXCJjdXJzb3JcIiksbi5jc3MoXCJjdXJzb3JcIixyLmN1cnNvciksdGhpcy5zdG9yZWRTdHlsZXNoZWV0PWUoXCI8c3R5bGU+KnsgY3Vyc29yOiBcIityLmN1cnNvcitcIiAhaW1wb3J0YW50OyB9PC9zdHlsZT5cIikuYXBwZW5kVG8obikpLHIub3BhY2l0eSYmKHRoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIikmJih0aGlzLl9zdG9yZWRPcGFjaXR5PXRoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIikpLHRoaXMuaGVscGVyLmNzcyhcIm9wYWNpdHlcIixyLm9wYWNpdHkpKSxyLnpJbmRleCYmKHRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiKSYmKHRoaXMuX3N0b3JlZFpJbmRleD10aGlzLmhlbHBlci5jc3MoXCJ6SW5kZXhcIikpLHRoaXMuaGVscGVyLmNzcyhcInpJbmRleFwiLHIuekluZGV4KSksdGhpcy5zY3JvbGxQYXJlbnRbMF0hPT1kb2N1bWVudCYmXCJIVE1MXCIhPT10aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lJiYodGhpcy5vdmVyZmxvd09mZnNldD10aGlzLnNjcm9sbFBhcmVudC5vZmZzZXQoKSksdGhpcy5fdHJpZ2dlcihcInN0YXJ0XCIsdCx0aGlzLl91aUhhc2goKSksdGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpLCFzKWZvcihhPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTthPj0wO2EtLSl0aGlzLmNvbnRhaW5lcnNbYV0uX3RyaWdnZXIoXCJhY3RpdmF0ZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKTtyZXR1cm4gZS51aS5kZG1hbmFnZXImJihlLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXMpLGUudWkuZGRtYW5hZ2VyJiYhci5kcm9wQmVoYXZpb3VyJiZlLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyh0aGlzLHQpLHRoaXMuZHJhZ2dpbmc9ITAsdGhpcy5oZWxwZXIuYWRkQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIiksdGhpcy5fbW91c2VEcmFnKHQpLCEwfSxfbW91c2VEcmFnOmZ1bmN0aW9uKHQpe3ZhciBpLHMsYSxuLHI9dGhpcy5vcHRpb25zLG89ITE7Zm9yKHRoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbih0KSx0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKFwiYWJzb2x1dGVcIiksdGhpcy5sYXN0UG9zaXRpb25BYnN8fCh0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzKSx0aGlzLm9wdGlvbnMuc2Nyb2xsJiYodGhpcy5zY3JvbGxQYXJlbnRbMF0hPT1kb2N1bWVudCYmXCJIVE1MXCIhPT10aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lPyh0aGlzLm92ZXJmbG93T2Zmc2V0LnRvcCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRIZWlnaHQtdC5wYWdlWTxyLnNjcm9sbFNlbnNpdGl2aXR5P3RoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1vPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcCtyLnNjcm9sbFNwZWVkOnQucGFnZVktdGhpcy5vdmVyZmxvd09mZnNldC50b3A8ci5zY3JvbGxTZW5zaXRpdml0eSYmKHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcD1vPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbFRvcC1yLnNjcm9sbFNwZWVkKSx0aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQrdGhpcy5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0V2lkdGgtdC5wYWdlWDxyLnNjcm9sbFNlbnNpdGl2aXR5P3RoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9bz10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0K3Iuc2Nyb2xsU3BlZWQ6dC5wYWdlWC10aGlzLm92ZXJmbG93T2Zmc2V0LmxlZnQ8ci5zY3JvbGxTZW5zaXRpdml0eSYmKHRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQ9bz10aGlzLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0LXIuc2Nyb2xsU3BlZWQpKToodC5wYWdlWS1lKGRvY3VtZW50KS5zY3JvbGxUb3AoKTxyLnNjcm9sbFNlbnNpdGl2aXR5P289ZShkb2N1bWVudCkuc2Nyb2xsVG9wKGUoZG9jdW1lbnQpLnNjcm9sbFRvcCgpLXIuc2Nyb2xsU3BlZWQpOmUod2luZG93KS5oZWlnaHQoKS0odC5wYWdlWS1lKGRvY3VtZW50KS5zY3JvbGxUb3AoKSk8ci5zY3JvbGxTZW5zaXRpdml0eSYmKG89ZShkb2N1bWVudCkuc2Nyb2xsVG9wKGUoZG9jdW1lbnQpLnNjcm9sbFRvcCgpK3Iuc2Nyb2xsU3BlZWQpKSx0LnBhZ2VYLWUoZG9jdW1lbnQpLnNjcm9sbExlZnQoKTxyLnNjcm9sbFNlbnNpdGl2aXR5P289ZShkb2N1bWVudCkuc2Nyb2xsTGVmdChlKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCktci5zY3JvbGxTcGVlZCk6ZSh3aW5kb3cpLndpZHRoKCktKHQucGFnZVgtZShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpKTxyLnNjcm9sbFNlbnNpdGl2aXR5JiYobz1lKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGUoZG9jdW1lbnQpLnNjcm9sbExlZnQoKStyLnNjcm9sbFNwZWVkKSkpLG8hPT0hMSYmZS51aS5kZG1hbmFnZXImJiFyLmRyb3BCZWhhdmlvdXImJmUudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsdCkpLHRoaXMucG9zaXRpb25BYnM9dGhpcy5fY29udmVydFBvc2l0aW9uVG8oXCJhYnNvbHV0ZVwiKSx0aGlzLm9wdGlvbnMuYXhpcyYmXCJ5XCI9PT10aGlzLm9wdGlvbnMuYXhpc3x8KHRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0K1wicHhcIiksdGhpcy5vcHRpb25zLmF4aXMmJlwieFwiPT09dGhpcy5vcHRpb25zLmF4aXN8fCh0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArXCJweFwiKSxpPXRoaXMuaXRlbXMubGVuZ3RoLTE7aT49MDtpLS0paWYocz10aGlzLml0ZW1zW2ldLGE9cy5pdGVtWzBdLG49dGhpcy5faW50ZXJzZWN0c1dpdGhQb2ludGVyKHMpLG4mJnMuaW5zdGFuY2U9PT10aGlzLmN1cnJlbnRDb250YWluZXImJmEhPT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLnBsYWNlaG9sZGVyWzE9PT1uP1wibmV4dFwiOlwicHJldlwiXSgpWzBdIT09YSYmIWUuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSxhKSYmKFwic2VtaS1keW5hbWljXCI9PT10aGlzLm9wdGlvbnMudHlwZT8hZS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sYSk6ITApKXtpZih0aGlzLmRpcmVjdGlvbj0xPT09bj9cImRvd25cIjpcInVwXCIsXCJwb2ludGVyXCIhPT10aGlzLm9wdGlvbnMudG9sZXJhbmNlJiYhdGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhzKSlicmVhazt0aGlzLl9yZWFycmFuZ2UodCxzKSx0aGlzLl90cmlnZ2VyKFwiY2hhbmdlXCIsdCx0aGlzLl91aUhhc2goKSk7YnJlYWt9cmV0dXJuIHRoaXMuX2NvbnRhY3RDb250YWluZXJzKHQpLGUudWkuZGRtYW5hZ2VyJiZlLnVpLmRkbWFuYWdlci5kcmFnKHRoaXMsdCksdGhpcy5fdHJpZ2dlcihcInNvcnRcIix0LHRoaXMuX3VpSGFzaCgpKSx0aGlzLmxhc3RQb3NpdGlvbkFicz10aGlzLnBvc2l0aW9uQWJzLCExfSxfbW91c2VTdG9wOmZ1bmN0aW9uKHQsaSl7aWYodCl7aWYoZS51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmZS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLHQpLHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBzPXRoaXMsYT10aGlzLnBsYWNlaG9sZGVyLm9mZnNldCgpLG49dGhpcy5vcHRpb25zLmF4aXMscj17fTtuJiZcInhcIiE9PW58fChyLmxlZnQ9YS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0Kyh0aGlzLm9mZnNldFBhcmVudFswXT09PWRvY3VtZW50LmJvZHk/MDp0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxMZWZ0KSksbiYmXCJ5XCIhPT1ufHwoci50b3A9YS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcC10aGlzLm1hcmdpbnMudG9wKyh0aGlzLm9mZnNldFBhcmVudFswXT09PWRvY3VtZW50LmJvZHk/MDp0aGlzLm9mZnNldFBhcmVudFswXS5zY3JvbGxUb3ApKSx0aGlzLnJldmVydGluZz0hMCxlKHRoaXMuaGVscGVyKS5hbmltYXRlKHIscGFyc2VJbnQodGhpcy5vcHRpb25zLnJldmVydCwxMCl8fDUwMCxmdW5jdGlvbigpe3MuX2NsZWFyKHQpfSl9ZWxzZSB0aGlzLl9jbGVhcih0LGkpO3JldHVybiExfX0sY2FuY2VsOmZ1bmN0aW9uKCl7aWYodGhpcy5kcmFnZ2luZyl7dGhpcy5fbW91c2VVcCh7dGFyZ2V0Om51bGx9KSxcIm9yaWdpbmFsXCI9PT10aGlzLm9wdGlvbnMuaGVscGVyP3RoaXMuY3VycmVudEl0ZW0uY3NzKHRoaXMuX3N0b3JlZENTUykucmVtb3ZlQ2xhc3MoXCJ1aS1zb3J0YWJsZS1oZWxwZXJcIik6dGhpcy5jdXJyZW50SXRlbS5zaG93KCk7Zm9yKHZhciB0PXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTt0Pj0wO3QtLSl0aGlzLmNvbnRhaW5lcnNbdF0uX3RyaWdnZXIoXCJkZWFjdGl2YXRlXCIsbnVsbCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1t0XS5jb250YWluZXJDYWNoZS5vdmVyJiYodGhpcy5jb250YWluZXJzW3RdLl90cmlnZ2VyKFwib3V0XCIsbnVsbCx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1t0XS5jb250YWluZXJDYWNoZS5vdmVyPTApfXJldHVybiB0aGlzLnBsYWNlaG9sZGVyJiYodGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlJiZ0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSksXCJvcmlnaW5hbFwiIT09dGhpcy5vcHRpb25zLmhlbHBlciYmdGhpcy5oZWxwZXImJnRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGUmJnRoaXMuaGVscGVyLnJlbW92ZSgpLGUuZXh0ZW5kKHRoaXMse2hlbHBlcjpudWxsLGRyYWdnaW5nOiExLHJldmVydGluZzohMSxfbm9GaW5hbFNvcnQ6bnVsbH0pLHRoaXMuZG9tUG9zaXRpb24ucHJldj9lKHRoaXMuZG9tUG9zaXRpb24ucHJldikuYWZ0ZXIodGhpcy5jdXJyZW50SXRlbSk6ZSh0aGlzLmRvbVBvc2l0aW9uLnBhcmVudCkucHJlcGVuZCh0aGlzLmN1cnJlbnRJdGVtKSksdGhpc30sc2VyaWFsaXplOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuX2dldEl0ZW1zQXNqUXVlcnkodCYmdC5jb25uZWN0ZWQpLHM9W107cmV0dXJuIHQ9dHx8e30sZShpKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9KGUodC5pdGVtfHx0aGlzKS5hdHRyKHQuYXR0cmlidXRlfHxcImlkXCIpfHxcIlwiKS5tYXRjaCh0LmV4cHJlc3Npb258fC8oLispW1xcLT1fXSguKykvKTtpJiZzLnB1c2goKHQua2V5fHxpWzFdK1wiW11cIikrXCI9XCIrKHQua2V5JiZ0LmV4cHJlc3Npb24/aVsxXTppWzJdKSl9KSwhcy5sZW5ndGgmJnQua2V5JiZzLnB1c2godC5rZXkrXCI9XCIpLHMuam9pbihcIiZcIil9LHRvQXJyYXk6ZnVuY3Rpb24odCl7dmFyIGk9dGhpcy5fZ2V0SXRlbXNBc2pRdWVyeSh0JiZ0LmNvbm5lY3RlZCkscz1bXTtyZXR1cm4gdD10fHx7fSxpLmVhY2goZnVuY3Rpb24oKXtzLnB1c2goZSh0Lml0ZW18fHRoaXMpLmF0dHIodC5hdHRyaWJ1dGV8fFwiaWRcIil8fFwiXCIpfSksc30sX2ludGVyc2VjdHNXaXRoOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMucG9zaXRpb25BYnMubGVmdCxpPXQrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aCxzPXRoaXMucG9zaXRpb25BYnMudG9wLGE9cyt0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxuPWUubGVmdCxyPW4rZS53aWR0aCxvPWUudG9wLGg9bytlLmhlaWdodCxsPXRoaXMub2Zmc2V0LmNsaWNrLnRvcCx1PXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQsYz1cInhcIj09PXRoaXMub3B0aW9ucy5heGlzfHxzK2w+byYmaD5zK2wsZD1cInlcIj09PXRoaXMub3B0aW9ucy5heGlzfHx0K3U+biYmcj50K3UscD1jJiZkO3JldHVyblwicG9pbnRlclwiPT09dGhpcy5vcHRpb25zLnRvbGVyYW5jZXx8dGhpcy5vcHRpb25zLmZvcmNlUG9pbnRlckZvckNvbnRhaW5lcnN8fFwicG9pbnRlclwiIT09dGhpcy5vcHRpb25zLnRvbGVyYW5jZSYmdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nP1wid2lkdGhcIjpcImhlaWdodFwiXT5lW3RoaXMuZmxvYXRpbmc/XCJ3aWR0aFwiOlwiaGVpZ2h0XCJdP3A6dCt0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzI+biYmcj5pLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMiYmcyt0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yPm8mJmg+YS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yfSxfaW50ZXJzZWN0c1dpdGhQb2ludGVyOmZ1bmN0aW9uKGUpe3ZhciBpPVwieFwiPT09dGhpcy5vcHRpb25zLmF4aXN8fHQodGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLGUudG9wLGUuaGVpZ2h0KSxzPVwieVwiPT09dGhpcy5vcHRpb25zLmF4aXN8fHQodGhpcy5wb3NpdGlvbkFicy5sZWZ0K3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQsZS5sZWZ0LGUud2lkdGgpLGE9aSYmcyxuPXRoaXMuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbigpLHI9dGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTtyZXR1cm4gYT90aGlzLmZsb2F0aW5nP3ImJlwicmlnaHRcIj09PXJ8fFwiZG93blwiPT09bj8yOjE6biYmKFwiZG93blwiPT09bj8yOjEpOiExfSxfaW50ZXJzZWN0c1dpdGhTaWRlczpmdW5jdGlvbihlKXt2YXIgaT10KHRoaXMucG9zaXRpb25BYnMudG9wK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCxlLnRvcCtlLmhlaWdodC8yLGUuaGVpZ2h0KSxzPXQodGhpcy5wb3NpdGlvbkFicy5sZWZ0K3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQsZS5sZWZ0K2Uud2lkdGgvMixlLndpZHRoKSxhPXRoaXMuX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbigpLG49dGhpcy5fZ2V0RHJhZ0hvcml6b250YWxEaXJlY3Rpb24oKTtyZXR1cm4gdGhpcy5mbG9hdGluZyYmbj9cInJpZ2h0XCI9PT1uJiZzfHxcImxlZnRcIj09PW4mJiFzOmEmJihcImRvd25cIj09PWEmJml8fFwidXBcIj09PWEmJiFpKX0sX2dldERyYWdWZXJ0aWNhbERpcmVjdGlvbjpmdW5jdGlvbigpe3ZhciBlPXRoaXMucG9zaXRpb25BYnMudG9wLXRoaXMubGFzdFBvc2l0aW9uQWJzLnRvcDtyZXR1cm4gMCE9PWUmJihlPjA/XCJkb3duXCI6XCJ1cFwiKX0sX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5wb3NpdGlvbkFicy5sZWZ0LXRoaXMubGFzdFBvc2l0aW9uQWJzLmxlZnQ7cmV0dXJuIDAhPT1lJiYoZT4wP1wicmlnaHRcIjpcImxlZnRcIil9LHJlZnJlc2g6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX3JlZnJlc2hJdGVtcyhlKSx0aGlzLnJlZnJlc2hQb3NpdGlvbnMoKSx0aGlzfSxfY29ubmVjdFdpdGg6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLm9wdGlvbnM7cmV0dXJuIGUuY29ubmVjdFdpdGguY29uc3RydWN0b3I9PT1TdHJpbmc/W2UuY29ubmVjdFdpdGhdOmUuY29ubmVjdFdpdGh9LF9nZXRJdGVtc0FzalF1ZXJ5OmZ1bmN0aW9uKHQpe3ZhciBpLHMsYSxuLHI9W10sbz1bXSxoPXRoaXMuX2Nvbm5lY3RXaXRoKCk7aWYoaCYmdClmb3IoaT1oLmxlbmd0aC0xO2k+PTA7aS0tKWZvcihhPWUoaFtpXSkscz1hLmxlbmd0aC0xO3M+PTA7cy0tKW49ZS5kYXRhKGFbc10sdGhpcy53aWRnZXRGdWxsTmFtZSksbiYmbiE9PXRoaXMmJiFuLm9wdGlvbnMuZGlzYWJsZWQmJm8ucHVzaChbZS5pc0Z1bmN0aW9uKG4ub3B0aW9ucy5pdGVtcyk/bi5vcHRpb25zLml0ZW1zLmNhbGwobi5lbGVtZW50KTplKG4ub3B0aW9ucy5pdGVtcyxuLmVsZW1lbnQpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIikubm90KFwiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLG5dKTtmb3Ioby5wdXNoKFtlLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnQsbnVsbCx7b3B0aW9uczp0aGlzLm9wdGlvbnMsaXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KS5ub3QoXCIudWktc29ydGFibGUtaGVscGVyXCIpLm5vdChcIi51aS1zb3J0YWJsZS1wbGFjZWhvbGRlclwiKSx0aGlzXSksaT1vLmxlbmd0aC0xO2k+PTA7aS0tKW9baV1bMF0uZWFjaChmdW5jdGlvbigpe3IucHVzaCh0aGlzKX0pO3JldHVybiBlKHIpfSxfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmN1cnJlbnRJdGVtLmZpbmQoXCI6ZGF0YShcIit0aGlzLndpZGdldE5hbWUrXCItaXRlbSlcIik7dGhpcy5pdGVtcz1lLmdyZXAodGhpcy5pdGVtcyxmdW5jdGlvbihlKXtmb3IodmFyIGk9MDt0Lmxlbmd0aD5pO2krKylpZih0W2ldPT09ZS5pdGVtWzBdKXJldHVybiExO3JldHVybiEwfSl9LF9yZWZyZXNoSXRlbXM6ZnVuY3Rpb24odCl7dGhpcy5pdGVtcz1bXSx0aGlzLmNvbnRhaW5lcnM9W3RoaXNdO3ZhciBpLHMsYSxuLHIsbyxoLGwsdT10aGlzLml0ZW1zLGM9W1tlLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sdCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KSx0aGlzXV0sZD10aGlzLl9jb25uZWN0V2l0aCgpO2lmKGQmJnRoaXMucmVhZHkpZm9yKGk9ZC5sZW5ndGgtMTtpPj0wO2ktLSlmb3IoYT1lKGRbaV0pLHM9YS5sZW5ndGgtMTtzPj0wO3MtLSluPWUuZGF0YShhW3NdLHRoaXMud2lkZ2V0RnVsbE5hbWUpLG4mJm4hPT10aGlzJiYhbi5vcHRpb25zLmRpc2FibGVkJiYoYy5wdXNoKFtlLmlzRnVuY3Rpb24obi5vcHRpb25zLml0ZW1zKT9uLm9wdGlvbnMuaXRlbXMuY2FsbChuLmVsZW1lbnRbMF0sdCx7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6ZShuLm9wdGlvbnMuaXRlbXMsbi5lbGVtZW50KSxuXSksdGhpcy5jb250YWluZXJzLnB1c2gobikpO2ZvcihpPWMubGVuZ3RoLTE7aT49MDtpLS0pZm9yKHI9Y1tpXVsxXSxvPWNbaV1bMF0scz0wLGw9by5sZW5ndGg7bD5zO3MrKyloPWUob1tzXSksaC5kYXRhKHRoaXMud2lkZ2V0TmFtZStcIi1pdGVtXCIsciksdS5wdXNoKHtpdGVtOmgsaW5zdGFuY2U6cix3aWR0aDowLGhlaWdodDowLGxlZnQ6MCx0b3A6MH0pfSxyZWZyZXNoUG9zaXRpb25zOmZ1bmN0aW9uKHQpe3RoaXMub2Zmc2V0UGFyZW50JiZ0aGlzLmhlbHBlciYmKHRoaXMub2Zmc2V0LnBhcmVudD10aGlzLl9nZXRQYXJlbnRPZmZzZXQoKSk7dmFyIGkscyxhLG47Zm9yKGk9dGhpcy5pdGVtcy5sZW5ndGgtMTtpPj0wO2ktLSlzPXRoaXMuaXRlbXNbaV0scy5pbnN0YW5jZSE9PXRoaXMuY3VycmVudENvbnRhaW5lciYmdGhpcy5jdXJyZW50Q29udGFpbmVyJiZzLml0ZW1bMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdfHwoYT10aGlzLm9wdGlvbnMudG9sZXJhbmNlRWxlbWVudD9lKHRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50LHMuaXRlbSk6cy5pdGVtLHR8fChzLndpZHRoPWEub3V0ZXJXaWR0aCgpLHMuaGVpZ2h0PWEub3V0ZXJIZWlnaHQoKSksbj1hLm9mZnNldCgpLHMubGVmdD1uLmxlZnQscy50b3A9bi50b3ApO2lmKHRoaXMub3B0aW9ucy5jdXN0b20mJnRoaXMub3B0aW9ucy5jdXN0b20ucmVmcmVzaENvbnRhaW5lcnMpdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycy5jYWxsKHRoaXMpO2Vsc2UgZm9yKGk9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2k+PTA7aS0tKW49dGhpcy5jb250YWluZXJzW2ldLmVsZW1lbnQub2Zmc2V0KCksdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLmxlZnQ9bi5sZWZ0LHRoaXMuY29udGFpbmVyc1tpXS5jb250YWluZXJDYWNoZS50b3A9bi50b3AsdGhpcy5jb250YWluZXJzW2ldLmNvbnRhaW5lckNhY2hlLndpZHRoPXRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVyV2lkdGgoKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUuaGVpZ2h0PXRoaXMuY29udGFpbmVyc1tpXS5lbGVtZW50Lm91dGVySGVpZ2h0KCk7cmV0dXJuIHRoaXN9LF9jcmVhdGVQbGFjZWhvbGRlcjpmdW5jdGlvbih0KXt0PXR8fHRoaXM7dmFyIGkscz10Lm9wdGlvbnM7cy5wbGFjZWhvbGRlciYmcy5wbGFjZWhvbGRlci5jb25zdHJ1Y3RvciE9PVN0cmluZ3x8KGk9cy5wbGFjZWhvbGRlcixzLnBsYWNlaG9sZGVyPXtlbGVtZW50OmZ1bmN0aW9uKCl7dmFyIHM9dC5jdXJyZW50SXRlbVswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLGE9ZShcIjxcIitzK1wiPlwiLHQuZG9jdW1lbnRbMF0pLmFkZENsYXNzKGl8fHQuY3VycmVudEl0ZW1bMF0uY2xhc3NOYW1lK1wiIHVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyXCIpLnJlbW92ZUNsYXNzKFwidWktc29ydGFibGUtaGVscGVyXCIpO3JldHVyblwidHJcIj09PXM/dC5jdXJyZW50SXRlbS5jaGlsZHJlbigpLmVhY2goZnVuY3Rpb24oKXtlKFwiPHRkPiYjMTYwOzwvdGQ+XCIsdC5kb2N1bWVudFswXSkuYXR0cihcImNvbHNwYW5cIixlKHRoaXMpLmF0dHIoXCJjb2xzcGFuXCIpfHwxKS5hcHBlbmRUbyhhKX0pOlwiaW1nXCI9PT1zJiZhLmF0dHIoXCJzcmNcIix0LmN1cnJlbnRJdGVtLmF0dHIoXCJzcmNcIikpLGl8fGEuY3NzKFwidmlzaWJpbGl0eVwiLFwiaGlkZGVuXCIpLGF9LHVwZGF0ZTpmdW5jdGlvbihlLGEpeyghaXx8cy5mb3JjZVBsYWNlaG9sZGVyU2l6ZSkmJihhLmhlaWdodCgpfHxhLmhlaWdodCh0LmN1cnJlbnRJdGVtLmlubmVySGVpZ2h0KCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nVG9wXCIpfHwwLDEwKS1wYXJzZUludCh0LmN1cnJlbnRJdGVtLmNzcyhcInBhZGRpbmdCb3R0b21cIil8fDAsMTApKSxhLndpZHRoKCl8fGEud2lkdGgodC5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nTGVmdFwiKXx8MCwxMCktcGFyc2VJbnQodC5jdXJyZW50SXRlbS5jc3MoXCJwYWRkaW5nUmlnaHRcIil8fDAsMTApKSl9fSksdC5wbGFjZWhvbGRlcj1lKHMucGxhY2Vob2xkZXIuZWxlbWVudC5jYWxsKHQuZWxlbWVudCx0LmN1cnJlbnRJdGVtKSksdC5jdXJyZW50SXRlbS5hZnRlcih0LnBsYWNlaG9sZGVyKSxzLnBsYWNlaG9sZGVyLnVwZGF0ZSh0LHQucGxhY2Vob2xkZXIpfSxfY29udGFjdENvbnRhaW5lcnM6ZnVuY3Rpb24ocyl7dmFyIGEsbixyLG8saCxsLHUsYyxkLHAsZj1udWxsLG09bnVsbDtmb3IoYT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7YT49MDthLS0paWYoIWUuY29udGFpbnModGhpcy5jdXJyZW50SXRlbVswXSx0aGlzLmNvbnRhaW5lcnNbYV0uZWxlbWVudFswXSkpaWYodGhpcy5faW50ZXJzZWN0c1dpdGgodGhpcy5jb250YWluZXJzW2FdLmNvbnRhaW5lckNhY2hlKSl7aWYoZiYmZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbYV0uZWxlbWVudFswXSxmLmVsZW1lbnRbMF0pKWNvbnRpbnVlO2Y9dGhpcy5jb250YWluZXJzW2FdLG09YX1lbHNlIHRoaXMuY29udGFpbmVyc1thXS5jb250YWluZXJDYWNoZS5vdmVyJiYodGhpcy5jb250YWluZXJzW2FdLl90cmlnZ2VyKFwib3V0XCIscyx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1thXS5jb250YWluZXJDYWNoZS5vdmVyPTApO2lmKGYpaWYoMT09PXRoaXMuY29udGFpbmVycy5sZW5ndGgpdGhpcy5jb250YWluZXJzW21dLmNvbnRhaW5lckNhY2hlLm92ZXJ8fCh0aGlzLmNvbnRhaW5lcnNbbV0uX3RyaWdnZXIoXCJvdmVyXCIscyx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1ttXS5jb250YWluZXJDYWNoZS5vdmVyPTEpO2Vsc2V7Zm9yKHI9MWU0LG89bnVsbCxwPWYuZmxvYXRpbmd8fGkodGhpcy5jdXJyZW50SXRlbSksaD1wP1wibGVmdFwiOlwidG9wXCIsbD1wP1wid2lkdGhcIjpcImhlaWdodFwiLHU9dGhpcy5wb3NpdGlvbkFic1toXSt0aGlzLm9mZnNldC5jbGlja1toXSxuPXRoaXMuaXRlbXMubGVuZ3RoLTE7bj49MDtuLS0pZS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbbV0uZWxlbWVudFswXSx0aGlzLml0ZW1zW25dLml0ZW1bMF0pJiZ0aGlzLml0ZW1zW25dLml0ZW1bMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiYoIXB8fHQodGhpcy5wb3NpdGlvbkFicy50b3ArdGhpcy5vZmZzZXQuY2xpY2sudG9wLHRoaXMuaXRlbXNbbl0udG9wLHRoaXMuaXRlbXNbbl0uaGVpZ2h0KSkmJihjPXRoaXMuaXRlbXNbbl0uaXRlbS5vZmZzZXQoKVtoXSxkPSExLE1hdGguYWJzKGMtdSk+TWF0aC5hYnMoYyt0aGlzLml0ZW1zW25dW2xdLXUpJiYoZD0hMCxjKz10aGlzLml0ZW1zW25dW2xdKSxyPk1hdGguYWJzKGMtdSkmJihyPU1hdGguYWJzKGMtdSksbz10aGlzLml0ZW1zW25dLHRoaXMuZGlyZWN0aW9uPWQ/XCJ1cFwiOlwiZG93blwiKSk7aWYoIW8mJiF0aGlzLm9wdGlvbnMuZHJvcE9uRW1wdHkpcmV0dXJuO2lmKHRoaXMuY3VycmVudENvbnRhaW5lcj09PXRoaXMuY29udGFpbmVyc1ttXSlyZXR1cm47bz90aGlzLl9yZWFycmFuZ2UocyxvLG51bGwsITApOnRoaXMuX3JlYXJyYW5nZShzLG51bGwsdGhpcy5jb250YWluZXJzW21dLmVsZW1lbnQsITApLHRoaXMuX3RyaWdnZXIoXCJjaGFuZ2VcIixzLHRoaXMuX3VpSGFzaCgpKSx0aGlzLmNvbnRhaW5lcnNbbV0uX3RyaWdnZXIoXCJjaGFuZ2VcIixzLHRoaXMuX3VpSGFzaCh0aGlzKSksdGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMuY29udGFpbmVyc1ttXSx0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIudXBkYXRlKHRoaXMuY3VycmVudENvbnRhaW5lcix0aGlzLnBsYWNlaG9sZGVyKSx0aGlzLmNvbnRhaW5lcnNbbV0uX3RyaWdnZXIoXCJvdmVyXCIscyx0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1ttXS5jb250YWluZXJDYWNoZS5vdmVyPTF9fSxfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMub3B0aW9ucyxzPWUuaXNGdW5jdGlvbihpLmhlbHBlcik/ZShpLmhlbHBlci5hcHBseSh0aGlzLmVsZW1lbnRbMF0sW3QsdGhpcy5jdXJyZW50SXRlbV0pKTpcImNsb25lXCI9PT1pLmhlbHBlcj90aGlzLmN1cnJlbnRJdGVtLmNsb25lKCk6dGhpcy5jdXJyZW50SXRlbTtyZXR1cm4gcy5wYXJlbnRzKFwiYm9keVwiKS5sZW5ndGh8fGUoXCJwYXJlbnRcIiE9PWkuYXBwZW5kVG8/aS5hcHBlbmRUbzp0aGlzLmN1cnJlbnRJdGVtWzBdLnBhcmVudE5vZGUpWzBdLmFwcGVuZENoaWxkKHNbMF0pLHNbMF09PT10aGlzLmN1cnJlbnRJdGVtWzBdJiYodGhpcy5fc3RvcmVkQ1NTPXt3aWR0aDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLndpZHRoLGhlaWdodDp0aGlzLmN1cnJlbnRJdGVtWzBdLnN0eWxlLmhlaWdodCxwb3NpdGlvbjp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInBvc2l0aW9uXCIpLHRvcDp0aGlzLmN1cnJlbnRJdGVtLmNzcyhcInRvcFwiKSxsZWZ0OnRoaXMuY3VycmVudEl0ZW0uY3NzKFwibGVmdFwiKX0pLCghc1swXS5zdHlsZS53aWR0aHx8aS5mb3JjZUhlbHBlclNpemUpJiZzLndpZHRoKHRoaXMuY3VycmVudEl0ZW0ud2lkdGgoKSksKCFzWzBdLnN0eWxlLmhlaWdodHx8aS5mb3JjZUhlbHBlclNpemUpJiZzLmhlaWdodCh0aGlzLmN1cnJlbnRJdGVtLmhlaWdodCgpKSxzfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbih0KXtcInN0cmluZ1wiPT10eXBlb2YgdCYmKHQ9dC5zcGxpdChcIiBcIikpLGUuaXNBcnJheSh0KSYmKHQ9e2xlZnQ6K3RbMF0sdG9wOit0WzFdfHwwfSksXCJsZWZ0XCJpbiB0JiYodGhpcy5vZmZzZXQuY2xpY2subGVmdD10LmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQpLFwicmlnaHRcImluIHQmJih0aGlzLm9mZnNldC5jbGljay5sZWZ0PXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdC5yaWdodCt0aGlzLm1hcmdpbnMubGVmdCksXCJ0b3BcImluIHQmJih0aGlzLm9mZnNldC5jbGljay50b3A9dC50b3ArdGhpcy5tYXJnaW5zLnRvcCksXCJib3R0b21cImluIHQmJih0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdC5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcCl9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgdD10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTtyZXR1cm5cImFic29sdXRlXCI9PT10aGlzLmNzc1Bvc2l0aW9uJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9PWRvY3VtZW50JiZlLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSYmKHQubGVmdCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpLHQudG9wKz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSksKHRoaXMub2Zmc2V0UGFyZW50WzBdPT09ZG9jdW1lbnQuYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmXCJodG1sXCI9PT10aGlzLm9mZnNldFBhcmVudFswXS50YWdOYW1lLnRvTG93ZXJDYXNlKCkmJmUudWkuaWUpJiYodD17dG9wOjAsbGVmdDowfSkse3RvcDp0LnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyVG9wV2lkdGhcIiksMTApfHwwKSxsZWZ0OnQubGVmdCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZihcInJlbGF0aXZlXCI9PT10aGlzLmNzc1Bvc2l0aW9uKXt2YXIgZT10aGlzLmN1cnJlbnRJdGVtLnBvc2l0aW9uKCk7cmV0dXJue3RvcDplLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKFwidG9wXCIpLDEwKXx8MCkrdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCksbGVmdDplLmxlZnQtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcyhcImxlZnRcIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fXJldHVybnt0b3A6MCxsZWZ0OjB9fSxfY2FjaGVNYXJnaW5zOmZ1bmN0aW9uKCl7dGhpcy5tYXJnaW5zPXtsZWZ0OnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luTGVmdFwiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKFwibWFyZ2luVG9wXCIpLDEwKXx8MH19LF9jYWNoZUhlbHBlclByb3BvcnRpb25zOmZ1bmN0aW9uKCl7dGhpcy5oZWxwZXJQcm9wb3J0aW9ucz17d2lkdGg6dGhpcy5oZWxwZXIub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmhlbHBlci5vdXRlckhlaWdodCgpfX0sX3NldENvbnRhaW5tZW50OmZ1bmN0aW9uKCl7dmFyIHQsaSxzLGE9dGhpcy5vcHRpb25zO1wicGFyZW50XCI9PT1hLmNvbnRhaW5tZW50JiYoYS5jb250YWlubWVudD10aGlzLmhlbHBlclswXS5wYXJlbnROb2RlKSwoXCJkb2N1bWVudFwiPT09YS5jb250YWlubWVudHx8XCJ3aW5kb3dcIj09PWEuY29udGFpbm1lbnQpJiYodGhpcy5jb250YWlubWVudD1bMC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LDAtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsZShcImRvY3VtZW50XCI9PT1hLmNvbnRhaW5tZW50P2RvY3VtZW50OndpbmRvdykud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChlKFwiZG9jdW1lbnRcIj09PWEuY29udGFpbm1lbnQ/ZG9jdW1lbnQ6d2luZG93KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF0pLC9eKGRvY3VtZW50fHdpbmRvd3xwYXJlbnQpJC8udGVzdChhLmNvbnRhaW5tZW50KXx8KHQ9ZShhLmNvbnRhaW5tZW50KVswXSxpPWUoYS5jb250YWlubWVudCkub2Zmc2V0KCkscz1cImhpZGRlblwiIT09ZSh0KS5jc3MoXCJvdmVyZmxvd1wiKSx0aGlzLmNvbnRhaW5tZW50PVtpLmxlZnQrKHBhcnNlSW50KGUodCkuY3NzKFwiYm9yZGVyTGVmdFdpZHRoXCIpLDEwKXx8MCkrKHBhcnNlSW50KGUodCkuY3NzKFwicGFkZGluZ0xlZnRcIiksMTApfHwwKS10aGlzLm1hcmdpbnMubGVmdCxpLnRvcCsocGFyc2VJbnQoZSh0KS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSwxMCl8fDApKyhwYXJzZUludChlKHQpLmNzcyhcInBhZGRpbmdUb3BcIiksMTApfHwwKS10aGlzLm1hcmdpbnMudG9wLGkubGVmdCsocz9NYXRoLm1heCh0LnNjcm9sbFdpZHRoLHQub2Zmc2V0V2lkdGgpOnQub2Zmc2V0V2lkdGgpLShwYXJzZUludChlKHQpLmNzcyhcImJvcmRlckxlZnRXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChlKHQpLmNzcyhcInBhZGRpbmdSaWdodFwiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQsaS50b3ArKHM/TWF0aC5tYXgodC5zY3JvbGxIZWlnaHQsdC5vZmZzZXRIZWlnaHQpOnQub2Zmc2V0SGVpZ2h0KS0ocGFyc2VJbnQoZSh0KS5jc3MoXCJib3JkZXJUb3BXaWR0aFwiKSwxMCl8fDApLShwYXJzZUludChlKHQpLmNzcyhcInBhZGRpbmdCb3R0b21cIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXSl9LF9jb252ZXJ0UG9zaXRpb25UbzpmdW5jdGlvbih0LGkpe2l8fChpPXRoaXMucG9zaXRpb24pO3ZhciBzPVwiYWJzb2x1dGVcIj09PXQ/MTotMSxhPVwiYWJzb2x1dGVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09ZG9jdW1lbnQmJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pP3RoaXMuc2Nyb2xsUGFyZW50OnRoaXMub2Zmc2V0UGFyZW50LG49LyhodG1sfGJvZHkpL2kudGVzdChhWzBdLnRhZ05hbWUpO3JldHVybnt0b3A6aS50b3ArdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wKnMrdGhpcy5vZmZzZXQucGFyZW50LnRvcCpzLShcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpuPzA6YS5zY3JvbGxUb3AoKSkqcyxsZWZ0OmkubGVmdCt0aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0KnMrdGhpcy5vZmZzZXQucGFyZW50LmxlZnQqcy0oXCJmaXhlZFwiPT09dGhpcy5jc3NQb3NpdGlvbj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOm4/MDphLnNjcm9sbExlZnQoKSkqc319LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKHQpe3ZhciBpLHMsYT10aGlzLm9wdGlvbnMsbj10LnBhZ2VYLHI9dC5wYWdlWSxvPVwiYWJzb2x1dGVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09ZG9jdW1lbnQmJmUuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pP3RoaXMuc2Nyb2xsUGFyZW50OnRoaXMub2Zmc2V0UGFyZW50LGg9LyhodG1sfGJvZHkpL2kudGVzdChvWzBdLnRhZ05hbWUpO3JldHVyblwicmVsYXRpdmVcIiE9PXRoaXMuY3NzUG9zaXRpb258fHRoaXMuc2Nyb2xsUGFyZW50WzBdIT09ZG9jdW1lbnQmJnRoaXMuc2Nyb2xsUGFyZW50WzBdIT09dGhpcy5vZmZzZXRQYXJlbnRbMF18fCh0aGlzLm9mZnNldC5yZWxhdGl2ZT10aGlzLl9nZXRSZWxhdGl2ZU9mZnNldCgpKSx0aGlzLm9yaWdpbmFsUG9zaXRpb24mJih0aGlzLmNvbnRhaW5tZW50JiYodC5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0mJihuPXRoaXMuY29udGFpbm1lbnRbMF0rdGhpcy5vZmZzZXQuY2xpY2subGVmdCksdC5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8dGhpcy5jb250YWlubWVudFsxXSYmKHI9dGhpcy5jb250YWlubWVudFsxXSt0aGlzLm9mZnNldC5jbGljay50b3ApLHQucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdJiYobj10aGlzLmNvbnRhaW5tZW50WzJdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLHQucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10mJihyPXRoaXMuY29udGFpbm1lbnRbM10rdGhpcy5vZmZzZXQuY2xpY2sudG9wKSksYS5ncmlkJiYoaT10aGlzLm9yaWdpbmFsUGFnZVkrTWF0aC5yb3VuZCgoci10aGlzLm9yaWdpbmFsUGFnZVkpL2EuZ3JpZFsxXSkqYS5ncmlkWzFdLHI9dGhpcy5jb250YWlubWVudD9pLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD49dGhpcy5jb250YWlubWVudFsxXSYmaS10aGlzLm9mZnNldC5jbGljay50b3A8PXRoaXMuY29udGFpbm1lbnRbM10/aTppLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD49dGhpcy5jb250YWlubWVudFsxXT9pLWEuZ3JpZFsxXTppK2EuZ3JpZFsxXTppLHM9dGhpcy5vcmlnaW5hbFBhZ2VYK01hdGgucm91bmQoKG4tdGhpcy5vcmlnaW5hbFBhZ2VYKS9hLmdyaWRbMF0pKmEuZ3JpZFswXSxuPXRoaXMuY29udGFpbm1lbnQ/cy10aGlzLm9mZnNldC5jbGljay5sZWZ0Pj10aGlzLmNvbnRhaW5tZW50WzBdJiZzLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8PXRoaXMuY29udGFpbm1lbnRbMl0/czpzLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+PXRoaXMuY29udGFpbm1lbnRbMF0/cy1hLmdyaWRbMF06cythLmdyaWRbMF06cykpLHt0b3A6ci10aGlzLm9mZnNldC5jbGljay50b3AtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3ArKFwiZml4ZWRcIj09PXRoaXMuY3NzUG9zaXRpb24/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpOmg/MDpvLnNjcm9sbFRvcCgpKSxsZWZ0Om4tdGhpcy5vZmZzZXQuY2xpY2subGVmdC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KyhcImZpeGVkXCI9PT10aGlzLmNzc1Bvc2l0aW9uPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6aD8wOm8uc2Nyb2xsTGVmdCgpKX19LF9yZWFycmFuZ2U6ZnVuY3Rpb24oZSx0LGkscyl7aT9pWzBdLmFwcGVuZENoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pOnQuaXRlbVswXS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLnBsYWNlaG9sZGVyWzBdLFwiZG93blwiPT09dGhpcy5kaXJlY3Rpb24/dC5pdGVtWzBdOnQuaXRlbVswXS5uZXh0U2libGluZyksdGhpcy5jb3VudGVyPXRoaXMuY291bnRlcj8rK3RoaXMuY291bnRlcjoxO3ZhciBhPXRoaXMuY291bnRlcjt0aGlzLl9kZWxheShmdW5jdGlvbigpe2E9PT10aGlzLmNvdW50ZXImJnRoaXMucmVmcmVzaFBvc2l0aW9ucyghcyl9KX0sX2NsZWFyOmZ1bmN0aW9uKGUsdCl7dGhpcy5yZXZlcnRpbmc9ITE7dmFyIGkscz1bXTtpZighdGhpcy5fbm9GaW5hbFNvcnQmJnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KCkubGVuZ3RoJiZ0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0aGlzLmN1cnJlbnRJdGVtKSx0aGlzLl9ub0ZpbmFsU29ydD1udWxsLHRoaXMuaGVscGVyWzBdPT09dGhpcy5jdXJyZW50SXRlbVswXSl7Zm9yKGkgaW4gdGhpcy5fc3RvcmVkQ1NTKShcImF1dG9cIj09PXRoaXMuX3N0b3JlZENTU1tpXXx8XCJzdGF0aWNcIj09PXRoaXMuX3N0b3JlZENTU1tpXSkmJih0aGlzLl9zdG9yZWRDU1NbaV09XCJcIik7dGhpcy5jdXJyZW50SXRlbS5jc3ModGhpcy5fc3RvcmVkQ1NTKS5yZW1vdmVDbGFzcyhcInVpLXNvcnRhYmxlLWhlbHBlclwiKX1lbHNlIHRoaXMuY3VycmVudEl0ZW0uc2hvdygpO2Zvcih0aGlzLmZyb21PdXRzaWRlJiYhdCYmcy5wdXNoKGZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJyZWNlaXZlXCIsZSx0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpfSksIXRoaXMuZnJvbU91dHNpZGUmJnRoaXMuZG9tUG9zaXRpb24ucHJldj09PXRoaXMuY3VycmVudEl0ZW0ucHJldigpLm5vdChcIi51aS1zb3J0YWJsZS1oZWxwZXJcIilbMF0mJnRoaXMuZG9tUG9zaXRpb24ucGFyZW50PT09dGhpcy5jdXJyZW50SXRlbS5wYXJlbnQoKVswXXx8dHx8cy5wdXNoKGZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJ1cGRhdGVcIixlLHRoaXMuX3VpSGFzaCgpKX0pLHRoaXMhPT10aGlzLmN1cnJlbnRDb250YWluZXImJih0fHwocy5wdXNoKGZ1bmN0aW9uKGUpe3RoaXMuX3RyaWdnZXIoXCJyZW1vdmVcIixlLHRoaXMuX3VpSGFzaCgpKX0pLHMucHVzaChmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7ZS5fdHJpZ2dlcihcInJlY2VpdmVcIix0LHRoaXMuX3VpSGFzaCh0aGlzKSl9fS5jYWxsKHRoaXMsdGhpcy5jdXJyZW50Q29udGFpbmVyKSkscy5wdXNoKGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtlLl90cmlnZ2VyKFwidXBkYXRlXCIsdCx0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY3VycmVudENvbnRhaW5lcikpKSksaT10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7aT49MDtpLS0pdHx8cy5wdXNoKGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtlLl90cmlnZ2VyKFwiZGVhY3RpdmF0ZVwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbaV0pKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3ZlciYmKHMucHVzaChmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7ZS5fdHJpZ2dlcihcIm91dFwiLHQsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbaV0pKSx0aGlzLmNvbnRhaW5lcnNbaV0uY29udGFpbmVyQ2FjaGUub3Zlcj0wKTtpZih0aGlzLnN0b3JlZEN1cnNvciYmKHRoaXMuZG9jdW1lbnQuZmluZChcImJvZHlcIikuY3NzKFwiY3Vyc29yXCIsdGhpcy5zdG9yZWRDdXJzb3IpLHRoaXMuc3RvcmVkU3R5bGVzaGVldC5yZW1vdmUoKSksdGhpcy5fc3RvcmVkT3BhY2l0eSYmdGhpcy5oZWxwZXIuY3NzKFwib3BhY2l0eVwiLHRoaXMuX3N0b3JlZE9wYWNpdHkpLHRoaXMuX3N0b3JlZFpJbmRleCYmdGhpcy5oZWxwZXIuY3NzKFwiekluZGV4XCIsXCJhdXRvXCI9PT10aGlzLl9zdG9yZWRaSW5kZXg/XCJcIjp0aGlzLl9zdG9yZWRaSW5kZXgpLHRoaXMuZHJhZ2dpbmc9ITEsdGhpcy5jYW5jZWxIZWxwZXJSZW1vdmFsKXtpZighdCl7Zm9yKHRoaXMuX3RyaWdnZXIoXCJiZWZvcmVTdG9wXCIsZSx0aGlzLl91aUhhc2goKSksaT0wO3MubGVuZ3RoPmk7aSsrKXNbaV0uY2FsbCh0aGlzLGUpO3RoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZSx0aGlzLl91aUhhc2goKSl9cmV0dXJuIHRoaXMuZnJvbU91dHNpZGU9ITEsITF9aWYodHx8dGhpcy5fdHJpZ2dlcihcImJlZm9yZVN0b3BcIixlLHRoaXMuX3VpSGFzaCgpKSx0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSksdGhpcy5oZWxwZXJbMF0hPT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmhlbHBlci5yZW1vdmUoKSx0aGlzLmhlbHBlcj1udWxsLCF0KXtmb3IoaT0wO3MubGVuZ3RoPmk7aSsrKXNbaV0uY2FsbCh0aGlzLGUpO3RoaXMuX3RyaWdnZXIoXCJzdG9wXCIsZSx0aGlzLl91aUhhc2goKSl9cmV0dXJuIHRoaXMuZnJvbU91dHNpZGU9ITEsITB9LF90cmlnZ2VyOmZ1bmN0aW9uKCl7ZS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmFwcGx5KHRoaXMsYXJndW1lbnRzKT09PSExJiZ0aGlzLmNhbmNlbCgpfSxfdWlIYXNoOmZ1bmN0aW9uKHQpe3ZhciBpPXR8fHRoaXM7cmV0dXJue2hlbHBlcjppLmhlbHBlcixwbGFjZWhvbGRlcjppLnBsYWNlaG9sZGVyfHxlKFtdKSxwb3NpdGlvbjppLnBvc2l0aW9uLG9yaWdpbmFsUG9zaXRpb246aS5vcmlnaW5hbFBvc2l0aW9uLG9mZnNldDppLnBvc2l0aW9uQWJzLGl0ZW06aS5jdXJyZW50SXRlbSxzZW5kZXI6dD90LmVsZW1lbnQ6bnVsbH19fSl9KShqUXVlcnkpOyhmdW5jdGlvbihlLHQpe3ZhciBpPVwidWktZWZmZWN0cy1cIjtlLmVmZmVjdHM9e2VmZmVjdDp7fX0sZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBpKGUsdCxpKXt2YXIgcz1jW3QudHlwZV18fHt9O3JldHVybiBudWxsPT1lP2l8fCF0LmRlZj9udWxsOnQuZGVmOihlPXMuZmxvb3I/fn5lOnBhcnNlRmxvYXQoZSksaXNOYU4oZSk/dC5kZWY6cy5tb2Q/KGUrcy5tb2QpJXMubW9kOjA+ZT8wOmU+cy5tYXg/cy5tYXg6ZSl9ZnVuY3Rpb24gcyhpKXt2YXIgcz1sKCksYT1zLl9yZ2JhPVtdO3JldHVybiBpPWkudG9Mb3dlckNhc2UoKSxmKGgsZnVuY3Rpb24oZSxuKXt2YXIgcixvPW4ucmUuZXhlYyhpKSxoPW8mJm4ucGFyc2UobyksbD1uLnNwYWNlfHxcInJnYmFcIjtyZXR1cm4gaD8ocj1zW2xdKGgpLHNbdVtsXS5jYWNoZV09clt1W2xdLmNhY2hlXSxhPXMuX3JnYmE9ci5fcmdiYSwhMSk6dH0pLGEubGVuZ3RoPyhcIjAsMCwwLDBcIj09PWEuam9pbigpJiZlLmV4dGVuZChhLG4udHJhbnNwYXJlbnQpLHMpOm5baV19ZnVuY3Rpb24gYShlLHQsaSl7cmV0dXJuIGk9KGkrMSklMSwxPjYqaT9lKzYqKHQtZSkqaToxPjIqaT90OjI+MyppP2UrNioodC1lKSooMi8zLWkpOmV9dmFyIG4scj1cImJhY2tncm91bmRDb2xvciBib3JkZXJCb3R0b21Db2xvciBib3JkZXJMZWZ0Q29sb3IgYm9yZGVyUmlnaHRDb2xvciBib3JkZXJUb3BDb2xvciBjb2xvciBjb2x1bW5SdWxlQ29sb3Igb3V0bGluZUNvbG9yIHRleHREZWNvcmF0aW9uQ29sb3IgdGV4dEVtcGhhc2lzQ29sb3JcIixvPS9eKFtcXC0rXSk9XFxzKihcXGQrXFwuP1xcZCopLyxoPVt7cmU6L3JnYmE/XFwoXFxzKihcXGR7MSwzfSlcXHMqLFxccyooXFxkezEsM30pXFxzKixcXHMqKFxcZHsxLDN9KVxccyooPzosXFxzKihcXGQ/KD86XFwuXFxkKyk/KVxccyopP1xcKS8scGFyc2U6ZnVuY3Rpb24oZSl7cmV0dXJuW2VbMV0sZVsyXSxlWzNdLGVbNF1dfX0se3JlOi9yZ2JhP1xcKFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqLFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqLFxccyooXFxkKyg/OlxcLlxcZCspPylcXCVcXHMqKD86LFxccyooXFxkPyg/OlxcLlxcZCspPylcXHMqKT9cXCkvLHBhcnNlOmZ1bmN0aW9uKGUpe3JldHVyblsyLjU1KmVbMV0sMi41NSplWzJdLDIuNTUqZVszXSxlWzRdXX19LHtyZTovIyhbYS1mMC05XXsyfSkoW2EtZjAtOV17Mn0pKFthLWYwLTldezJ9KS8scGFyc2U6ZnVuY3Rpb24oZSl7cmV0dXJuW3BhcnNlSW50KGVbMV0sMTYpLHBhcnNlSW50KGVbMl0sMTYpLHBhcnNlSW50KGVbM10sMTYpXX19LHtyZTovIyhbYS1mMC05XSkoW2EtZjAtOV0pKFthLWYwLTldKS8scGFyc2U6ZnVuY3Rpb24oZSl7cmV0dXJuW3BhcnNlSW50KGVbMV0rZVsxXSwxNikscGFyc2VJbnQoZVsyXStlWzJdLDE2KSxwYXJzZUludChlWzNdK2VbM10sMTYpXX19LHtyZTovaHNsYT9cXChcXHMqKFxcZCsoPzpcXC5cXGQrKT8pXFxzKixcXHMqKFxcZCsoPzpcXC5cXGQrKT8pXFwlXFxzKixcXHMqKFxcZCsoPzpcXC5cXGQrKT8pXFwlXFxzKig/OixcXHMqKFxcZD8oPzpcXC5cXGQrKT8pXFxzKik/XFwpLyxzcGFjZTpcImhzbGFcIixwYXJzZTpmdW5jdGlvbihlKXtyZXR1cm5bZVsxXSxlWzJdLzEwMCxlWzNdLzEwMCxlWzRdXX19XSxsPWUuQ29sb3I9ZnVuY3Rpb24odCxpLHMsYSl7cmV0dXJuIG5ldyBlLkNvbG9yLmZuLnBhcnNlKHQsaSxzLGEpfSx1PXtyZ2JhOntwcm9wczp7cmVkOntpZHg6MCx0eXBlOlwiYnl0ZVwifSxncmVlbjp7aWR4OjEsdHlwZTpcImJ5dGVcIn0sYmx1ZTp7aWR4OjIsdHlwZTpcImJ5dGVcIn19fSxoc2xhOntwcm9wczp7aHVlOntpZHg6MCx0eXBlOlwiZGVncmVlc1wifSxzYXR1cmF0aW9uOntpZHg6MSx0eXBlOlwicGVyY2VudFwifSxsaWdodG5lc3M6e2lkeDoyLHR5cGU6XCJwZXJjZW50XCJ9fX19LGM9e1wiYnl0ZVwiOntmbG9vcjohMCxtYXg6MjU1fSxwZXJjZW50OnttYXg6MX0sZGVncmVlczp7bW9kOjM2MCxmbG9vcjohMH19LGQ9bC5zdXBwb3J0PXt9LHA9ZShcIjxwPlwiKVswXSxmPWUuZWFjaDtwLnN0eWxlLmNzc1RleHQ9XCJiYWNrZ3JvdW5kLWNvbG9yOnJnYmEoMSwxLDEsLjUpXCIsZC5yZ2JhPXAuc3R5bGUuYmFja2dyb3VuZENvbG9yLmluZGV4T2YoXCJyZ2JhXCIpPi0xLGYodSxmdW5jdGlvbihlLHQpe3QuY2FjaGU9XCJfXCIrZSx0LnByb3BzLmFscGhhPXtpZHg6Myx0eXBlOlwicGVyY2VudFwiLGRlZjoxfX0pLGwuZm49ZS5leHRlbmQobC5wcm90b3R5cGUse3BhcnNlOmZ1bmN0aW9uKGEscixvLGgpe2lmKGE9PT10KXJldHVybiB0aGlzLl9yZ2JhPVtudWxsLG51bGwsbnVsbCxudWxsXSx0aGlzOyhhLmpxdWVyeXx8YS5ub2RlVHlwZSkmJihhPWUoYSkuY3NzKHIpLHI9dCk7dmFyIGM9dGhpcyxkPWUudHlwZShhKSxwPXRoaXMuX3JnYmE9W107cmV0dXJuIHIhPT10JiYoYT1bYSxyLG8saF0sZD1cImFycmF5XCIpLFwic3RyaW5nXCI9PT1kP3RoaXMucGFyc2UocyhhKXx8bi5fZGVmYXVsdCk6XCJhcnJheVwiPT09ZD8oZih1LnJnYmEucHJvcHMsZnVuY3Rpb24oZSx0KXtwW3QuaWR4XT1pKGFbdC5pZHhdLHQpfSksdGhpcyk6XCJvYmplY3RcIj09PWQ/KGEgaW5zdGFuY2VvZiBsP2YodSxmdW5jdGlvbihlLHQpe2FbdC5jYWNoZV0mJihjW3QuY2FjaGVdPWFbdC5jYWNoZV0uc2xpY2UoKSl9KTpmKHUsZnVuY3Rpb24odCxzKXt2YXIgbj1zLmNhY2hlO2Yocy5wcm9wcyxmdW5jdGlvbihlLHQpe2lmKCFjW25dJiZzLnRvKXtpZihcImFscGhhXCI9PT1lfHxudWxsPT1hW2VdKXJldHVybjtjW25dPXMudG8oYy5fcmdiYSl9Y1tuXVt0LmlkeF09aShhW2VdLHQsITApfSksY1tuXSYmMD5lLmluQXJyYXkobnVsbCxjW25dLnNsaWNlKDAsMykpJiYoY1tuXVszXT0xLHMuZnJvbSYmKGMuX3JnYmE9cy5mcm9tKGNbbl0pKSl9KSx0aGlzKTp0fSxpczpmdW5jdGlvbihlKXt2YXIgaT1sKGUpLHM9ITAsYT10aGlzO3JldHVybiBmKHUsZnVuY3Rpb24oZSxuKXt2YXIgcixvPWlbbi5jYWNoZV07cmV0dXJuIG8mJihyPWFbbi5jYWNoZV18fG4udG8mJm4udG8oYS5fcmdiYSl8fFtdLGYobi5wcm9wcyxmdW5jdGlvbihlLGkpe3JldHVybiBudWxsIT1vW2kuaWR4XT9zPW9baS5pZHhdPT09cltpLmlkeF06dH0pKSxzfSksc30sX3NwYWNlOmZ1bmN0aW9uKCl7dmFyIGU9W10sdD10aGlzO3JldHVybiBmKHUsZnVuY3Rpb24oaSxzKXt0W3MuY2FjaGVdJiZlLnB1c2goaSl9KSxlLnBvcCgpfSx0cmFuc2l0aW9uOmZ1bmN0aW9uKGUsdCl7dmFyIHM9bChlKSxhPXMuX3NwYWNlKCksbj11W2FdLHI9MD09PXRoaXMuYWxwaGEoKT9sKFwidHJhbnNwYXJlbnRcIik6dGhpcyxvPXJbbi5jYWNoZV18fG4udG8oci5fcmdiYSksaD1vLnNsaWNlKCk7cmV0dXJuIHM9c1tuLmNhY2hlXSxmKG4ucHJvcHMsZnVuY3Rpb24oZSxhKXt2YXIgbj1hLmlkeCxyPW9bbl0sbD1zW25dLHU9Y1thLnR5cGVdfHx7fTtudWxsIT09bCYmKG51bGw9PT1yP2hbbl09bDoodS5tb2QmJihsLXI+dS5tb2QvMj9yKz11Lm1vZDpyLWw+dS5tb2QvMiYmKHItPXUubW9kKSksaFtuXT1pKChsLXIpKnQrcixhKSkpfSksdGhpc1thXShoKX0sYmxlbmQ6ZnVuY3Rpb24odCl7aWYoMT09PXRoaXMuX3JnYmFbM10pcmV0dXJuIHRoaXM7dmFyIGk9dGhpcy5fcmdiYS5zbGljZSgpLHM9aS5wb3AoKSxhPWwodCkuX3JnYmE7cmV0dXJuIGwoZS5tYXAoaSxmdW5jdGlvbihlLHQpe3JldHVybigxLXMpKmFbdF0rcyplfSkpfSx0b1JnYmFTdHJpbmc6ZnVuY3Rpb24oKXt2YXIgdD1cInJnYmEoXCIsaT1lLm1hcCh0aGlzLl9yZ2JhLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGw9PWU/dD4yPzE6MDplfSk7cmV0dXJuIDE9PT1pWzNdJiYoaS5wb3AoKSx0PVwicmdiKFwiKSx0K2kuam9pbigpK1wiKVwifSx0b0hzbGFTdHJpbmc6ZnVuY3Rpb24oKXt2YXIgdD1cImhzbGEoXCIsaT1lLm1hcCh0aGlzLmhzbGEoKSxmdW5jdGlvbihlLHQpe3JldHVybiBudWxsPT1lJiYoZT10PjI/MTowKSx0JiYzPnQmJihlPU1hdGgucm91bmQoMTAwKmUpK1wiJVwiKSxlfSk7cmV0dXJuIDE9PT1pWzNdJiYoaS5wb3AoKSx0PVwiaHNsKFwiKSx0K2kuam9pbigpK1wiKVwifSx0b0hleFN0cmluZzpmdW5jdGlvbih0KXt2YXIgaT10aGlzLl9yZ2JhLnNsaWNlKCkscz1pLnBvcCgpO3JldHVybiB0JiZpLnB1c2gofn4oMjU1KnMpKSxcIiNcIitlLm1hcChpLGZ1bmN0aW9uKGUpe3JldHVybiBlPShlfHwwKS50b1N0cmluZygxNiksMT09PWUubGVuZ3RoP1wiMFwiK2U6ZX0pLmpvaW4oXCJcIil9LHRvU3RyaW5nOmZ1bmN0aW9uKCl7cmV0dXJuIDA9PT10aGlzLl9yZ2JhWzNdP1widHJhbnNwYXJlbnRcIjp0aGlzLnRvUmdiYVN0cmluZygpfX0pLGwuZm4ucGFyc2UucHJvdG90eXBlPWwuZm4sdS5oc2xhLnRvPWZ1bmN0aW9uKGUpe2lmKG51bGw9PWVbMF18fG51bGw9PWVbMV18fG51bGw9PWVbMl0pcmV0dXJuW251bGwsbnVsbCxudWxsLGVbM11dO3ZhciB0LGkscz1lWzBdLzI1NSxhPWVbMV0vMjU1LG49ZVsyXS8yNTUscj1lWzNdLG89TWF0aC5tYXgocyxhLG4pLGg9TWF0aC5taW4ocyxhLG4pLGw9by1oLHU9bytoLGM9LjUqdTtyZXR1cm4gdD1oPT09bz8wOnM9PT1vPzYwKihhLW4pL2wrMzYwOmE9PT1vPzYwKihuLXMpL2wrMTIwOjYwKihzLWEpL2wrMjQwLGk9MD09PWw/MDouNT49Yz9sL3U6bC8oMi11KSxbTWF0aC5yb3VuZCh0KSUzNjAsaSxjLG51bGw9PXI/MTpyXX0sdS5oc2xhLmZyb209ZnVuY3Rpb24oZSl7aWYobnVsbD09ZVswXXx8bnVsbD09ZVsxXXx8bnVsbD09ZVsyXSlyZXR1cm5bbnVsbCxudWxsLG51bGwsZVszXV07dmFyIHQ9ZVswXS8zNjAsaT1lWzFdLHM9ZVsyXSxuPWVbM10scj0uNT49cz9zKigxK2kpOnMraS1zKmksbz0yKnMtcjtyZXR1cm5bTWF0aC5yb3VuZCgyNTUqYShvLHIsdCsxLzMpKSxNYXRoLnJvdW5kKDI1NSphKG8scix0KSksTWF0aC5yb3VuZCgyNTUqYShvLHIsdC0xLzMpKSxuXX0sZih1LGZ1bmN0aW9uKHMsYSl7dmFyIG49YS5wcm9wcyxyPWEuY2FjaGUsaD1hLnRvLHU9YS5mcm9tO2wuZm5bc109ZnVuY3Rpb24ocyl7aWYoaCYmIXRoaXNbcl0mJih0aGlzW3JdPWgodGhpcy5fcmdiYSkpLHM9PT10KXJldHVybiB0aGlzW3JdLnNsaWNlKCk7dmFyIGEsbz1lLnR5cGUocyksYz1cImFycmF5XCI9PT1vfHxcIm9iamVjdFwiPT09bz9zOmFyZ3VtZW50cyxkPXRoaXNbcl0uc2xpY2UoKTtyZXR1cm4gZihuLGZ1bmN0aW9uKGUsdCl7dmFyIHM9Y1tcIm9iamVjdFwiPT09bz9lOnQuaWR4XTtudWxsPT1zJiYocz1kW3QuaWR4XSksZFt0LmlkeF09aShzLHQpfSksdT8oYT1sKHUoZCkpLGFbcl09ZCxhKTpsKGQpfSxmKG4sZnVuY3Rpb24odCxpKXtsLmZuW3RdfHwobC5mblt0XT1mdW5jdGlvbihhKXt2YXIgbixyPWUudHlwZShhKSxoPVwiYWxwaGFcIj09PXQ/dGhpcy5faHNsYT9cImhzbGFcIjpcInJnYmFcIjpzLGw9dGhpc1toXSgpLHU9bFtpLmlkeF07cmV0dXJuXCJ1bmRlZmluZWRcIj09PXI/dTooXCJmdW5jdGlvblwiPT09ciYmKGE9YS5jYWxsKHRoaXMsdSkscj1lLnR5cGUoYSkpLG51bGw9PWEmJmkuZW1wdHk/dGhpczooXCJzdHJpbmdcIj09PXImJihuPW8uZXhlYyhhKSxuJiYoYT11K3BhcnNlRmxvYXQoblsyXSkqKFwiK1wiPT09blsxXT8xOi0xKSkpLGxbaS5pZHhdPWEsdGhpc1toXShsKSkpfSl9KX0pLGwuaG9vaz1mdW5jdGlvbih0KXt2YXIgaT10LnNwbGl0KFwiIFwiKTtmKGksZnVuY3Rpb24odCxpKXtlLmNzc0hvb2tzW2ldPXtzZXQ6ZnVuY3Rpb24odCxhKXt2YXIgbixyLG89XCJcIjtpZihcInRyYW5zcGFyZW50XCIhPT1hJiYoXCJzdHJpbmdcIiE9PWUudHlwZShhKXx8KG49cyhhKSkpKXtpZihhPWwobnx8YSksIWQucmdiYSYmMSE9PWEuX3JnYmFbM10pe2ZvcihyPVwiYmFja2dyb3VuZENvbG9yXCI9PT1pP3QucGFyZW50Tm9kZTp0OyhcIlwiPT09b3x8XCJ0cmFuc3BhcmVudFwiPT09bykmJnImJnIuc3R5bGU7KXRyeXtvPWUuY3NzKHIsXCJiYWNrZ3JvdW5kQ29sb3JcIikscj1yLnBhcmVudE5vZGV9Y2F0Y2goaCl7fWE9YS5ibGVuZChvJiZcInRyYW5zcGFyZW50XCIhPT1vP286XCJfZGVmYXVsdFwiKX1hPWEudG9SZ2JhU3RyaW5nKCl9dHJ5e3Quc3R5bGVbaV09YX1jYXRjaChoKXt9fX0sZS5meC5zdGVwW2ldPWZ1bmN0aW9uKHQpe3QuY29sb3JJbml0fHwodC5zdGFydD1sKHQuZWxlbSxpKSx0LmVuZD1sKHQuZW5kKSx0LmNvbG9ySW5pdD0hMCksZS5jc3NIb29rc1tpXS5zZXQodC5lbGVtLHQuc3RhcnQudHJhbnNpdGlvbih0LmVuZCx0LnBvcykpfX0pfSxsLmhvb2sociksZS5jc3NIb29rcy5ib3JkZXJDb2xvcj17ZXhwYW5kOmZ1bmN0aW9uKGUpe3ZhciB0PXt9O3JldHVybiBmKFtcIlRvcFwiLFwiUmlnaHRcIixcIkJvdHRvbVwiLFwiTGVmdFwiXSxmdW5jdGlvbihpLHMpe3RbXCJib3JkZXJcIitzK1wiQ29sb3JcIl09ZX0pLHR9fSxuPWUuQ29sb3IubmFtZXM9e2FxdWE6XCIjMDBmZmZmXCIsYmxhY2s6XCIjMDAwMDAwXCIsYmx1ZTpcIiMwMDAwZmZcIixmdWNoc2lhOlwiI2ZmMDBmZlwiLGdyYXk6XCIjODA4MDgwXCIsZ3JlZW46XCIjMDA4MDAwXCIsbGltZTpcIiMwMGZmMDBcIixtYXJvb246XCIjODAwMDAwXCIsbmF2eTpcIiMwMDAwODBcIixvbGl2ZTpcIiM4MDgwMDBcIixwdXJwbGU6XCIjODAwMDgwXCIscmVkOlwiI2ZmMDAwMFwiLHNpbHZlcjpcIiNjMGMwYzBcIix0ZWFsOlwiIzAwODA4MFwiLHdoaXRlOlwiI2ZmZmZmZlwiLHllbGxvdzpcIiNmZmZmMDBcIix0cmFuc3BhcmVudDpbbnVsbCxudWxsLG51bGwsMF0sX2RlZmF1bHQ6XCIjZmZmZmZmXCJ9fShqUXVlcnkpLGZ1bmN0aW9uKCl7ZnVuY3Rpb24gaSh0KXt2YXIgaSxzLGE9dC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3P3Qub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHQsbnVsbCk6dC5jdXJyZW50U3R5bGUsbj17fTtpZihhJiZhLmxlbmd0aCYmYVswXSYmYVthWzBdXSlmb3Iocz1hLmxlbmd0aDtzLS07KWk9YVtzXSxcInN0cmluZ1wiPT10eXBlb2YgYVtpXSYmKG5bZS5jYW1lbENhc2UoaSldPWFbaV0pO2Vsc2UgZm9yKGkgaW4gYSlcInN0cmluZ1wiPT10eXBlb2YgYVtpXSYmKG5baV09YVtpXSk7cmV0dXJuIG59ZnVuY3Rpb24gcyh0LGkpe3ZhciBzLGEscj17fTtmb3IocyBpbiBpKWE9aVtzXSx0W3NdIT09YSYmKG5bc118fChlLmZ4LnN0ZXBbc118fCFpc05hTihwYXJzZUZsb2F0KGEpKSkmJihyW3NdPWEpKTtyZXR1cm4gcn12YXIgYT1bXCJhZGRcIixcInJlbW92ZVwiLFwidG9nZ2xlXCJdLG49e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2UuZWFjaChbXCJib3JkZXJMZWZ0U3R5bGVcIixcImJvcmRlclJpZ2h0U3R5bGVcIixcImJvcmRlckJvdHRvbVN0eWxlXCIsXCJib3JkZXJUb3BTdHlsZVwiXSxmdW5jdGlvbih0LGkpe2UuZnguc3RlcFtpXT1mdW5jdGlvbihlKXsoXCJub25lXCIhPT1lLmVuZCYmIWUuc2V0QXR0cnx8MT09PWUucG9zJiYhZS5zZXRBdHRyKSYmKGpRdWVyeS5zdHlsZShlLmVsZW0saSxlLmVuZCksZS5zZXRBdHRyPSEwKX19KSxlLmZuLmFkZEJhY2t8fChlLmZuLmFkZEJhY2s9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuYWRkKG51bGw9PWU/dGhpcy5wcmV2T2JqZWN0OnRoaXMucHJldk9iamVjdC5maWx0ZXIoZSkpfSksZS5lZmZlY3RzLmFuaW1hdGVDbGFzcz1mdW5jdGlvbih0LG4scixvKXt2YXIgaD1lLnNwZWVkKG4scixvKTtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBuLHI9ZSh0aGlzKSxvPXIuYXR0cihcImNsYXNzXCIpfHxcIlwiLGw9aC5jaGlsZHJlbj9yLmZpbmQoXCIqXCIpLmFkZEJhY2soKTpyO2w9bC5tYXAoZnVuY3Rpb24oKXt2YXIgdD1lKHRoaXMpO3JldHVybntlbDp0LHN0YXJ0OmkodGhpcyl9fSksbj1mdW5jdGlvbigpe2UuZWFjaChhLGZ1bmN0aW9uKGUsaSl7dFtpXSYmcltpK1wiQ2xhc3NcIl0odFtpXSl9KX0sbigpLGw9bC5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbmQ9aSh0aGlzLmVsWzBdKSx0aGlzLmRpZmY9cyh0aGlzLnN0YXJ0LHRoaXMuZW5kKSx0aGlzfSksci5hdHRyKFwiY2xhc3NcIixvKSxsPWwubWFwKGZ1bmN0aW9uKCl7dmFyIHQ9dGhpcyxpPWUuRGVmZXJyZWQoKSxzPWUuZXh0ZW5kKHt9LGgse3F1ZXVlOiExLGNvbXBsZXRlOmZ1bmN0aW9uKCl7aS5yZXNvbHZlKHQpfX0pO3JldHVybiB0aGlzLmVsLmFuaW1hdGUodGhpcy5kaWZmLHMpLGkucHJvbWlzZSgpfSksZS53aGVuLmFwcGx5KGUsbC5nZXQoKSkuZG9uZShmdW5jdGlvbigpe24oKSxlLmVhY2goYXJndW1lbnRzLGZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5lbDtlLmVhY2godGhpcy5kaWZmLGZ1bmN0aW9uKGUpe3QuY3NzKGUsXCJcIil9KX0pLGguY29tcGxldGUuY2FsbChyWzBdKX0pfSl9LGUuZm4uZXh0ZW5kKHthZGRDbGFzczpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSxzLGEsbil7cmV0dXJuIHM/ZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMse2FkZDppfSxzLGEsbik6dC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fShlLmZuLmFkZENsYXNzKSxyZW1vdmVDbGFzczpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oaSxzLGEsbil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg+MT9lLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyx7cmVtb3ZlOml9LHMsYSxuKTp0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX19KGUuZm4ucmVtb3ZlQ2xhc3MpLHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGkpe3JldHVybiBmdW5jdGlvbihzLGEsbixyLG8pe3JldHVyblwiYm9vbGVhblwiPT10eXBlb2YgYXx8YT09PXQ/bj9lLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyxhP3thZGQ6c306e3JlbW92ZTpzfSxuLHIsbyk6aS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5jYWxsKHRoaXMse3RvZ2dsZTpzfSxhLG4scil9fShlLmZuLnRvZ2dsZUNsYXNzKSxzd2l0Y2hDbGFzczpmdW5jdGlvbih0LGkscyxhLG4pe3JldHVybiBlLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmNhbGwodGhpcyx7YWRkOmkscmVtb3ZlOnR9LHMsYSxuKX19KX0oKSxmdW5jdGlvbigpe2Z1bmN0aW9uIHModCxpLHMsYSl7cmV0dXJuIGUuaXNQbGFpbk9iamVjdCh0KSYmKGk9dCx0PXQuZWZmZWN0KSx0PXtlZmZlY3Q6dH0sbnVsbD09aSYmKGk9e30pLGUuaXNGdW5jdGlvbihpKSYmKGE9aSxzPW51bGwsaT17fSksKFwibnVtYmVyXCI9PXR5cGVvZiBpfHxlLmZ4LnNwZWVkc1tpXSkmJihhPXMscz1pLGk9e30pLGUuaXNGdW5jdGlvbihzKSYmKGE9cyxzPW51bGwpLGkmJmUuZXh0ZW5kKHQsaSkscz1zfHxpLmR1cmF0aW9uLHQuZHVyYXRpb249ZS5meC5vZmY/MDpcIm51bWJlclwiPT10eXBlb2Ygcz9zOnMgaW4gZS5meC5zcGVlZHM/ZS5meC5zcGVlZHNbc106ZS5meC5zcGVlZHMuX2RlZmF1bHQsdC5jb21wbGV0ZT1hfHxpLmNvbXBsZXRlLHR9ZnVuY3Rpb24gYSh0KXtyZXR1cm4hdHx8XCJudW1iZXJcIj09dHlwZW9mIHR8fGUuZnguc3BlZWRzW3RdPyEwOlwic3RyaW5nXCIhPXR5cGVvZiB0fHxlLmVmZmVjdHMuZWZmZWN0W3RdP2UuaXNGdW5jdGlvbih0KT8hMDpcIm9iamVjdFwiIT10eXBlb2YgdHx8dC5lZmZlY3Q/ITE6ITA6ITB9ZS5leHRlbmQoZS5lZmZlY3RzLHt2ZXJzaW9uOlwiMS4xMC4zXCIsc2F2ZTpmdW5jdGlvbihlLHQpe2Zvcih2YXIgcz0wO3QubGVuZ3RoPnM7cysrKW51bGwhPT10W3NdJiZlLmRhdGEoaSt0W3NdLGVbMF0uc3R5bGVbdFtzXV0pfSxyZXN0b3JlOmZ1bmN0aW9uKGUscyl7dmFyIGEsbjtmb3Iobj0wO3MubGVuZ3RoPm47bisrKW51bGwhPT1zW25dJiYoYT1lLmRhdGEoaStzW25dKSxhPT09dCYmKGE9XCJcIiksZS5jc3Moc1tuXSxhKSl9LHNldE1vZGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm5cInRvZ2dsZVwiPT09dCYmKHQ9ZS5pcyhcIjpoaWRkZW5cIik/XCJzaG93XCI6XCJoaWRlXCIpLHR9LGdldEJhc2VsaW5lOmZ1bmN0aW9uKGUsdCl7dmFyIGkscztzd2l0Y2goZVswXSl7Y2FzZVwidG9wXCI6aT0wO2JyZWFrO2Nhc2VcIm1pZGRsZVwiOmk9LjU7YnJlYWs7Y2FzZVwiYm90dG9tXCI6aT0xO2JyZWFrO2RlZmF1bHQ6aT1lWzBdL3QuaGVpZ2h0fXN3aXRjaChlWzFdKXtjYXNlXCJsZWZ0XCI6cz0wO2JyZWFrO2Nhc2VcImNlbnRlclwiOnM9LjU7YnJlYWs7Y2FzZVwicmlnaHRcIjpzPTE7YnJlYWs7ZGVmYXVsdDpzPWVbMV0vdC53aWR0aH1yZXR1cm57eDpzLHk6aX19LGNyZWF0ZVdyYXBwZXI6ZnVuY3Rpb24odCl7aWYodC5wYXJlbnQoKS5pcyhcIi51aS1lZmZlY3RzLXdyYXBwZXJcIikpcmV0dXJuIHQucGFyZW50KCk7dmFyIGk9e3dpZHRoOnQub3V0ZXJXaWR0aCghMCksaGVpZ2h0OnQub3V0ZXJIZWlnaHQoITApLFwiZmxvYXRcIjp0LmNzcyhcImZsb2F0XCIpfSxzPWUoXCI8ZGl2PjwvZGl2PlwiKS5hZGRDbGFzcyhcInVpLWVmZmVjdHMtd3JhcHBlclwiKS5jc3Moe2ZvbnRTaXplOlwiMTAwJVwiLGJhY2tncm91bmQ6XCJ0cmFuc3BhcmVudFwiLGJvcmRlcjpcIm5vbmVcIixtYXJnaW46MCxwYWRkaW5nOjB9KSxhPXt3aWR0aDp0LndpZHRoKCksaGVpZ2h0OnQuaGVpZ2h0KCl9LG49ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDt0cnl7bi5pZH1jYXRjaChyKXtuPWRvY3VtZW50LmJvZHl9cmV0dXJuIHQud3JhcChzKSwodFswXT09PW58fGUuY29udGFpbnModFswXSxuKSkmJmUobikuZm9jdXMoKSxzPXQucGFyZW50KCksXCJzdGF0aWNcIj09PXQuY3NzKFwicG9zaXRpb25cIik/KHMuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCJ9KSx0LmNzcyh7cG9zaXRpb246XCJyZWxhdGl2ZVwifSkpOihlLmV4dGVuZChpLHtwb3NpdGlvbjp0LmNzcyhcInBvc2l0aW9uXCIpLHpJbmRleDp0LmNzcyhcInotaW5kZXhcIil9KSxlLmVhY2goW1widG9wXCIsXCJsZWZ0XCIsXCJib3R0b21cIixcInJpZ2h0XCJdLGZ1bmN0aW9uKGUscyl7aVtzXT10LmNzcyhzKSxpc05hTihwYXJzZUludChpW3NdLDEwKSkmJihpW3NdPVwiYXV0b1wiKX0pLHQuY3NzKHtwb3NpdGlvbjpcInJlbGF0aXZlXCIsdG9wOjAsbGVmdDowLHJpZ2h0OlwiYXV0b1wiLGJvdHRvbTpcImF1dG9cIn0pKSx0LmNzcyhhKSxzLmNzcyhpKS5zaG93KCl9LHJlbW92ZVdyYXBwZXI6ZnVuY3Rpb24odCl7dmFyIGk9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtyZXR1cm4gdC5wYXJlbnQoKS5pcyhcIi51aS1lZmZlY3RzLXdyYXBwZXJcIikmJih0LnBhcmVudCgpLnJlcGxhY2VXaXRoKHQpLCh0WzBdPT09aXx8ZS5jb250YWlucyh0WzBdLGkpKSYmZShpKS5mb2N1cygpKSx0fSxzZXRUcmFuc2l0aW9uOmZ1bmN0aW9uKHQsaSxzLGEpe3JldHVybiBhPWF8fHt9LGUuZWFjaChpLGZ1bmN0aW9uKGUsaSl7dmFyIG49dC5jc3NVbml0KGkpO25bMF0+MCYmKGFbaV09blswXSpzK25bMV0pfSksYX19KSxlLmZuLmV4dGVuZCh7ZWZmZWN0OmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtmdW5jdGlvbiBzKCl7ZS5pc0Z1bmN0aW9uKG4pJiZuLmNhbGwoYVswXSksZS5pc0Z1bmN0aW9uKHQpJiZ0KCl9dmFyIGE9ZSh0aGlzKSxuPWkuY29tcGxldGUsbz1pLm1vZGU7KGEuaXMoXCI6aGlkZGVuXCIpP1wiaGlkZVwiPT09bzpcInNob3dcIj09PW8pPyhhW29dKCkscygpKTpyLmNhbGwoYVswXSxpLHMpfXZhciBpPXMuYXBwbHkodGhpcyxhcmd1bWVudHMpLGE9aS5tb2RlLG49aS5xdWV1ZSxyPWUuZWZmZWN0cy5lZmZlY3RbaS5lZmZlY3RdO3JldHVybiBlLmZ4Lm9mZnx8IXI/YT90aGlzW2FdKGkuZHVyYXRpb24saS5jb21wbGV0ZSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7aS5jb21wbGV0ZSYmaS5jb21wbGV0ZS5jYWxsKHRoaXMpfSk6bj09PSExP3RoaXMuZWFjaCh0KTp0aGlzLnF1ZXVlKG58fFwiZnhcIix0KX0sc2hvdzpmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7aWYoYSh0KSlyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIGk9cy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIGkubW9kZT1cInNob3dcIix0aGlzLmVmZmVjdC5jYWxsKHRoaXMsaSl9fShlLmZuLnNob3cpLGhpZGU6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe2lmKGEodCkpcmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO3ZhciBpPXMuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBpLm1vZGU9XCJoaWRlXCIsdGhpcy5lZmZlY3QuY2FsbCh0aGlzLGkpfX0oZS5mbi5oaWRlKSx0b2dnbGU6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe2lmKGEodCl8fFwiYm9vbGVhblwiPT10eXBlb2YgdClyZXR1cm4gZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIGk9cy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIGkubW9kZT1cInRvZ2dsZVwiLHRoaXMuZWZmZWN0LmNhbGwodGhpcyxpKX19KGUuZm4udG9nZ2xlKSxjc3NVbml0OmZ1bmN0aW9uKHQpe3ZhciBpPXRoaXMuY3NzKHQpLHM9W107cmV0dXJuIGUuZWFjaChbXCJlbVwiLFwicHhcIixcIiVcIixcInB0XCJdLGZ1bmN0aW9uKGUsdCl7aS5pbmRleE9mKHQpPjAmJihzPVtwYXJzZUZsb2F0KGkpLHRdKX0pLHN9fSl9KCksZnVuY3Rpb24oKXt2YXIgdD17fTtlLmVhY2goW1wiUXVhZFwiLFwiQ3ViaWNcIixcIlF1YXJ0XCIsXCJRdWludFwiLFwiRXhwb1wiXSxmdW5jdGlvbihlLGkpe3RbaV09ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGgucG93KHQsZSsyKX19KSxlLmV4dGVuZCh0LHtTaW5lOmZ1bmN0aW9uKGUpe3JldHVybiAxLU1hdGguY29zKGUqTWF0aC5QSS8yKX0sQ2lyYzpmdW5jdGlvbihlKXtyZXR1cm4gMS1NYXRoLnNxcnQoMS1lKmUpfSxFbGFzdGljOmZ1bmN0aW9uKGUpe3JldHVybiAwPT09ZXx8MT09PWU/ZTotTWF0aC5wb3coMiw4KihlLTEpKSpNYXRoLnNpbigoODAqKGUtMSktNy41KSpNYXRoLlBJLzE1KX0sQmFjazpmdW5jdGlvbihlKXtyZXR1cm4gZSplKigzKmUtMil9LEJvdW5jZTpmdW5jdGlvbihlKXtmb3IodmFyIHQsaT00OygodD1NYXRoLnBvdygyLC0taSkpLTEpLzExPmU7KTtyZXR1cm4gMS9NYXRoLnBvdyg0LDMtaSktNy41NjI1Kk1hdGgucG93KCgzKnQtMikvMjItZSwyKX19KSxlLmVhY2godCxmdW5jdGlvbih0LGkpe2UuZWFzaW5nW1wiZWFzZUluXCIrdF09aSxlLmVhc2luZ1tcImVhc2VPdXRcIit0XT1mdW5jdGlvbihlKXtyZXR1cm4gMS1pKDEtZSl9LGUuZWFzaW5nW1wiZWFzZUluT3V0XCIrdF09ZnVuY3Rpb24oZSl7cmV0dXJuLjU+ZT9pKDIqZSkvMjoxLWkoLTIqZSsyKS8yfX0pfSgpfSkoalF1ZXJ5KTsoZnVuY3Rpb24oZSl7ZS5lZmZlY3RzLmVmZmVjdC5oaWdobGlnaHQ9ZnVuY3Rpb24odCxpKXt2YXIgcz1lKHRoaXMpLGE9W1wiYmFja2dyb3VuZEltYWdlXCIsXCJiYWNrZ3JvdW5kQ29sb3JcIixcIm9wYWNpdHlcIl0sbj1lLmVmZmVjdHMuc2V0TW9kZShzLHQubW9kZXx8XCJzaG93XCIpLHI9e2JhY2tncm91bmRDb2xvcjpzLmNzcyhcImJhY2tncm91bmRDb2xvclwiKX07XCJoaWRlXCI9PT1uJiYoci5vcGFjaXR5PTApLGUuZWZmZWN0cy5zYXZlKHMsYSkscy5zaG93KCkuY3NzKHtiYWNrZ3JvdW5kSW1hZ2U6XCJub25lXCIsYmFja2dyb3VuZENvbG9yOnQuY29sb3J8fFwiI2ZmZmY5OVwifSkuYW5pbWF0ZShyLHtxdWV1ZTohMSxkdXJhdGlvbjp0LmR1cmF0aW9uLGVhc2luZzp0LmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe1wiaGlkZVwiPT09biYmcy5oaWRlKCksZS5lZmZlY3RzLnJlc3RvcmUocyxhKSxpKCl9fSl9fSkoalF1ZXJ5KTsiLCIvLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xuLy8gI0NIQU5HRUxJU1QjXG4vKiBnbG9iYWwgQ01TLCB0cmVlX2NvbXBvbmVudCAqL1xuXG4oZnVuY3Rpb24gKCQpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy8gQ01TLiQgd2lsbCBiZSBwYXNzZWQgZm9yICRcbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgLyohXG4gICAgICAgICAqIFRyZWVNYW5hZ2VyXG4gICAgICAgICAqIEhhbmRsZXMgdHJlZXZpZXdcbiAgICAgICAgICogVE9ETyB0aGlzIHdpbGwgYmUgcmVmYWN0b3JlZCBpbiAzLjJcbiAgICAgICAgICovXG4gICAgICAgIENNUy5UcmVlTWFuYWdlciA9IG5ldyBDTVMuQ2xhc3Moe1xuXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgJ2xhbmcnOiB7fVxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcblxuICAgICAgICAgICAgICAgIC8vIGxvYWQgaW50ZXJuYWwgZnVuY3Rpb25zXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2V0dGluZ3MuZmlsdGVyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cEZ1bmN0aW9ucygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHVwVHJlZVB1Ymxpc2hpbmcoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cFVJSGFja3MoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cEdsb2JhbHMoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR1cFRyZWUoKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpbml0IHRyZWUgY29tcG9uZW50XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5pbml0VHJlZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gZmlsdGVyZWQgaXMgYWN0aXZlLCBwcmV2ZW50IHRyZWUgYWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHVwRnVuY3Rpb25zKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dXBVSUhhY2tzKCk7XG4gICAgICAgICAgICAgICAgICAgICQuc3luY0NvbHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBzZXR1cEZ1bmN0aW9uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcblxuICAgICAgICAgICAgICAgICQuc3luY0NvbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtc29mdHJvb3QnKS5zeW5jV2lkdGgoMCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtYXBwaG9vaycpLnN5bmNXaWR0aCgwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpdGVtYXAgLmNvbC1sYW5ndWFnZScpLnN5bmNXaWR0aCgwKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpdGVtYXAgLmNvbC1uYXZpZ2F0aW9uJykuc3luY1dpZHRoKDApO1xuICAgICAgICAgICAgICAgICAgICAkKCcjc2l0ZW1hcCAuY29sLWFjdGlvbnMnKS5zeW5jV2lkdGgoMCk7XG4gICAgICAgICAgICAgICAgICAgICQoJyNzaXRlbWFwIC5jb2wtaW5mbycpLnN5bmNXaWR0aCgwKTtcblxuICAgICAgICAgICAgICAgICAgICB0aGF0LnJlZnJlc2hDb2x1bW5zLmNhbGwoJCgndWwudHJlZS1kZWZhdWx0IGxpJykpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKiBDb2x1bXMgd2lkdGggc3luYyAqL1xuICAgICAgICAgICAgICAgICQuZm4uc3luY1dpZHRoID0gZnVuY3Rpb24gKG1heCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSAkKHRoaXMpLndpZHRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA+IG1heCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXggPSB2YWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZpc2libGUgJiYgbWF4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnd2lkdGgnLCBtYXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8ganF1ZXJ5LmZ1bmN0aW9uYWxcbiAgICAgICAgICAgICAgICAkLmN1cnJ5ID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciBhcmdzID0gJC5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxLCBhcmd1bWVudHMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmdzLmNvbmNhdCgkLm1ha2VBcnJheShhcmd1bWVudHMpKSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICQuX19jYWxsYmFja1Bvb2wgPSB7fTtcblxuICAgICAgICAgICAgICAgICQuY2FsbGJhY2tSZWdpc3RlciA9IGZ1bmN0aW9uIChuYW1lLCBmbiAvKiwgYXJnMCwgYXJnMSwgLi4qLykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBjdXJyaWVkIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBmbiA9ICQuY3VycnkuYXBwbHkodGhpcywgJC5tYWtlQXJyYXkoYXJndW1lbnRzKS5zbGljZSgxLCBhcmd1bWVudHMubGVuZ3RoKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJC5fX2NhbGxiYWNrUG9vbFtuYW1lXSA9IGZuO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgJC5jYWxsYmFja0NhbGwgPSBmdW5jdGlvbiAobmFtZS8qLCBleHRyYSBhcmcwLCBleHRyYSBhcmcxLCAuLiovKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbmFtZSB8fCAhKG5hbWUgaW4gJC5fX2NhbGxiYWNrUG9vbCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93ICdObyBjYWxsYmFjayByZWdpc3RlcmVkIHdpdGggbmFtZTogJyArIG5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJC5fX2NhbGxiYWNrUG9vbFtuYW1lXS5hcHBseSh0aGlzLCAkLm1ha2VBcnJheShhcmd1bWVudHMpLnNsaWNlKDEsIGFyZ3VtZW50cy5sZW5ndGgpKTtcbiAgICAgICAgICAgICAgICAgICAgJC5jYWxsYmFja1JlbW92ZShuYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICQuY2FsbGJhY2tSZW1vdmUgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgJC5fX2NhbGxiYWNrUG9vbFtuYW1lXTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gdmVyeSBzaW1wbGUgeWVsbG93IGZhZGUgcGx1Z2luLi5cbiAgICAgICAgICAgICAgICAkLmZuLnlmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lZmZlY3QoJ2hpZ2hsaWdodCcsIHt9LCAxMDAwKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8ganF1ZXJ5IHJlcGxhY2UgcGx1Z2luIDopXG4gICAgICAgICAgICAgICAgJC5mbi5yZXBsYWNlID0gZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWZ0ZXIobykucmVtb3ZlKCkuZW5kKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2V0dXBUcmVlUHVibGlzaGluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIEFERCBESVJFQ1QgUFVCTElTSElOR1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgdHJlZSA9ICQoJy50cmVlJyk7XG4gICAgICAgICAgICAgICAgdmFyIGxhbmdUcmlnZ2VyID0gJy5jb2wtbGFuZ3VhZ2UgLnRyaWdnZXItdG9vbHRpcCBzcGFuJztcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1Rvb2x0aXBzID0gJy5sYW5ndWFnZS10b29sdGlwJztcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ1RpbWVyID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgdmFyIGxhbmdEZWxheSA9IDEwMDtcbiAgICAgICAgICAgICAgICB2YXIgbGFuZ0ZhZGVEdXJhdGlvbiA9IDIwMDtcbiAgICAgICAgICAgICAgICAvLyB3b3JrYXJvdW5kIGZvciB0aGUgcHVibGlzaGluZyB0b29sdGlwIG9uIHRvdWNoIGRldmljZXNcbiAgICAgICAgICAgICAgICB2YXIgdG91Y2hVc2VkTm9kZTtcblxuICAgICAgICAgICAgICAgIC8vIHNob3cgdGhlIHRvb2x0aXBcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGxhbmdUcmlnZ2VyLCAncG9pbnRlcm92ZXIgdG91Y2hzdGFydCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBlbCA9ICQodGhpcykuY2xvc2VzdCgnLmNvbC1sYW5ndWFnZScpLmZpbmQoJy5sYW5ndWFnZS10b29sdGlwJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhbmNob3JzID0gZWwuZmluZCgnYScpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3BhbiA9ICQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxhbmdUaW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIGlmIHRvb2x0aXAgYWxyZWFkeSB2aXNpYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbC5pcygnOnZpc2libGUnKSAmJiAhdG91Y2hVc2VkTm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGNvcnJlY3QgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgZWwuY3NzKCdyaWdodCcsIDIwICsgJCh0aGlzKS5wb3NpdGlvbigpLmxlZnQpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGZpZ3VyZSBvdXQgd2hhdCBzaG91bGQgYmUgc2hvd25cbiAgICAgICAgICAgICAgICAgICAgYW5jaG9ycy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGFuLmhhc0NsYXNzKCd1bnB1Ymxpc2hlZCcpIHx8IHNwYW4uaGFzQ2xhc3MoJ3VucHVibGlzaGVkcGFyZW50JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcnMuZXEoMSkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChzcGFuLmhhc0NsYXNzKCdwdWJsaXNoZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9ycy5lcSgwKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNwYW4uaGFzQ2xhc3MoJ2RpcnR5JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcnMuc2hvdygpLnBhcmVudCgpLmFkZENsYXNzKCdsYW5ndWFnZS10b29sdGlwLW11bHRpcGxlJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIGFsbCBlbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICAkKGxhbmdUb29sdGlwcykuZmFkZU91dChsYW5nRGVsYXkpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdG91Y2hVc2VkTm9kZSA9IHRvdWNoVXNlZE5vZGUgPT09IGUudGFyZ2V0ID8gZmFsc2UgOiBlLnRhcmdldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3VjaFVzZWROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIGEgdGltZW91dCB0byBkaXNwbGF5IHRoZSB0b29sdGlwXG4gICAgICAgICAgICAgICAgICAgIGxhbmdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWwuc3RvcCh0cnVlLCB0cnVlKS5mYWRlSW4obGFuZ0ZhZGVEdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH0sIGxhbmdEZWxheSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gaGlkZSB0aGUgdG9vbHRpcCB3aGVuIGxlYXZpbmcgdGhlIGFyZWFcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKGxhbmdUcmlnZ2VyLCAncG9pbnRlcm91dCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdWNoVXNlZE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciB0aW1lclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobGFuZ1RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaGlkZSBhbGwgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgbGFuZ1RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKGxhbmdUb29sdGlwcykuZmFkZU91dChsYW5nRmFkZUR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgbGFuZ0RlbGF5ICogMik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy8gcmVzZXQgaGlkaW5nIHdoZW4gZW50ZXJpbmcgdGhlIHRvb2x0aXAgaXRzZWxmXG4gICAgICAgICAgICAgICAgdHJlZS5kZWxlZ2F0ZShsYW5nVG9vbHRpcHMsICdwb2ludGVyb3ZlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYXIgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxhbmdUaW1lcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdHJlZS5kZWxlZ2F0ZShsYW5nVG9vbHRpcHMsICdwb2ludGVyb3V0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBoaWRlIGFsbCBlbGVtZW50c1xuICAgICAgICAgICAgICAgICAgICBsYW5nVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQobGFuZ1Rvb2x0aXBzKS5mYWRlT3V0KGxhbmdGYWRlRHVyYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9LCBsYW5nRGVsYXkgKiAyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBhdHRhY2ggZG91YmxlIGNoZWNrIGV2ZW50IGlmIHB1Ymxpc2ggb3IgdW5wdWJsaXNoIHNob3VsZCBiZSB0cmlnZ2VyZWRcbiAgICAgICAgICAgICAgICB0cmVlLmRlbGVnYXRlKCcubGFuZ3VhZ2UtdG9vbHRpcCBhJywgJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCBpZiBub3QgY29uZmlybWVkXG4gICAgICAgICAgICAgICAgICAgIGlmICghY29uZmlybSh0aGF0Lm9wdGlvbnMubGFuZy5wdWJsaXNoLnJlcGxhY2UoJ8KnJywgJCh0aGlzKS50ZXh0KCkudG9Mb3dlckNhc2UoKSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBzZW5kIHBvc3QgcmVxdWVzdCB0byBwcmV2ZW50IHhzcyBhdHRhY2tzXG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncG9zdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICQodGhpcykucHJvcCgnaHJlZicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENNUy5BUEkuSGVscGVycy5yZWxvYWRCcm93c2VyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcXVlc3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldHVwVUlIYWNrczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIGVuYWJsZXMgdGFiIGNsaWNrIG9uIHRpdGxlIGVudHJ5IHRvIG9wZW4gaW4gbmV3IHdpbmRvd1xuICAgICAgICAgICAgICAgICQoJy50cmVlJykub24oJ2NsaWNrJywgJy5jb2wxIC50aXRsZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZS5tZXRhS2V5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudG9wLmxvY2F0aW9uLmhyZWYgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKCQodGhpcykuYXR0cignaHJlZicpLCAnX2JsYW5rJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIGFkZHMgZnVuY3Rpb25hbGl0eSB0byB0aGUgZmlsdGVyXG4gICAgICAgICAgICAgICAgJCgnI2NoYW5nZWxpc3QtZmlsdGVyLWJ1dHRvbicpLmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjY2hhbmdlbGlzdC1maWx0ZXInKS50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNldCBjb3JyZWN0IGFjdGl2ZSBlbnRyeVxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cucGFyZW50ICYmIHdpbmRvdy5wYXJlbnQuQ01TICYmIHdpbmRvdy5wYXJlbnQuQ01TLmNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcGFnZV9pZCA9IHdpbmRvdy5wYXJlbnQuQ01TLmNvbmZpZy5yZXF1ZXN0LnBhZ2VfaWQ7XG5cbiAgICAgICAgICAgICAgICAgICAgJCgnZGl2W2RhdGEtcGFnZV9pZD1cIicgKyBwYWdlX2lkICsgJ1wiXScpLmFkZENsYXNzKCdjb250LWFjdGl2ZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHNldHVwR2xvYmFsczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gJyc7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cubW92ZVN1Y2Nlc3MgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAkLnN5bmNDb2xzKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgbXNnID0gJCgnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+JyArIHRoYXQub3B0aW9ucy5sYW5nLnN1Y2Nlc3MgKyAnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSB3aW5kb3cucGFyZW50O1xuXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYWZ0ZXIobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQoKS5maW5kKCcuY29sMicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgbXNnLmZhZGVPdXQoMTAwMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5wYXJlbnQoKS5maW5kKCcuY29sMicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciByZWxvYWQgY2hhbmdlc1xuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LnNlbGYgIT09IHdpbmRvdy50b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQuQ01TLkFQSS5IZWxwZXJzLnJlbG9hZEJyb3dzZXIoZmFsc2UsIGZhbHNlLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wYXJlbnQuQ01TLkFQSS5Ub29sYmFyLm9wZW5NZXNzYWdlKHRoYXQub3B0aW9ucy5sYW5nLmNoYW5nZXMsIGZhbHNlLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cubW92ZUVycm9yID0gZnVuY3Rpb24gKG5vZGUsIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZSAhPT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gJCgnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+JyArIG1lc3NhZ2UgKyAnPC9zcGFuPicpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbXNnID0gJCgnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+JyArIHRoYXQub3B0aW9ucy5sYW5nLmVycm9yICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBub2RlLnBhcmVudCgpLmZpbmQoJy5jb2wyJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICBub2RlLmFmdGVyKG1zZyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgc2V0dXBUcmVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICAgICAgICAgIHZhciB0cmVlO1xuICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lICtcbiAgICAgICAgICAgICAgICAgICAgKHdpbmRvdy5sb2NhdGlvbi5wb3J0ID8gJzonICsgd2luZG93LmxvY2F0aW9uLnBvcnQgOiAnJyk7XG4gICAgICAgICAgICAgICAgLy8gZ2xvYmFsIGluaXRUcmVlIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgd2luZG93LmluaXRUcmVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBqc2hpbnQgbmV3Y2FwOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAvLyBqc2NzOmRpc2FibGUgcmVxdWlyZUNhcGl0YWxpemVkQ29uc3RydWN0b3JzXG4gICAgICAgICAgICAgICAgICAgIHRyZWUgPSBuZXcgdHJlZV9jb21wb25lbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8ganNjczplbmFibGUgcmVxdWlyZUNhcGl0YWxpemVkQ29uc3RydWN0b3JzXG4gICAgICAgICAgICAgICAgICAgIC8vIGpzaGludCBuZXdjYXA6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBydWxlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrYWJsZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVuYW1lYWJsZTogJ25vbmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0YWJsZTogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRhYmxlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6ICdhbGwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdydWxlczogJ2FsbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcHBhYmxlOiAnYWxsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YSA6ICdtZGF0YScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlX2lubGluZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZHJvcHBhYmxlIDogWyd0cmVlX2Ryb3AnXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhhcyB0byBiZSBhYnNvbHV0ZSBmdWxsIHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG9yaWdpbiArIHRoYXQub3B0aW9ucy5zZXR0aW5ncy5zdGF0aWNQYXRoICsgJ2Ntcy9qcy9qc3RyZWUvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVpOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG90czogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3Zlcl9tb2RlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhlbWVfcGF0aDogc2NyaXB0X3VybF9wYXRoKCkgKyAnLy4uL2pzdHJlZS90aGVtZXMvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhX2NsYXNzOiAndGl0bGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcyA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXg6ICdkamFuZ29jbXNfbm9kZXMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2s6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVtb3ZlICA6IGZ1bmN0aW9uICh3aGF0LCB3aGVyZSwgcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lml0ZW1faWQgPSB3aGF0LmlkLnNwbGl0KCdwYWdlXycpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0X2lkID0gd2hlcmUuaWQuc3BsaXQoJ3BhZ2VfJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRfbm9kZSA9IHdoYXQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQod2hhdCkucGFyZW50KCkuY2hpbGRyZW4oJ2xpJykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQod2hhdCkubmV4dCgnbGknKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX3RhcmdldCA9ICQod2hhdCkubmV4dCgnbGknKVswXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX3Bvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHdoYXQpLnByZXYoJ2xpJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF90YXJnZXQgPSAkKHdoYXQpLnByZXYoJ2xpJylbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF9wb3NpdGlvbiA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKHdoYXQpLmF0dHIoJ3JlbCcpICE9PSAndG9wbm9kZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub2xkX3RhcmdldCA9ICQod2hhdCkucGFyZW50KCkucGFyZW50KClbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9sZF9wb3NpdGlvbiA9ICdpbnNpZGUnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVW5kbyh3aGF0LCB3aGVyZSwgcG9zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ubW92ZTogZnVuY3Rpb24gKHdoYXQsIHdoZXJlLCBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaXRlbV9pZCA9IHdoYXQuaWQuc3BsaXQoJ3BhZ2VfJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy50YXJnZXRfaWQgPSB3aGVyZS5pZC5zcGxpdCgncGFnZV8nKVsxXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPT09ICdiZWZvcmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ2FmdGVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAncmlnaHQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAnaW5zaWRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAnbGFzdC1jaGlsZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZVRyZWVJdGVtKHdoYXQsIHdpbmRvdy5pdGVtX2lkLCB3aW5kb3cudGFyZ2V0X2lkLCBwb3NpdGlvbiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZUNhbGMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoISQoJCgnZGl2LnRyZWUnKS5nZXQoMCkpLmhhc0NsYXNzKCdyb290X2FsbG93X2NoaWxkcmVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc2Fsb3cgcG9zc2liaWxpdHkgZm9yIGFkZGluZyBzdWJub2RlcyB0byBtYWluIHRyZWUsIHVzZXIgZG9lc24ndFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSBwZXJtaXNzaW9ucyBmb3IgdGhpc1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5ydWxlcy5kcmFncnVsZXMgPSBbJ25vZGUgaW5zaWRlIHRvcG5vZGUnLCAndG9wbm9kZSBpbnNpZGUgdG9wbm9kZScsICdub2RlICogbm9kZSddO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdHJlZS5pbml0KCQoJ2Rpdi50cmVlJyksIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGFjdGlvbiA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgdmFyIF9vbGRBamF4ID0gJC5hamF4O1xuXG4gICAgICAgICAgICAgICAgJC5hamF4ID0gZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8ganVzdCBvdmVycmlkZSBhamF4IGZ1bmN0aW9uLCBzbyB0aGUgbG9hZGVyIG1lc3NhZ2UgZ2V0cyBkaXNwbGF5ZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gYWx3YXlzXG4gICAgICAgICAgICAgICAgICAgICQoJyNsb2FkZXItbWVzc2FnZScpLnNob3coKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSBzLnN1Y2Nlc3MgfHwgZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHMuc3VjY2VzcyA9IGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEsIHN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjbG9hZGVyLW1lc3NhZ2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgLy8ganVzdCBmb3IgZGVidWdpbmchIVxuICAgICAgICAgICAgICAgICAgICAvKnMuY29tcGxldGUgPSBmdW5jdGlvbiAoeGhyLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gJ2Vycm9yJyAmJiB0aGF0Lm9wdGlvbnMuc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykuYmVmb3JlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9Ki9cbiAgICAgICAgICAgICAgICAgICAgLy8gZW5kIGp1c3QgZm9yIGRlYnVnaW5nXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogYWRkIGVycm9yIHN0YXRlIVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX29sZEFqYXgocyk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIC8vIGRlZmluZWQgYnV0IG5ldmVyIHVzZWRcbiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbiByZWZyZXNoKCkge1xuICAgICAgICAgICAgICAgIC8vICAgICB3aW5kb3cubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICAgICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgICAgICAvLyAvLyBkZWZpbmVkIGJ1dCBuZXZlciB1c2VkXG4gICAgICAgICAgICAgICAgLy8gZnVuY3Rpb24gcmVmcmVzaElmQ2hpbGRyZW4ocGFnZUlkKSB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHJldHVybiAkKCcjcGFnZV8nICsgcGFnZUlkKS5maW5kKCdsaVtpZF49cGFnZV9dJykubGVuZ3RoID9cbiAgICAgICAgICAgICAgICAvLyAgICAgcmVmcmVzaCA6XG4gICAgICAgICAgICAgICAgLy8gICAgIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRydWU7IH07XG4gICAgICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogTG9hZHMgcmVtb3RlIGRpYWxvZyB0byBkaWFsb2dzIGRpdi5cbiAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmxcbiAgICAgICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBEYXRhIHRvIGJlIHNlbmQgb3ZlciBwb3N0XG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gbm9EaWFsb2dDYWxsYmFjayBHZXRzIGNhbGxlZCB3aGVuIHJlc3BvbnNlIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFN0YW5kYXJkIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGxvYWREaWFsb2codXJsLCBkYXRhLCBub0RpYWxvZ0NhbGxiYWNrLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJC5wb3N0KHVybCwgZGF0YSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgPT09ICcnICYmIG5vRGlhbG9nQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0RpYWxvZ0NhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjZGlhbG9ncycpLmVtcHR5KCkuYXBwZW5kKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbWFya19jb3B5X25vZGUoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnYS5tb3ZlLXRhcmdldCwgc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXIsIHNwYW4ubGluZScpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIGlkKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3BhZ2VfJyArIGlkKS5wYXJlbnQoKS5wYXJlbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKCdkaXYuY29udCcpLmZpbmQoJ2EubW92ZS10YXJnZXQuZmlyc3QtY2hpbGQsIHNwYW4uc2Vjb25kJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgaWQpLnBhcmVudCgpLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oJ3VsJykuY2hpbGRyZW4oJ2xpJykuY2hpbGRyZW4oJ2Rpdi5jb250JylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCdhLm1vdmUtdGFyZ2V0LmxlZnQsIGEubW92ZS10YXJnZXQucmlnaHQsIHNwYW4uZmlyc3QsIHNwYW4uc2Vjb25kJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2NvcHknO1xuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgLy8gbGV0J3Mgc3RhcnQgZXZlbnQgZGVsZWdhdGlvblxuICAgICAgICAgICAgICAgICQoJyNjaGFuZ2VsaXN0IGxpJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSSB3YW50IGEgbGluayB0byBjaGVjayB0aGUgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUgPT09ICdJTUcnIHx8IGUudGFyZ2V0LnRhZ05hbWUgPT09ICdTUEFOJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnRhcmdldCA9IGUudGFyZ2V0LnBhcmVudE5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIGp0YXJnZXQgPSAkKHdpbmRvdy50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlX2lkO1xuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnbW92ZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmVwYXJlIHRyZWUgZm9yIG1vdmUgLyBjdXQgcGFzdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gZS50YXJnZXQuaWQuc3BsaXQoJ21vdmUtbGluay0nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZCA9IGUudGFyZ2V0LnBhcmVudE5vZGUuaWQuc3BsaXQoJ21vdmUtbGluay0nKVsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VfaWQgPSBpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZWxlY3RlZF9wYWdlID0gcGFnZV9pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICdtb3ZlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ3NwYW4ubW92ZS10YXJnZXQtY29udGFpbmVyLCBzcGFuLmxpbmUsIGEubW92ZS10YXJnZXQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgcGFnZV9pZCkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZV8nICsgcGFnZV9pZCArICcgc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ2NvcHknKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlcGFyZSB0cmVlIGZvciBjb3B5XG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IGUudGFyZ2V0LmlkLnNwbGl0KCdjb3B5LWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQgPSBlLnRhcmdldC5wYXJlbnROb2RlLmlkLnNwbGl0KCdjb3B5LWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IGlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gbWFya19jb3B5X25vZGUoaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCd2aWV3cGFnZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmlld19wYWdlX3VybCA9ICQoJyMnICsgd2luZG93LnRhcmdldC5pZCArICctc2VsZWN0JykudmFsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlld19wYWdlX3VybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHZpZXdfcGFnZV91cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ2FkZGxpbmsnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEvIyQvZy50ZXN0KGp0YXJnZXQuYXR0cignaHJlZicpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIHVybCBpbnN0ZWFkIG9mICMgaW5zaWRlIGhyZWYsIGZvbGxvdyB0aGlzIHVybFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZWQgaWYgdXNlciBoYXZlcyBhZGRfcGFnZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCd0cicpLnJlbW92ZUNsYXNzKCd0YXJnZXQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNjaGFuZ2VsaXN0IHRhYmxlJykucmVtb3ZlQ2xhc3MoJ3RhYmxlLXNlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlX2lkID0gd2luZG93LnRhcmdldC5pZC5zcGxpdCgnYWRkLWxpbmstJylbMV07XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2VsZWN0ZWRfcGFnZSA9IHBhZ2VfaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb24gPSAnYWRkJztcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ3RyJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcGFnZS1yb3ctJyArIHBhZ2VfaWQpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vdmUtdGFyZ2V0LWNvbnRhaW5lcicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2EubW92ZS10YXJnZXQsIHNwYW4ubGluZSwgI21vdmUtdGFyZ2V0LScgKyBwYWdlX2lkKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgYXNzdW1lIGFkbWluIHNpdGUgaXMgcm9vdC1sZXZlbFxuICAgICAgICAgICAgICAgICAgICAvLyBncmFiIGJhc2UgdXJsIHRvIGNvbnN0cnVjdCBmdWxsIGFic29sdXRlIFVSTHNcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkbWluX2Jhc2VfdXJsID0gZG9jdW1lbnQuVVJMLnNwbGl0KCcvY21zL3BhZ2UvJylbMF0gKyAnLyc7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VJZDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhbmd1YWdlO1xuICAgICAgICAgICAgICAgICAgICAvLyBpbiBuYXZpZ2F0aW9uXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCduYXZpZ2F0aW9uLWNoZWNrYm94JykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VJZCA9IGp0YXJnZXQuYXR0cignbmFtZScpLnNwbGl0KCduYXZpZ2F0aW9uLScpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBqdGFyZ2V0LmNsb3Nlc3QoJy5jb250JykuZmluZCgnYVtsYW5nXScpLmF0dHIoJ2xhbmcnKSB8fCAnJztcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgSSBkb24ndCBwdXQgZGF0YSBpbiB0aGUgcG9zdCwgZGphbmdvIGRvZXNuJ3QgZ2V0IGl0XG4gICAgICAgICAgICAgICAgICAgICAgICByZWxvYWRJdGVtKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp0YXJnZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkbWluX2Jhc2VfdXJsICsgJ2Ntcy9wYWdlLycgKyBwYWdlSWQgKyAnL2NoYW5nZS1uYXZpZ2F0aW9uLz9sYW5ndWFnZT0nICsgbGFuZ3VhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAxOiAxIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBsYXp5IGxvYWQgZGVzY2VuZGFudHMgb24gdHJlZSBvcGVuXG4gICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdjbG9zZWQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25seSBsb2FkIHRoZW0gb25jZVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuZmluZCgndWwgPiBsaScpLmxlbmd0aCA9PT0gMCAmJiAhanRhcmdldC5oYXNDbGFzcygnbG9hZGluZycpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8ga2VlcHMgdGhpcyBldmVudCBmcm9tIGZpcmluZyBtdWx0aXBsZSB0aW1lcyBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZG9tIGFzIGNoYW5nZWQuIGl0IHN0aWxsIG5lZWRzIHRvIHByb3BhZ2F0ZSBmb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgb3RoZXIgY2xpY2sgZXZlbnQgb24gdGhpcyBlbGVtZW50IHRvIGZpcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZUlkID0gJChqdGFyZ2V0KS5hdHRyKCdpZCcpLnNwbGl0KCdwYWdlXycpWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlID0gJChqdGFyZ2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oJ2Rpdi5jb250JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKCdkaXYuY29sMScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbignLnRpdGxlJykuYXR0cignbGFuZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZ2V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRtaW5fYmFzZV91cmwgKyAnY21zL3BhZ2UvJyArIHBhZ2VJZCArICcvJyArIGxhbmd1YWdlICsgJy9kZXNjZW5kYW50cy8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGp0YXJnZXQuY2hpbGRyZW4oJ3VsJykuYXBwZW5kKHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2hvdyBtb3ZlIHRhcmdldHMgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJCgnc3Bhbi5tb3ZlLXRhcmdldC1jb250YWluZXI6dmlzaWJsZScpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqdGFyZ2V0LmNoaWxkcmVuKCd1bCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCdhLm1vdmUtdGFyZ2V0LCBzcGFuLm1vdmUtdGFyZ2V0LWNvbnRhaW5lciwgc3Bhbi5saW5lJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlQ2FsYygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVDYWxjKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoanRhcmdldC5oYXNDbGFzcygnbW92ZS10YXJnZXQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp0YXJnZXQuaGFzQ2xhc3MoJ2xlZnQnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wb3NpdGlvbiA9ICdsZWZ0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdyaWdodCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnBvc2l0aW9uID0gJ3JpZ2h0JztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqdGFyZ2V0Lmhhc0NsYXNzKCdsYXN0LWNoaWxkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cucG9zaXRpb24gPSAnbGFzdC1jaGlsZCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cudGFyZ2V0X2lkID0gd2luZG93LnRhcmdldC5wYXJlbnROb2RlLmlkLnNwbGl0KCdtb3ZlLXRhcmdldC0nKVsxXTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ21vdmUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZVRyZWVJdGVtKG51bGwsIHdpbmRvdy5zZWxlY3RlZF9wYWdlLCB3aW5kb3cudGFyZ2V0X2lkLCB3aW5kb3cucG9zaXRpb24sIHRyZWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2NvcHknKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNpdGUgPSAkKCcjc2l0ZS1zZWxlY3QnKVswXS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3B5VHJlZUl0ZW0od2luZG93LnNlbGVjdGVkX3BhZ2UsIHdpbmRvdy50YXJnZXRfaWQsIHdpbmRvdy5wb3NpdGlvbiwgd2luZG93LnNpdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb3ZlLXRhcmdldC1jb250YWluZXInKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PT0gJ2FkZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2l0ZSA9ICQoJyNzaXRlLXNlbGVjdCcpWzBdLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKVswXS5zcGxpdCgnIycpWzBdICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FkZC8/dGFyZ2V0PScgKyB3aW5kb3cudGFyZ2V0X2lkICsgJyZhbXA7cG9zaXRpb249JyArIHdpbmRvdy5wb3NpdGlvbiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmYW1wO3NpdGU9JyArIHdpbmRvdy5zaXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAkKCdkaXYjc2l0ZW1hcCcpLnNob3coKTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlQ2FsYygpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5zeW5jQ29scygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUnLCByZUNhbGMpO1xuICAgICAgICAgICAgICAgIC8qIFNpdGUgU2VsZWN0b3IgKi9cbiAgICAgICAgICAgICAgICAkKCcjc2l0ZS1zZWxlY3QnKS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm9ybSA9ICQodGhpcykuY2xvc2VzdCgnZm9ybScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgY29ycmVjdCB2YWx1ZSBmb3IgY29weVxuICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnY29weScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaXRlLWNvcHknKS52YWwod2luZG93LnNlbGVjdGVkX3BhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIHN1Ym1pdCBmb3JtXG4gICAgICAgICAgICAgICAgICAgIGZvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vIElmIGFuIEEgZWxlbWVudCBoYXMgYSBkYXRhLWF0dHJpYnV0ZSAnYWx0LWNsYXNzJy4gQXQgdGhpcyB0aW1lLFxuICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgb25seSB0aGUgZWRpdCBidXR0b24gaW4gdGhlIHBhZ2UtdHJlZSwgYnV0IGNvdWxkIGJlXG4gICAgICAgICAgICAgICAgLy8gbW9yZSBpbiBmdXR1cmUuIEl0IGlzIGltcG9ydGFudCB0aGF0IHRoZSBDU1MgYmUgd3JpdHRlbiBpbiBzdWNoXG4gICAgICAgICAgICAgICAgLy8gYSBtYW5uZXIgdGhhdCB0aGUgYWx0LWNsYXNzIGlzIGRlZmluZWQgYWZ0ZXIgdGhlIG5vcm1hbCBjbGFzcyxcbiAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IGl0IGNhbiBiZSBvdmVycmlkZGVuIHdoZW4gdGhlIGFsdC1rZXkgaXMgZGVwcmVzc2VkLlxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8gTk9URTogVGhpcyAncHJldmlldycgcGFydCBvZiB0aGUgJ2FsdC1jbGljayB0byBbYWx0ZXJuYXRpdmVcbiAgICAgICAgICAgICAgICAvLyBmdW5jdGlvbl0nIGZlYXR1cmUgbWF5IG5vdCB3b3JrIGluIHNvbWUgZW52aXJvbm1lbnRzIChXaW5kb3dzXG4gICAgICAgICAgICAgICAgLy8gaW4gYSBzb21lIHZpcnR1YWwgbWFjaGluZSBlbnZpcm9ubWVudHMsIG5vdGFibHkpLCBidXQgaXMgb25seSBhXG4gICAgICAgICAgICAgICAgLy8gbmljZS0nZXh0cmEnLCBub3QgYSByZXF1aXJlbWVudCBmb3IgdGhlIGZlYXR1cmUuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50KS5vbigna2V5ZG93biBrZXl1cCcsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2dC53aGljaCA9PT0gMTgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2FbZGF0YS1hbHQtY2xhc3NdJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGYgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudG9nZ2xlQ2xhc3Moc2VsZi5kYXRhKCdhbHQtY2xhc3MnKSwgZXZ0LnR5cGUgPT09ICdrZXlkb3duJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgQS1lbGVtZW50IGhhcyBhIGRhdGEtYXR0cmlidXRlICdhbHQtaHJlZicsIHRoZW4gdGhpc1xuICAgICAgICAgICAgICAgIC8vIGNsaWNrLWhhbmRsZXIgdXNlcyB0aGF0IGluc3RlYWQgb2YgdGhlIG5vcm1hbCBocmVmIGF0dHJpYnV0ZSBhc1xuICAgICAgICAgICAgICAgIC8vIHRoZSBjbGljay1kZXN0aW5hdGlvbi4gQWdhaW4sIGN1cnJlbnRseSB0aGlzIGlzIG9ubHkgb24gdGhlXG4gICAgICAgICAgICAgICAgLy8gZWRpdCBidXR0b24sIGJ1dCBjb3VsZCBiZSBtb3JlIGluIGZ1dHVyZS5cbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICQoJ2FbZGF0YS1hbHQtaHJlZl0nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBocmVmO1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2dC5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaHJlZiA9ICQodGhpcykuZGF0YSgnYWx0LWhyZWYnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhyZWYgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBocmVmO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNvcHlfc3BsaXRzID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJ2NvcHk9Jyk7XG4gICAgICAgICAgICAgICAgaWYgKGNvcHlfc3BsaXRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gY29weV9zcGxpdHNbMV0uc3BsaXQoJyYnKVswXTtcbiAgICAgICAgICAgICAgICAgICAgLy8ganNoaW50IGxhdGVkZWY6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3Rpb24gPSBtYXJrX2NvcHlfbm9kZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGpzaGludCBsYXRlZGVmOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZWxlY3RlZF9wYWdlID0gaWQ7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY29weVRyZWVJdGVtKGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHNpdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoYXQub3B0aW9ucy5zZXR0aW5ncy5wZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9hZERpYWxvZygnLi8nICsgaXRlbV9pZCArICcvZGlhbG9nL2NvcHkvJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldF9pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXRlOiBzaXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAkLmNhbGxiYWNrUmVnaXN0ZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdfY29weVRyZWVJdGVtJywgX2NvcHlUcmVlSXRlbSwgaXRlbV9pZCwgdGFyZ2V0X2lkLCBwb3NpdGlvbiwgc2l0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29weVRyZWVJdGVtKGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHNpdGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF9jb3B5VHJlZUl0ZW0oaXRlbV9pZCwgdGFyZ2V0X2lkLCBwb3NpdGlvbiwgc2l0ZSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0X2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2l0ZTogc2l0ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJC5leHRlbmQoZGF0YSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgICAgICAgICAgJC5wb3N0KCcuLycgKyBpdGVtX2lkICsgJy9jb3B5LXBhZ2UvJywgZGF0YSwgZnVuY3Rpb24gKGRlY29kZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IGRlY29kZWQuY29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBkZWNvZGVkLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbG9hZCB0cmVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubW92ZUVycm9yKCQoJyNwYWdlXycgKyBpdGVtX2lkICsgJyBkaXYuY29sMTplcSgwKScpLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIFJlbG9hZHMgdHJlZSBpdGVtIChvbmUgbGluZSkuIElmIHNvbWUgZmlsdGVyaW5nIGlzIGZvdW5kLCBhZGRzXG4gICAgICAgICAgICAgICAgICogZmlsdGVyZWQgdmFyaWFibGUgaW50byBwb3N0ZWQgZGF0YS5cbiAgICAgICAgICAgICAgICAgKlxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsIEFueSBjaGlsZCBlbGVtZW50IG9mIHRyZWUgaXRlbVxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwgUmVxdWVzdGVkIHVybFxuICAgICAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIE9wdGlvbmFsIHBvc3RlZCBkYXRhXG4gICAgICAgICAgICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgT3B0aW9uYWwgY2FsYmFjayBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbG9hZEl0ZW0oZWwsIHVybCwgZGF0YSwgY2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKC9cXC9cXD8vaWcudGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByb2JhYmx5IHNvbWUgZmlsdGVyIGhlcmUsIHRlbGwgYmFja2VuZCwgd2UgbmVlZCBhIGZpbHRlcmVkXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB2ZXJzaW9uIG9mIGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEuZml0bGVyZWQgPSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKHJlc3BvbnNlLCB0ZXh0U3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBjYWxsYmFjayhyZXNwb25zZSwgdGV4dFN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC9wYWdlX1xcZCsvLnRlc3QoJChlbCkuYXR0cignaWQnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25lIGxldmVsIGhpZ2hlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSAkKGVsKS5maW5kKCdkaXYuY29udDpmaXJzdCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCA9ICQoZWwpLnBhcmVudHMoJ2Rpdi5jb250OmZpcnN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRhcmdldC5wYXJlbnQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0aGUgZWxlbWVudCBpZiBzb21ldGhpbmcgd2VudCB3cm9uZ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gJ05vdEZvdW5kJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyZW50LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmlnaW4gPSAkKCcubWVzc2FnZWxpc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXQucmVwbGFjZShyZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSAkKHBhcmVudCkuZmluZCgnLm1lc3NhZ2VsaXN0Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW4ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzLmluc2VydEFmdGVyKCcuYnJlYWRjcnVtYnMnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmZpbmQoJ2Rpdi5jb250OmZpcnN0JykueWZ0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlbnN1cmUgYWZ0ZXIgcmVtb3ZhbCBldmVyeXRoaW5nIGlzIGFsaWduZWQgYWdhaW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF0YSc6IGRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogdXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N1Y2Nlc3MnOiBvblN1Y2Nlc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXJyb3JDYWxsYmFjayBpcyBwYXNzZWQgdGhyb3VnaCB0aGUgcmVsb2FkSXRlbSBmdW5jdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvckNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yQ2FsbGJhY2soWE1MSHR0cFJlcXVlc3QsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3hocic6ICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gbW92ZVRyZWVJdGVtKGp0YXJnZXQsIGl0ZW1faWQsIHRhcmdldF9pZCwgcG9zaXRpb24sIHRyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkSXRlbShcbiAgICAgICAgICAgICAgICAgICAgICAgIGp0YXJnZXQsICcuLycgKyBpdGVtX2lkICsgJy9tb3ZlLXBhZ2UvJyxcblxuICAgICAgICAgICAgICAgICAgICAgICAgeyBwb3NpdGlvbjogcG9zaXRpb24sIHRhcmdldDogdGFyZ2V0X2lkIH0sXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uIHN1Y2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkZWNvZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gZGVjb2RlZC5jb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBkZWNvZGVkLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0cmVlX3BvcyA9IHsgJ2xlZnQnOiAnYmVmb3JlJywgJ3JpZ2h0JzogJ2FmdGVyJyB9W3Bvc2l0aW9uXSB8fCAnaW5zaWRlJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyZWUubW92ZWQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyNwYWdlXycgKyBpdGVtX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNwYWdlXycgKyB0YXJnZXRfaWQgKyAnIGEudGl0bGUnKVswXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmVlX3BvcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3ZlU3VjY2VzcygkKCcjcGFnZV8nICsgaXRlbV9pZCArICcgZGl2LmNvbDE6ZXEoMCknKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3ZlRXJyb3IoJCgnI3BhZ2VfJyArIGl0ZW1faWQgKyAnIGRpdi5jb2wxOmVxKDApJyksIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgdW5kb3MgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZFVuZG8obm9kZSwgdGFyZ2V0LCBwb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICB1bmRvcy5wdXNoKHsgbm9kZTogbm9kZSwgdGFyZ2V0OiB0YXJnZXQsIHBvc2l0aW9uOiBwb3NpdGlvbiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICByZWZyZXNoQ29sdW1uczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICQoJ2Rpdi5jb2wyJykuY2hpbGRyZW4oJ2RpdicpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY3NzKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdmFyIG1pbl93aWR0aCA9IDEwMDAwMDtcbiAgICAgICAgICAgICAgICB2YXIgbWF4X2NvbDJfd2lkdGggPSAwO1xuICAgICAgICAgICAgICAgIHZhciBtYXhfY29sMiA9IG51bGw7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnQgPSAkKHRoaXMpLmNoaWxkcmVuKCdkaXYuY29udCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNvbnQuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgY29sMSA9IGNvbnQuY2hpbGRyZW4oJ2Rpdi5jb2wxJykuZmluZCgnLnRpdGxlIHNwYW4nKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbDIgPSBjb250LmNoaWxkcmVuKCdkaXYuY29sMicpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29sMV93aWR0aCA9IGNvbDEub3V0ZXJXaWR0aCh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbDJfd2lkdGggPSBjb2wyLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbF93aWR0aCA9IGNvbnQub3V0ZXJXaWR0aCh0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZGlmID0gdG90YWxfd2lkdGggLSBjb2wxX3dpZHRoO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlmIDwgbWluX3dpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5fd2lkdGggPSBkaWY7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbDJfd2lkdGggPiBtYXhfY29sMl93aWR0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2NvbDJfd2lkdGggPSBjb2wyX3dpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2NvbDIgPSBjb2wyO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0ID0gNTA7XG4gICAgICAgICAgICAgICAgdmFyIHcgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBoaWRkZW5fY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBtYXhfcmVhY2hlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChtYXhfY29sMikge1xuICAgICAgICAgICAgICAgICAgICBtYXhfY29sMi5jaGlsZHJlbignZGl2JykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1heF9yZWFjaGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdyArPSAkKHRoaXMpLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXhfcmVhY2hlZCB8fCB3ID4gKG1pbl93aWR0aCAtIG9mZnNldCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRkZW5fY291bnQgPSBoaWRkZW5fY291bnQgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heF9yZWFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZGRlbl9jb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdkaXYuY29udCcpLmNoaWxkcmVuKCdkaXYuY29sMicpLmNoaWxkcmVuKCdkaXYnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoLWhpZGRlbl9jb3VudCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNzcygnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdkaXYjc2l0ZW1hcCB1bC5oZWFkZXIgZGl2LmNvbDInKS5jaGlsZHJlbigpLnNsaWNlKC1oaWRkZW5fY291bnQpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG59KShDTVMuJCk7XG4iLCIvLyBhbGwsIGJ1dCB3aXRob3V0IGpxdWVyeSAhISAobW9kaWZpZWQgYnkgUGV0ZXIgQ2ljbWFuKVxuXG4vLyBjc3MuanNcblxuZnVuY3Rpb24gZ2V0X2NzcyhydWxlX25hbWUsc3R5bGVzaGVldCxkZWxldGVfZmxhZyl7aWYoIWRvY3VtZW50LnN0eWxlU2hlZXRzKXJldHVybiBmYWxzZTtydWxlX25hbWU9cnVsZV9uYW1lLnRvTG93ZXJDYXNlKCk7c3R5bGVzaGVldD1zdHlsZXNoZWV0fHwwO2Zvcih2YXIgaT1zdHlsZXNoZWV0O2k8ZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoO2krKyl7dmFyIHN0eWxlU2hlZXQ9ZG9jdW1lbnQuc3R5bGVTaGVldHNbaV07Y3NzX3J1bGVzPWRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLmNzc1J1bGVzfHxkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5ydWxlcztpZighY3NzX3J1bGVzKWNvbnRpbnVlO3ZhciBqPTA7ZG97aWYoY3NzX3J1bGVzW2pdLnNlbGVjdG9yVGV4dC50b0xvd2VyQ2FzZSgpPT1ydWxlX25hbWUpe2lmKGRlbGV0ZV9mbGFnPT10cnVlKXtpZihkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5yZW1vdmVSdWxlKWRvY3VtZW50LnN0eWxlU2hlZXRzW2ldLnJlbW92ZVJ1bGUoaik7aWYoZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uZGVsZXRlUnVsZSlkb2N1bWVudC5zdHlsZVNoZWV0c1tpXS5kZWxldGVSdWxlKGopO3JldHVybiB0cnVlO31cbmVsc2UgcmV0dXJuIGNzc19ydWxlc1tqXTt9fVxud2hpbGUoY3NzX3J1bGVzWysral0pO31cbnJldHVybiBmYWxzZTt9XG5mdW5jdGlvbiBhZGRfY3NzKHJ1bGVfbmFtZSxzdHlsZXNoZWV0KXtydWxlX25hbWU9cnVsZV9uYW1lLnRvTG93ZXJDYXNlKCk7c3R5bGVzaGVldD1zdHlsZXNoZWV0fHwwO2lmKCFkb2N1bWVudC5zdHlsZVNoZWV0c3x8Z2V0X2NzcyhydWxlX25hbWUsc3R5bGVzaGVldCkpcmV0dXJuIGZhbHNlOyhkb2N1bWVudC5zdHlsZVNoZWV0c1tzdHlsZXNoZWV0XS5hZGRSdWxlKT9kb2N1bWVudC5zdHlsZVNoZWV0c1tzdHlsZXNoZWV0XS5hZGRSdWxlKHJ1bGVfbmFtZSxudWxsLDApOmRvY3VtZW50LnN0eWxlU2hlZXRzW3N0eWxlc2hlZXRdLmluc2VydFJ1bGUocnVsZV9uYW1lKycgeyB9JywwKTtyZXR1cm4gZ2V0X2NzcyhydWxlX25hbWUpO31cbmZ1bmN0aW9uIGdldF9zaGVldF9udW0oaHJlZl9uYW1lKXtpZighZG9jdW1lbnQuc3R5bGVTaGVldHMpcmV0dXJuIGZhbHNlO2Zvcih2YXIgaT0wO2k8ZG9jdW1lbnQuc3R5bGVTaGVldHMubGVuZ3RoO2krKyl7aWYoZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uaHJlZiYmZG9jdW1lbnQuc3R5bGVTaGVldHNbaV0uaHJlZi50b1N0cmluZygpLm1hdGNoKGhyZWZfbmFtZSkpcmV0dXJuIGk7fVxucmV0dXJuIGZhbHNlO31cbmZ1bmN0aW9uIHJlbW92ZV9jc3MocnVsZV9uYW1lLHN0eWxlc2hlZXQpe3JldHVybiBnZXRfY3NzKHJ1bGVfbmFtZSxzdHlsZXNoZWV0LHRydWUpO31cbmZ1bmN0aW9uIGFkZF9zaGVldCh1cmwpe2lmKGRvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQpe2RvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQodXJsKTt9XG5lbHNle3ZhciBzdHlsZXM9XCJAaW1wb3J0IHVybCgnIFwiK3VybCtcIiAnKTtcIjt2YXIgbmV3U1M9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpO25ld1NTLnJlbD0nc3R5bGVzaGVldCc7bmV3U1MuaHJlZj0nZGF0YTp0ZXh0L2NzcywnK2VzY2FwZShzdHlsZXMpO2RvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXS5hcHBlbmRDaGlsZChuZXdTUyk7fX1cblxuLy8ganF1ZXJ5Lmxpc3Rlbi5qc1xuOyhmdW5jdGlvbigkKXt2YXIgYT0naW5kZXhlcicsaD0kLmV2ZW50LGo9aC5zcGVjaWFsLGs9JC5saXN0ZW49ZnVuY3Rpb24oYyxkLGUsZil7aWYodHlwZW9mIGQhPSdvYmplY3QnKXtmPWU7ZT1kO2Q9ZG9jdW1lbnR9byhjLnNwbGl0KC9cXHMrLyksZnVuY3Rpb24oYSl7YT1rLmZpeGVzW2FdfHxhO3ZhciBiPW0oZCxhKXx8bShkLGEsbmV3IG4oYSxkKSk7Yi5hcHBlbmQoZSxmKTtiLnN0YXJ0KCl9KX0sbT1mdW5jdGlvbihiLGMsZCl7cmV0dXJuICQuZGF0YShiLGMrJy4nK2EsZCl9OyQuZm5bYV09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXNbMF0mJm0odGhpc1swXSxhKXx8bnVsbH07JFthXT1mdW5jdGlvbihhKXtyZXR1cm4gbShkb2N1bWVudCxhKX07JC5leHRlbmQoayx7cmVnZXg6L14oKD86XFx3Kj98XFwqKSkoPzooWyMuXSkoW1xcdy1dKykpPyQvLGZpeGVzOntmb2N1czonZm9jdXNpbicsYmx1cjonZm9jdXNvdXQnfSxjYWNoZTpmdW5jdGlvbihhKXt0aGlzLmNhY2hpbmc9YX19KTskLmVhY2goay5maXhlcyxmdW5jdGlvbihhLGIpe2pbYl09e3NldHVwOmZ1bmN0aW9uKCl7aWYoJC5icm93c2VyLm1zaWUpcmV0dXJuITE7dGhpcy5hZGRFdmVudExpc3RlbmVyKGEsaltiXS5oYW5kbGVyLCEwKX0sdGVhcmRvd246ZnVuY3Rpb24oKXtpZigkLmJyb3dzZXIubXNpZSlyZXR1cm4hMTt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSxqW2JdLmhhbmRsZXIsITApfSxoYW5kbGVyOmZ1bmN0aW9uKGUpe2FyZ3VtZW50c1swXT1lPWguZml4KGUpO2UudHlwZT1iO3JldHVybiBoLmhhbmRsZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9fX0pOyQuZm4ubGlzdGVuPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ayhhLHRoaXMsYixjKX0pfTtmdW5jdGlvbiBuKGEsYil7JC5leHRlbmQodGhpcyx7aWRzOnt9LHRhZ3M6e30sbGlzdGVuZXI6YixldmVudDphfSk7dGhpcy5pZD1uLmluc3RhbmNlcy5wdXNoKHRoaXMpfTtuLmluc3RhbmNlcz1bXTtuLnByb3RvdHlwZT17Y29uc3RydWN0b3I6bixoYW5kbGU6ZnVuY3Rpb24oZSl7dmFyIGE9ZS5zdG9wUHJvcGFnYXRpb247ZS5zdG9wUHJvcGFnYXRpb249ZnVuY3Rpb24oKXtlLnN0b3BwZWQ9MTthLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07bSh0aGlzLGUudHlwZSkucGFyc2UoZSk7ZS5zdG9wUHJvcGFnYXRpb249YTthPWUuZGF0YT1udWxsfSxvbjowLGJ1YmJsZXM6MCxzdGFydDpmdW5jdGlvbigpe3ZhciBhPXRoaXM7aWYoIWEub24pe2guYWRkKGEubGlzdGVuZXIsYS5ldmVudCxhLmhhbmRsZSk7YS5vbj0xfX0sc3RvcDpmdW5jdGlvbigpe3ZhciBhPXRoaXM7aWYoYS5vbil7aC5yZW1vdmUoYS5saXN0ZW5lcixhLmV2ZW50LGEuaGFuZGxlKTthLm9uPTB9fSxjYWNoZTpmdW5jdGlvbihhLGIpe3JldHVybiAkLmRhdGEoYSwnbGlzdGVuQ2FjaGVfJyt0aGlzLmlkLGIpfSxwYXJzZTpmdW5jdGlvbihlKXt2YXIgej10aGlzLGM9ZS5kYXRhfHxlLnRhcmdldCxkPWFyZ3VtZW50cyxmO2lmKCFrLmNhY2hpbmd8fCEoZj16LmNhY2hlKGMpKSl7Zj1bXTtpZihjLmlkJiZ6Lmlkc1tjLmlkXSlwKGYsei5pZHNbYy5pZF0pO28oW2Mubm9kZU5hbWUsJyonXSxmdW5jdGlvbihhKXt2YXIgYj16LnRhZ3NbYV07aWYoYilvKChjLmNsYXNzTmFtZSsnIConKS5zcGxpdCgnICcpLGZ1bmN0aW9uKGEpe2lmKGEmJmJbYV0pcChmLGJbYV0pfSl9KTtpZihrLmNhY2hpbmcpei5jYWNoZShjLGYpfWlmKGZbMF0pe28oZixmdW5jdGlvbihhKXtpZihhLmFwcGx5KGMsZCk9PT0hMSl7ZS5wcmV2ZW50RGVmYXVsdCgpO2Uuc3RvcFByb3BhZ2F0aW9uKCl9fSl9aWYoIWUuc3RvcHBlZCYmKGM9Yy5wYXJlbnROb2RlKSYmKGMubm9kZU5hbWU9PSdBJ3x8ei5idWJibGVzJiZjIT16Lmxpc3RlbmVyKSl7ZS5kYXRhPWM7ei5wYXJzZShlKX1mPWQ9Yz1udWxsfSxhcHBlbmQ6ZnVuY3Rpb24oZixnKXt2YXIgej10aGlzO28oZi5zcGxpdCgvXFxzKixcXHMqLyksZnVuY3Rpb24oYSl7dmFyIGI9ay5yZWdleC5leGVjKGEpO2lmKCFiKXRocm93JyQubGlzdGVuID4gXCInK2ErJ1wiIGlzIG5vdCBhIHN1cHBvcnRlZCBzZWxlY3Rvci4nO3ZhciBjPWJbMl09PScjJyYmYlszXSxkPWJbMV0udG9VcHBlckNhc2UoKXx8JyonLGU9YlszXXx8JyonO2lmKGMpKHouaWRzW2NdfHwoei5pZHNbY109W10pKS5wdXNoKGcpO2Vsc2UgaWYoZCl7ZD16LnRhZ3NbZF09ei50YWdzW2RdfHx7fTsoZFtlXXx8KGRbZV09W10pKS5wdXNoKGcpfX0pfX07ZnVuY3Rpb24gbyhhLGIsYyl7Zm9yKHZhciBpPTAsbD1hLmxlbmd0aDtpPGw7aSsrKWIuY2FsbChjLGFbaV0saSl9O2Z1bmN0aW9uIHAoYSxiKXthLnB1c2guYXBwbHkoYSxiKTtyZXR1cm4gYX07JCh3aW5kb3cpLnVubG9hZChmdW5jdGlvbigpe2lmKHR5cGVvZiBuPT0nZnVuY3Rpb24nKW8obi5pbnN0YW5jZXMsZnVuY3Rpb24oYil7Yi5zdG9wKCk7JC5yZW1vdmVEYXRhKGIubGlzdGVuZXIsYi5ldmVudCsnLicrYSk7Yi5pZHM9Yi5uYW1lcz1iLmxpc3RlbmVyPW51bGx9KX0pfSkoalF1ZXJ5KTtcblxuLy8gc2FyaXNzYS5qc1xuXG5mdW5jdGlvbiBTYXJpc3NhKCl7fVxuU2FyaXNzYS5WRVJTSU9OPVwiMC45LjkuNFwiO1Nhcmlzc2EuUEFSU0VEX09LPVwiRG9jdW1lbnQgY29udGFpbnMgbm8gcGFyc2luZyBlcnJvcnNcIjtTYXJpc3NhLlBBUlNFRF9FTVBUWT1cIkRvY3VtZW50IGlzIGVtcHR5XCI7U2FyaXNzYS5QQVJTRURfVU5LTk9XTl9FUlJPUj1cIk5vdCB3ZWxsLWZvcm1lZCBvciBvdGhlciBlcnJvclwiO1Nhcmlzc2EuSVNfRU5BQkxFRF9UUkFOU0ZPUk1fTk9ERT1mYWxzZTtTYXJpc3NhLlJFTU9URV9DQUxMX0ZMQUc9XCJnci5hYmlzcy5zYXJpc3NhLlJFTU9URV9DQUxMX0ZMQUdcIjtTYXJpc3NhLl9sYXN0VW5pcXVlU3VmZml4PTA7U2FyaXNzYS5fZ2V0VW5pcXVlU3VmZml4PWZ1bmN0aW9uKCl7cmV0dXJuIFNhcmlzc2EuX2xhc3RVbmlxdWVTdWZmaXgrKzt9O1Nhcmlzc2EuX1NBUklTU0FfSUVQUkVGSVg0WFNMUEFSQU09XCJcIjtTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fSU1QTEVNRU5UQVRJT049ZG9jdW1lbnQuaW1wbGVtZW50YXRpb24mJnRydWU7U2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0NSRUFURV9ET0NVTUVOVD1TYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fSU1QTEVNRU5UQVRJT04mJmRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50O1Nhcmlzc2EuX1NBUklTU0FfSEFTX0RPTV9GRUFUVVJFPVNhcmlzc2EuX1NBUklTU0FfSEFTX0RPTV9JTVBMRU1FTlRBVElPTiYmZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZTtTYXJpc3NhLl9TQVJJU1NBX0lTX01PWj1TYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fQ1JFQVRFX0RPQ1VNRU5UJiZTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fRkVBVFVSRTtTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSST1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcInNhZmFyaVwiKSE9LTF8fG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwia29ucXVlcm9yXCIpIT0tMTtTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSSV9PTEQ9U2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUkkmJihwYXJzZUludCgobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvQXBwbGVXZWJLaXRcXC8oXFxkKykvKXx8e30pWzFdLDEwKTw0MjApO1Nhcmlzc2EuX1NBUklTU0FfSVNfSUU9ZG9jdW1lbnQuYWxsJiZ3aW5kb3cuQWN0aXZlWE9iamVjdCYmbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJtc2llXCIpPi0xJiZuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIm9wZXJhXCIpPT0tMTtTYXJpc3NhLl9TQVJJU1NBX0lTX09QRVJBPW5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwib3BlcmFcIikhPS0xO2lmKCF3aW5kb3cuTm9kZXx8IU5vZGUuRUxFTUVOVF9OT0RFKXtOb2RlPXtFTEVNRU5UX05PREU6MSxBVFRSSUJVVEVfTk9ERToyLFRFWFRfTk9ERTozLENEQVRBX1NFQ1RJT05fTk9ERTo0LEVOVElUWV9SRUZFUkVOQ0VfTk9ERTo1LEVOVElUWV9OT0RFOjYsUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOjcsQ09NTUVOVF9OT0RFOjgsRE9DVU1FTlRfTk9ERTo5LERPQ1VNRU5UX1RZUEVfTk9ERToxMCxET0NVTUVOVF9GUkFHTUVOVF9OT0RFOjExLE5PVEFUSU9OX05PREU6MTJ9O31cbmlmKFNhcmlzc2EuX1NBUklTU0FfSVNfU0FGQVJJX09MRCl7SFRNTEh0bWxFbGVtZW50PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJodG1sXCIpLmNvbnN0cnVjdG9yO05vZGU9SFRNTEVsZW1lbnQ9e307SFRNTEVsZW1lbnQucHJvdG90eXBlPUhUTUxIdG1sRWxlbWVudC5fX3Byb3RvX18uX19wcm90b19fO0hUTUxEb2N1bWVudD1Eb2N1bWVudD1kb2N1bWVudC5jb25zdHJ1Y3Rvcjt2YXIgeD1uZXcgRE9NUGFyc2VyKCk7WE1MRG9jdW1lbnQ9eC5jb25zdHJ1Y3RvcjtFbGVtZW50PXgucGFyc2VGcm9tU3RyaW5nKFwiPFNpbmdsZSAvPlwiLFwidGV4dC94bWxcIikuZG9jdW1lbnRFbGVtZW50LmNvbnN0cnVjdG9yO3g9bnVsbDt9XG5pZih0eXBlb2YgWE1MRG9jdW1lbnQ9PVwidW5kZWZpbmVkXCImJnR5cGVvZiBEb2N1bWVudCE9XCJ1bmRlZmluZWRcIil7WE1MRG9jdW1lbnQ9RG9jdW1lbnQ7fVxuaWYoU2FyaXNzYS5fU0FSSVNTQV9JU19JRSl7U2FyaXNzYS5fU0FSSVNTQV9JRVBSRUZJWDRYU0xQQVJBTT1cInhzbDpcIjt2YXIgX1NBUklTU0FfRE9NX1BST0dJRD1cIlwiO3ZhciBfU0FSSVNTQV9YTUxIVFRQX1BST0dJRD1cIlwiO3ZhciBfU0FSSVNTQV9ET01fWE1MV1JJVEVSPVwiXCI7U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEPWZ1bmN0aW9uKGlkTGlzdCl7dmFyIGJGb3VuZD1mYWxzZSxlO3ZhciBvMlN0b3JlO2Zvcih2YXIgaT0wO2k8aWRMaXN0Lmxlbmd0aCYmIWJGb3VuZDtpKyspe3RyeXt2YXIgb0RvYz1uZXcgQWN0aXZlWE9iamVjdChpZExpc3RbaV0pO28yU3RvcmU9aWRMaXN0W2ldO2JGb3VuZD10cnVlO31jYXRjaChvYmpFeGNlcHRpb24pe2U9b2JqRXhjZXB0aW9uO319XG5pZighYkZvdW5kKXt0aHJvd1wiQ291bGQgbm90IHJldHJpZXZlIGEgdmFsaWQgcHJvZ0lEIG9mIENsYXNzOiBcIitpZExpc3RbaWRMaXN0Lmxlbmd0aC0xXStcIi4gKG9yaWdpbmFsIGV4Y2VwdGlvbjogXCIrZStcIilcIjt9XG5pZExpc3Q9bnVsbDtyZXR1cm4gbzJTdG9yZTt9O19TQVJJU1NBX0RPTV9QUk9HSUQ9bnVsbDtfU0FSSVNTQV9USFJFQURFRERPTV9QUk9HSUQ9bnVsbDtfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQ9bnVsbDtfU0FSSVNTQV9YTUxIVFRQX1BST0dJRD1udWxsO1hNTEh0dHBSZXF1ZXN0PWZ1bmN0aW9uKCl7aWYoIV9TQVJJU1NBX1hNTEhUVFBfUFJPR0lEKXtfU0FSSVNTQV9YTUxIVFRQX1BST0dJRD1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTXN4bWwyLlhNTEhUVFAuNi4wXCIsXCJNU1hNTDIuWE1MSFRUUC4zLjBcIixcIk1TWE1MMi5YTUxIVFRQXCIsXCJNaWNyb3NvZnQuWE1MSFRUUFwiXSk7fVxucmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX1hNTEhUVFBfUFJPR0lEKTt9O1Nhcmlzc2EuZ2V0RG9tRG9jdW1lbnQ9ZnVuY3Rpb24oc1VyaSxzTmFtZSl7aWYoIV9TQVJJU1NBX0RPTV9QUk9HSUQpe19TQVJJU1NBX0RPTV9QUk9HSUQ9U2FyaXNzYS5waWNrUmVjZW50UHJvZ0lEKFtcIk1zeG1sMi5ET01Eb2N1bWVudC42LjBcIixcIk1zeG1sMi5ET01Eb2N1bWVudC4zLjBcIixcIk1TWE1MMi5ET01Eb2N1bWVudFwiLFwiTVNYTUwuRE9NRG9jdW1lbnRcIixcIk1pY3Jvc29mdC5YTUxET01cIl0pO31cbnZhciBvRG9jPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX0RPTV9QUk9HSUQpO2lmKHNOYW1lKXt2YXIgcHJlZml4PVwiXCI7aWYoc1VyaSl7aWYoc05hbWUuaW5kZXhPZihcIjpcIik+MSl7cHJlZml4PXNOYW1lLnN1YnN0cmluZygwLHNOYW1lLmluZGV4T2YoXCI6XCIpKTtzTmFtZT1zTmFtZS5zdWJzdHJpbmcoc05hbWUuaW5kZXhPZihcIjpcIikrMSk7fWVsc2V7cHJlZml4PVwiYVwiK1Nhcmlzc2EuX2dldFVuaXF1ZVN1ZmZpeCgpO319XG5pZihzVXJpKXtvRG9jLmxvYWRYTUwoJzwnK3ByZWZpeCsnOicrc05hbWUrXCIgeG1sbnM6XCIrcHJlZml4K1wiPVxcXCJcIitzVXJpK1wiXFxcIlwiK1wiIC8+XCIpO31lbHNle29Eb2MubG9hZFhNTCgnPCcrc05hbWUrXCIgLz5cIik7fX1cbnJldHVybiBvRG9jO307U2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dD1mdW5jdGlvbihvRG9jKXt2YXIgcGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfT0s7aWYob0RvYyYmb0RvYy5wYXJzZUVycm9yJiZvRG9jLnBhcnNlRXJyb3IuZXJyb3JDb2RlJiZvRG9jLnBhcnNlRXJyb3IuZXJyb3JDb2RlIT0wKXtwYXJzZUVycm9yVGV4dD1cIlhNTCBQYXJzaW5nIEVycm9yOiBcIitvRG9jLnBhcnNlRXJyb3IucmVhc29uK1wiXFxuTG9jYXRpb246IFwiK29Eb2MucGFyc2VFcnJvci51cmwrXCJcXG5MaW5lIE51bWJlciBcIitvRG9jLnBhcnNlRXJyb3IubGluZStcIiwgQ29sdW1uIFwiK1xub0RvYy5wYXJzZUVycm9yLmxpbmVwb3MrXCI6XFxuXCIrb0RvYy5wYXJzZUVycm9yLnNyY1RleHQrXCJcXG5cIjtmb3IodmFyIGk9MDtpPG9Eb2MucGFyc2VFcnJvci5saW5lcG9zO2krKyl7cGFyc2VFcnJvclRleHQrPVwiLVwiO31cbnBhcnNlRXJyb3JUZXh0Kz1cIl5cXG5cIjt9XG5lbHNlIGlmKG9Eb2MuZG9jdW1lbnRFbGVtZW50PT09bnVsbCl7cGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfRU1QVFk7fVxucmV0dXJuIHBhcnNlRXJyb3JUZXh0O307U2FyaXNzYS5zZXRYcGF0aE5hbWVzcGFjZXM9ZnVuY3Rpb24ob0RvYyxzTnNTZXQpe29Eb2Muc2V0UHJvcGVydHkoXCJTZWxlY3Rpb25MYW5ndWFnZVwiLFwiWFBhdGhcIik7b0RvYy5zZXRQcm9wZXJ0eShcIlNlbGVjdGlvbk5hbWVzcGFjZXNcIixzTnNTZXQpO307WFNMVFByb2Nlc3Nvcj1mdW5jdGlvbigpe2lmKCFfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQpe19TQVJJU1NBX1hTTFRFTVBMQVRFX1BST0dJRD1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTXN4bWwyLlhTTFRlbXBsYXRlLjYuMFwiLFwiTVNYTUwyLlhTTFRlbXBsYXRlLjMuMFwiXSk7fVxudGhpcy50ZW1wbGF0ZT1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9YU0xURU1QTEFURV9QUk9HSUQpO3RoaXMucHJvY2Vzc29yPW51bGw7fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS5pbXBvcnRTdHlsZXNoZWV0PWZ1bmN0aW9uKHhzbERvYyl7aWYoIV9TQVJJU1NBX1RIUkVBREVERE9NX1BST0dJRCl7X1NBUklTU0FfVEhSRUFERURET01fUFJPR0lEPVNhcmlzc2EucGlja1JlY2VudFByb2dJRChbXCJNU1hNTDIuRnJlZVRocmVhZGVkRE9NRG9jdW1lbnQuNi4wXCIsXCJNU1hNTDIuRnJlZVRocmVhZGVkRE9NRG9jdW1lbnQuMy4wXCJdKTt9XG54c2xEb2Muc2V0UHJvcGVydHkoXCJTZWxlY3Rpb25MYW5ndWFnZVwiLFwiWFBhdGhcIik7eHNsRG9jLnNldFByb3BlcnR5KFwiU2VsZWN0aW9uTmFtZXNwYWNlc1wiLFwieG1sbnM6eHNsPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0nXCIpO3ZhciBjb252ZXJ0ZWQ9bmV3IEFjdGl2ZVhPYmplY3QoX1NBUklTU0FfVEhSRUFERURET01fUFJPR0lEKTt0cnl7Y29udmVydGVkLnJlc29sdmVFeHRlcm5hbHM9dHJ1ZTtjb252ZXJ0ZWQuc2V0UHJvcGVydHkoXCJBbGxvd0RvY3VtZW50RnVuY3Rpb25cIix0cnVlKTt9XG5jYXRjaChlKXt9XG5pZih4c2xEb2MudXJsJiZ4c2xEb2Muc2VsZWN0U2luZ2xlTm9kZShcIi8veHNsOipbbG9jYWwtbmFtZSgpID0gJ2ltcG9ydCcgb3IgbG9jYWwtbmFtZSgpID0gJ2luY2x1ZGUnXVwiKSE9bnVsbCl7Y29udmVydGVkLmFzeW5jPWZhbHNlO2NvbnZlcnRlZC5sb2FkKHhzbERvYy51cmwpO31cbmVsc2V7Y29udmVydGVkLmxvYWRYTUwoeHNsRG9jLnhtbCk7fVxuY29udmVydGVkLnNldFByb3BlcnR5KFwiU2VsZWN0aW9uTmFtZXNwYWNlc1wiLFwieG1sbnM6eHNsPSdodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0nXCIpO3ZhciBvdXRwdXQ9Y29udmVydGVkLnNlbGVjdFNpbmdsZU5vZGUoXCIvL3hzbDpvdXRwdXRcIik7aWYob3V0cHV0KXt0aGlzLm91dHB1dE1ldGhvZD1vdXRwdXQuZ2V0QXR0cmlidXRlKFwibWV0aG9kXCIpO31cbmVsc2V7ZGVsZXRlIHRoaXMub3V0cHV0TWV0aG9kO31cbnRoaXMudGVtcGxhdGUuc3R5bGVzaGVldD1jb252ZXJ0ZWQ7dGhpcy5wcm9jZXNzb3I9dGhpcy50ZW1wbGF0ZS5jcmVhdGVQcm9jZXNzb3IoKTt0aGlzLnBhcmFtc1NldD1bXTt9O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLnRyYW5zZm9ybVRvRG9jdW1lbnQ9ZnVuY3Rpb24oc291cmNlRG9jKXt2YXIgb3V0RG9jO2lmKF9TQVJJU1NBX1RIUkVBREVERE9NX1BST0dJRCl7dGhpcy5wcm9jZXNzb3IuaW5wdXQ9c291cmNlRG9jO291dERvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fUFJPR0lEKTt0aGlzLnByb2Nlc3Nvci5vdXRwdXQ9b3V0RG9jO3RoaXMucHJvY2Vzc29yLnRyYW5zZm9ybSgpO3JldHVybiBvdXREb2M7fVxuZWxzZXtpZighX1NBUklTU0FfRE9NX1hNTFdSSVRFUil7X1NBUklTU0FfRE9NX1hNTFdSSVRFUj1TYXJpc3NhLnBpY2tSZWNlbnRQcm9nSUQoW1wiTXN4bWwyLk1YWE1MV3JpdGVyLjYuMFwiLFwiTXN4bWwyLk1YWE1MV3JpdGVyLjMuMFwiLFwiTVNYTUwyLk1YWE1MV3JpdGVyXCIsXCJNU1hNTC5NWFhNTFdyaXRlclwiLFwiTWljcm9zb2Z0LlhNTERPTVwiXSk7fVxudGhpcy5wcm9jZXNzb3IuaW5wdXQ9c291cmNlRG9jO291dERvYz1uZXcgQWN0aXZlWE9iamVjdChfU0FSSVNTQV9ET01fWE1MV1JJVEVSKTt0aGlzLnByb2Nlc3Nvci5vdXRwdXQ9b3V0RG9jO3RoaXMucHJvY2Vzc29yLnRyYW5zZm9ybSgpO3ZhciBvRG9jPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX0RPTV9QUk9HSUQpO29Eb2MubG9hZFhNTChvdXREb2Mub3V0cHV0K1wiXCIpO3JldHVybiBvRG9jO319O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLnRyYW5zZm9ybVRvRnJhZ21lbnQ9ZnVuY3Rpb24oc291cmNlRG9jLG93bmVyRG9jKXt0aGlzLnByb2Nlc3Nvci5pbnB1dD1zb3VyY2VEb2M7dGhpcy5wcm9jZXNzb3IudHJhbnNmb3JtKCk7dmFyIHM9dGhpcy5wcm9jZXNzb3Iub3V0cHV0O3ZhciBmPW93bmVyRG9jLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTt2YXIgY29udGFpbmVyO2lmKHRoaXMub3V0cHV0TWV0aG9kPT0ndGV4dCcpe2YuYXBwZW5kQ2hpbGQob3duZXJEb2MuY3JlYXRlVGV4dE5vZGUocykpO31lbHNlIGlmKG93bmVyRG9jLmJvZHkmJm93bmVyRG9jLmJvZHkuaW5uZXJIVE1MKXtjb250YWluZXI9b3duZXJEb2MuY3JlYXRlRWxlbWVudCgnZGl2Jyk7Y29udGFpbmVyLmlubmVySFRNTD1zO3doaWxlKGNvbnRhaW5lci5oYXNDaGlsZE5vZGVzKCkpe2YuYXBwZW5kQ2hpbGQoY29udGFpbmVyLmZpcnN0Q2hpbGQpO319XG5lbHNle3ZhciBvRG9jPW5ldyBBY3RpdmVYT2JqZWN0KF9TQVJJU1NBX0RPTV9QUk9HSUQpO2lmKHMuc3Vic3RyaW5nKDAsNSk9PSc8P3htbCcpe3M9cy5zdWJzdHJpbmcocy5pbmRleE9mKCc/PicpKzIpO31cbnZhciB4bWw9JycuY29uY2F0KCc8bXk+JyxzLCc8L215PicpO29Eb2MubG9hZFhNTCh4bWwpO2NvbnRhaW5lcj1vRG9jLmRvY3VtZW50RWxlbWVudDt3aGlsZShjb250YWluZXIuaGFzQ2hpbGROb2RlcygpKXtmLmFwcGVuZENoaWxkKGNvbnRhaW5lci5maXJzdENoaWxkKTt9fVxucmV0dXJuIGY7fTtYU0xUUHJvY2Vzc29yLnByb3RvdHlwZS5zZXRQYXJhbWV0ZXI9ZnVuY3Rpb24obnNVUkksbmFtZSx2YWx1ZSl7dmFsdWU9dmFsdWU/dmFsdWU6XCJcIjtpZihuc1VSSSl7dGhpcy5wcm9jZXNzb3IuYWRkUGFyYW1ldGVyKG5hbWUsdmFsdWUsbnNVUkkpO31lbHNle3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLHZhbHVlKTt9XG5uc1VSST1cIlwiKyhuc1VSSXx8XCJcIik7aWYoIXRoaXMucGFyYW1zU2V0W25zVVJJXSl7dGhpcy5wYXJhbXNTZXRbbnNVUkldPVtdO31cbnRoaXMucGFyYW1zU2V0W25zVVJJXVtuYW1lXT12YWx1ZTt9O1hTTFRQcm9jZXNzb3IucHJvdG90eXBlLmdldFBhcmFtZXRlcj1mdW5jdGlvbihuc1VSSSxuYW1lKXtuc1VSST1cIlwiKyhuc1VSSXx8XCJcIik7aWYodGhpcy5wYXJhbXNTZXRbbnNVUkldJiZ0aGlzLnBhcmFtc1NldFtuc1VSSV1bbmFtZV0pe3JldHVybiB0aGlzLnBhcmFtc1NldFtuc1VSSV1bbmFtZV07fWVsc2V7cmV0dXJuIG51bGw7fX07WFNMVFByb2Nlc3Nvci5wcm90b3R5cGUuY2xlYXJQYXJhbWV0ZXJzPWZ1bmN0aW9uKCl7Zm9yKHZhciBuc1VSSSBpbiB0aGlzLnBhcmFtc1NldCl7Zm9yKHZhciBuYW1lIGluIHRoaXMucGFyYW1zU2V0W25zVVJJXSl7aWYobnNVUkkhPVwiXCIpe3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLFwiXCIsbnNVUkkpO31lbHNle3RoaXMucHJvY2Vzc29yLmFkZFBhcmFtZXRlcihuYW1lLFwiXCIpO319fVxudGhpcy5wYXJhbXNTZXQ9W107fTt9ZWxzZXtpZihTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fQ1JFQVRFX0RPQ1VNRU5UKXtTYXJpc3NhLl9faGFuZGxlTG9hZF9fPWZ1bmN0aW9uKG9Eb2Mpe1Nhcmlzc2EuX19zZXRSZWFkeVN0YXRlX18ob0RvYyw0KTt9O19zYXJpc3NhX1hNTERvY3VtZW50X29ubG9hZD1mdW5jdGlvbigpe1Nhcmlzc2EuX19oYW5kbGVMb2FkX18odGhpcyk7fTtTYXJpc3NhLl9fc2V0UmVhZHlTdGF0ZV9fPWZ1bmN0aW9uKG9Eb2MsaVJlYWR5U3RhdGUpe29Eb2MucmVhZHlTdGF0ZT1pUmVhZHlTdGF0ZTtvRG9jLnJlYWR5c3RhdGU9aVJlYWR5U3RhdGU7aWYob0RvYy5vbnJlYWR5c3RhdGVjaGFuZ2UhPW51bGwmJnR5cGVvZiBvRG9jLm9ucmVhZHlzdGF0ZWNoYW5nZT09XCJmdW5jdGlvblwiKXtvRG9jLm9ucmVhZHlzdGF0ZWNoYW5nZSgpO319O1Nhcmlzc2EuZ2V0RG9tRG9jdW1lbnQ9ZnVuY3Rpb24oc1VyaSxzTmFtZSl7dmFyIG9Eb2M9ZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnQoc1VyaT9zVXJpOm51bGwsc05hbWU/c05hbWU6bnVsbCxudWxsKTtpZighb0RvYy5vbnJlYWR5c3RhdGVjaGFuZ2Upe29Eb2Mub25yZWFkeXN0YXRlY2hhbmdlPW51bGw7fVxuaWYoIW9Eb2MucmVhZHlTdGF0ZSl7b0RvYy5yZWFkeVN0YXRlPTA7fVxub0RvYy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLF9zYXJpc3NhX1hNTERvY3VtZW50X29ubG9hZCxmYWxzZSk7cmV0dXJuIG9Eb2M7fTtpZih3aW5kb3cuWE1MRG9jdW1lbnQpe31cbmVsc2UgaWYoU2FyaXNzYS5fU0FSSVNTQV9IQVNfRE9NX0ZFQVRVUkUmJndpbmRvdy5Eb2N1bWVudCYmIURvY3VtZW50LnByb3RvdHlwZS5sb2FkJiZkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5oYXNGZWF0dXJlKCdMUycsJzMuMCcpKXtTYXJpc3NhLmdldERvbURvY3VtZW50PWZ1bmN0aW9uKHNVcmksc05hbWUpe3ZhciBvRG9jPWRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50KHNVcmk/c1VyaTpudWxsLHNOYW1lP3NOYW1lOm51bGwsbnVsbCk7cmV0dXJuIG9Eb2M7fTt9XG5lbHNle1Nhcmlzc2EuZ2V0RG9tRG9jdW1lbnQ9ZnVuY3Rpb24oc1VyaSxzTmFtZSl7dmFyIG9Eb2M9ZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnQoc1VyaT9zVXJpOm51bGwsc05hbWU/c05hbWU6bnVsbCxudWxsKTtpZihvRG9jJiYoc1VyaXx8c05hbWUpJiYhb0RvYy5kb2N1bWVudEVsZW1lbnQpe29Eb2MuYXBwZW5kQ2hpbGQob0RvYy5jcmVhdGVFbGVtZW50TlMoc1VyaSxzTmFtZSkpO31cbnJldHVybiBvRG9jO307fX19XG5pZighd2luZG93LkRPTVBhcnNlcil7aWYoU2FyaXNzYS5fU0FSSVNTQV9JU19TQUZBUkkpe0RPTVBhcnNlcj1mdW5jdGlvbigpe307RE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmc9ZnVuY3Rpb24oc1htbCxjb250ZW50VHlwZSl7dmFyIHhtbGh0dHA9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7eG1saHR0cC5vcGVuKFwiR0VUXCIsXCJkYXRhOnRleHQveG1sO2NoYXJzZXQ9dXRmLTgsXCIrZW5jb2RlVVJJQ29tcG9uZW50KHNYbWwpLGZhbHNlKTt4bWxodHRwLnNlbmQobnVsbCk7cmV0dXJuIHhtbGh0dHAucmVzcG9uc2VYTUw7fTt9ZWxzZSBpZihTYXJpc3NhLmdldERvbURvY3VtZW50JiZTYXJpc3NhLmdldERvbURvY3VtZW50KCkmJlNhcmlzc2EuZ2V0RG9tRG9jdW1lbnQobnVsbCxcImJhclwiKS54bWwpe0RPTVBhcnNlcj1mdW5jdGlvbigpe307RE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmc9ZnVuY3Rpb24oc1htbCxjb250ZW50VHlwZSl7dmFyIGRvYz1TYXJpc3NhLmdldERvbURvY3VtZW50KCk7ZG9jLmxvYWRYTUwoc1htbCk7cmV0dXJuIGRvYzt9O319XG5pZigodHlwZW9mKGRvY3VtZW50LmltcG9ydE5vZGUpPT1cInVuZGVmaW5lZFwiKSYmU2FyaXNzYS5fU0FSSVNTQV9JU19JRSl7dHJ5e2RvY3VtZW50LmltcG9ydE5vZGU9ZnVuY3Rpb24ob05vZGUsYkNoaWxkcmVuKXt2YXIgdG1wO2lmKG9Ob2RlLm5vZGVOYW1lPT0nI3RleHQnKXtyZXR1cm4gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUob05vZGUuZGF0YSk7fVxuZWxzZXtpZihvTm9kZS5ub2RlTmFtZT09XCJ0Ym9keVwifHxvTm9kZS5ub2RlTmFtZT09XCJ0clwiKXt0bXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO31cbmVsc2UgaWYob05vZGUubm9kZU5hbWU9PVwidGRcIil7dG1wPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTt9XG5lbHNlIGlmKG9Ob2RlLm5vZGVOYW1lPT1cIm9wdGlvblwiKXt0bXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTt9XG5lbHNle3RtcD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO31cbmlmKGJDaGlsZHJlbil7dG1wLmlubmVySFRNTD1vTm9kZS54bWw/b05vZGUueG1sOm9Ob2RlLm91dGVySFRNTDt9ZWxzZXt0bXAuaW5uZXJIVE1MPW9Ob2RlLnhtbD9vTm9kZS5jbG9uZU5vZGUoZmFsc2UpLnhtbDpvTm9kZS5jbG9uZU5vZGUoZmFsc2UpLm91dGVySFRNTDt9XG5yZXR1cm4gdG1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiKlwiKVswXTt9fTt9Y2F0Y2goZSl7fX1cbmlmKCFTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KXtTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0PWZ1bmN0aW9uKG9Eb2Mpe3ZhciBwYXJzZUVycm9yVGV4dD1TYXJpc3NhLlBBUlNFRF9PSztpZigoIW9Eb2MpfHwoIW9Eb2MuZG9jdW1lbnRFbGVtZW50KSl7cGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfRU1QVFk7fWVsc2UgaWYob0RvYy5kb2N1bWVudEVsZW1lbnQudGFnTmFtZT09XCJwYXJzZXJlcnJvclwiKXtwYXJzZUVycm9yVGV4dD1vRG9jLmRvY3VtZW50RWxlbWVudC5maXJzdENoaWxkLmRhdGE7cGFyc2VFcnJvclRleHQrPVwiXFxuXCIrb0RvYy5kb2N1bWVudEVsZW1lbnQuZmlyc3RDaGlsZC5uZXh0U2libGluZy5maXJzdENoaWxkLmRhdGE7fWVsc2UgaWYob0RvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInBhcnNlcmVycm9yXCIpLmxlbmd0aD4wKXt2YXIgcGFyc2VyZXJyb3I9b0RvYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInBhcnNlcmVycm9yXCIpWzBdO3BhcnNlRXJyb3JUZXh0PVNhcmlzc2EuZ2V0VGV4dChwYXJzZXJlcnJvcix0cnVlKStcIlxcblwiO31lbHNlIGlmKG9Eb2MucGFyc2VFcnJvciYmb0RvYy5wYXJzZUVycm9yLmVycm9yQ29kZSE9MCl7cGFyc2VFcnJvclRleHQ9U2FyaXNzYS5QQVJTRURfVU5LTk9XTl9FUlJPUjt9XG5yZXR1cm4gcGFyc2VFcnJvclRleHQ7fTt9XG5TYXJpc3NhLmdldFRleHQ9ZnVuY3Rpb24ob05vZGUsZGVlcCl7dmFyIHM9XCJcIjt2YXIgbm9kZXM9b05vZGUuY2hpbGROb2Rlcztmb3IodmFyIGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe3ZhciBub2RlPW5vZGVzW2ldO3ZhciBub2RlVHlwZT1ub2RlLm5vZGVUeXBlO2lmKG5vZGVUeXBlPT1Ob2RlLlRFWFRfTk9ERXx8bm9kZVR5cGU9PU5vZGUuQ0RBVEFfU0VDVElPTl9OT0RFKXtzKz1ub2RlLmRhdGE7fWVsc2UgaWYoZGVlcD09PXRydWUmJihub2RlVHlwZT09Tm9kZS5FTEVNRU5UX05PREV8fG5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREV8fG5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX0ZSQUdNRU5UX05PREUpKXtzKz1TYXJpc3NhLmdldFRleHQobm9kZSx0cnVlKTt9fVxucmV0dXJuIHM7fTtpZighd2luZG93LlhNTFNlcmlhbGl6ZXImJlNhcmlzc2EuZ2V0RG9tRG9jdW1lbnQmJlNhcmlzc2EuZ2V0RG9tRG9jdW1lbnQoXCJcIixcImZvb1wiLG51bGwpLnhtbCl7WE1MU2VyaWFsaXplcj1mdW5jdGlvbigpe307WE1MU2VyaWFsaXplci5wcm90b3R5cGUuc2VyaWFsaXplVG9TdHJpbmc9ZnVuY3Rpb24ob05vZGUpe3JldHVybiBvTm9kZS54bWw7fTt9XG5TYXJpc3NhLnN0cmlwVGFncz1mdW5jdGlvbihzKXtyZXR1cm4gcz9zLnJlcGxhY2UoLzxbXj5dKz4vZyxcIlwiKTpzO307U2FyaXNzYS5jbGVhckNoaWxkTm9kZXM9ZnVuY3Rpb24ob05vZGUpe3doaWxlKG9Ob2RlLmZpcnN0Q2hpbGQpe29Ob2RlLnJlbW92ZUNoaWxkKG9Ob2RlLmZpcnN0Q2hpbGQpO319O1Nhcmlzc2EuY29weUNoaWxkTm9kZXM9ZnVuY3Rpb24obm9kZUZyb20sbm9kZVRvLGJQcmVzZXJ2ZUV4aXN0aW5nKXtpZihTYXJpc3NhLl9TQVJJU1NBX0lTX1NBRkFSSSYmbm9kZVRvLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREUpe25vZGVUbz1ub2RlVG8uZG9jdW1lbnRFbGVtZW50O31cbmlmKCghbm9kZUZyb20pfHwoIW5vZGVUbykpe3Rocm93XCJCb3RoIHNvdXJjZSBhbmQgZGVzdGluYXRpb24gbm9kZXMgbXVzdCBiZSBwcm92aWRlZFwiO31cbmlmKCFiUHJlc2VydmVFeGlzdGluZyl7U2FyaXNzYS5jbGVhckNoaWxkTm9kZXMobm9kZVRvKTt9XG52YXIgb3duZXJEb2M9bm9kZVRvLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREU/bm9kZVRvOm5vZGVUby5vd25lckRvY3VtZW50O3ZhciBub2Rlcz1ub2RlRnJvbS5jaGlsZE5vZGVzO3ZhciBpO2lmKHR5cGVvZihvd25lckRvYy5pbXBvcnROb2RlKSE9XCJ1bmRlZmluZWRcIil7Zm9yKGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe25vZGVUby5hcHBlbmRDaGlsZChvd25lckRvYy5pbXBvcnROb2RlKG5vZGVzW2ldLHRydWUpKTt9fWVsc2V7Zm9yKGk9MDtpPG5vZGVzLmxlbmd0aDtpKyspe25vZGVUby5hcHBlbmRDaGlsZChub2Rlc1tpXS5jbG9uZU5vZGUodHJ1ZSkpO319fTtTYXJpc3NhLm1vdmVDaGlsZE5vZGVzPWZ1bmN0aW9uKG5vZGVGcm9tLG5vZGVUbyxiUHJlc2VydmVFeGlzdGluZyl7aWYoKCFub2RlRnJvbSl8fCghbm9kZVRvKSl7dGhyb3dcIkJvdGggc291cmNlIGFuZCBkZXN0aW5hdGlvbiBub2RlcyBtdXN0IGJlIHByb3ZpZGVkXCI7fVxuaWYoIWJQcmVzZXJ2ZUV4aXN0aW5nKXtTYXJpc3NhLmNsZWFyQ2hpbGROb2Rlcyhub2RlVG8pO31cbnZhciBub2Rlcz1ub2RlRnJvbS5jaGlsZE5vZGVzO2lmKG5vZGVGcm9tLm93bmVyRG9jdW1lbnQ9PW5vZGVUby5vd25lckRvY3VtZW50KXt3aGlsZShub2RlRnJvbS5maXJzdENoaWxkKXtub2RlVG8uYXBwZW5kQ2hpbGQobm9kZUZyb20uZmlyc3RDaGlsZCk7fX1lbHNle3ZhciBvd25lckRvYz1ub2RlVG8ubm9kZVR5cGU9PU5vZGUuRE9DVU1FTlRfTk9ERT9ub2RlVG86bm9kZVRvLm93bmVyRG9jdW1lbnQ7dmFyIGk7aWYodHlwZW9mKG93bmVyRG9jLmltcG9ydE5vZGUpIT1cInVuZGVmaW5lZFwiKXtmb3IoaT0wO2k8bm9kZXMubGVuZ3RoO2krKyl7bm9kZVRvLmFwcGVuZENoaWxkKG93bmVyRG9jLmltcG9ydE5vZGUobm9kZXNbaV0sdHJ1ZSkpO319ZWxzZXtmb3IoaT0wO2k8bm9kZXMubGVuZ3RoO2krKyl7bm9kZVRvLmFwcGVuZENoaWxkKG5vZGVzW2ldLmNsb25lTm9kZSh0cnVlKSk7fX1cblNhcmlzc2EuY2xlYXJDaGlsZE5vZGVzKG5vZGVGcm9tKTt9fTtTYXJpc3NhLnhtbGl6ZT1mdW5jdGlvbihhbnlPYmplY3Qsb2JqZWN0TmFtZSxpbmRlbnRTcGFjZSl7aW5kZW50U3BhY2U9aW5kZW50U3BhY2U/aW5kZW50U3BhY2U6Jyc7dmFyIHM9aW5kZW50U3BhY2UrJzwnK29iamVjdE5hbWUrJz4nO3ZhciBpc0xlYWY9ZmFsc2U7aWYoIShhbnlPYmplY3QgaW5zdGFuY2VvZiBPYmplY3QpfHxhbnlPYmplY3QgaW5zdGFuY2VvZiBOdW1iZXJ8fGFueU9iamVjdCBpbnN0YW5jZW9mIFN0cmluZ3x8YW55T2JqZWN0IGluc3RhbmNlb2YgQm9vbGVhbnx8YW55T2JqZWN0IGluc3RhbmNlb2YgRGF0ZSl7cys9U2FyaXNzYS5lc2NhcGUoXCJcIithbnlPYmplY3QpO2lzTGVhZj10cnVlO31lbHNle3MrPVwiXFxuXCI7dmFyIGlzQXJyYXlJdGVtPWFueU9iamVjdCBpbnN0YW5jZW9mIEFycmF5O2Zvcih2YXIgbmFtZSBpbiBhbnlPYmplY3Qpe3MrPVNhcmlzc2EueG1saXplKGFueU9iamVjdFtuYW1lXSwoaXNBcnJheUl0ZW0/XCJhcnJheS1pdGVtIGtleT1cXFwiXCIrbmFtZStcIlxcXCJcIjpuYW1lKSxpbmRlbnRTcGFjZStcIiAgIFwiKTt9XG5zKz1pbmRlbnRTcGFjZTt9XG5yZXR1cm4ocys9KG9iamVjdE5hbWUuaW5kZXhPZignICcpIT0tMT9cIjwvYXJyYXktaXRlbT5cXG5cIjpcIjwvXCIrb2JqZWN0TmFtZStcIj5cXG5cIikpO307U2FyaXNzYS5lc2NhcGU9ZnVuY3Rpb24oc1htbCl7cmV0dXJuIHNYbWwucmVwbGFjZSgvJi9nLFwiJmFtcDtcIikucmVwbGFjZSgvPC9nLFwiJmx0O1wiKS5yZXBsYWNlKC8+L2csXCImZ3Q7XCIpLnJlcGxhY2UoL1wiL2csXCImcXVvdDtcIikucmVwbGFjZSgvJy9nLFwiJmFwb3M7XCIpO307U2FyaXNzYS51bmVzY2FwZT1mdW5jdGlvbihzWG1sKXtyZXR1cm4gc1htbC5yZXBsYWNlKC8mYXBvczsvZyxcIidcIikucmVwbGFjZSgvJnF1b3Q7L2csXCJcXFwiXCIpLnJlcGxhY2UoLyZndDsvZyxcIj5cIikucmVwbGFjZSgvJmx0Oy9nLFwiPFwiKS5yZXBsYWNlKC8mYW1wOy9nLFwiJlwiKTt9O1Nhcmlzc2EudXBkYXRlQ3Vyc29yPWZ1bmN0aW9uKG9UYXJnZXRFbGVtZW50LHNWYWx1ZSl7aWYob1RhcmdldEVsZW1lbnQmJm9UYXJnZXRFbGVtZW50LnN0eWxlJiZvVGFyZ2V0RWxlbWVudC5zdHlsZS5jdXJzb3IhPXVuZGVmaW5lZCl7b1RhcmdldEVsZW1lbnQuc3R5bGUuY3Vyc29yPXNWYWx1ZTt9fTtTYXJpc3NhLnVwZGF0ZUNvbnRlbnRGcm9tVVJJPWZ1bmN0aW9uKHNGcm9tVXJsLG9UYXJnZXRFbGVtZW50LHhzbHRwcm9jLGNhbGxiYWNrLHNraXBDYWNoZSl7dHJ5e1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwid2FpdFwiKTt2YXIgeG1saHR0cD1uZXcgWE1MSHR0cFJlcXVlc3QoKTt4bWxodHRwLm9wZW4oXCJHRVRcIixzRnJvbVVybCx0cnVlKTt4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2lmKHhtbGh0dHAucmVhZHlTdGF0ZT09NCl7dHJ5e3ZhciBvRG9tRG9jPXhtbGh0dHAucmVzcG9uc2VYTUw7aWYob0RvbURvYyYmU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvRG9tRG9jKT09U2FyaXNzYS5QQVJTRURfT0spe1Nhcmlzc2EudXBkYXRlQ29udGVudEZyb21Ob2RlKHhtbGh0dHAucmVzcG9uc2VYTUwsb1RhcmdldEVsZW1lbnQseHNsdHByb2MpO2lmKGNhbGxiYWNrKXtjYWxsYmFjayhzRnJvbVVybCxvVGFyZ2V0RWxlbWVudCk7fX1cbmVsc2V7dGhyb3cgU2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChvRG9tRG9jKTt9fVxuY2F0Y2goZSl7aWYoY2FsbGJhY2spe2NhbGxiYWNrKHNGcm9tVXJsLG9UYXJnZXRFbGVtZW50LGUpO31cbmVsc2V7dGhyb3cgZTt9fX19O2lmKHNraXBDYWNoZSl7dmFyIG9sZGFnZT1cIlNhdCwgMSBKYW4gMjAwMCAwMDowMDowMCBHTVRcIjt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJJZi1Nb2RpZmllZC1TaW5jZVwiLG9sZGFnZSk7fVxueG1saHR0cC5zZW5kKFwiXCIpO31cbmNhdGNoKGUpe1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwiYXV0b1wiKTtpZihjYWxsYmFjayl7Y2FsbGJhY2soc0Zyb21Vcmwsb1RhcmdldEVsZW1lbnQsZSk7fVxuZWxzZXt0aHJvdyBlO319fTtTYXJpc3NhLnVwZGF0ZUNvbnRlbnRGcm9tTm9kZT1mdW5jdGlvbihvTm9kZSxvVGFyZ2V0RWxlbWVudCx4c2x0cHJvYyl7dHJ5e1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwid2FpdFwiKTtTYXJpc3NhLmNsZWFyQ2hpbGROb2RlcyhvVGFyZ2V0RWxlbWVudCk7dmFyIG93bmVyRG9jPW9Ob2RlLm5vZGVUeXBlPT1Ob2RlLkRPQ1VNRU5UX05PREU/b05vZGU6b05vZGUub3duZXJEb2N1bWVudDtpZihvd25lckRvYy5wYXJzZUVycm9yJiZvd25lckRvYy5wYXJzZUVycm9yLmVycm9yQ29kZSE9MCl7dmFyIHByZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO3ByZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KG93bmVyRG9jKSkpO29UYXJnZXRFbGVtZW50LmFwcGVuZENoaWxkKHByZSk7fVxuZWxzZXtpZih4c2x0cHJvYyl7b05vZGU9eHNsdHByb2MudHJhbnNmb3JtVG9Eb2N1bWVudChvTm9kZSk7fVxuaWYob1RhcmdldEVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpPT1cInRleHRhcmVhXCJ8fG9UYXJnZXRFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKT09XCJpbnB1dFwiKXtvVGFyZ2V0RWxlbWVudC52YWx1ZT1uZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKG9Ob2RlKTt9XG5lbHNle3RyeXtvVGFyZ2V0RWxlbWVudC5hcHBlbmRDaGlsZChvVGFyZ2V0RWxlbWVudC5vd25lckRvY3VtZW50LmltcG9ydE5vZGUob05vZGUsdHJ1ZSkpO31cbmNhdGNoKGUpe29UYXJnZXRFbGVtZW50LmlubmVySFRNTD1uZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKG9Ob2RlKTt9fX19XG5jYXRjaChlKXt0aHJvdyBlO31cbmZpbmFsbHl7U2FyaXNzYS51cGRhdGVDdXJzb3Iob1RhcmdldEVsZW1lbnQsXCJhdXRvXCIpO319O1Nhcmlzc2EuZm9ybVRvUXVlcnlTdHJpbmc9ZnVuY3Rpb24ob0Zvcm0pe3ZhciBxcz1cIlwiO2Zvcih2YXIgaT0wO2k8b0Zvcm0uZWxlbWVudHMubGVuZ3RoO2krKyl7dmFyIG9GaWVsZD1vRm9ybS5lbGVtZW50c1tpXTt2YXIgc0ZpZWxkTmFtZT1vRmllbGQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKT9vRmllbGQuZ2V0QXR0cmlidXRlKFwibmFtZVwiKTpvRmllbGQuZ2V0QXR0cmlidXRlKFwiaWRcIik7aWYoc0ZpZWxkTmFtZSYmKCghb0ZpZWxkLmRpc2FibGVkKXx8b0ZpZWxkLnR5cGU9PVwiaGlkZGVuXCIpKXtzd2l0Y2gob0ZpZWxkLnR5cGUpe2Nhc2VcImhpZGRlblwiOmNhc2VcInRleHRcIjpjYXNlXCJ0ZXh0YXJlYVwiOmNhc2VcInBhc3N3b3JkXCI6cXMrPXNGaWVsZE5hbWUrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KG9GaWVsZC52YWx1ZSkrXCImXCI7YnJlYWs7Y2FzZVwic2VsZWN0LW9uZVwiOnFzKz1zRmllbGROYW1lK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChvRmllbGQub3B0aW9uc1tvRmllbGQuc2VsZWN0ZWRJbmRleF0udmFsdWUpK1wiJlwiO2JyZWFrO2Nhc2VcInNlbGVjdC1tdWx0aXBsZVwiOmZvcih2YXIgaj0wO2o8b0ZpZWxkLmxlbmd0aDtqKyspe3ZhciBvcHRFbGVtPW9GaWVsZC5vcHRpb25zW2pdO2lmKG9wdEVsZW0uc2VsZWN0ZWQ9PT10cnVlKXtxcys9c0ZpZWxkTmFtZStcIltdXCIrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KG9wdEVsZW0udmFsdWUpK1wiJlwiO319XG5icmVhaztjYXNlXCJjaGVja2JveFwiOmNhc2VcInJhZGlvXCI6aWYob0ZpZWxkLmNoZWNrZWQpe3FzKz1zRmllbGROYW1lK1wiPVwiK2VuY29kZVVSSUNvbXBvbmVudChvRmllbGQudmFsdWUpK1wiJlwiO31cbmJyZWFrO319fVxucmV0dXJuIHFzLnN1YnN0cigwLHFzLmxlbmd0aC0xKTt9O1Nhcmlzc2EudXBkYXRlQ29udGVudEZyb21Gb3JtPWZ1bmN0aW9uKG9Gb3JtLG9UYXJnZXRFbGVtZW50LHhzbHRwcm9jLGNhbGxiYWNrKXt0cnl7U2FyaXNzYS51cGRhdGVDdXJzb3Iob1RhcmdldEVsZW1lbnQsXCJ3YWl0XCIpO3ZhciBwYXJhbXM9U2FyaXNzYS5mb3JtVG9RdWVyeVN0cmluZyhvRm9ybSkrXCImXCIrU2FyaXNzYS5SRU1PVEVfQ0FMTF9GTEFHK1wiPXRydWVcIjt2YXIgeG1saHR0cD1uZXcgWE1MSHR0cFJlcXVlc3QoKTt2YXIgYlVzZUdldD1vRm9ybS5nZXRBdHRyaWJ1dGUoXCJtZXRob2RcIikmJm9Gb3JtLmdldEF0dHJpYnV0ZShcIm1ldGhvZFwiKS50b0xvd2VyQ2FzZSgpPT1cImdldFwiO2lmKGJVc2VHZXQpe3htbGh0dHAub3BlbihcIkdFVFwiLG9Gb3JtLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKStcIj9cIitwYXJhbXMsdHJ1ZSk7fVxuZWxzZXt4bWxodHRwLm9wZW4oJ1BPU1QnLG9Gb3JtLmdldEF0dHJpYnV0ZShcImFjdGlvblwiKSx0cnVlKTt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LXR5cGVcIixcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiKTt4bWxodHRwLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LWxlbmd0aFwiLHBhcmFtcy5sZW5ndGgpO3htbGh0dHAuc2V0UmVxdWVzdEhlYWRlcihcIkNvbm5lY3Rpb25cIixcImNsb3NlXCIpO31cbnhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7dHJ5e2lmKHhtbGh0dHAucmVhZHlTdGF0ZT09NCl7dmFyIG9Eb21Eb2M9eG1saHR0cC5yZXNwb25zZVhNTDtpZihvRG9tRG9jJiZTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KG9Eb21Eb2MpPT1TYXJpc3NhLlBBUlNFRF9PSyl7U2FyaXNzYS51cGRhdGVDb250ZW50RnJvbU5vZGUoeG1saHR0cC5yZXNwb25zZVhNTCxvVGFyZ2V0RWxlbWVudCx4c2x0cHJvYyk7aWYoY2FsbGJhY2spe2NhbGxiYWNrKG9Gb3JtLG9UYXJnZXRFbGVtZW50KTt9fVxuZWxzZXt0aHJvdyBTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KG9Eb21Eb2MpO319fVxuY2F0Y2goZSl7aWYoY2FsbGJhY2spe2NhbGxiYWNrKG9Gb3JtLG9UYXJnZXRFbGVtZW50LGUpO31cbmVsc2V7dGhyb3cgZTt9fX07eG1saHR0cC5zZW5kKGJVc2VHZXQ/XCJcIjpwYXJhbXMpO31cbmNhdGNoKGUpe1Nhcmlzc2EudXBkYXRlQ3Vyc29yKG9UYXJnZXRFbGVtZW50LFwiYXV0b1wiKTtpZihjYWxsYmFjayl7Y2FsbGJhY2sob0Zvcm0sb1RhcmdldEVsZW1lbnQsZSk7fVxuZWxzZXt0aHJvdyBlO319XG5yZXR1cm4gZmFsc2U7fTtTYXJpc3NhLkZVTkNUSU9OX05BTUVfUkVHRVhQPW5ldyBSZWdFeHAoXCJcIik7U2FyaXNzYS5nZXRGdW5jdGlvbk5hbWU9ZnVuY3Rpb24ob0Z1bmMsYkZvcmNlKXt2YXIgbmFtZTtpZighbmFtZSl7aWYoYkZvcmNlKXtuYW1lPVwiU2FyaXNzYUFub255bW91c1wiK1Nhcmlzc2EuX2dldFVuaXF1ZVN1ZmZpeCgpO3dpbmRvd1tuYW1lXT1vRnVuYzt9XG5lbHNle25hbWU9bnVsbDt9fVxuaWYobmFtZSl7d2luZG93W25hbWVdPW9GdW5jO31cbnJldHVybiBuYW1lO307U2FyaXNzYS5zZXRSZW1vdGVKc29uQ2FsbGJhY2s9ZnVuY3Rpb24odXJsLGNhbGxiYWNrLGNhbGxiYWNrUGFyYW0pe2lmKCFjYWxsYmFja1BhcmFtKXtjYWxsYmFja1BhcmFtPVwiY2FsbGJhY2tcIjt9XG52YXIgY2FsbGJhY2tGdW5jdGlvbk5hbWU9U2FyaXNzYS5nZXRGdW5jdGlvbk5hbWUoY2FsbGJhY2ssdHJ1ZSk7dmFyIGlkPVwic2FyaXNzYV9qc29uX3NjcmlwdF9pZF9cIitTYXJpc3NhLl9nZXRVbmlxdWVTdWZmaXgoKTt2YXIgb0hlYWQ9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdO3ZhciBzY3JpcHRUYWc9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7c2NyaXB0VGFnLnR5cGU9J3RleHQvamF2YXNjcmlwdCc7c2NyaXB0VGFnLmlkPWlkO3NjcmlwdFRhZy5vbmxvYWQ9ZnVuY3Rpb24oKXt9O2lmKHVybC5pbmRleE9mKFwiP1wiKSE9LTEpe3VybCs9KFwiJlwiK2NhbGxiYWNrUGFyYW0rXCI9XCIrY2FsbGJhY2tGdW5jdGlvbk5hbWUpO31cbmVsc2V7dXJsKz0oXCI/XCIrY2FsbGJhY2tQYXJhbStcIj1cIitjYWxsYmFja0Z1bmN0aW9uTmFtZSk7fVxuc2NyaXB0VGFnLnNyYz11cmw7b0hlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTtyZXR1cm4gaWQ7fTtcblxuLy8gc2FyaXNzYV9pZWVtdV94cGF0aC5qc1xuXG5pZihTYXJpc3NhLl9TQVJJU1NBX0hBU19ET01fRkVBVFVSRSYmZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZShcIlhQYXRoXCIsXCIzLjBcIikpe1Nhcmlzc2FOb2RlTGlzdD1mdW5jdGlvbihpKXt0aGlzLmxlbmd0aD1pO307U2FyaXNzYU5vZGVMaXN0LnByb3RvdHlwZT1bXTtTYXJpc3NhTm9kZUxpc3QucHJvdG90eXBlLmNvbnN0cnVjdG9yPUFycmF5O1Nhcmlzc2FOb2RlTGlzdC5wcm90b3R5cGUuaXRlbT1mdW5jdGlvbihpKXtyZXR1cm4oaTwwfHxpPj10aGlzLmxlbmd0aCk/bnVsbDp0aGlzW2ldO307U2FyaXNzYU5vZGVMaXN0LnByb3RvdHlwZS5leHByPVwiXCI7aWYod2luZG93LlhNTERvY3VtZW50JiYoIVhNTERvY3VtZW50LnByb3RvdHlwZS5zZXRQcm9wZXJ0eSkpe1hNTERvY3VtZW50LnByb3RvdHlwZS5zZXRQcm9wZXJ0eT1mdW5jdGlvbih4LHkpe307fVxuU2FyaXNzYS5zZXRYcGF0aE5hbWVzcGFjZXM9ZnVuY3Rpb24ob0RvYyxzTnNTZXQpe29Eb2MuX3Nhcmlzc2FfdXNlQ3VzdG9tUmVzb2x2ZXI9dHJ1ZTt2YXIgbmFtZXNwYWNlcz1zTnNTZXQuaW5kZXhPZihcIiBcIik+LTE/c05zU2V0LnNwbGl0KFwiIFwiKTpbc05zU2V0XTtvRG9jLl9zYXJpc3NhX3hwYXRoTmFtZXNwYWNlcz1bXTtmb3IodmFyIGk9MDtpPG5hbWVzcGFjZXMubGVuZ3RoO2krKyl7dmFyIG5zPW5hbWVzcGFjZXNbaV07dmFyIGNvbG9uUG9zPW5zLmluZGV4T2YoXCI6XCIpO3ZhciBhc3NpZ25Qb3M9bnMuaW5kZXhPZihcIj1cIik7aWYoY29sb25Qb3M+MCYmYXNzaWduUG9zPmNvbG9uUG9zKzEpe3ZhciBwcmVmaXg9bnMuc3Vic3RyaW5nKGNvbG9uUG9zKzEsYXNzaWduUG9zKTt2YXIgdXJpPW5zLnN1YnN0cmluZyhhc3NpZ25Qb3MrMixucy5sZW5ndGgtMSk7b0RvYy5fc2FyaXNzYV94cGF0aE5hbWVzcGFjZXNbcHJlZml4XT11cmk7fWVsc2V7dGhyb3dcIkJhZCBmb3JtYXQgb24gbmFtZXNwYWNlIGRlY2xhcmF0aW9uKHMpIGdpdmVuXCI7fX19O1hNTERvY3VtZW50LnByb3RvdHlwZS5fc2FyaXNzYV91c2VDdXN0b21SZXNvbHZlcj1mYWxzZTtYTUxEb2N1bWVudC5wcm90b3R5cGUuX3Nhcmlzc2FfeHBhdGhOYW1lc3BhY2VzPVtdO1hNTERvY3VtZW50LnByb3RvdHlwZS5zZWxlY3ROb2Rlcz1mdW5jdGlvbihzRXhwcixjb250ZXh0Tm9kZSxyZXR1cm5TaW5nbGUpe3ZhciBuc0RvYz10aGlzO3ZhciBuc3Jlc29sdmVyO2lmKHRoaXMuX3Nhcmlzc2FfdXNlQ3VzdG9tUmVzb2x2ZXIpe25zcmVzb2x2ZXI9ZnVuY3Rpb24ocHJlZml4KXt2YXIgcz1uc0RvYy5fc2FyaXNzYV94cGF0aE5hbWVzcGFjZXNbcHJlZml4XTtpZihzKXtyZXR1cm4gczt9XG5lbHNle3Rocm93XCJObyBuYW1lc3BhY2UgVVJJIGZvdW5kIGZvciBwcmVmaXg6ICdcIitwcmVmaXgrXCInXCI7fX07fVxuZWxzZXtuc3Jlc29sdmVyPXRoaXMuY3JlYXRlTlNSZXNvbHZlcih0aGlzLmRvY3VtZW50RWxlbWVudCk7fVxudmFyIHJlc3VsdD1udWxsO2lmKCFyZXR1cm5TaW5nbGUpe3ZhciBvUmVzdWx0PXRoaXMuZXZhbHVhdGUoc0V4cHIsKGNvbnRleHROb2RlP2NvbnRleHROb2RlOnRoaXMpLG5zcmVzb2x2ZXIsWFBhdGhSZXN1bHQuT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsbnVsbCk7dmFyIG5vZGVMaXN0PW5ldyBTYXJpc3NhTm9kZUxpc3Qob1Jlc3VsdC5zbmFwc2hvdExlbmd0aCk7bm9kZUxpc3QuZXhwcj1zRXhwcjtmb3IodmFyIGk9MDtpPG5vZGVMaXN0Lmxlbmd0aDtpKyspe25vZGVMaXN0W2ldPW9SZXN1bHQuc25hcHNob3RJdGVtKGkpO31cbnJlc3VsdD1ub2RlTGlzdDt9XG5lbHNle3Jlc3VsdD10aGlzLmV2YWx1YXRlKHNFeHByLChjb250ZXh0Tm9kZT9jb250ZXh0Tm9kZTp0aGlzKSxuc3Jlc29sdmVyLFhQYXRoUmVzdWx0LkZJUlNUX09SREVSRURfTk9ERV9UWVBFLG51bGwpLnNpbmdsZU5vZGVWYWx1ZTt9XG5yZXR1cm4gcmVzdWx0O307RWxlbWVudC5wcm90b3R5cGUuc2VsZWN0Tm9kZXM9ZnVuY3Rpb24oc0V4cHIpe3ZhciBkb2M9dGhpcy5vd25lckRvY3VtZW50O2lmKGRvYy5zZWxlY3ROb2Rlcyl7cmV0dXJuIGRvYy5zZWxlY3ROb2RlcyhzRXhwcix0aGlzKTt9XG5lbHNle3Rocm93XCJNZXRob2Qgc2VsZWN0Tm9kZXMgaXMgb25seSBzdXBwb3J0ZWQgYnkgWE1MIEVsZW1lbnRzXCI7fX07WE1MRG9jdW1lbnQucHJvdG90eXBlLnNlbGVjdFNpbmdsZU5vZGU9ZnVuY3Rpb24oc0V4cHIsY29udGV4dE5vZGUpe3ZhciBjdHg9Y29udGV4dE5vZGU/Y29udGV4dE5vZGU6bnVsbDtyZXR1cm4gdGhpcy5zZWxlY3ROb2RlcyhzRXhwcixjdHgsdHJ1ZSk7fTtFbGVtZW50LnByb3RvdHlwZS5zZWxlY3RTaW5nbGVOb2RlPWZ1bmN0aW9uKHNFeHByKXt2YXIgZG9jPXRoaXMub3duZXJEb2N1bWVudDtpZihkb2Muc2VsZWN0U2luZ2xlTm9kZSl7cmV0dXJuIGRvYy5zZWxlY3RTaW5nbGVOb2RlKHNFeHByLHRoaXMpO31cbmVsc2V7dGhyb3dcIk1ldGhvZCBzZWxlY3ROb2RlcyBpcyBvbmx5IHN1cHBvcnRlZCBieSBYTUwgRWxlbWVudHNcIjt9fTtTYXJpc3NhLklTX0VOQUJMRURfU0VMRUNUX05PREVTPXRydWU7fVxuXG4vLyBqcXVlcnkueHNsdC5qc1xuXG52YXIgeHNsVHJhbnNmb3JtPXt2ZXJzaW9uOjIwMDcxMjAzLGRlYnVnOmZhbHNlLGluaXQ6ZnVuY3Rpb24oKXt0cnl7cGFyc2VGbG9hdChqUXVlcnkuZm4uanF1ZXJ5KT49MTt9Y2F0Y2goZSl7YWxlcnQoJ3hzbFRyYW5zZm9ybSByZXF1aXJlcyBqUXVlcnkgMS4wLjQgb3IgZ3JlYXRlciAuLi4gcGxlYXNlIGxvYWQgaXQgcHJpb3IgdG8geHNsVHJhbnNmb3JtJyk7fVxudHJ5e1Nhcmlzc2E7fWNhdGNoKGUpe2FsZXJ0KCdNaXNzaW5nIFNhcmlzc2EgLi4uIHBsZWFzZSBsb2FkIGl0IHByaW9yIHRvIHhzbFRyYW5zZm9ybScpO31cbmlmKCFqUXVlcnkubG9nKXtqUXVlcnkubG9nPWZ1bmN0aW9uKCl7fTtqUXVlcnkuZm4uZGVidWc9ZnVuY3Rpb24oKXt9O31cbmlmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygneHNsVHJhbnNmb3JtOmluaXQoKTogdmVyc2lvbiAnK3hzbFRyYW5zZm9ybS52ZXJzaW9uKTt9LFhNTFNlcmlhbGl6ZXI6bmV3IFhNTFNlcmlhbGl6ZXIoKSxzZXJpYWxpemU6ZnVuY3Rpb24oZGF0YSl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdzZXJpYWxpemUoKTogcmVjZWl2ZWQgJyt0eXBlb2YoZGF0YSkpO2lmKHR5cGVvZihkYXRhKT09J3N0cmluZycpe3JldHVybiBkYXRhO31cbnJldHVybiB0aGlzLlhNTFNlcmlhbGl6ZXIuc2VyaWFsaXplVG9TdHJpbmcoZGF0YSk7fSxsb2FkOmZ1bmN0aW9uKHhtbCxtZXRoKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ2xvYWQoKTogcmVjZWl2ZWQgJyt0eXBlb2YoeG1sKSk7dmFyIHI7aWYodHlwZW9mKHhtbCk9PSdvYmplY3QnKXtyZXR1cm4geG1sO31cbmlmKHhtbC5zdWJzdHJpbmcoMCwxKT09JzwnKXtyPXRoaXMubG9hZFN0cmluZyh4bWwpO31lbHNle3I9dGhpcy5sb2FkRmlsZSh4bWwsbWV0aCk7fVxuaWYocil7ci5zZXRQcm9wZXJ0eSgnU2VsZWN0aW9uTmFtZXNwYWNlcycsJ3htbG5zOnhzbD1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkvWFNML1RyYW5zZm9ybVwiJyk7ci5zZXRQcm9wZXJ0eSgnU2VsZWN0aW9uTGFuZ3VhZ2UnLCdYUGF0aCcpO3JldHVybiByO31lbHNle2lmKHRoaXMuZGVidWcpJC5sb2coJ1VuYWJsZSB0byBsb2FkICcreG1sKTtyZXR1cm4gZmFsc2U7fX0sbG9hZFN0cmluZzpmdW5jdGlvbihzdHIpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZFN0cmluZygpOiAnK3N0cisnOjonK3R5cGVvZihzdHIpKTt2YXIgcD1uZXcgRE9NUGFyc2VyKCk7dmFyIHhtbD1wLnBhcnNlRnJvbVN0cmluZyhzdHIsJ3RleHQveG1sJyk7aWYoIXhtbCl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdsb2FkU3RyaW5nKCk6IHBhcnNlRnJvbVN0cmluZygpIGZhaWxlZCcpO3JldHVybiBmYWxzZTt9XG5yZXR1cm4geG1sO30sbG9hZEZpbGU6ZnVuY3Rpb24odXJsLG1ldGgpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZEZpbGUoKTogJyt1cmwrJzo6Jyt0eXBlb2YodXJsKSk7aWYoIXVybCl7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdFUlJPUjogbG9hZEZpbGUoKSBtaXNzaW5nIHVybCcpO3JldHVybiBmYWxzZTt9XG52YXIgZG9jO3RoaXMueGhyc3VjY2Vzcz1mdW5jdGlvbihkYXRhLHN0cil7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCdsb2FkRmlsZSgpIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgKCcrc3RyKycpJyk7ZG9jPWRhdGE7cmV0dXJuIHRydWU7fTt0aGlzLnhocmVycm9yPWZ1bmN0aW9uKHhocixlcnIpe3dpbmRvdy5ERUJVRz10cnVlO2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnbG9hZEZpbGUoKSBmYWlsZWQgdG8gbG9hZCB0aGUgcmVxdWVzdGVkIGZpbGU6ICgnK2VycisnKSAtIHhtbDogJyt4aHIucmVzcG9uc2VYTUwrJyAtIHRleHQ6ICcreGhyLnJlc3BvbnNlVGV4dCk7ZG9jPW51bGw7cmV0dXJuIGZhbHNlO307aWYoIW1ldGgpbWV0aD1cIkdFVFwiOyQuYWpheCh7dHlwZTptZXRoLHVybDp1cmwsYXN5bmM6ZmFsc2Usc3VjY2Vzczp0aGlzLnhocnN1Y2Nlc3MsZXJyb3I6dGhpcy54aHJlcnJvcn0pO2lmKCFkb2Mpe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygnRVJST1I6IGRvY3VtZW50ICcrdXJsKycgbm90IGZvdW5kICg0MDQpLCBvciB1bmFibGUgdG8gbG9hZCcpO3JldHVybiBmYWxzZTt9XG5pZihkb2MubGVuZ3RoPT0wKXtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ0VSUk9SOiBkb2N1bWVudCAnK3VybCsnIGxvYWRlZCBpbiBsb2FkRmlsZSgpIGhhcyBubyBkYXRhJyk7cmV0dXJuIGZhbHNlO31cbnJldHVybiBkb2M7fSx0cmFuc2Zvcm06ZnVuY3Rpb24oeHNsLHhtbCxvcHRpb25zKXt2YXIgbG9nPXsneHNsJzp4c2wsJ3htbCc6eG1sLCdvcHRpb25zJzpvcHRpb25zfTtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ3RyYW5zZm9ybSgpOiAnK3hzbCsnOjonK3htbCsnOjonK29wdGlvbnMudG9TdHJpbmcoKSk7b3B0aW9ucz1vcHRpb25zfHx7fTt2YXIgeG1sPXsncmVxdWVzdCc6eG1sLCdkb2MnOnRoaXMubG9hZCh4bWwsb3B0aW9ucy5tZXRoKX07aWYob3B0aW9ucy54cGF0aCYmeG1sLmRvYyYmIWpRdWVyeS5icm93c2VyLm1zaWUpe3htbC5kb2M9eG1sLmRvYy5zZWxlY3RTaW5nbGVOb2RlKG9wdGlvbnMueHBhdGgudG9TdHJpbmcoKSk7aWYodGhpcy5kZWJ1ZykkLmxvZygndHJhbnNmb3JtKCk6IHhwYXRoIGhhcyBiZWVuIHJ1bi4uLnJlc3VsdGluZyBkb2M6ICcrKHRoaXMuc2VyaWFsaXplKHhtbC5kb2MpKSk7fVxudmFyIHJlc3VsdD17J3hzbCc6dGhpcy5sb2FkKHhzbCxvcHRpb25zLm1ldGgpfTtyZXN1bHQuanNvbj1mYWxzZTtpZihvcHRpb25zLmpzb24mJnhtbC5kb2Mpe3Jlc3VsdC5qc29uPXhtbC5kb2Muc2VsZWN0U2luZ2xlTm9kZShvcHRpb25zLmpzb24udG9TdHJpbmcoKSk7fVxudmFyIHByb2Nlc3Nvcj1uZXcgWFNMVFByb2Nlc3NvcigpO3Byb2Nlc3Nvci5pbXBvcnRTdHlsZXNoZWV0KHJlc3VsdC54c2wpO2lmKG9wdGlvbnMucGFyYW1zJiZwcm9jZXNzb3Ipe2lmKHRoaXMuZGVidWcpalF1ZXJ5LmxvZygndHJhbnNmb3JtKCk6IHJlY2VpdmVkIHhzbCBwYXJhbXM6ICcrb3B0aW9ucy5wYXJhbXMudG9TdHJpbmcoKSk7Zm9yKGtleSBpbiBvcHRpb25zLnBhcmFtcyl7cHJvY2Vzc29yLnNldFBhcmFtZXRlcihudWxsLGtleS50b1N0cmluZygpLG9wdGlvbnMucGFyYW1zW2tleV0udG9TdHJpbmcoKSk7fX1cbnJlc3VsdC5kb2M9cHJvY2Vzc29yLnRyYW5zZm9ybVRvRG9jdW1lbnQoeG1sLmRvYyk7dmFyIGVycm9yVHh0PVNhcmlzc2EuZ2V0UGFyc2VFcnJvclRleHQocmVzdWx0LmRvYyk7aWYodGhpcy5kZWJ1ZylqUXVlcnkubG9nKCd0cmFuc2Zvcm0oKTogU2FyaXNzYSBwYXJzZSB0ZXh0OiAnK2Vycm9yVHh0KTtpZihlcnJvclR4dCE9U2FyaXNzYS5QQVJTRURfT0spe3Jlc3VsdC5zdHJpbmc9U2FyaXNzYS5nZXRQYXJzZUVycm9yVGV4dChyZXN1bHQuZG9jKSsnIDo6IHVzaW5nICcreHNsKycgPT4gJyt4bWwucmVxdWVzdDtpZih0aGlzLmRlYnVnKWpRdWVyeS5sb2coJ3RyYW5zZm9ybSgpOiBlcnJvciBpbiB0cmFuc2Zvcm1hdGlvbjogJytTYXJpc3NhLmdldFBhcnNlRXJyb3JUZXh0KHJlc3VsdC5kb2MpKTtyZXR1cm4gcmVzdWx0O31cbnJlc3VsdC5zdHJpbmc9dGhpcy5zZXJpYWxpemUocmVzdWx0LmRvYyk7cmVzdWx0LnNjcmlwdHM9alF1ZXJ5KCdzY3JpcHQnLHJlc3VsdC5kb2MpLnRleHQoKTtyZXR1cm4gcmVzdWx0O319O3hzbFRyYW5zZm9ybS5pbml0KCk7alF1ZXJ5LmZuLmdldFRyYW5zZm9ybT1mdW5jdGlvbih4c2wseG1sLG9wdGlvbnMpe3ZhciBzZXR0aW5ncz17YXBwZW5kOmZhbHNlLHBhcmFtczp7fSx4cGF0aDonJyxldmFsOnRydWUsY2FsbGJhY2s6JycsanNvbjpmYWxzZSxtZXRoOlwiR0VUXCJ9O2pRdWVyeS5leHRlbmQoc2V0dGluZ3Msb3B0aW9ucyk7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ2dldFRyYW5zZm9ybTogJyt4c2wrJzo6Jyt4bWwrJzo6JytzZXR0aW5ncy50b1N0cmluZygpKTtpZigheHNsfHwheG1sKXtpZih4c2xUcmFuc2Zvcm0uZGVidWcpalF1ZXJ5LmxvZygnZ2V0VHJhbnNmb3JtOiBtaXNzaW5nIHhzbCBvciB4bWwnKTtyZXR1cm47fVxucmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB0cmFucz14c2xUcmFuc2Zvcm0udHJhbnNmb3JtKHhzbCx4bWwsc2V0dGluZ3MpO3ZhciByZT10cmFucy5zdHJpbmcubWF0Y2goLzxcXD94bWwuKj9cXD8+Lyk7aWYocmUpe3RyYW5zLnN0cmluZz10cmFucy5zdHJpbmcucmVwbGFjZShyZSwnJyk7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ2dldFRyYW5zZm9ybSgpOiBmb3VuZCBhbiB4bWwgZGVjbGFyYXRpb24gYW5kIHJlbW92ZWQgaXQnKTt9XG50cnl7aWYoc2V0dGluZ3MuYXBwZW5kKSQodGhpcykuYXBwZW5kKHRyYW5zLnN0cmluZyk7ZWxzZSBpZihzZXR0aW5ncy5yZXBsKSQodGhpcykucmVwbGFjZVdpdGgodHJhbnMuc3RyaW5nKTtlbHNlICQodGhpcykuaHRtbCh0cmFucy5zdHJpbmcpO31jYXRjaChlKXtpZih4c2xUcmFuc2Zvcm0uZGVidWcpJC5sb2coJ2dldFRyYW5zZm9ybTogZXJyb3IgcGxhY2luZyByZXN1bHRzIG9mIHRyYW5zZm9ybSBpbnRvIGVsZW1lbnQsIGZhbGxpbmcgYmFjayB0byBpbm5lckhUTUw6ICcrZS50b1N0cmluZygpKTskKHRoaXMpWzBdLmlubmVySFRNTD10cmFucy5zdHJpbmc7fVxuaWYoc2V0dGluZ3MuZXZhbCYmdHJhbnMuc2NyaXB0cyl7aWYodHJhbnMuc2NyaXB0cy5sZW5ndGg+MCl7aWYoeHNsVHJhbnNmb3JtLmRlYnVnKWpRdWVyeS5sb2coJ0ZvdW5kIHRleHQvamF2YXNjcmlwdCBpbiB0cmFuc2Zvcm1lZCByZXN1bHQnKTtldmFsLmNhbGwod2luZG93LHRyYW5zLnNjcmlwdHMpO319XG5pZihzZXR0aW5ncy5jYWxsYmFjayYmalF1ZXJ5LmlzRnVuY3Rpb24oc2V0dGluZ3MuY2FsbGJhY2spKXt2YXIganNvbj1mYWxzZTtpZihzZXR0aW5ncy5qc29uJiZ0cmFucy5qc29uKWV2YWwoXCJqc29uID0gXCIrdHJhbnMuanNvbi5maXJzdENoaWxkLmRhdGEpO3NldHRpbmdzLmNhbGxiYWNrLmFwcGx5KHdpbmRvdyxbdHJhbnMuc3RyaW5nLGpzb25dKTt9fSk7fTtcblxuLy8ganF1ZXJ5Lm1ldGFkYXRhLmpzXG5cbihmdW5jdGlvbigkKXskLmV4dGVuZCh7bWV0YWRhdGE6e2RlZmF1bHRzOnt0eXBlOidjbGFzcycsbmFtZTonbWV0YWRhdGEnLGNyZTovKHsuKn0pLyxzaW5nbGU6J21ldGFkYXRhJ30sc2V0VHlwZTpmdW5jdGlvbih0eXBlLG5hbWUpe3RoaXMuZGVmYXVsdHMudHlwZT10eXBlO3RoaXMuZGVmYXVsdHMubmFtZT1uYW1lO30sZ2V0OmZ1bmN0aW9uKGVsZW0sb3B0cyl7dmFyIHNldHRpbmdzPSQuZXh0ZW5kKHt9LHRoaXMuZGVmYXVsdHMsb3B0cyk7aWYoIXNldHRpbmdzLnNpbmdsZS5sZW5ndGgpc2V0dGluZ3Muc2luZ2xlPSdtZXRhZGF0YSc7dmFyIGRhdGE9JC5kYXRhKGVsZW0sc2V0dGluZ3Muc2luZ2xlKTtpZihkYXRhKXJldHVybiBkYXRhO2RhdGE9XCJ7fVwiO2lmKHNldHRpbmdzLnR5cGU9PVwiY2xhc3NcIil7dmFyIG09c2V0dGluZ3MuY3JlLmV4ZWMoZWxlbS5jbGFzc05hbWUpO2lmKG0pXG5kYXRhPW1bMV07fWVsc2UgaWYoc2V0dGluZ3MudHlwZT09XCJlbGVtXCIpe2lmKCFlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKVxucmV0dXJuIHVuZGVmaW5lZDt2YXIgZT1lbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKHNldHRpbmdzLm5hbWUpO2lmKGUubGVuZ3RoKVxuZGF0YT0kLnRyaW0oZVswXS5pbm5lckhUTUwpO31lbHNlIGlmKGVsZW0uZ2V0QXR0cmlidXRlIT11bmRlZmluZWQpe3ZhciBhdHRyPWVsZW0uZ2V0QXR0cmlidXRlKHNldHRpbmdzLm5hbWUpO2lmKGF0dHIpXG5kYXRhPWF0dHI7fVxuaWYoZGF0YS5pbmRleE9mKCd7Jyk8MClcbmRhdGE9XCJ7XCIrZGF0YStcIn1cIjtkYXRhPWV2YWwoXCIoXCIrZGF0YStcIilcIik7JC5kYXRhKGVsZW0sc2V0dGluZ3Muc2luZ2xlLGRhdGEpO3JldHVybiBkYXRhO319fSk7JC5mbi5tZXRhZGF0YT1mdW5jdGlvbihvcHRzKXtyZXR1cm4gJC5tZXRhZGF0YS5nZXQodGhpc1swXSxvcHRzKTt9O30pKGpRdWVyeSk7XG5cbi8vIGpxdWVyeS5jb29raWUuanNcblxualF1ZXJ5LmNvb2tpZT1mdW5jdGlvbihuYW1lLHZhbHVlLG9wdGlvbnMpe2lmKHR5cGVvZiB2YWx1ZSE9J3VuZGVmaW5lZCcpe29wdGlvbnM9b3B0aW9uc3x8e307aWYodmFsdWU9PT1udWxsKXt2YWx1ZT0nJztvcHRpb25zLmV4cGlyZXM9LTE7fVxudmFyIGV4cGlyZXM9Jyc7aWYob3B0aW9ucy5leHBpcmVzJiYodHlwZW9mIG9wdGlvbnMuZXhwaXJlcz09J251bWJlcid8fG9wdGlvbnMuZXhwaXJlcy50b1VUQ1N0cmluZykpe3ZhciBkYXRlO2lmKHR5cGVvZiBvcHRpb25zLmV4cGlyZXM9PSdudW1iZXInKXtkYXRlPW5ldyBEYXRlKCk7ZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpKyhvcHRpb25zLmV4cGlyZXMqMjQqNjAqNjAqMTAwMCkpO31lbHNle2RhdGU9b3B0aW9ucy5leHBpcmVzO31cbmV4cGlyZXM9JzsgZXhwaXJlcz0nK2RhdGUudG9VVENTdHJpbmcoKTt9XG52YXIgcGF0aD1vcHRpb25zLnBhdGg/JzsgcGF0aD0nKyhvcHRpb25zLnBhdGgpOicnO3ZhciBkb21haW49b3B0aW9ucy5kb21haW4/JzsgZG9tYWluPScrKG9wdGlvbnMuZG9tYWluKTonJzt2YXIgc2VjdXJlPW9wdGlvbnMuc2VjdXJlPyc7IHNlY3VyZSc6Jyc7ZG9jdW1lbnQuY29va2llPVtuYW1lLCc9JyxlbmNvZGVVUklDb21wb25lbnQodmFsdWUpLGV4cGlyZXMscGF0aCxkb21haW4sc2VjdXJlXS5qb2luKCcnKTt9ZWxzZXt2YXIgY29va2llVmFsdWU9bnVsbDtpZihkb2N1bWVudC5jb29raWUmJmRvY3VtZW50LmNvb2tpZSE9Jycpe3ZhciBjb29raWVzPWRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpO2Zvcih2YXIgaT0wO2k8Y29va2llcy5sZW5ndGg7aSsrKXt2YXIgY29va2llPWpRdWVyeS50cmltKGNvb2tpZXNbaV0pO2lmKGNvb2tpZS5zdWJzdHJpbmcoMCxuYW1lLmxlbmd0aCsxKT09KG5hbWUrJz0nKSl7Y29va2llVmFsdWU9ZGVjb2RlVVJJQ29tcG9uZW50KGNvb2tpZS5zdWJzdHJpbmcobmFtZS5sZW5ndGgrMSkpO2JyZWFrO319fVxucmV0dXJuIGNvb2tpZVZhbHVlO319OyIsIi8qXG4gKiBqc1RyZWUgMC45LjVcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMDggSXZhbiBCb3poYW5vdiAodmFrYXRhLmNvbSlcbiAqXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlczpcbiAqICAgaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAqICAgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC5odG1sXG4gKlxuICogRGF0ZTogMjAwOS0wMS0wM1xuICpcbiAqL1xuLy9qc2hpbnQgaWdub3JlOnN0YXJ0XG4vL2pzY3M6ZGlzYWJsZVxuXG4vLyBicm93c2VyIGZpeFxualF1ZXJ5LmJyb3dzZXIgPSB7fTtcbmpRdWVyeS5icm93c2VyLm1vemlsbGEgPSAvbW96aWxsYS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICEvd2Via2l0Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG5qUXVlcnkuYnJvd3Nlci53ZWJraXQgPSAvd2Via2l0Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG5qUXVlcnkuYnJvd3Nlci5vcGVyYSA9IC9vcGVyYS8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpO1xualF1ZXJ5LmJyb3dzZXIubXNpZSA9IC9tc2llLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSk7XG5cbi8vIGpRdWVyeSBwbHVnaW5cbmpRdWVyeS5mbi50cmVlID0gZnVuY3Rpb24gKG9wdHMpIHtcbiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZih0cmVlX2NvbXBvbmVudC5pbnN0ICYmIHRyZWVfY29tcG9uZW50Lmluc3RbalF1ZXJ5KHRoaXMpLmF0dHIoJ2lkJyldKSB7XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W2pRdWVyeSh0aGlzKS5hdHRyKCdpZCcpXS5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYob3B0cyAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHZhciB0bXAgPSBuZXcgdHJlZV9jb21wb25lbnQoKTtcbiAgICAgICAgICAgIHRtcC5pbml0KHRoaXMsIG9wdHMpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG4vLyBjb3JlXG5mdW5jdGlvbiB0cmVlX2NvbXBvbmVudCAoKSB7XG4gICAgLy8gaW5zdGFuY2UgbWFuYWdlclxuICAgIGlmKHR5cGVvZiB0cmVlX2NvbXBvbmVudC5pbnN0ID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgdHJlZV9jb21wb25lbnQuY250ciA9IDA7XG4gICAgICAgIHRyZWVfY29tcG9uZW50Lmluc3QgPSBbXTtcbiAgICAgICAgdHJlZV9jb21wb25lbnQuZHJvcCA9IFtdO1xuXG4gICAgICAgIHRyZWVfY29tcG9uZW50LmZvY3VzSW5zdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmVlX2NvbXBvbmVudC5pbnN0W3RyZWVfY29tcG9uZW50LmZvY3VzZWRdO1xuICAgICAgICB9XG4gICAgICAgIHRyZWVfY29tcG9uZW50Lm1vdXNlZG93biA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAkKCdodG1sJykuYXR0cignZGF0YS10b3VjaC1hY3Rpb24nLCAnbm9uZScpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdHJlZV9jb21wb25lbnQuZm9jdXNJbnN0KCk7XG4gICAgICAgICAgICBpZighX3RoaXMpIHJldHVybjtcblxuICAgICAgICAgICAgdmFyIHRtcCA9IGpRdWVyeShldmVudC50YXJnZXQpO1xuICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuZHJvcC5sZW5ndGggJiYgdG1wLmlzKFwiLlwiICsgdHJlZV9jb21wb25lbnQuZHJvcC5qb2luKFwiLCAuXCIpKSApIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5kcmFnID0galF1ZXJ5KFwiPGxpIGlkPSdkcmFnZ2VkJyBjbGFzcz0nZHJhZ2dlZCBmb3JlaWduIFwiICsgZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSArIFwiJz48YSBocmVmPScjJz5cIiArIHRtcC50ZXh0KCkgKyBcIjwvYT48L2xpPlwiKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5fZHJhZyA9IF90aGlzLmRyYWc7XG4gICAgICAgICAgICAgICAgX3RoaXMuaXNkb3duICAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBfdGhpcy5mb3JlaWduICAgID0gdG1wO1xuICAgICAgICAgICAgICAgIHRtcC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB0cmVlX2NvbXBvbmVudC5tb3VzZXVwID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICQoJ2h0bWwnKS5yZW1vdmVBdHRyKCdkYXRhLXRvdWNoLWFjdGlvbicpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdHJlZV9jb21wb25lbnQuZm9jdXNJbnN0KCk7XG4gICAgICAgICAgICBpZighX3RoaXMpIHJldHVybjtcblxuXG4gICAgICAgICAgICAvLyBDTEVBUiBUSU1FT1VUIEZPUiBPUEVOSU5HIEhPVkVSRUQgTk9ERVMgV0hJTEUgRFJBR0dJTkdcbiAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LnRvKSAgICBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQudG8pO1xuICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuc3RvKSAgICBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQuc3RvKTtcbiAgICAgICAgICAgIGlmKF90aGlzLmZvcmVpZ24gPT09IGZhbHNlICYmIF90aGlzLmRyYWcgJiYgX3RoaXMuZHJhZy5wYXJlbnROb2RlICYmIF90aGlzLmRyYWcucGFyZW50Tm9kZSA9PSBqUXVlcnkoX3RoaXMuY29udGFpbmVyKS5jaGlsZHJlbihcInVsOmVxKDApXCIpLmdldCgwKSkge1xuICAgICAgICAgICAgICAgIGpRdWVyeShfdGhpcy5kcmFnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAvLyBDQUxMIEZVTkNUSU9OIEZPUiBDT01QTEVUSU5HIE1PVkVcbiAgICAgICAgICAgICAgICBpZihfdGhpcy5tb3ZlVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gdHJlZV9jb21wb25lbnQuaW5zdFtqUXVlcnkoX3RoaXMubW92ZVJlZikucGFyZW50cyhcIi50cmVlOmVxKDApXCIpLmF0dHIoXCJpZFwiKV07XG4gICAgICAgICAgICAgICAgICAgIGlmKHRtcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG1wLm1vdmVkKF90aGlzLmNvbnRhaW5lci5maW5kKFwibGkuZHJhZ2dlZFwiKSwgX3RoaXMubW92ZVJlZiwgX3RoaXMubW92ZVR5cGUsIGZhbHNlLCAoX3RoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ19jb3B5ID09IFwib25cIiB8fCAoX3RoaXMuc2V0dGluZ3MucnVsZXMuZHJhZ19jb3B5ID09IFwiY3RybFwiICYmIGV2ZW50LmN0cmxLZXkpICkgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIF90aGlzLm1vdmVSZWYgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKF90aGlzLmRyYWcgJiYgX3RoaXMuZm9yZWlnbiAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkoX3RoaXMuZHJhZykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgaWYoX3RoaXMubW92ZVR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IHRyZWVfY29tcG9uZW50Lmluc3RbalF1ZXJ5KF90aGlzLm1vdmVSZWYpLnBhcmVudHMoXCIudHJlZTplcSgwKVwiKS5hdHRyKFwiaWRcIildO1xuICAgICAgICAgICAgICAgICAgICBpZih0bXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5zZXR0aW5ncy5jYWxsYmFjay5vbmRyb3AuY2FsbChudWxsLCBfdGhpcy5mb3JlaWduLmdldCgwKSwgX3RoaXMuZ2V0X25vZGUoIF90aGlzLm1vdmVSZWYpLmdldCgwKSwgX3RoaXMubW92ZVR5cGUsIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5mb3JlaWduID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBSRVNFVCBFVkVSWVRISU5HXG4gICAgICAgICAgICBqUXVlcnkoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgIF90aGlzLl9kcmFnICAgICAgICA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuZHJhZyAgICAgICAgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLmlzZG93biAgICA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuYXBwZW5kZWQgICAgPSBmYWxzZTtcbiAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5maW5kKFwibGkuZHJhZ2dlZFwiKS5yZW1vdmVDbGFzcyhcImRyYWdnZWRcIik7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG4gICAgICAgIHRyZWVfY29tcG9uZW50Lm1vdXNlbW92ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0cmVlX2NvbXBvbmVudC5mb2N1c0luc3QoKTtcbiAgICAgICAgICAgIGlmKCFfdGhpcykgcmV0dXJuO1xuXG4gICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgIGlmKF90aGlzLmlzZG93bikge1xuICAgICAgICAgICAgICAgIC8vIENMRUFSIFRJTUVPVVQgRk9SIE9QRU5JTkcgSE9WRVJFRCBOT0RFUyBXSElMRSBEUkFHR0lOR1xuICAgICAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LnRvKSBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQudG8pO1xuICAgICAgICAgICAgICAgIGlmKCFfdGhpcy5hcHBlbmRlZCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250YWluZXIuY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5hcHBlbmQoX3RoaXMuZHJhZyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBqUXVlcnkoX3RoaXMuZHJhZykub2Zmc2V0UGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRtcC5pcyhcImh0bWxcIikpIHRtcCA9IGpRdWVyeShcImJvZHlcIik7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnBvID0gdG1wLm9mZnNldCgpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5hcHBlbmRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGpRdWVyeShfdGhpcy5kcmFnKS5jc3MoeyBcImxlZnRcIiA6IChldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VYIC0gX3RoaXMucG8ubGVmdCAtIChfdGhpcy5zZXR0aW5ncy51aS5ydGwgPyBqUXVlcnkoX3RoaXMuZHJhZykud2lkdGgoKSA6IC01ICkgKSwgXCJ0b3BcIiA6IChldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gX3RoaXMucG8udG9wICArIChqUXVlcnkuYnJvd3Nlci5vcGVyYSA/IF90aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSA6IDApICsgMTUpIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYoZXZlbnQudGFyZ2V0LnRhZ05hbWUgPT0gXCJJTUdcIiAmJiBldmVudC50YXJnZXQuaWQgPT0gXCJtYXJrZXJcIikgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgdmFyIGNudCA9IGpRdWVyeShldmVudC50YXJnZXQpLnBhcmVudHMoXCIudHJlZTplcSgwKVwiKTtcblxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCBtb3Zpbmcgb3ZlciBhIHRyZWVcbiAgICAgICAgICAgICAgICBpZihjbnQuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuc3RvKSBjbGVhclRpbWVvdXQodHJlZV9jb21wb25lbnQuc3RvKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoalF1ZXJ5KF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiSU1HXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoX3RoaXMuZHJhZykuYXBwZW5kKFwiPGltZyBjbGFzcz0ncmVtb3ZlaWNvbicgc3R5bGU9J3Bvc2l0aW9uOmFic29sdXRlOyBcIiArIChfdGhpcy5zZXR0aW5ncy51aS5ydGwgPyBcInJpZ2h0XCIgOiBcImxlZnRcIiApICsgXCI6NHB4OyB0b3A6MHB4Oycgc3JjPSdcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcmVtb3ZlLmdpZicgLz5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KFwiI21hcmtlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W2NudC5hdHRyKFwiaWRcIildLm9mZl9oZWlnaHQoKTtcblxuICAgICAgICAgICAgICAgIC8vIGlmIG1vdmluZyBvdmVyIGFub3RoZXIgdHJlZSBhbmQgbXVsdGl0cmVlIGlzIGZhbHNlXG4gICAgICAgICAgICAgICAgaWYoIF90aGlzLmZvcmVpZ24gPT09IGZhbHNlICYmIGNudC5nZXQoMCkgIT0gX3RoaXMuY29udGFpbmVyLmdldCgwKSAmJiAoIV90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpdHJlZSB8fCAhdHJlZV9jb21wb25lbnQuaW5zdFtjbnQuYXR0cihcImlkXCIpXS5zZXR0aW5ncy5ydWxlcy5tdWx0aXRyZWUpICkge1xuICAgICAgICAgICAgICAgICAgICBpZihqUXVlcnkoX3RoaXMuZHJhZykuY2hpbGRyZW4oXCJJTUdcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeShfdGhpcy5kcmFnKS5hcHBlbmQoXCI8aW1nIGNsYXNzPSdyZW1vdmVpY29uJyBzdHlsZT0ncG9zaXRpb246YWJzb2x1dGU7IFwiICsgKF90aGlzLnNldHRpbmdzLnVpLnJ0bCA/IFwicmlnaHRcIiA6IFwibGVmdFwiICkgKyBcIjo0cHg7IHRvcDowcHg7JyBzcmM9J1wiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9yZW1vdmUuZ2lmJyAvPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlUmVmICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LnN0bykgY2xlYXJUaW1lb3V0KHRyZWVfY29tcG9uZW50LnN0byk7XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuc3RvID0gc2V0VGltZW91dCggZnVuY3Rpb24oKSB7IHRyZWVfY29tcG9uZW50Lmluc3RbY250LmF0dHIoXCJpZFwiKV0uc2Nyb2xsQ2hlY2soZXZlbnQub3JpZ2luYWxFdmVudC5wYWdlWCxldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZKTsgfSwgNTApO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1vdiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBzdCA9IGNudC5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICAgICAgIGlmKGV2ZW50LnRhcmdldC50YWdOYW1lID09IFwiQVwiICYmIGV2ZW50LnRhcmdldC5jbGFzc05hbWU9PVwidGl0bGVcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBqdXN0IGluIGNhc2UgaWYgaG92ZXIgaXMgb3ZlciB0aGUgZHJhZ2dhYmxlXG4gICAgICAgICAgICAgICAgICAgIGlmKGpRdWVyeShldmVudC50YXJnZXQpLmlzKFwiI2RyYWdnZWRcIikpIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZ29UbyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHggOiAoalF1ZXJ5KGV2ZW50LnRhcmdldCkub2Zmc2V0KCkubGVmdCAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgeSA6IChldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gdHJlZV9jb21wb25lbnQuaW5zdFtjbnQuYXR0cihcImlkXCIpXS5vZmZzZXQudG9wKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKGNudC5oYXNDbGFzcyhcInJ0bFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ29Uby54ICs9IGpRdWVyeShldmVudC50YXJnZXQpLndpZHRoKCkgLSA4O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKCAoZ29Uby55ICsgc3QpJV90aGlzLmxpX2hlaWdodCA8IF90aGlzLmxpX2hlaWdodC8zICsgMSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdiA9IFwiYmVmb3JlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnkgPSBldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gKGdvVG8ueSArIHN0KSVfdGhpcy5saV9oZWlnaHQgLSAyIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKChnb1RvLnkgKyBzdCklX3RoaXMubGlfaGVpZ2h0ID4gX3RoaXMubGlfaGVpZ2h0KjIvMyAtIDEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb3YgPSBcImFmdGVyXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnkgPSBldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZIC0gKGdvVG8ueSArIHN0KSVfdGhpcy5saV9oZWlnaHQgKyBfdGhpcy5saV9oZWlnaHQgLSAyIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdiA9IFwiaW5zaWRlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBnb1RvLnggLT0gMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNudC5oYXNDbGFzcyhcInJ0bFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdvVG8ueCArPSAzNjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGdvVG8ueSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQucGFnZVkgLSAoZ29Uby55ICsgc3QpJV90aGlzLmxpX2hlaWdodCArIE1hdGguZmxvb3IoX3RoaXMubGlfaGVpZ2h0LzIpIC0gMiA7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpLmhhc0NsYXNzKFwiY2xvc2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQudG8gPSBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7IF90aGlzLm9wZW5fYnJhbmNoKF90aGlzLmdldF9ub2RlKGV2ZW50LnRhcmdldCkpOyB9LCA1MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodHJlZV9jb21wb25lbnQuaW5zdFtjbnQuYXR0cihcImlkXCIpXS5jaGVja01vdmUoX3RoaXMuY29udGFpbmVyLmZpbmQoXCJsaS5kcmFnZ2VkXCIpLCBqUXVlcnkoZXZlbnQudGFyZ2V0KSwgbW92KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYobW92ID09IFwiaW5zaWRlXCIpICAgIGpRdWVyeShcIiNtYXJrZXJcIikuYXR0cihcInNyY1wiLCBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L3BsdXMuZ2lmXCIpLndpZHRoKDE0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNudC5oYXNDbGFzcyhcInJ0bFwiKSkgICAgeyBqUXVlcnkoXCIjbWFya2VyXCIpLmF0dHIoXCJzcmNcIiwgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfcGF0aCArIFwiZGVmYXVsdC9tYXJrZXJfcnRsLmdpZlwiKS53aWR0aCg0MCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICB7IGpRdWVyeShcIiNtYXJrZXJcIikuYXR0cihcInNyY1wiLCBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L21hcmtlci5naWZcIikud2lkdGgoNDApOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSAgICA9IG1vdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm1vdmVSZWYgICAgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoX3RoaXMuZHJhZykuY2hpbGRyZW4oXCJJTUdcIikucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoXCIjbWFya2VyXCIpLmNzcyh7IFwibGVmdFwiIDogZ29Uby54LTEgLCBcInRvcFwiIDogZ29Uby55LTIgfSkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoalF1ZXJ5KF90aGlzLmRyYWcpLmNoaWxkcmVuKFwiSU1HXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KF90aGlzLmRyYWcpLmFwcGVuZChcIjxpbWcgY2xhc3M9J3JlbW92ZWljb24nIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTsgXCIgKyAoX3RoaXMuc2V0dGluZ3MudWkucnRsID8gXCJyaWdodDowcHg7XCIgOiBcImxlZnQ6NHB4O1wiICkgKyBcIiB0b3A6MHB4Oycgc3JjPSdcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcmVtb3ZlLmdpZicgLz5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KFwiI21hcmtlclwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGpRdWVyeShfdGhpcy5kcmFnKS5jaGlsZHJlbihcIklNR1wiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KF90aGlzLmRyYWcpLmFwcGVuZChcIjxpbWcgY2xhc3M9J3JlbW92ZWljb24nIHN0eWxlPSdwb3NpdGlvbjphYnNvbHV0ZTsgXCIgKyAoX3RoaXMuc2V0dGluZ3MudWkucnRsID8gXCJyaWdodDowcHg7XCIgOiBcImxlZnQ6NHB4O1wiICkgKyBcIiB0b3A6MHB4Oycgc3JjPSdcIiArIF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvcmVtb3ZlLmdpZicgLz5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVR5cGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW92ZVJlZiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY250ciA6IHRyZWVfY29tcG9uZW50LmNudHIgKyssXG4gICAgICAgIHNldHRpbmdzIDoge1xuICAgICAgICAgICAgZGF0YSAgICA6IHtcbiAgICAgICAgICAgICAgICB0eXBlICAgIDogXCJwcmVkZWZpbmVkXCIsICAgIC8vIEVOVU0gW2pzb24sIHhtbF9mbGF0LCB4bWxfbmVzdGVkLCBwcmVkZWZpbmVkXVxuICAgICAgICAgICAgICAgIG1ldGhvZCAgICA6IFwiR0VUXCIsICAgICAgICAvLyBIT1cgVE8gUkVRVUVTVCBGSUxFU1xuICAgICAgICAgICAgICAgIGFzeW5jICAgIDogZmFsc2UsICAgICAgICAvLyBCT09MIC0gYXN5bmMgbG9hZGluZyBvbm9wZW5cbiAgICAgICAgICAgICAgICBhc3luY19kYXRhIDogZnVuY3Rpb24gKE5PREUpIHsgcmV0dXJuIHsgaWQgOiBqUXVlcnkoTk9ERSkuYXR0cihcImlkXCIpIHx8IDAgfSB9LCAvLyBQQVJBTUVURVJTIFBBU1NFRCBUTyBTRVJWRVJcbiAgICAgICAgICAgICAgICB1cmwgICAgICAgIDogZmFsc2UsICAgICAgICAvLyBGQUxTRSBvciBTVFJJTkcgLSB1cmwgdG8gZG9jdW1lbnQgdG8gYmUgdXNlZCAoYXN5bmMgb3Igbm90KVxuICAgICAgICAgICAgICAgIGpzb24gICAgOiBmYWxzZSAgICAgICAgICAgIC8vIEZBTFNFIG9yIE9CSkVDVCBpZiB0eXBlIGlzIEpTT04gYW5kIGFzeW5jIGlzIGZhbHNlIC0gdGhlIHRyZWUgZHVtcCBhcyBqc29uXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2VsZWN0ZWQgICAgOiBmYWxzZSwgICAgICAgIC8vIEZBTFNFIG9yIFNUUklORyBvciBBUlJBWVxuICAgICAgICAgICAgb3BlbmVkICAgICAgICA6IFtdLCAgICAgICAgICAgIC8vIEFSUkFZIE9GIElOSVRJQUxMWSBPUEVORUQgTk9ERVNcbiAgICAgICAgICAgIGxhbmd1YWdlcyAgICA6IFtdLCAgICAgICAgICAgIC8vIEFSUkFZIG9mIHN0cmluZyB2YWx1ZXMgKHdoaWNoIHdpbGwgYmUgdXNlZCBhcyBDU1MgY2xhc3NlcyAtIHNpIHRoZXkgbXVzdCBiZSB2YWxpZClcbiAgICAgICAgICAgIHBhdGggICAgICAgIDogZmFsc2UsICAgICAgICAvLyBGQUxTRSBvciBTVFJJTkcgKGlmIGZhbHNlIC0gd2lsbCBiZSBhdXRvZGV0ZWN0ZWQpXG4gICAgICAgICAgICBjb29raWVzICAgICAgICA6IGZhbHNlLCAgICAgICAgLy8gRkFMU0Ugb3IgT0JKRUNUIChwcmVmaXgsIG9wdHMgLSBmcm9tIGpxQ29va2llIC0gZXhwaXJlcywgcGF0aCwgZG9tYWluLCBzZWN1cmUpXG4gICAgICAgICAgICB1aSAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgZG90cyAgICAgICAgOiB0cnVlLCAgICAgICAgLy8gQk9PTCAtIGRvdHMgb3Igbm8gZG90c1xuICAgICAgICAgICAgICAgIHJ0bCAgICAgICAgICAgIDogZmFsc2UsICAgIC8vIEJPT0wgLSBpcyB0aGUgdHJlZSByaWdodC10by1sZWZ0XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uICAgIDogMCwgICAgICAgIC8vIElOVCAtIGR1cmF0aW9uIG9mIG9wZW4vY2xvc2UgYW5pbWF0aW9ucyBpbiBtaWxpc2Vjb25kc1xuICAgICAgICAgICAgICAgIGhvdmVyX21vZGUgICAgOiB0cnVlLCAgICAgICAgLy8gU0hPVUxEIGdldF8qIGZ1bmN0aW9ucyBjaGFnZSBmb2N1cyBvciBjaGFuZ2UgaG92ZXJlZCBpdGVtXG4gICAgICAgICAgICAgICAgc2Nyb2xsX3NwZCAgICA6IDQsXG4gICAgICAgICAgICAgICAgdGhlbWVfcGF0aCAgICA6IGZhbHNlLCAgICAvLyBQYXRoIHRvIHRoZW1lc1xuICAgICAgICAgICAgICAgIHRoZW1lX25hbWUgICAgOiBcImRlZmF1bHRcIiwvLyBOYW1lIG9mIHRoZW1lXG4gICAgICAgICAgICAgICAgY29udGV4dCAgICAgICAgOiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgICA6IFwiY3JlYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCAgICA6IFwiQ3JlYXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uICAgIDogXCJjcmVhdGUucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IGlmKE5PREUubGVuZ3RoICE9IDEpIHJldHVybiBmYWxzZTsgcmV0dXJuIFRSRUVfT0JKLmNoZWNrKFwiY3JlYXRhYmxlXCIsIE5PREUpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IFRSRUVfT0JKLmNyZWF0ZShmYWxzZSwgTk9ERSk7IH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgXCJzZXBhcmF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgIDogXCJyZW5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICAgIDogXCJSZW5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gICAgOiBcInJlbmFtZS5wbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGUgICAgOiBmdW5jdGlvbiAoTk9ERSwgVFJFRV9PQkopIHsgaWYoTk9ERS5sZW5ndGggIT0gMSkgcmV0dXJuIGZhbHNlOyByZXR1cm4gVFJFRV9PQkouY2hlY2soXCJyZW5hbWVhYmxlXCIsIE5PREUpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IFRSRUVfT0JKLnJlbmFtZSgpOyB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkICAgICAgICA6IFwiZGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbCAgICA6IFwiRGVsZXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uICAgIDogXCJyZW1vdmUuZ2lmXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlICAgIDogZnVuY3Rpb24gKE5PREUsIFRSRUVfT0JKKSB7IHJldHVybiBUUkVFX09CSi5jaGVjayhcImRlbGV0YWJsZVwiLCBOT0RFKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiAgICA6IGZ1bmN0aW9uIChOT0RFLCBUUkVFX09CSikgeyBOT0RFLmVhY2goIGZ1bmN0aW9uICgpIHsgVFJFRV9PQkoucmVtb3ZlKHRoaXMpOyB9KTsgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJ1bGVzICAgIDoge1xuICAgICAgICAgICAgICAgIG11bHRpcGxlICAgIDogZmFsc2UsICAgIC8vIEZBTFNFIHwgQ1RSTCB8IE9OIC0gbXVsdGlwbGUgc2VsZWN0aW9uIG9mZi8gd2l0aCBvciB3aXRob3V0IGhvbGRpbmcgQ3RybFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhICAgIDogZmFsc2UsICAgIC8vIEZBTFNFIG9yIFNUUklORyAtIGF0dHJpYnV0ZSBuYW1lICh1c2UgbWV0YWRhdGEgcGx1Z2luKVxuICAgICAgICAgICAgICAgIHR5cGVfYXR0ciAgICA6IFwicmVsXCIsICAgIC8vIFNUUklORyBhdHRyaWJ1dGUgbmFtZSAod2hlcmUgaXMgdGhlIHR5cGUgc3RvcmVkIGlmIG5vIG1ldGFkYXRhKVxuICAgICAgICAgICAgICAgIG11bHRpdHJlZSAgICA6IGZhbHNlLCAgICAvLyBCT09MIC0gaXMgZHJhZyBuIGRyb3AgYmV0d2VlbiB0cmVlcyBhbGxvd2VkXG4gICAgICAgICAgICAgICAgY3JlYXRlYXQgICAgOiBcImJvdHRvbVwiLCAgICAvLyBTVFJJTkcgKHRvcCBvciBib3R0b20pIG5ldyBub2RlcyBnZXQgaW5zZXJ0ZWQgYXQgdG9wIG9yIGJvdHRvbVxuICAgICAgICAgICAgICAgIHVzZV9pbmxpbmUgICAgOiBmYWxzZSwgICAgLy8gQ0hFQ0sgRk9SIElOTElORSBSVUxFUyAtIFJFUVVJUkVTIE1FVEFEQVRBXG4gICAgICAgICAgICAgICAgY2xpY2thYmxlICAgIDogXCJhbGxcIiwgICAgLy8gd2hpY2ggbm9kZSB0eXBlcyBjYW4gdGhlIHVzZXIgc2VsZWN0IHwgZGVmYXVsdCAtIGFsbFxuICAgICAgICAgICAgICAgIHJlbmFtZWFibGUgICAgOiBcImFsbFwiLCAgICAvLyB3aGljaCBub2RlIHR5cGVzIGNhbiB0aGUgdXNlciBzZWxlY3QgfCBkZWZhdWx0IC0gYWxsXG4gICAgICAgICAgICAgICAgZGVsZXRhYmxlICAgIDogXCJhbGxcIiwgICAgLy8gd2hpY2ggbm9kZSB0eXBlcyBjYW4gdGhlIHVzZXIgZGVsZXRlIHwgZGVmYXVsdCAtIGFsbFxuICAgICAgICAgICAgICAgIGNyZWF0YWJsZSAgICA6IFwiYWxsXCIsICAgIC8vIHdoaWNoIG5vZGUgdHlwZXMgY2FuIHRoZSB1c2VyIGNyZWF0ZSBpbiB8IGRlZmF1bHQgLSBhbGxcbiAgICAgICAgICAgICAgICBkcmFnZ2FibGUgICAgOiBcIm5vbmVcIiwgICAgLy8gd2hpY2ggbm9kZSB0eXBlcyBjYW4gdGhlIHVzZXIgbW92ZSB8IGRlZmF1bHQgLSBub25lIHwgXCJhbGxcIlxuICAgICAgICAgICAgICAgIGRyYWdydWxlcyAgICA6IFwiYWxsXCIsICAgIC8vIHdoYXQgbW92ZSBvcGVyYXRpb25zIGJldHdlZW4gbm9kZXMgYXJlIGFsbG93ZWQgfCBkZWZhdWx0IC0gbm9uZSB8IFwiYWxsXCJcbiAgICAgICAgICAgICAgICBkcmFnX2NvcHkgICAgOiBmYWxzZSwgICAgLy8gRkFMU0UgfCBDVFJMIHwgT04gLSBkcmFnIHRvIGNvcHkgb2ZmLyB3aXRoIG9yIHdpdGhvdXQgaG9sZGluZyBDdHJsXG4gICAgICAgICAgICAgICAgZHJvcHBhYmxlICAgIDogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsYW5nIDoge1xuICAgICAgICAgICAgICAgIG5ld19ub2RlICAgIDogXCJOZXcgZm9sZGVyXCIsXG4gICAgICAgICAgICAgICAgbG9hZGluZyAgICAgICAgOiBcIkxvYWRpbmcgLi4uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjYWxsYmFjayAgICA6IHsgICAgICAgICAgICAgICAgLy8gdmFyaW91cyBjYWxsYmFja3MgdG8gYXR0YWNoIGN1c3RvbSBsb2dpYyB0b1xuICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBmb2N1cyAgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgIGJlZm9yZWNoYW5nZTogZnVuY3Rpb24oTk9ERSxUUkVFX09CSikgeyByZXR1cm4gdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBtb3ZlICAgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgIGJlZm9yZW1vdmUgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7IHJldHVybiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgLy8gYmVmb3JlIGNyZWF0ZSAtIHNob3VsZCByZXR1cm4gdHJ1ZSB8IGZhbHNlXG4gICAgICAgICAgICAgICAgYmVmb3JlY3JlYXRlOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHsgcmV0dXJuIHRydWUgfSxcbiAgICAgICAgICAgICAgICAvLyBiZWZvcmUgcmVuYW1lIC0gc2hvdWxkIHJldHVybiB0cnVlIHwgZmFsc2VcbiAgICAgICAgICAgICAgICBiZWZvcmVyZW5hbWU6IGZ1bmN0aW9uKE5PREUsTEFORyxUUkVFX09CSikgeyByZXR1cm4gdHJ1ZSB9LFxuICAgICAgICAgICAgICAgIC8vIGJlZm9yZSBkZWxldGUgLSBzaG91bGQgcmV0dXJuIHRydWUgfCBmYWxzZVxuICAgICAgICAgICAgICAgIGJlZm9yZWRlbGV0ZTogZnVuY3Rpb24oTk9ERSxUUkVFX09CSikgeyByZXR1cm4gdHJ1ZSB9LFxuXG4gICAgICAgICAgICAgICAgb25jaGFuZ2UgICAgOiBmdW5jdGlvbihOT0RFLFRSRUVfT0JKKSB7IH0sICAgICAgICAgICAgICAgICAgICAvLyBmb2N1cyBjaGFuZ2VkXG4gICAgICAgICAgICAgICAgb25yZW5hbWUgICAgOiBmdW5jdGlvbihOT0RFLExBTkcsVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgLy8gbm9kZSByZW5hbWVkIElTTkVXIC0gVFJVRXxGQUxTRSwgY3VycmVudCBsYW5ndWFnZVxuICAgICAgICAgICAgICAgIG9ubW92ZSAgICAgICAgOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHsgfSwgICAgLy8gbW92ZSBjb21wbGV0ZWQgKFRZUEUgaXMgQkVMT1d8QUJPVkV8SU5TSURFKVxuICAgICAgICAgICAgICAgIG9uY29weSAgICAgICAgOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHsgfSwgICAgLy8gY29weSBjb21wbGV0ZWQgKFRZUEUgaXMgQkVMT1d8QUJPVkV8SU5TSURFKVxuICAgICAgICAgICAgICAgIG9uY3JlYXRlICAgIDogZnVuY3Rpb24oTk9ERSxSRUZfTk9ERSxUWVBFLFRSRUVfT0JKKSB7IH0sICAgIC8vIG5vZGUgY3JlYXRlZCwgcGFyZW50IG5vZGUgKFRZUEUgaXMgaW5zZXJ0QXQpXG4gICAgICAgICAgICAgICAgb25kZWxldGUgICAgOiBmdW5jdGlvbihOT0RFLCBUUkVFX09CSikgeyB9LCAgICAgICAgICAgICAgICAgICAgLy8gbm9kZSBkZWxldGVkXG4gICAgICAgICAgICAgICAgb25vcGVuICAgICAgICA6IGZ1bmN0aW9uKE5PREUsIFRSRUVfT0JKKSB7IH0sICAgICAgICAgICAgICAgICAgICAvLyBub2RlIG9wZW5lZFxuICAgICAgICAgICAgICAgIG9uY2xvc2UgICAgICAgIDogZnVuY3Rpb24oTk9ERSwgVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIG5vZGUgY2xvc2VkXG4gICAgICAgICAgICAgICAgZXJyb3IgICAgICAgIDogZnVuY3Rpb24oVEVYVCwgVFJFRV9PQkopIHsgfSwgICAgICAgICAgICAgICAgICAgIC8vIGVycm9yIG9jY3VyZWRcbiAgICAgICAgICAgICAgICAvLyBkb3VibGUgY2xpY2sgb24gbm9kZSAtIGRlZmF1bHRzIHRvIG9wZW4vY2xvc2UgJiBzZWxlY3RcbiAgICAgICAgICAgICAgICBvbmRibGNsayAgICA6IGZ1bmN0aW9uKE5PREUsIFRSRUVfT0JKKSB7IFRSRUVfT0JKLnRvZ2dsZV9icmFuY2guY2FsbChUUkVFX09CSiwgTk9ERSk7IFRSRUVfT0JKLnNlbGVjdF9icmFuY2guY2FsbChUUkVFX09CSiwgTk9ERSk7IH0sXG4gICAgICAgICAgICAgICAgLy8gcmlnaHQgY2xpY2sgLSB0byBwcmV2ZW50IHVzZTogRVYucHJldmVudERlZmF1bHQoKTsgRVYuc3RvcFByb3BhZ2F0aW9uKCk7IHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgIG9ucmd0Y2xrICAgIDogZnVuY3Rpb24oTk9ERSwgVFJFRV9PQkosIEVWKSB7IH0sXG4gICAgICAgICAgICAgICAgb25sb2FkICAgICAgICA6IGZ1bmN0aW9uKFRSRUVfT0JKKSB7IH0sXG4gICAgICAgICAgICAgICAgb25mb2N1cyAgICAgICAgOiBmdW5jdGlvbihUUkVFX09CSikgeyB9LFxuICAgICAgICAgICAgICAgIG9uZHJvcCAgICAgICAgOiBmdW5jdGlvbihOT0RFLFJFRl9OT0RFLFRZUEUsVFJFRV9PQkopIHt9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIElOSVRJQUxJWkFUSU9OXG4gICAgICAgIGluaXQgOiBmdW5jdGlvbihlbGVtLCBvcHRzKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXIgICAgICAgID0galF1ZXJ5KGVsZW0pO1xuICAgICAgICAgICAgaWYodGhpcy5jb250YWluZXIuc2l6ZSA9PSAwKSB7IGFsZXJ0KFwiSW52YWxpZCBjb250YWluZXIgbm9kZSFcIik7IHJldHVybiB9XG5cbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50Lmluc3RbdGhpcy5jbnRyXSA9IHRoaXM7XG4gICAgICAgICAgICBpZighdGhpcy5jb250YWluZXIuYXR0cihcImlkXCIpKSB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIixcImpzdHJlZV9cIiArIHRoaXMuY250cik7XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5pbnN0W3RoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKV0gPSB0cmVlX2NvbXBvbmVudC5pbnN0W3RoaXMuY250cl07XG4gICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5mb2N1c2VkID0gdGhpcy5jbnRyO1xuXG4gICAgICAgICAgICAvLyBNRVJHRSBPUFRJT05TIFdJVEggREVGQVVMVFNcbiAgICAgICAgICAgIGlmKG9wdHMgJiYgb3B0cy5jb29raWVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jb29raWVzID0galF1ZXJ5LmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLmNvb2tpZXMsb3B0cy5jb29raWVzKTtcbiAgICAgICAgICAgICAgICBkZWxldGUgb3B0cy5jb29raWVzO1xuICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNvb2tpZXMub3B0cykgdGhpcy5zZXR0aW5ncy5jb29raWVzLm9wdHMgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG9wdHMgJiYgb3B0cy5jYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sgPSBqUXVlcnkuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MuY2FsbGJhY2ssb3B0cy5jYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMuY2FsbGJhY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihvcHRzICYmIG9wdHMuZGF0YSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuZGF0YSA9IGpRdWVyeS5leHRlbmQoe30sdGhpcy5zZXR0aW5ncy5kYXRhLG9wdHMuZGF0YSk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMuZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG9wdHMgJiYgb3B0cy51aSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MudWkgPSBqUXVlcnkuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MudWksb3B0cy51aSk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG9wdHMudWk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihvcHRzICYmIG9wdHMucnVsZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnJ1bGVzID0galF1ZXJ5LmV4dGVuZCh7fSx0aGlzLnNldHRpbmdzLnJ1bGVzLG9wdHMucnVsZXMpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLnJ1bGVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYob3B0cyAmJiBvcHRzLmxhbmcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmxhbmcgPSBqUXVlcnkuZXh0ZW5kKHt9LHRoaXMuc2V0dGluZ3MubGFuZyxvcHRzLmxhbmcpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBvcHRzLmxhbmc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzICAgICAgICA9IGpRdWVyeS5leHRlbmQoe30sdGhpcy5zZXR0aW5ncyxvcHRzKTtcblxuICAgICAgICAgICAgLy8gUEFUSCBUTyBJTUFHRVMgQU5EIFhTTFxuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5wYXRoID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXRoID0gXCJcIjtcbiAgICAgICAgICAgICAgICBqUXVlcnkoXCJzY3JpcHRcIikuZWFjaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNyYy50b1N0cmluZygpLm1hdGNoKC90cmVlX2NvbXBvbmVudC4qP2pzLiokLykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBhdGggPSB0aGlzLnNyYy50b1N0cmluZygpLnJlcGxhY2UoL3RyZWVfY29tcG9uZW50Lio/anMuKiQvLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB0aGlzLnBhdGggPSB0aGlzLnNldHRpbmdzLnBhdGg7XG5cbiAgICAgICAgICAgIC8vIERFQUwgV0lUSCBMQU5HVUFHRSBWRVJTSU9OU1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50X2xhbmcgICAgPSB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcyAmJiB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGggPyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1swXSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMgJiYgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zbiA9IGdldF9zaGVldF9udW0oXCJ0cmVlX2NvbXBvbmVudC5jc3NcIik7XG4gICAgICAgICAgICAgICAgdmFyIHN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdmFyIGlkID0gdGhpcy5jb250YWluZXIuYXR0cihcImlkXCIpID8gXCIjXCIgKyB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIikgOiBcIi50cmVlXCI7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBsbiA9IDA7IGxuIDwgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoOyBsbisrKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0ID0gYWRkX2NzcyhpZCArIFwiIC5cIiArIHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2xuXSwgdGhpcy5zbik7XG4gICAgICAgICAgICAgICAgICAgIGlmKHN0ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbbG5dID09IHRoaXMuY3VycmVudF9sYW5nKSAgICBzdC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBEUk9QUEFCTEVTXG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IoaSBpbiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZSkge1xuICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5kcm9wLnB1c2godGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGVbaV0pO1xuICAgICAgICAgICAgICAgICAgICB0cmVlX2NvbXBvbmVudC5kcm9wID0galF1ZXJ5LnVuaXF1ZSh0cmVlX2NvbXBvbmVudC5kcm9wKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFRIRU1FU1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoID09PSBmYWxzZSkgdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoID0gdGhpcy5wYXRoICsgXCJ0aGVtZXMvXCI7XG4gICAgICAgICAgICB0aGlzLnRoZW1lID0gdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZSArIFwiL1wiO1xuICAgICAgICAgICAgYWRkX3NoZWV0KF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvc3R5bGUuY3NzXCIpO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS50aGVtZV9uYW1lICE9IFwiZGVmYXVsdFwiKSBhZGRfc2hlZXQoX3RoaXMudGhlbWUgKyBcInN0eWxlLmNzc1wiKTtcblxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoXCJ0cmVlXCIpO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ydGwpIHRoaXMuY29udGFpbmVyLmFkZENsYXNzKFwicnRsXCIpO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSkgdGhpcy5zZWxlY3RlZF9hcnIgPSBbXTtcbiAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuZG90cyA9PSBmYWxzZSkgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoXCJub19kb3RzXCIpO1xuXG4gICAgICAgICAgICAvLyBDT05URVhUIE1FTlVcbiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGZhbHNlO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5jb250ZXh0ICE9IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0ciA9ICc8ZGl2IGNsYXNzPVwiY29udGV4dFwiPic7XG4gICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXSA9PSBcInNlcGFyYXRvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCI8c3BhbiBjbGFzcz0nc2VwYXJhdG9yJz4mbmJzcDs8L3NwYW4+XCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgaWNuID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmljb24pIGljbiA9ICdiYWNrZ3JvdW5kLWltYWdlOnVybChcXCcnICsgKCB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWNvbi5pbmRleE9mKFwiL1wiKSA9PSAtMSA/IHRoaXMudGhlbWUgKyB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWNvbiA6IHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5pY29uICkgKyAnXFwnKTsnO1xuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzxhIHJlbD1cIicgKyB0aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWQgKyAnXCIgaHJlZj1cIiNcIiBzdHlsZT1cIicgKyBpY24gKyAnXCI+JyArIHRoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXS5sYWJlbCArICc8L2E+JztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RyICs9ICc8L2Rpdj4nO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IGpRdWVyeShzdHIpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmFwcGVuZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmhvdmVyZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMubG9ja2VkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIENSRUFURSBEVU1NWSBGT1IgTU9WSU5HXG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdnYWJsZSAhPSBcIm5vbmVcIiAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlcyAhPSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgalF1ZXJ5KFwiPGltZz5cIilcbiAgICAgICAgICAgICAgICAgICAgLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQgICAgICAgIDogXCJtYXJrZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYyAgICA6IF90aGlzLnNldHRpbmdzLnVpLnRoZW1lX3BhdGggKyBcImRlZmF1bHQvbWFya2VyLmdpZlwiXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ICAgICAgICA6IFwiOHB4XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCAgICAgICAgOiBcIjQycHhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXkgICAgICAgIDogXCJibG9ja1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gICAgOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0ICAgICAgICA6IFwiMzBweFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wICAgICAgICAgICAgOiBcIjMwcHhcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleCAgICAgICAgOiBcIjEwMDBcIlxuICAgICAgICAgICAgICAgICAgICB9KS5oaWRlKCkuYXBwZW5kVG8oXCJib2R5XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgICAgICB0aGlzLmF0dGFjaEV2ZW50cygpO1xuICAgICAgICAgICAgdGhpcy5mb2N1cygpO1xuICAgICAgICB9LFxuICAgICAgICBvZmZfaGVpZ2h0IDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYodGhpcy5vZmZzZXQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuY3NzKHsgcG9zaXRpb24gOiBcInJlbGF0aXZlXCIgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXQoKTtcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gMDtcbiAgICAgICAgICAgICAgICB0bXAgPSBwYXJzZUludChqUXVlcnkuY3NzKHRoaXMuY29udGFpbmVyLmdldCgwKSwgXCJwYWRkaW5nVG9wXCIsIHRydWUpLDEwKTtcbiAgICAgICAgICAgICAgICBpZih0bXApIHRoaXMub2Zmc2V0LnRvcCArPSB0bXA7XG4gICAgICAgICAgICAgICAgdG1wID0gcGFyc2VJbnQoalF1ZXJ5LmNzcyh0aGlzLmNvbnRhaW5lci5nZXQoMCksIFwiYm9yZGVyVG9wV2lkdGhcIiwgdHJ1ZSksMTApO1xuICAgICAgICAgICAgICAgIGlmKHRtcCkgdGhpcy5vZmZzZXQudG9wICs9IHRtcDtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jc3MoeyBwb3NpdGlvbiA6IFwiXCIgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZighdGhpcy5saV9oZWlnaHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5jb250YWluZXIuZmluZChcInVsIGxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlfaGVpZ2h0ID0gdG1wLmZpbmQoJy50aXRsZTpmaXJzdCcpLmhlaWdodCgpICsgMTtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5saV9oZWlnaHQpIHRoaXMubGlfaGVpZ2h0ID0gMTg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIFJFUEFJTlQgVFJFRVxuICAgICAgICByZWZyZXNoIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgICAgICAgLy8gU0FWRSBPUEVORURcbiAgICAgICAgICAgIHRoaXMub3BlbmVkID0gQXJyYXkoKTtcbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuY29va2llcyAmJiBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX29wZW4nKSkge1xuICAgICAgICAgICAgICAgIHZhciBzdHIgPSBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX29wZW4nKTtcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gc3RyLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0bXAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5vcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodGhpcy5zZXR0aW5ncy5vcGVuZWQgIT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0aGlzLnNldHRpbmdzLm9wZW5lZCwgZnVuY3Rpb24gKGksIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5vcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoXCJsaS5vcGVuXCIpLmVhY2goZnVuY3Rpb24gKGkpIHsgX3RoaXMub3BlbmVkLnB1c2goXCIjXCIgKyB0aGlzLmlkKTsgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNBVkUgU0VMRUNURURcbiAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnNlbGVjdGVkID0gQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNlbGVjdGVkX2Fycikge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0aGlzLnNlbGVjdGVkX2FyciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0dGluZ3Muc2VsZWN0ZWQucHVzaChcIiNcIiArIHRoaXMuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZC5wdXNoKFwiI1wiICsgdGhpcy5zZWxlY3RlZC5hdHRyKFwiaWRcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyplbHNlIGlmKHRoaXMuc2V0dGluZ3MuY29va2llcyAmJiBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX3NlbGVjdGVkJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnNlbGVjdGVkID0gQXJyYXkoKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RyID0galF1ZXJ5LmNvb2tpZSh0aGlzLnNldHRpbmdzLmNvb2tpZXMucHJlZml4ICsgJ19zZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIHZhciB0bXAgPSBzdHIuc3BsaXQoXCIsXCIpO1xuICAgICAgICAgICAgICAgIGpRdWVyeS5lYWNoKHRtcCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXR0aW5ncy5zZWxlY3RlZC5wdXNoKFwiI1wiICsgdGhpcy5yZXBsYWNlKC9eIy8sXCJcIikpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSovXG4gICAgICAgICAgICBlbHNlIGlmKHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRtcCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgaWYoKHR5cGVvZiB0aGlzLnNldHRpbmdzLnNlbGVjdGVkKS50b0xvd2VyQ2FzZSgpID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmVhY2godGhpcy5zZXR0aW5ncy5zZWxlY3RlZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnB1c2goXCIjXCIgKyB0aGlzLnJlcGxhY2UoL14jLyxcIlwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHRtcC5wdXNoKFwiI1wiICsgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZC5yZXBsYWNlKC9eIy8sXCJcIikpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3Muc2VsZWN0ZWQgPSB0bXA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKG9iaiAmJiB0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wZW5lZCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIG9iai5maW5kKFwibGkub3BlblwiKS5lYWNoKGZ1bmN0aW9uIChpKSB7IF90aGlzLm9wZW5lZC5wdXNoKFwiI1wiICsgdGhpcy5pZCk7IH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VfYnJhbmNoKG9iaiwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuaHRtbChcIlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuX2JyYW5jaChvYmosIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMucmVzZWxlY3QuYXBwbHkoX3RoaXMpOyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNscyA9IFwidHJlZS1kZWZhdWx0XCI7XG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLnRoZW1lX25hbWUgIT0gXCJkZWZhdWx0XCIpIGNscyArPSBcIiB0cmVlLVwiICsgX3RoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZTtcblxuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLnR5cGUgPT0gXCJ4bWxfZmxhdFwiIHx8IHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwieG1sX25lc3RlZFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3J0b3AgPSB0aGlzLmNvbnRhaW5lci5nZXQoMCkuc2Nyb2xsVG9wO1xuICAgICAgICAgICAgICAgIHZhciB4c2wgPSAodGhpcy5zZXR0aW5ncy5kYXRhLnR5cGUgPT0gXCJ4bWxfZmxhdFwiKSA/IFwiZmxhdC54c2xcIiA6IFwibmVzdGVkLnhzbFwiO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmdldFRyYW5zZm9ybSh0aGlzLnBhdGggKyB4c2wsIHRoaXMuc2V0dGluZ3MuZGF0YS51cmwsIHsgcGFyYW1zIDogeyB0aGVtZV9uYW1lIDogY2xzLCB0aGVtZV9wYXRoIDogX3RoaXMudGhlbWUgfSwgbWV0aCA6IF90aGlzLnNldHRpbmdzLmRhdGEubWV0aG9kICxjYWxsYmFjazogZnVuY3Rpb24gKCkgeyBfdGhpcy5yZXNlbGVjdC5hcHBseShfdGhpcyk7IH0gfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcImpzb25cIikge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5qc29uKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuanNvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLnNldHRpbmdzLmRhdGEuanNvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSB0aGlzLnBhcnNlSlNPTih0aGlzLnNldHRpbmdzLmRhdGEuanNvbltpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBzdHIgPSB0aGlzLnBhcnNlSlNPTih0aGlzLnNldHRpbmdzLmRhdGEuanNvbik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmh0bWwoXCI8dWwgY2xhc3M9J1wiICsgY2xzICsgXCInPlwiICsgc3RyICsgXCI8L3VsPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImxpOmxhc3QtY2hpbGRcIikuYWRkQ2xhc3MoXCJsYXN0XCIpLmVuZCgpLmZpbmQoXCJsaTpoYXModWwpXCIpLm5vdChcIi5vcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGlcIikubm90KFwiLm9wZW5cIikubm90KFwiLmNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzZWxlY3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLm1ldGhvZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybCAgICAgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLnVybCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgICAgICAgIDogdGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jX2RhdGEoZmFsc2UpLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGUgICAgOiBcImpzb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgICAgICAgIDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IF90aGlzLnBhcnNlSlNPTihkYXRhW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBzdHIgPSBfdGhpcy5wYXJzZUpTT04oZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGFpbmVyLmh0bWwoXCI8dWwgY2xhc3M9J1wiICsgY2xzICsgXCInPlwiICsgc3RyICsgXCI8L3VsPlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250YWluZXIuZmluZChcImxpOmxhc3QtY2hpbGRcIikuYWRkQ2xhc3MoXCJsYXN0XCIpLmVuZCgpLmZpbmQoXCJsaTpoYXModWwpXCIpLm5vdChcIi5vcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5maW5kKFwibGlcIikubm90KFwiLm9wZW5cIikubm90KFwiLmNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVzZWxlY3QuYXBwbHkoX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5jaGlsZHJlbihcInVsOmVxKDApXCIpLmF0dHIoXCJjbGFzc1wiLCBjbHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmZpbmQoXCJsaTpsYXN0LWNoaWxkXCIpLmFkZENsYXNzKFwibGFzdFwiKS5lbmQoKS5maW5kKFwibGk6aGFzKHVsKVwiKS5ub3QoXCIub3BlblwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGlcIikubm90KFwiLm9wZW5cIikubm90KFwiLmNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNlbGVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyBDT05WRVJUIEpTT04gVE8gSFRNTFxuICAgICAgICBwYXJzZUpTT04gOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgdmFyIHN0ciA9IFwiXCI7XG4gICAgICAgICAgICBzdHIgKz0gXCI8bGkgXCI7XG4gICAgICAgICAgICB2YXIgY2xzID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IoaSBpbiBkYXRhLmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICBpZihpID09IFwiY2xhc3NcIikge1xuICAgICAgICAgICAgICAgICAgICBzdHIgKz0gXCIgY2xhc3M9J1wiICsgZGF0YS5hdHRyaWJ1dGVzW2ldICsgXCIgXCI7XG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuc3RhdGUgPT0gXCJjbG9zZWRcIiB8fCBkYXRhLnN0YXRlID09IFwib3BlblwiKSBzdHIgKz0gXCIgXCIgKyBkYXRhLnN0YXRlICsgXCIgXCI7XG4gICAgICAgICAgICAgICAgICAgIHN0ciArPSBcIicgXCI7XG4gICAgICAgICAgICAgICAgICAgIGNscyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Ugc3RyICs9IFwiIFwiICsgaSArIFwiPSdcIiArIGRhdGEuYXR0cmlidXRlc1tpXSArIFwiJyBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCFjbHMgJiYgKGRhdGEuc3RhdGUgPT0gXCJjbG9zZWRcIiB8fCBkYXRhLnN0YXRlID09IFwib3BlblwiKSkgc3RyICs9IFwiIGNsYXNzPSdcIiArIGRhdGEuc3RhdGUgKyBcIicgXCI7XG4gICAgICAgICAgICBzdHIgKz0gXCI+XCI7XG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgYXR0cltcImhyZWZcIl0gPSBcIiNcIjtcbiAgICAgICAgICAgICAgICAgICAgYXR0cltcInN0eWxlXCJdID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgYXR0cltcImNsYXNzXCJdID0gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV07XG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0gJiYgKHR5cGVvZiBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXMpLnRvTG93ZXJDYXNlKCkgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5hdHRyaWJ1dGVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaiA9PSBcInN0eWxlXCIgfHwgaiA9PSBcImNsYXNzXCIpICAgIGF0dHJbal0gKz0gXCIgXCIgKyBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltqXSAgPSBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXNbal07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXSAmJiBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY24gPSBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmljb24uaW5kZXhPZihcIi9cIikgPT0gLTEgPyB0aGlzLnRoZW1lICsgZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5pY29uIDogZGF0YS5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXS5pY29uO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cltcInN0eWxlXCJdICs9IFwiIDsgYmFja2dyb3VuZC1pbWFnZTp1cmwoJ1wiICsgaWNuICsgXCInKTsgXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiPGFcIjtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gYXR0cikgc3RyICs9ICcgJyArIGogKyAnPVwiJyArIGF0dHJbal0gKyAnXCIgJztcbiAgICAgICAgICAgICAgICAgICAgc3RyICs9IFwiPlwiICsgKCAodHlwZW9mIGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0udGl0bGUpLnRvTG93ZXJDYXNlKCkgIT0gXCJ1bmRlZmluZWRcIiA/IGRhdGEuZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0udGl0bGUgOiBkYXRhLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dICkgKyBcIjwvYT5cIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IFtdO1xuICAgICAgICAgICAgICAgIGF0dHJbXCJocmVmXCJdID0gXCIjXCI7XG4gICAgICAgICAgICAgICAgYXR0cltcInN0eWxlXCJdID0gXCJcIjtcbiAgICAgICAgICAgICAgICBhdHRyW1wiY2xhc3NcIl0gPSBcIlwiO1xuICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgZGF0YS5kYXRhLmF0dHJpYnV0ZXMpLnRvTG93ZXJDYXNlKCkgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiBkYXRhLmRhdGEuYXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoaSA9PSBcInN0eWxlXCIgfHwgaSA9PSBcImNsYXNzXCIpICAgIGF0dHJbaV0gKz0gXCIgXCIgKyBkYXRhLmRhdGEuYXR0cmlidXRlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJbaV0gID0gZGF0YS5kYXRhLmF0dHJpYnV0ZXNbaV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoZGF0YS5kYXRhLmljb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGljbiA9IGRhdGEuZGF0YS5pY29uLmluZGV4T2YoXCIvXCIpID09IC0xID8gdGhpcy50aGVtZSArIGRhdGEuZGF0YS5pY29uIDogZGF0YS5kYXRhLmljb247XG4gICAgICAgICAgICAgICAgICAgIGF0dHJbXCJzdHlsZVwiXSArPSBcIiA7IGJhY2tncm91bmQtaW1hZ2U6dXJsKCdcIiArIGljbiArIFwiJyk7XCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0ciArPSBcIjxhXCI7XG4gICAgICAgICAgICAgICAgZm9yKGkgaW4gYXR0cikgc3RyICs9ICcgJyArIGkgKyAnPVwiJyArIGF0dHJbaV0gKyAnXCIgJztcbiAgICAgICAgICAgICAgICBzdHIgKz0gXCI+XCIgKyAoICh0eXBlb2YgZGF0YS5kYXRhLnRpdGxlKS50b0xvd2VyQ2FzZSgpICE9IFwidW5kZWZpbmVkXCIgPyBkYXRhLmRhdGEudGl0bGUgOiBkYXRhLmRhdGEgKSArIFwiPC9hPlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZGF0YS5jaGlsZHJlbiAmJiBkYXRhLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHN0ciArPSAnPHVsPic7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGRhdGEuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyICs9IHRoaXMucGFyc2VKU09OKGRhdGEuY2hpbGRyZW5baV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzdHIgKz0gJzwvdWw+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0ciArPSBcIjwvbGk+XCI7XG4gICAgICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgICB9LFxuICAgICAgICAvLyBnZXRKU09OIGZyb20gSFRNTFxuICAgICAgICBnZXRKU09OIDogZnVuY3Rpb24gKG5vZCwgb3V0ZXJfYXR0cmliLCBpbm5lcl9hdHRyaWIsIGZvcmNlKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgaWYoIW5vZCB8fCBqUXVlcnkobm9kKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgIG5vZCA9IHRoaXMuY29udGFpbmVyLmNoaWxkcmVuKFwidWxcIikuY2hpbGRyZW4oXCJsaVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Ugbm9kID0galF1ZXJ5KG5vZCk7XG5cbiAgICAgICAgICAgIGlmKG5vZC5zaXplKCkgPiAxKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFyciA9IFtdO1xuICAgICAgICAgICAgICAgIG5vZC5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2goX3RoaXMuZ2V0SlNPTih0aGlzLCBvdXRlcl9hdHRyaWIsIGlubmVyX2F0dHJpYikpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBhcnI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKCFvdXRlcl9hdHRyaWIpIG91dGVyX2F0dHJpYiA9IFsgXCJpZFwiLCBcInJlbFwiLCBcImNsYXNzXCIgXTtcbiAgICAgICAgICAgIGlmKCFpbm5lcl9hdHRyaWIpIGlubmVyX2F0dHJpYiA9IFsgXTtcbiAgICAgICAgICAgIHZhciBvYmogPSB7IGF0dHJpYnV0ZXMgOiB7fSwgZGF0YSA6IGZhbHNlIH07XG4gICAgICAgICAgICBmb3IoaSBpbiBvdXRlcl9hdHRyaWIpIHtcbiAgICAgICAgICAgICAgICBvYmouYXR0cmlidXRlc1tvdXRlcl9hdHRyaWJbaV1dID0gbm9kLmF0dHIob3V0ZXJfYXR0cmliW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIG9iai5kYXRhID0ge307XG4gICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGEgPSBub2QuY2hpbGRyZW4oXCJhLlwiICsgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBpZihmb3JjZSB8fCBpbm5lcl9hdHRyaWIubGVuZ3RoIHx8IGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS50b1N0cmluZygpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0udGl0bGUgPSBhLnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZGF0YVt0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXV0uaWNvbiA9IGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS5yZXBsYWNlKFwidXJsKFwiLFwiXCIpLnJlcGxhY2UoXCIpXCIsXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihpbm5lcl9hdHRyaWIubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaiBpbiBpbm5lcl9hdHRyaWIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmRhdGFbdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV1dLmF0dHJpYnV0ZXNbaW5uZXJfYXR0cmliW2pdXSA9IGEuYXR0cihpbm5lcl9hdHRyaWJbal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhW3RoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzW2ldXSA9IGEudGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSBub2QuY2hpbGRyZW4oXCJhXCIpO1xuICAgICAgICAgICAgICAgIGlmKGZvcmNlIHx8IGlubmVyX2F0dHJpYi5sZW5ndGggfHwgYS5nZXQoMCkuc3R5bGUuYmFja2dyb3VuZEltYWdlLnRvU3RyaW5nKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5kYXRhID0ge307XG4gICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLnRpdGxlID0gYS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGEuZ2V0KDApLnN0eWxlLmJhY2tncm91bmRJbWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLmljb24gPSBhLmdldCgwKS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UucmVwbGFjZShcInVybChcIixcIlwiKS5yZXBsYWNlKFwiKVwiLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKGlubmVyX2F0dHJpYi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLmF0dHJpYnV0ZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqIGluIGlubmVyX2F0dHJpYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5kYXRhLmF0dHJpYnV0ZXNbaW5uZXJfYXR0cmliW2pdXSA9IGEuYXR0cihpbm5lcl9hdHRyaWJbal0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvYmouZGF0YSA9IGEudGV4dCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYobm9kLmNoaWxkcmVuKFwidWxcIikuc2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbiA9IFtdO1xuICAgICAgICAgICAgICAgIG5vZC5jaGlsZHJlbihcInVsXCIpLmNoaWxkcmVuKFwibGlcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKF90aGlzLmdldEpTT04odGhpcywgb3V0ZXJfYXR0cmliLCBpbm5lcl9hdHRyaWIpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH0sXG4gICAgICAgIGZvY3VzIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGlmKHRyZWVfY29tcG9uZW50LmZvY3VzZWQgIT0gdGhpcy5jbnRyKSB7XG4gICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuZm9jdXNlZCA9IHRoaXMuY250cjtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uZm9jdXMuY2FsbChudWxsLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2hvd19jb250ZXh0IDogZnVuY3Rpb24gKG9iaiwgeCwgeSkge1xuICAgICAgICAgICAgdmFyIHRtcCA9IHRoaXMuY29udGV4dC5zaG93KCkub2Zmc2V0UGFyZW50KCk7XG4gICAgICAgICAgICBpZih0bXAuaXMoXCJodG1sXCIpKSB0bXAgPSBqUXVlcnkoXCJib2R5XCIpO1xuICAgICAgICAgICAgdG1wID0gdG1wLm9mZnNldCgpO1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmNzcyh7IFwibGVmdFwiIDogKHggLSB0bXAubGVmdCAtICh0aGlzLnNldHRpbmdzLnVpLnJ0bCA/IGpRdWVyeSh0aGlzLmNvbnRleHQpLndpZHRoKCkgOiAtNSApICksIFwidG9wXCIgOiAoeSAtIHRtcC50b3AgICsgKGpRdWVyeS5icm93c2VyLm9wZXJhID8gdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgOiAwKSArIDE1KSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgaGlkZV9jb250ZXh0IDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmhpZGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gQUxMIEVWRU5UU1xuICAgICAgICBhdHRhY2hFdmVudHMgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJjbGlja1wiLCBcImxpXCIsIGZ1bmN0aW9uKGV2ZW50KSB7IC8vIFdIRU4gQ0xJQ0sgSVMgT04gVEhFIEFSUk9XXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy50b2dnbGVfYnJhbmNoLmFwcGx5KF90aGlzLCBbZXZlbnQudGFyZ2V0XSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubGlzdGVuKFwiY2xpY2tcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkgeyAvLyBXSEVOIENMSUNLIElTIE9OIFRIRSBURVhUIE9SIElDT05cbiAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMubG9ja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RfYnJhbmNoLmFwcGx5KF90aGlzLCBbZXZlbnQudGFyZ2V0LCBldmVudC5jdHJsS2V5IHx8IF90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlID09IFwib25cIl0pO1xuICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5pbnApIHsgX3RoaXMuaW5wLmJsdXIoKTsgfVxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAubGlzdGVuKFwiZGJsY2xpY2tcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkgeyAvLyBXSEVOIERPVUJMRUNMSUNLIE9OIFRFWFQgT1IgSUNPTlxuICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25kYmxjbGsuY2FsbChudWxsLCBfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpLmdldCgwKSwgX3RoaXMpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJjb250ZXh0bWVudVwiLCBcImEudGl0bGVcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLmxvY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbnJndGNsay5jYWxsKG51bGwsIF90aGlzLmdldF9ub2RlKGV2ZW50LnRhcmdldCkuZ2V0KDApLCBfdGhpcywgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jb250ZXh0LmFwcGVuZCA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRhaW5lci5maW5kKFwidWw6ZXEoMClcIikuYXBwZW5kKF90aGlzLmNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNvbnRleHQuYXBwZW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IoaSBpbiBfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0gPT0gXCJzZXBhcmF0b3JcIikgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnVuYyA9IF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uYWN0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGV4dC5jaGlsZHJlbihcIltyZWw9XCIgKyBfdGhpcy5zZXR0aW5ncy51aS5jb250ZXh0W2ldLmlkICtcIl1cIikuYmluZChcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmMuY2FsbChudWxsLCBfdGhpcy5zZWxlY3RlZF9hcnIgfHwgX3RoaXMuc2VsZWN0ZWQsIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oaWRlX2NvbnRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBfdGhpcy5nZXRfbm9kZShldmVudC50YXJnZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuaW5wKSB7IF90aGlzLmlucC5ibHVyKCk7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFvYmouY2hpbGRyZW4oXCJhOmVxKDApXCIpLmhhc0NsYXNzKFwiY2xpY2tlZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RfYnJhbmNoLmFwcGx5KF90aGlzLCBbZXZlbnQudGFyZ2V0LCBldmVudC5jdHJsS2V5IHx8IF90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlID09IFwib25cIl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQuYmx1cigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZXh0LmNoaWxkcmVuKFwibGlcIikuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnbyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihpIGluIF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX3RoaXMuc2V0dGluZ3MudWkuY29udGV4dFtpXSA9PSBcInNlcGFyYXRvclwiKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoIV90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0udmlzaWJsZS5jYWxsKG51bGwsIF90aGlzLnNlbGVjdGVkX2FyciB8fCBfdGhpcy5zZWxlY3RlZCwgX3RoaXMpKSBfdGhpcy5jb250ZXh0LmNoaWxkcmVuKFwiW3JlbD1cIiArIF90aGlzLnNldHRpbmdzLnVpLmNvbnRleHRbaV0uaWQgK1wiXVwiKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgZ28gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihnbyA9PSB0cnVlKSBfdGhpcy5zaG93X2NvbnRleHQob2JqLCBldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VYLCBldmVudC5vcmlnaW5hbEV2ZW50LnBhZ2VZKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJwb2ludGVyZW50ZXJcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5zZXR0aW5ncy51aS5ob3Zlcl9tb2RlICYmIF90aGlzLmhvdmVyZWQgIT09IGZhbHNlICYmIGV2ZW50LnRhcmdldC50YWdOYW1lID09IFwiQVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5ob3ZlcmVkLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImhvdmVyXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaG92ZXJlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBBVFRBQ0ggRFJBRyAmIERST1AgT05MWSBJRiBORUVERURcbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdnYWJsZSAhPSBcIm5vbmVcIiAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlcyAhPSBcIm5vbmVcIikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdwb2ludGVydXAgcG9pbnRlcmRvd24nLCAnLmNvbDInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMuX2RyYWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uKFwicG9pbnRlcmRvd25cIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmZvY3VzLmFwcGx5KF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5sb2NrZWQpIHJldHVybiBfdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTRUxFQ1QgTElTVCBJVEVNIE5PREVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gX3RoaXMuZ2V0X25vZGUoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJRiBJVEVNIElTIERSQUdHQUJMRVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF90aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmIF90aGlzLnNlbGVjdGVkX2Fyci5sZW5ndGggPiAxICYmIG9iai5jaGlsZHJlbihcImE6ZXEoMClcIikuaGFzQ2xhc3MoXCJjbGlja2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gX3RoaXMuc2VsZWN0ZWRfYXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jaGVjayhcImRyYWdnYWJsZVwiLCBfdGhpcy5zZWxlY3RlZF9hcnJbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VsZWN0ZWRfYXJyW2ldLmFkZENsYXNzKFwiZHJhZ2dlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyICsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNvdW50ZXIgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jaGVjayhcImRyYWdnYWJsZVwiLCBvYmopKSAgICBfdGhpcy5fZHJhZyA9IG9iajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9kcmFnID0gX3RoaXMuY29udGFpbmVyLmZpbmQoXCJsaS5kcmFnZ2VkOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNkb3duICAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWcgICAgICAgID0gX3RoaXMuX2RyYWcuZ2V0KDApLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWcuaWQgICAgPSBcImRyYWdnZWRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeShfdGhpcy5kcmFnKS5jaGlsZHJlbihcImFcIikuaHRtbChcIk11bHRpcGxlIHNlbGVjdGlvblwiKS5lbmQoKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfdGhpcy5jaGVjayhcImRyYWdnYWJsZVwiLCBvYmopKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fZHJhZyAgICAgICAgPSBvYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnICAgICAgICA9IG9iai5nZXQoMCkuY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZy5pZCAgICA9IFwiZHJhZ2dlZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaXNkb3duICAgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmZvcmVpZ24gICAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iai5hZGRDbGFzcyhcImRyYWdnZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmJsdXIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAubGlzdGVuKFwicG9pbnRlcnVwXCIsIFwibGlcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5saXN0ZW4oXCJwb2ludGVydXBcIiwgXCJhLnRpdGxlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5fZHJhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCdodG1sJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcmRvd25cIiwgICAgdHJlZV9jb21wb25lbnQubW91c2Vkb3duKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJwb2ludGVydXBcIiwgICAgdHJlZV9jb21wb25lbnQubW91c2V1cClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcm1vdmVcIiwgICAgdHJlZV9jb21wb25lbnQubW91c2Vtb3ZlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRU5ESUYgT0YgRFJBRyAmIERST1AgRlVOQ1RJT05TXG4gICAgICAgICAgICBpZihfdGhpcy5jb250ZXh0KSBqUXVlcnkoJ2h0bWwnKS5iaW5kKFwicG9pbnRlcnVwXCIsIGZ1bmN0aW9uKCkgeyBfdGhpcy5oaWRlX2NvbnRleHQoKTsgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNoZWNrTW92ZSA6IGZ1bmN0aW9uIChOT0RFUywgUkVGX05PREUsIFRZUEUpIHtcbiAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAvLyBPVkVSIFNFTEYgT1IgQ0hJTERSRU5cbiAgICAgICAgICAgIGlmKFJFRl9OT0RFLnBhcmVudHMoXCJsaS5kcmFnZ2VkXCIpLnNpemUoKSA+IDAgfHwgUkVGX05PREUuaXMoXCIuZHJhZ2dlZFwiKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJNT1ZFOiBOT0RFIE9WRVIgU0VMRlwiKTtcbiAgICAgICAgICAgIC8vIENIRUNLIEFHQUlOU1QgRFJBR19SVUxFU1xuICAgICAgICAgICAgaWYoTk9ERVMuc2l6ZSgpID09IDEpIHtcbiAgICAgICAgICAgICAgICB2YXIgTk9ERSA9IE5PREVTLmVxKDApO1xuICAgICAgICAgICAgICAgIGlmKE5PREUuaGFzQ2xhc3MoXCJmb3JlaWduXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMuZHJvcHBhYmxlLmxlbmd0aCA9PSAwKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFOT0RFLmlzKFwiLlwiICsgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGUuam9pbihcIiwgLlwiKSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGZvcihpIGluIHRoaXMuc2V0dGluZ3MucnVsZXMuZHJvcHBhYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihOT0RFLmlzKFwiLlwiICsgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcm9wcGFibGVbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5PREUuYXR0cih0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhLCBcInR5cGU6ICdcIiArIHRoaXMuc2V0dGluZ3MucnVsZXMuZHJvcHBhYmxlW2ldICsgXCInXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTk9ERS5hdHRyKHRoaXMuc2V0dGluZ3MucnVsZXMudHlwZV9hdHRyLCB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyb3BwYWJsZVtpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZighb2spIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJkcmFncnVsZXNcIiwgW05PREUsIFRZUEUsIFJFRl9OT0RFLnBhcmVudHMoXCJsaTplcSgwKVwiKV0pKSByZXR1cm4gdGhpcy5lcnJvcihcIk1PVkU6IEFHQUlOU1QgRFJBRyBSVUxFU1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XG4gICAgICAgICAgICAgICAgTk9ERVMuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICBpZihvayA9PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBpZihpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZiA9IE5PREVTLmVxKCAoaSAtIDEpICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXYgPSBcImFmdGVyXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVmID0gUkVGX05PREU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXYgPSBUWVBFO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKCFfdGhpcy5jaGVjay5hcHBseShfdGhpcyxbXCJkcmFncnVsZXNcIiwgW2pRdWVyeSh0aGlzKSwgbXYsIHJlZl1dKSkgb2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZihvayA9PSBmYWxzZSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJNT1ZFOiBBR0FJTlNUIERSQUcgUlVMRVNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDSEVDSyBBR0FJTlNUIE1FVEFEQVRBXG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLnVzZV9pbmxpbmUgJiYgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBuZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmKFRZUEUgPT0gXCJpbnNpZGVcIikgICAgbmQgPSBSRUZfTk9ERS5wYXJlbnRzKFwibGk6ZXEoMClcIik7XG4gICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgbmQgPSBSRUZfTk9ERS5wYXJlbnRzKFwibGk6ZXEoMSlcIik7XG4gICAgICAgICAgICAgICAgaWYobmQuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFZBTElEIENISUxEUkVOIENIRUNLXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBuZC5tZXRhZGF0YSgpW1widmFsaWRfY2hpbGRyZW5cIl0gIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcCA9IG5kLm1ldGFkYXRhKClbXCJ2YWxpZF9jaGlsZHJlblwiXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBOT0RFUy5lYWNoKGZ1bmN0aW9uIChpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihqUXVlcnkuaW5BcnJheShfdGhpcy5nZXRfdHlwZSh0aGlzKSwgdG1wKSA9PSAtMSkgb2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYob2sgPT0gZmFsc2UpIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogTk9UIEEgVkFMSUQgQ0hJTERcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQ0hFQ0sgSUYgUEFSRU5UIEhBUyBGUkVFIFNMT1RTIEZPUiBDSElMRFJFTlxuICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgbmQubWV0YWRhdGEoKVtcIm1heF9jaGlsZHJlblwiXSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZigobmQuY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpXCIpLm5vdChcIi5kcmFnZ2VkXCIpLnNpemUoKSArIE5PREVTLnNpemUoKSkgPiBuZC5tZXRhZGF0YSgpLm1heF9jaGlsZHJlbikgcmV0dXJuIHRoaXMuZXJyb3IoXCJNT1ZFOiBNQVggQ0hJTERSRU4gUkVBQ0hFRFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBDSEVDSyBGT1IgTUFYREVQVEggVVAgVEhFIENIQUlOXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbmNyID0gMDtcbiAgICAgICAgICAgICAgICAgICAgTk9ERVMuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBqUXVlcnkodGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZShpIDwgMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdCA9IHQuY2hpbGRyZW4oXCJ1bDplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0LnNpemUoKSA9PSAwKSBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICsrXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmNyID0gTWF0aC5tYXgoaSxpbmNyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvayA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIG5kLnBhcmVudHMoXCJsaVwiKS5lYWNoKGZ1bmN0aW9uKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9rID09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihqUXVlcnkodGhpcykubWV0YWRhdGEoKS5tYXhfZGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiggKGkgKyBpbmNyKSA+PSBqUXVlcnkodGhpcykubWV0YWRhdGEoKS5tYXhfZGVwdGgpIG9rID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZihvayA9PSBmYWxzZSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJNT1ZFOiBNQVhfREVQVEggUkVBQ0hFRFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gVVNFRCBBRlRFUiBSRUZSRVNIXG4gICAgICAgIHJlc2VsZWN0IDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIC8vIFJFT1BFTiBCUkFOQ0hFU1xuICAgICAgICAgICAgaWYodGhpcy5vcGVuZWQgJiYgdGhpcy5vcGVuZWQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9wbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCB0aGlzLm9wZW5lZC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2V0X25vZGUodGhpcy5vcGVuZWRbal0pLnNpemUoKSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcG4gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLm9wZW5lZFtqXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5vcGVuZWRbal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcGVuX2JyYW5jaCh0bXAsIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMucmVzZWxlY3QuYXBwbHkoX3RoaXMpOyB9IClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMub3Blbl9icmFuY2godGhpcy5vcGVuZWRbal0sIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMgJiYgb3BuKSByZXR1cm47XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMub3BlbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUkVQT1NJVElPTiBTQ1JPTExcbiAgICAgICAgICAgIGlmKHRoaXMuc2NydG9wKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKF90aGlzLnNjcnRvcCk7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2NydG9wO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUkVTRUxFQ1QgUFJFVklPVVNMWSBTRUxFQ1RFRFxuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5zZWxlY3RlZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0aGlzLnNldHRpbmdzLnNlbGVjdGVkLCBmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RfYnJhbmNoKGpRdWVyeShfdGhpcy5zZXR0aW5ncy5zZWxlY3RlZFtpXSksIChfdGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPT0gZmFsc2UgJiYgaSA+IDApICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmxvYWQuY2FsbChudWxsLCBfdGhpcyk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIEdFVCBUSEUgRVhURU5ERUQgTEkgRUxFTUVOVFxuICAgICAgICBnZXRfbm9kZSA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHZhciBvYmogPSBqUXVlcnkob2JqKTtcbiAgICAgICAgICAgIHJldHVybiBvYmouaXMoXCJsaVwiKSA/IG9iaiA6IG9iai5wYXJlbnRzKFwibGk6ZXEoMClcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIEdFVCBUSEUgVFlQRSBPRiBUSEUgTk9ERVxuICAgICAgICBnZXRfdHlwZSA6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIG9iaiA9ICFvYmogPyB0aGlzLnNlbGVjdGVkIDogdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgaWYoIW9iaikgcmV0dXJuO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5tZXRhZGF0YS5zZXRUeXBlKFwiYXR0clwiLCB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKTtcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gb2JqLm1ldGFkYXRhKCkudHlwZTtcbiAgICAgICAgICAgICAgICBpZih0bXApIHJldHVybiB0bXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2JqLmF0dHIodGhpcy5zZXR0aW5ncy5ydWxlcy50eXBlX2F0dHIpO1xuICAgICAgICB9LFxuICAgICAgICAvLyBTQ1JPTEwgQ09OVEFJTkVSIFdISUxFIERSQUdHSU5HXG4gICAgICAgIHNjcm9sbENoZWNrIDogZnVuY3Rpb24gKHgseSkge1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHZhciBjbnQgPSBfdGhpcy5jb250YWluZXI7XG4gICAgICAgICAgICB2YXIgb2ZmID0gX3RoaXMub2Zmc2V0O1xuXG4gICAgICAgICAgICB2YXIgc3QgPSBjbnQuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICB2YXIgc2wgPSBjbnQuc2Nyb2xsTGVmdCgpO1xuICAgICAgICAgICAgLy8gREVURUNUIEhPUklaT05UQUwgU0NST0xMXG4gICAgICAgICAgICB2YXIgaF9jb3IgPSAoY250LmdldCgwKS5zY3JvbGxXaWR0aCA+IGNudC53aWR0aCgpKSA/IDQwIDogMjA7XG5cbiAgICAgICAgICAgIGlmKHkgLSBvZmYudG9wIDwgMjApICAgICAgICAgICAgICAgICAgICAgICAgY250LnNjcm9sbFRvcChNYXRoLm1heCggKHN0IC0gX3RoaXMuc2V0dGluZ3MudWkuc2Nyb2xsX3NwZCkgLDApKTsgICAgLy8gTkVBUiBUT1BcbiAgICAgICAgICAgIGlmKGNudC5oZWlnaHQoKSAtICh5IC0gb2ZmLnRvcCkgPCBoX2NvcikgICAgY250LnNjcm9sbFRvcChzdCArIF90aGlzLnNldHRpbmdzLnVpLnNjcm9sbF9zcGQpOyAgICAgICAgICAgICAgICAgICAgLy8gTkVBUiBCT1RUT01cbiAgICAgICAgICAgIGlmKHggLSBvZmYubGVmdCA8IDIwKSAgICAgICAgICAgICAgICAgICAgICAgIGNudC5zY3JvbGxMZWZ0KE1hdGgubWF4KCAoc2wgLSBfdGhpcy5zZXR0aW5ncy51aS5zY3JvbGxfc3BkKSwwKSk7ICAgIC8vIE5FQVIgTEVGVFxuICAgICAgICAgICAgaWYoY250LndpZHRoKCkgLSAoeCAtIG9mZi5sZWZ0KSA8IDQwKSAgICAgICAgY250LnNjcm9sbExlZnQoc2wgKyBfdGhpcy5zZXR0aW5ncy51aS5zY3JvbGxfc3BkKTsgICAgICAgICAgICAgICAgICAgIC8vIE5FQVIgUklHSFRcblxuICAgICAgICAgICAgaWYoY250LnNjcm9sbExlZnQoKSAhPSBzbCB8fCBjbnQuc2Nyb2xsVG9wKCkgIT0gc3QpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5tb3ZlVHlwZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIF90aGlzLm1vdmVSZWYgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBqUXVlcnkoXCIjbWFya2VyXCIpLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LnN0byA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgeyBfdGhpcy5zY3JvbGxDaGVjayh4LHkpOyB9LCA1MCk7XG4gICAgICAgIH0sXG4gICAgICAgIGNoZWNrIDogZnVuY3Rpb24gKHJ1bGUsIG5vZGVzKSB7XG4gICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICAvLyBDSEVDSyBMT0NBTCBSVUxFUyBJRiBNRVRBREFUQVxuICAgICAgICAgICAgaWYocnVsZSAhPSBcImRyYWdydWxlc1wiICYmIHRoaXMuc2V0dGluZ3MucnVsZXMudXNlX2lubGluZSAmJiB0aGlzLnNldHRpbmdzLnJ1bGVzLm1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5Lm1ldGFkYXRhLnNldFR5cGUoXCJhdHRyXCIsIHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLmdldF9ub2RlKG5vZGVzKS5tZXRhZGF0YSgpW3J1bGVdICE9IFwidW5kZWZpbmVkXCIpIHJldHVybiB0aGlzLmdldF9ub2RlKG5vZGVzKS5tZXRhZGF0YSgpW3J1bGVdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MucnVsZXNbcnVsZV0pICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlc1tydWxlXSA9PSBcIm5vbmVcIikgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlc1tydWxlXSA9PSBcImFsbFwiKSAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGlmKHJ1bGUgPT0gXCJkcmFncnVsZXNcIikge1xuICAgICAgICAgICAgICAgIHZhciBuZHMgPSBuZXcgQXJyYXkoKTtcbiAgICAgICAgICAgICAgICBuZHNbMF0gPSB0aGlzLmdldF90eXBlKG5vZGVzWzBdKTtcbiAgICAgICAgICAgICAgICBuZHNbMV0gPSBub2Rlc1sxXTtcbiAgICAgICAgICAgICAgICBuZHNbMl0gPSB0aGlzLmdldF90eXBlKG5vZGVzWzJdKTtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5zZXR0aW5ncy5ydWxlcy5kcmFncnVsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSB0aGlzLnNldHRpbmdzLnJ1bGVzLmRyYWdydWxlc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSAoci5pbmRleE9mKFwiIVwiKSA9PT0gMCkgPyBmYWxzZSA6IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFuKSByID0gci5yZXBsYWNlKFwiIVwiLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gci5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaiA9IDA7IGogPCAzOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRtcFtqXSA9PSBuZHNbal0gfHwgdG1wW2pdID09IFwiKlwiKSB0bXBbal0gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKHRtcFswXSA9PT0gdHJ1ZSAmJiB0bXBbMV0gPT09IHRydWUgJiYgdG1wWzJdID09PSB0cnVlKSByZXR1cm4gbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHJldHVybiAoalF1ZXJ5LmluQXJyYXkodGhpcy5nZXRfdHlwZShub2RlcyksdGhpcy5zZXR0aW5ncy5ydWxlc1tydWxlXSkgIT0gLTEpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICBob3Zlcl9icmFuY2ggOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnVpLmhvdmVyX21vZGUgPT0gZmFsc2UpIHJldHVybiB0aGlzLnNlbGVjdF9icmFuY2gob2JqKTtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgb2JqID0gX3RoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgIGlmKCFvYmouc2l6ZSgpKSByZXR1cm4gdGhpcy5lcnJvcihcIkhPVkVSOiBOT1QgQSBWQUxJRCBOT0RFXCIpO1xuICAgICAgICAgICAgLy8gQ0hFQ0sgQUdBSU5TVCBSVUxFUyBGT1IgU0VMRUNUQUJMRSBOT0RFU1xuICAgICAgICAgICAgaWYoIV90aGlzLmNoZWNrKFwiY2xpY2thYmxlXCIsIG9iaikpIHJldHVybiB0aGlzLmVycm9yKFwiU0VMRUNUOiBOT0RFIE5PVCBTRUxFQ1RBQkxFXCIpO1xuICAgICAgICAgICAgaWYodGhpcy5ob3ZlcmVkKSB0aGlzLmhvdmVyZWQuY2hpbGRyZW4oXCJBXCIpLnJlbW92ZUNsYXNzKFwiaG92ZXJcIik7XG5cbiAgICAgICAgICAgIC8vIFNBVkUgTkVXTFkgU0VMRUNURURcbiAgICAgICAgICAgIHRoaXMuaG92ZXJlZCA9IG9iajtcblxuICAgICAgICAgICAgLy8gRk9DVVMgTkVXIE5PREUgQU5EIE9QRU4gQUxMIFBBUkVOVCBOT0RFUyBJRiBDTE9TRURcbiAgICAgICAgICAgIHRoaXMuaG92ZXJlZC5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKS5hZGRDbGFzcyhcImhvdmVyXCIpO1xuXG4gICAgICAgICAgICAvLyBTQ1JPTEwgU0VMRUNURUQgTk9ERSBJTlRPIFZJRVdcbiAgICAgICAgICAgIHZhciBvZmZfdCA9IHRoaXMuaG92ZXJlZC5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICB2YXIgYmVnX3QgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICB2YXIgZW5kX3QgPSBiZWdfdCArIHRoaXMuY29udGFpbmVyLmhlaWdodCgpO1xuICAgICAgICAgICAgdmFyIGhfY29yID0gKHRoaXMuY29udGFpbmVyLmdldCgwKS5zY3JvbGxXaWR0aCA+IHRoaXMuY29udGFpbmVyLndpZHRoKCkpID8gNDAgOiAyMDtcbiAgICAgICAgICAgIGlmKG9mZl90ICsgNSA8IGJlZ190KSB0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AodGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKCkgLSAoYmVnX3QgLSBvZmZfdCArIDUpICk7XG4gICAgICAgICAgICBpZihvZmZfdCArIGhfY29yID4gZW5kX3QpIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCh0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSArIChvZmZfdCArIGhfY29yIC0gZW5kX3QpICk7XG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdF9icmFuY2ggOiBmdW5jdGlvbiAob2JqLCBtdWx0aXBsZSkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgaWYoIW9iaiAmJiB0aGlzLmhvdmVyZWQgIT09IGZhbHNlKSBvYmogPSB0aGlzLmhvdmVyZWQ7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgb2JqID0gX3RoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgIGlmKCFvYmouc2l6ZSgpKSByZXR1cm4gdGhpcy5lcnJvcihcIlNFTEVDVDogTk9UIEEgVkFMSUQgTk9ERVwiKTtcbiAgICAgICAgICAgIG9iai5jaGlsZHJlbihcImFcIikucmVtb3ZlQ2xhc3MoXCJob3ZlclwiKTtcbiAgICAgICAgICAgIC8vIENIRUNLIEFHQUlOU1QgUlVMRVMgRk9SIFNFTEVDVEFCTEUgTk9ERVNcbiAgICAgICAgICAgIGlmKCFfdGhpcy5jaGVjayhcImNsaWNrYWJsZVwiLCBvYmopKSByZXR1cm4gdGhpcy5lcnJvcihcIlNFTEVDVDogTk9ERSBOT1QgU0VMRUNUQUJMRVwiKTtcbiAgICAgICAgICAgIGlmKF90aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZWNoYW5nZS5jYWxsKG51bGwsb2JqLmdldCgwKSxfdGhpcykgPT09IGZhbHNlKSByZXR1cm4gdGhpcy5lcnJvcihcIlNFTEVDVDogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgLy8gSUYgbXVsdGlwbGUgQU5EIG9iaiBJUyBBTFJFQURZIFNFTEVDVEVEIC0gREVTRUxFQ1QgSVRcbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgbXVsdGlwbGUgJiYgb2JqLmNoaWxkcmVuKFwiYS5jbGlja2VkXCIpLnNpemUoKSA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kZXNlbGVjdF9icmFuY2gob2JqKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgbXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkX2Fyci5wdXNoKG9iaik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlICE9IGZhbHNlICYmICFtdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIGZvcihpIGluIHRoaXMuc2VsZWN0ZWRfYXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyW2ldLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9hcnIucHVzaChvYmopO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQpIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJBXCIpLnJlbW92ZUNsYXNzKFwiY2xpY2tlZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLnJ1bGVzLm11bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcIkFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU0FWRSBORVdMWSBTRUxFQ1RFRFxuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IG9iajtcbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MudWkuaG92ZXJfbW9kZSAmJiB0aGlzLmhvdmVyZWQgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ob3ZlcmVkLmNoaWxkcmVuKFwiQVwiKS5yZW1vdmVDbGFzcyhcImhvdmVyXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuaG92ZXJlZCA9IG9iajtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRk9DVVMgTkVXIE5PREUgQU5EIE9QRU4gQUxMIFBBUkVOVCBOT0RFUyBJRiBDTE9TRURcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJhXCIpLnJlbW92ZUNsYXNzKFwiY2xpY2tlZFwiKS5hZGRDbGFzcyhcImNsaWNrZWRcIikuZW5kKCkucGFyZW50cyhcImxpLmNsb3NlZFwiKS5lYWNoKCBmdW5jdGlvbiAoKSB7IF90aGlzLm9wZW5fYnJhbmNoKHRoaXMsIHRydWUpOyB9KTtcblxuICAgICAgICAgICAgLy8gU0NST0xMIFNFTEVDVEVEIE5PREUgSU5UTyBWSUVXXG4gICAgICAgICAgICB2YXIgb2ZmX3QgPSB0aGlzLnNlbGVjdGVkLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgIHZhciBiZWdfdCA9IHRoaXMuY29udGFpbmVyLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgIHZhciBlbmRfdCA9IGJlZ190ICsgdGhpcy5jb250YWluZXIuaGVpZ2h0KCk7XG4gICAgICAgICAgICB2YXIgaF9jb3IgPSAodGhpcy5jb250YWluZXIuZ2V0KDApLnNjcm9sbFdpZHRoID4gdGhpcy5jb250YWluZXIud2lkdGgoKSkgPyA0MCA6IDIwO1xuICAgICAgICAgICAgaWYob2ZmX3QgKyA1IDwgYmVnX3QpIHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCh0aGlzLmNvbnRhaW5lci5zY3JvbGxUb3AoKSAtIChiZWdfdCAtIG9mZl90ICsgNSkgKTtcbiAgICAgICAgICAgIGlmKG9mZl90ICsgaF9jb3IgPiBlbmRfdCkgdGhpcy5jb250YWluZXIuc2Nyb2xsVG9wKHRoaXMuY29udGFpbmVyLnNjcm9sbFRvcCgpICsgKG9mZl90ICsgaF9jb3IgLSBlbmRfdCkgKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwic2VsZWN0ZWRcIik7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uY2hhbmdlLmNhbGwobnVsbCwgdGhpcy5zZWxlY3RlZC5nZXQoMCksIF90aGlzKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVzZWxlY3RfYnJhbmNoIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICBvYmouY2hpbGRyZW4oXCJhXCIpLnJlbW92ZUNsYXNzKFwiY2xpY2tlZFwiKTtcbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImEuY2xpY2tlZFwiKS5maWx0ZXIoXCI6Zmlyc3QtY2hpbGRcIikucGFyZW50KCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdGVkX2Fyci5wdXNoKGpRdWVyeSh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYob2JqLmdldCgwKSA9PSB0aGlzLnNlbGVjdGVkLmdldCgwKSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZF9hcnJbMF07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UpIHRoaXMuc2VsZWN0ZWRfYXJyID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmNoYW5nZS5jYWxsKG51bGwsIHRoaXMuc2VsZWN0ZWQuZ2V0KDApLCBfdGhpcyk7XG4gICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2sub25jaGFuZ2UuY2FsbChudWxsLCBmYWxzZSwgX3RoaXMpO1xuICAgICAgICB9LFxuICAgICAgICB0b2dnbGVfYnJhbmNoIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcImNsb3NlZFwiKSkgICAgcmV0dXJuIHRoaXMub3Blbl9icmFuY2gob2JqKTtcbiAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcIm9wZW5cIikpICAgIHJldHVybiB0aGlzLmNsb3NlX2JyYW5jaChvYmopO1xuICAgICAgICB9LFxuICAgICAgICBvcGVuX2JyYW5jaCA6IGZ1bmN0aW9uIChvYmosIGRpc2FibGVfYW5pbWF0aW9uLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0X25vZGUob2JqKTtcbiAgICAgICAgICAgIGlmKCFvYmouc2l6ZSgpKSByZXR1cm4gdGhpcy5lcnJvcihcIk9QRU46IE5PIFNVQ0ggTk9ERVwiKTtcbiAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcImxlYWZcIikpIHJldHVybiB0aGlzLmVycm9yKFwiT1BFTjogT1BFTklORyBMRUFGIE5PREVcIik7XG5cbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luYyAmJiBvYmouZmluZChcImxpXCIpLnNpemUoKSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5yZW1vdmUoKS5lbmQoKS5hcHBlbmQoXCI8dWw+PGxpIGNsYXNzPSdsYXN0Jz48YSBzdHlsZT0nYmFja2dyb3VuZC1pbWFnZTp1cmwoXCIgKyBfdGhpcy5zZXR0aW5ncy51aS50aGVtZV9wYXRoICsgXCJkZWZhdWx0L3Rocm9iYmVyLmdpZiknIGhyZWY9JyMnPlwiICsgKF90aGlzLnNldHRpbmdzLmxhbmcubG9hZGluZyB8fCBcIkxvYWRpbmcgLi4uXCIpICsgXCI8L2E+PC9saT48L3VsPlwiKTtcbiAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikuYWRkQ2xhc3MoXCJvcGVuXCIpO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwieG1sX2ZsYXRcIiB8fCB0aGlzLnNldHRpbmdzLmRhdGEudHlwZSA9PSBcInhtbF9uZXN0ZWRcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgeHNsID0gKHRoaXMuc2V0dGluZ3MuZGF0YS50eXBlID09IFwieG1sX2ZsYXRcIikgPyBcImZsYXQueHNsXCIgOiBcIm5lc3RlZC54c2xcIjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0ciA9ICh0aGlzLnNldHRpbmdzLmRhdGEudXJsLmluZGV4T2YoXCI/XCIpID09IC0xKSA/IFwiP2lkPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KG9iai5hdHRyKFwiaWRcIikpIDogXCImaWQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQob2JqLmF0dHIoXCJpZFwiKSk7XG4gICAgICAgICAgICAgICAgICAgIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLmdldFRyYW5zZm9ybSh0aGlzLnBhdGggKyB4c2wsIHRoaXMuc2V0dGluZ3MuZGF0YS51cmwgKyBzdHIsIHsgcGFyYW1zIDogeyB0aGVtZV9wYXRoIDogX3RoaXMudGhlbWUgfSwgbWV0aCA6IHRoaXMuc2V0dGluZ3MuZGF0YS5tZXRob2QsIHJlcGwgOiB0cnVlLCBjYWxsYmFjazogZnVuY3Rpb24gKHN0ciwganNvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHN0ci5sZW5ndGggPCAxNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLmFkZENsYXNzKFwibGVhZlwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjYWxsYmFjaykgY2FsbGJhY2suY2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9wZW5fYnJhbmNoLmFwcGx5KF90aGlzLCBbb2JqXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS5tZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmwgICAgICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS51cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhICAgICAgICA6IHRoaXMuc2V0dGluZ3MuZGF0YS5hc3luY19kYXRhKG9iaiksXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZSAgICA6IFwianNvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyAgICAgICAgOiBmdW5jdGlvbiAoZGF0YSwgdGV4dFN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFkYXRhIHx8IGRhdGEubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLnJlbW92ZUNsYXNzKFwib3BlblwiKS5hZGRDbGFzcyhcImxlYWZcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9IF90aGlzLnBhcnNlSlNPTihkYXRhW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHN0ciA9IF90aGlzLnBhcnNlSlNPTihkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5yZXBsYWNlV2l0aChcIjx1bD5cIiArIHN0ciArIFwiPC91bD5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqLmZpbmQoXCJsaTpsYXN0LWNoaWxkXCIpLmFkZENsYXNzKFwibGFzdFwiKS5lbmQoKS5maW5kKFwibGk6aGFzKHVsKVwiKS5ub3QoXCIub3BlblwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouZmluZChcImxpXCIpLm5vdChcIi5vcGVuXCIpLm5vdChcIi5jbG9zZWRcIikuYWRkQ2xhc3MoXCJsZWFmXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLm9wZW5fYnJhbmNoLmFwcGx5KF90aGlzLCBbb2JqXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYocGFyc2VJbnQodGhpcy5zZXR0aW5ncy51aS5hbmltYXRpb24pID4gMCAmJiAhZGlzYWJsZV9hbmltYXRpb24gJiYgIShqUXVlcnkuYnJvd3Nlci5tc2llICYmIGpRdWVyeS5icm93c2VyLnZlcnNpb24gPCA3KSApIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLmFkZENsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuc2xpZGVEb3duKHBhcnNlSW50KHRoaXMuc2V0dGluZ3MudWkuYW5pbWF0aW9uKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykuY3NzKFwiZGlzcGxheVwiLFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLmFkZENsYXNzKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoY2FsbGJhY2spIGNhbGxiYWNrLmNhbGwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9ub3Blbi5jYWxsKG51bGwsIG9iai5nZXQoMCksIHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjbG9zZV9icmFuY2ggOiBmdW5jdGlvbiAob2JqLCBkaXNhYmxlX2FuaW1hdGlvbikge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmdldF9ub2RlKG9iaik7XG4gICAgICAgICAgICBpZihwYXJzZUludCh0aGlzLnNldHRpbmdzLnVpLmFuaW1hdGlvbikgPiAwICYmICFkaXNhYmxlX2FuaW1hdGlvbiAmJiAhKGpRdWVyeS5icm93c2VyLm1zaWUgJiYgalF1ZXJ5LmJyb3dzZXIudmVyc2lvbiA8IDcpICYmIG9iai5jaGlsZHJlbihcInVsOmVxKDApXCIpLnNpemUoKSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuc2xpZGVVcChwYXJzZUludCh0aGlzLnNldHRpbmdzLnVpLmFuaW1hdGlvbiksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBvYmoucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLmFkZENsYXNzKFwiY2xvc2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLmNzcyhcImRpc3BsYXlcIixcIlwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9iai5yZW1vdmVDbGFzcyhcIm9wZW5cIikuYWRkQ2xhc3MoXCJjbG9zZWRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHRoaXMuc2VsZWN0ZWQgJiYgb2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuZmluZChcImEuY2xpY2tlZFwiKS5zaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgb2JqLmZpbmQoXCJsaTpoYXMoYS5jbGlja2VkKVwiKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5kZXNlbGVjdF9icmFuY2godGhpcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYob2JqLmNoaWxkcmVuKFwiYS5jbGlja2VkXCIpLnNpemUoKSA9PSAwKSB0aGlzLnNlbGVjdF9icmFuY2gob2JqLCAodGhpcy5zZXR0aW5ncy5ydWxlcy5tdWx0aXBsZSAhPSBmYWxzZSAmJiB0aGlzLnNlbGVjdGVkX2Fyci5sZW5ndGggPiAwKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmNsb3NlLmNhbGwobnVsbCwgb2JqLmdldCgwKSwgdGhpcyk7XG4gICAgICAgIH0sXG4gICAgICAgIG9wZW5fYWxsIDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIG9iaiA9IG9iaiA/IGpRdWVyeShvYmopIDogdGhpcy5jb250YWluZXI7XG4gICAgICAgICAgICBvYmouZmluZChcImxpLmNsb3NlZFwiKS5lYWNoKCBmdW5jdGlvbiAoKSB7IHZhciBfX3RoaXMgPSB0aGlzOyBfdGhpcy5vcGVuX2JyYW5jaC5hcHBseShfdGhpcywgW3RoaXMsIHRydWUsIGZ1bmN0aW9uKCkgeyBfdGhpcy5vcGVuX2FsbC5hcHBseShfdGhpcywgW19fdGhpc10pOyB9IF0pOyB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xvc2VfYWxsIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgIGpRdWVyeSh0aGlzLmNvbnRhaW5lcikuZmluZChcImxpLm9wZW5cIikuZWFjaCggZnVuY3Rpb24gKCkgeyBfdGhpcy5jbG9zZV9icmFuY2godGhpcywgdHJ1ZSk7IH0pO1xuICAgICAgICB9LFxuICAgICAgICBzaG93X2xhbmcgOiBmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0gPT0gdGhpcy5jdXJyZW50X2xhbmcpIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgdmFyIHN0ID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaWQgPSB0aGlzLmNvbnRhaW5lci5hdHRyKFwiaWRcIikgPyBcIiNcIiArIHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSA6IFwiLnRyZWVcIjtcbiAgICAgICAgICAgIHN0ID0gZ2V0X2NzcyhpZCArIFwiIC5cIiArIHRoaXMuY3VycmVudF9sYW5nLCB0aGlzLnNuKTtcbiAgICAgICAgICAgIGlmKHN0ICE9PSBmYWxzZSkgc3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgc3QgPSBnZXRfY3NzKGlkICsgXCIgLlwiICsgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0sIHRoaXMuc24pO1xuICAgICAgICAgICAgaWYoc3QgIT09IGZhbHNlKSBzdC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50X2xhbmcgPSB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBjeWNsZV9sYW5nIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgcmV0dXJuIHRoaXMuZXJyb3IoXCJMT0NLRURcIik7XG4gICAgICAgICAgICB2YXIgaSA9IGpRdWVyeS5pbkFycmF5KHRoaXMuY3VycmVudF9sYW5nLCB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcyk7XG4gICAgICAgICAgICBpICsrO1xuICAgICAgICAgICAgaWYoaSA+IHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCAtIDEpIGkgPSAwO1xuICAgICAgICAgICAgdGhpcy5zaG93X2xhbmcoaSk7XG4gICAgICAgIH0sXG4gICAgICAgIGNyZWF0ZSA6IGZ1bmN0aW9uICh0eXBlLCBvYmosIGRhdGEsIGljb24sIGlkICkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgLy8gTk9USElORyBTRUxFQ1RFRFxuICAgICAgICAgICAgb2JqID0gb2JqID8gdGhpcy5nZXRfbm9kZShvYmopIDogdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgIGlmKCFvYmogfHwgIW9iai5zaXplKCkpIHJldHVybiB0aGlzLmVycm9yKFwiQ1JFQVRFOiBOTyBOT0RFIFNFTEVDVEVEXCIpO1xuICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJjcmVhdGFibGVcIiwgb2JqKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IENBTk5PVCBDUkVBVEUgSU4gTk9ERVwiKTtcblxuICAgICAgICAgICAgdmFyIHQgPSB0eXBlIHx8IHRoaXMuZ2V0X3R5cGUob2JqKSB8fCBcIlwiO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5ydWxlcy51c2VfaW5saW5lICYmIHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIG9iai5tZXRhZGF0YSgpW1widmFsaWRfY2hpbGRyZW5cIl0gIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICBpZihqUXVlcnkuaW5BcnJheSh0LCBvYmoubWV0YWRhdGEoKVtcInZhbGlkX2NoaWxkcmVuXCJdKSA9PSAtMSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE5PREUgTk9UIEEgVkFMSUQgQ0hJTERcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBvYmoubWV0YWRhdGEoKVtcIm1heF9jaGlsZHJlblwiXSAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCAob2JqLmNoaWxkcmVuKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaVwiKS5zaXplKCkgKyAxKSA+IG9iai5tZXRhZGF0YSgpLm1heF9jaGlsZHJlbikgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE1BWF9DSElMRFJFTiBSRUFDSEVEXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgb2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG9iai5wYXJlbnRzKFwibGlcIikuZWFjaChmdW5jdGlvbihpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGpRdWVyeSh0aGlzKS5tZXRhZGF0YSgpLm1heF9kZXB0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIChpICsgMSkgPj0galF1ZXJ5KHRoaXMpLm1ldGFkYXRhKCkubWF4X2RlcHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2sgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmKCFvaykgcmV0dXJuIHRoaXMuZXJyb3IoXCJDUkVBVEU6IE1BWF9ERVBUSCBSRUFDSEVEXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwiY2xvc2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuX2JyYW5jaChvYmosIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMuY3JlYXRlLmFwcGx5KF90aGlzLCBbdHlwZSwgb2JqLCBkYXRhLCBpY29uLCBpZF0pOyB9ICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKGlkKSAgICAkbGkgPSBqUXVlcnkoXCI8bGkgaWQ9J1wiICsgaWQgKyBcIicgLz5cIik7XG4gICAgICAgICAgICBlbHNlICAgICRsaSA9IGpRdWVyeShcIjxsaSAvPlwiKTtcbiAgICAgICAgICAgIC8vIE5FVyBOT0RFIElTIE9GIFBBU1NFRCBUWVBFIE9SIFBBUkVOVCdTIFRZUEVcbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubWV0YWRhdGEpIHtcbiAgICAgICAgICAgICAgICBqUXVlcnkubWV0YWRhdGEuc2V0VHlwZShcImF0dHJcIiwgdGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSk7XG4gICAgICAgICAgICAgICAgJGxpLmF0dHIodGhpcy5zZXR0aW5ncy5ydWxlcy5tZXRhZGF0YSwgXCJ0eXBlOiAnXCIgKyB0ICsgXCInXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJGxpLmF0dHIodGhpcy5zZXR0aW5ncy5ydWxlcy50eXBlX2F0dHIsIHQpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBpY24gPSBcIlwiO1xuICAgICAgICAgICAgaWYoKHR5cGVvZiBpY29uKS50b0xvd2VyQ2FzZSgpID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICBpY24gPSBpY29uO1xuICAgICAgICAgICAgICAgIGljbiA9IGljbi5pbmRleE9mKFwiL1wiKSA9PSAtMSA/IHRoaXMudGhlbWUgKyBpY24gOiBpY247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCB0aGlzLnNldHRpbmdzLmxhbmd1YWdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIGRhdGEpLnRvTG93ZXJDYXNlKCkgPT0gXCJzdHJpbmdcIikgdmFsID0gZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihkYXRhICYmIGRhdGFbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGRhdGFbaV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNldHRpbmdzLmxhbmcubmV3X25vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCh0eXBlb2YgdGhpcy5zZXR0aW5ncy5sYW5nLm5ld19ub2RlKS50b0xvd2VyQ2FzZSgpICE9IFwic3RyaW5nXCIgJiYgdGhpcy5zZXR0aW5ncy5sYW5nLm5ld19ub2RlW2ldKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuc2V0dGluZ3MubGFuZy5uZXdfbm9kZVtpXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLnNldHRpbmdzLmxhbmcubmV3X25vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBcIk5ldyBmb2xkZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZigodHlwZW9mIGljb24pLnRvTG93ZXJDYXNlKCkgIT0gXCJzdHJpbmdcIiAmJiBpY29uICYmIGljb25baV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGljbiA9IGljb25baV07XG4gICAgICAgICAgICAgICAgICAgICAgICBpY24gPSBpY24uaW5kZXhPZihcIi9cIikgPT0gLTEgPyB0aGlzLnRoZW1lICsgaWNuIDogaWNuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICRsaS5hcHBlbmQoXCI8YSBocmVmPScjJ1wiICsgKCBpY24ubGVuZ3RoID8gXCIgc3R5bGU9J2JhY2tncm91bmQtaW1hZ2U6dXJsKFxcXCJcIiArIGljbiArIFwiXFxcIik7JyBcIiA6IFwiIFwiKSArIFwiY2xhc3M9J1wiICsgdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0gKyBcIic+XCIgKyB2YWwgKyBcIjwvYT5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7ICRsaS5hcHBlbmQoXCI8YSBocmVmPScjJ1wiICsgKCBpY24ubGVuZ3RoID8gXCIgc3R5bGU9J2JhY2tncm91bmQtaW1hZ2U6dXJsKFxcXCJcIiArIGljbiArIFwiXFxcIik7JyBcIiA6IFwiIFwiKSArIFwiPlwiICsgKGRhdGEgfHwgdGhpcy5zZXR0aW5ncy5sYW5nLm5ld19ub2RlIHx8IFwiTmV3IGZvbGRlclwiKSArIFwiPC9hPlwiKTsgfVxuICAgICAgICAgICAgJGxpLmFkZENsYXNzKFwibGVhZlwiKTtcbiAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMuY3JlYXRlYXQgPT0gXCJ0b3BcIiB8fCBvYmouY2hpbGRyZW4oXCJ1bFwiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZWQoJGxpLG9iai5jaGlsZHJlbihcImE6ZXEoMClcIiksXCJpbnNpZGVcIiwgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmVkKCRsaSxvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpOmxhc3RcIikuY2hpbGRyZW4oXCJhOmVxKDApXCIpLFwiYWZ0ZXJcIix0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2VsZWN0X2JyYW5jaCgkbGkuY2hpbGRyZW4oXCJhOmVxKDApXCIpKTtcbiAgICAgICAgICAgIGlmKCFkYXRhKSB0aGlzLnJlbmFtZSgpO1xuICAgICAgICAgICAgcmV0dXJuICRsaTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVuYW1lIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJyZW5hbWVhYmxlXCIsIHRoaXMuc2VsZWN0ZWQpKSByZXR1cm4gdGhpcy5lcnJvcihcIlJFTkFNRTogTk9ERSBOT1QgUkVOQU1BQkxFXCIpO1xuICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmNhbGxiYWNrLmJlZm9yZXJlbmFtZS5jYWxsKG51bGwsdGhpcy5zZWxlY3RlZC5nZXQoMCksIF90aGlzLmN1cnJlbnRfbGFuZywgX3RoaXMpKSByZXR1cm4gdGhpcy5lcnJvcihcIlJFTkFNRTogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudF9sYW5nKSAgICBvYmogPSBvYmouZmluZChcImEuXCIgKyB0aGlzLmN1cnJlbnRfbGFuZykuZ2V0KDApO1xuICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgIG9iaiA9IG9iai5maW5kKFwiYTpmaXJzdFwiKS5nZXQoMCk7XG4gICAgICAgICAgICAgICAgbGFzdF92YWx1ZSA9IG9iai5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgX3RoaXMuaW5wID0galF1ZXJ5KFwiPGlucHV0IHR5cGU9J3RleHQnIC8+XCIpO1xuICAgICAgICAgICAgICAgIF90aGlzLmlucFxuICAgICAgICAgICAgICAgICAgICAudmFsKGxhc3RfdmFsdWUpXG4gICAgICAgICAgICAgICAgICAgIC5iaW5kKFwicG9pbnRlcmRvd25cIiwgICAgICAgIGZ1bmN0aW9uIChldmVudCkgeyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJwb2ludGVydXBcIiwgICAgICAgIGZ1bmN0aW9uIChldmVudCkgeyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJjbGlja1wiLCAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkgeyBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgLmJpbmQoXCJrZXl1cFwiLCAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldmVudC5rZXlDb2RlIHx8IGV2ZW50LndoaWNoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGtleSA9PSAyNykgeyB0aGlzLnZhbHVlID0gbGFzdF92YWx1ZTsgdGhpcy5ibHVyKCk7IHJldHVybiB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoa2V5ID09IDEzKSB7IHRoaXMuYmx1cigpOyByZXR1cm4gfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgX3RoaXMuaW5wLmJsdXIoZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMudmFsdWUgPT0gXCJcIikgdGhpcy52YWx1ZSA9PSBsYXN0X3ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KG9iaikuaHRtbCggalF1ZXJ5KG9iaikucGFyZW50KCkuZmluZChcImlucHV0XCIpLmVxKDApLmF0dHIoXCJ2YWx1ZVwiKSApLmdldCgwKS5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeShvYmopLnByZXZBbGwoXCJzcGFuXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy52YWx1ZSAhPSBsYXN0X3ZhbHVlKSBfdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbnJlbmFtZS5jYWxsKG51bGwsIF90aGlzLmdldF9ub2RlKG9iaikuZ2V0KDApLCBfdGhpcy5jdXJyZW50X2xhbmcsIF90aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmlucCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB2YXIgc3BuID0galF1ZXJ5KFwiPHNwYW4gLz5cIikuYWRkQ2xhc3Mob2JqLmNsYXNzTmFtZSkuYXBwZW5kKF90aGlzLmlucCk7XG4gICAgICAgICAgICAgICAgc3BuLmF0dHIoXCJzdHlsZVwiLCBqUXVlcnkob2JqKS5hdHRyKFwic3R5bGVcIikpO1xuICAgICAgICAgICAgICAgIG9iai5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgICAgICAgICAgalF1ZXJ5KG9iaikucGFyZW50KCkucHJlcGVuZChzcG4pO1xuICAgICAgICAgICAgICAgIF90aGlzLmlucC5nZXQoMCkuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICBfdGhpcy5pbnAuZ2V0KDApLnNlbGVjdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSByZXR1cm4gdGhpcy5lcnJvcihcIlJFTkFNRTogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gUkVNT1ZFIE5PREVTXG4gICAgICAgIHJlbW92ZSA6IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgb2JqID0gdGhpcy5nZXRfbm9kZShvYmopO1xuICAgICAgICAgICAgICAgIGlmKG9iai5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJkZWxldGFibGVcIiwgb2JqKSkgcmV0dXJuIHRoaXMuZXJyb3IoXCJERUxFVEU6IE5PREUgTk9UIERFTEVUQUJMRVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlZGVsZXRlLmNhbGwobnVsbCxvYmouZ2V0KDApLCBfdGhpcykpIHJldHVybiB0aGlzLmVycm9yKFwiREVMRVRFOiBTVE9QUEVEIEJZIFVTRVJcIik7XG4gICAgICAgICAgICAgICAgICAgICRwYXJlbnQgPSBvYmoucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIG9iaiA9IG9iai5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgJHBhcmVudC5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZigkcGFyZW50LmNoaWxkcmVuKFwibGlcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsaSA9ICRwYXJlbnQucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxpLnJlbW92ZUNsYXNzKFwib3BlblwiKS5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcIm9wZW5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmRlbGV0ZS5jYWxsKG51bGwsIG9iaiwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2soXCJkZWxldGFibGVcIiwgdGhpcy5zZWxlY3RlZCkpIHJldHVybiB0aGlzLmVycm9yKFwiREVMRVRFOiBOT0RFIE5PVCBERUxFVEFCTEVcIik7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlZGVsZXRlLmNhbGwobnVsbCx0aGlzLnNlbGVjdGVkLmdldCgwKSwgX3RoaXMpKSByZXR1cm4gdGhpcy5lcnJvcihcIkRFTEVURTogU1RPUFBFRCBCWSBVU0VSXCIpO1xuICAgICAgICAgICAgICAgICRwYXJlbnQgPSB0aGlzLnNlbGVjdGVkLnBhcmVudCgpO1xuICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgPT0gZmFsc2UgfHwgdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3AgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG1wID0gKHRoaXMuc2VsZWN0ZWQucHJldihcImxpOmVxKDApXCIpLnNpemUoKSkgPyB0aGlzLnNlbGVjdGVkLnByZXYoXCJsaTplcSgwKVwiKSA6IHRoaXMuc2VsZWN0ZWQucGFyZW50cyhcImxpOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmdldF9wcmV2KHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvYmogPSBvYmoucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgJHBhcmVudC5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgIGlmKCRwYXJlbnQuY2hpbGRyZW4oXCJsaVwiKS5zaXplKCkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAkbGkgPSAkcGFyZW50LnBhcmVudHMoXCJsaTplcSgwKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJGxpLnJlbW92ZUNsYXNzKFwib3BlblwiKS5yZW1vdmVDbGFzcyhcImNsb3NlZFwiKS5hZGRDbGFzcyhcImxlYWZcIikuY2hpbGRyZW4oXCJ1bFwiKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfY29va2llKFwib3BlblwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy90aGlzLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbmRlbGV0ZS5jYWxsKG51bGwsIG9iaiwgdGhpcyk7XG4gICAgICAgICAgICAgICAgaWYoc3RvcCAmJiB0bXApIHRoaXMuc2VsZWN0X2JyYW5jaCh0bXApO1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgIXN0b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZF9hcnIgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImEuY2xpY2tlZFwiKS5maWx0ZXIoXCI6Zmlyc3QtY2hpbGRcIikucGFyZW50KCkuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RlZF9hcnIucHVzaChqUXVlcnkodGhpcykpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHRoaXMuc2VsZWN0ZWRfYXJyWzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgcmV0dXJuIHRoaXMuZXJyb3IoXCJERUxFVEU6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIEZPUiBFWFBMT1JFUi1MSUtFIEtFWUJPQVJEIFNIT1JUQ1VUU1xuICAgICAgICBnZXRfbmV4dCA6IGZ1bmN0aW9uKGZvcmNlKSB7XG4gICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5ob3ZlcmVkIHx8IHRoaXMuc2VsZWN0ZWQ7XG4gICAgICAgICAgICBpZihvYmopIHtcbiAgICAgICAgICAgICAgICBpZihvYmouaGFzQ2xhc3MoXCJvcGVuXCIpKSAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmouZmluZChcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5maW5kKFwibGk6ZXEoMClcIikpO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYoalF1ZXJ5KG9iaikubmV4dEFsbChcImxpXCIpLnNpemUoKSA+IDApICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoubmV4dEFsbChcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5uZXh0QWxsKFwibGk6ZXEoMClcIikpO1xuICAgICAgICAgICAgICAgIGVsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoucGFyZW50cyhcImxpXCIpLm5leHQoXCJsaVwiKS5lcSgwKSkgOiB0aGlzLmhvdmVyX2JyYW5jaChvYmoucGFyZW50cyhcImxpXCIpLm5leHQoXCJsaVwiKS5lcSgwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdldF9wcmV2IDogZnVuY3Rpb24oZm9yY2UpIHtcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmhvdmVyZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgIGlmKG9iai5wcmV2KFwibGlcIikuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBvYmoucHJldihcImxpXCIpLmVxKDApO1xuICAgICAgICAgICAgICAgICAgICB3aGlsZShvYmouaGFzQ2xhc3MoXCJvcGVuXCIpKSBvYmogPSBvYmouY2hpbGRyZW4oXCJ1bDplcSgwKVwiKS5jaGlsZHJlbihcImxpOmxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmopIDogdGhpcy5ob3Zlcl9icmFuY2gob2JqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7IHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoucGFyZW50cyhcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5wYXJlbnRzKFwibGk6ZXEoMClcIikpOyB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdldF9sZWZ0IDogZnVuY3Rpb24oZm9yY2UsIHJ0bCkge1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ydGwgJiYgIXJ0bCkgcmV0dXJuIHRoaXMuZ2V0X3JpZ2h0KGZvcmNlLCB0cnVlKTtcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmhvdmVyZWQgfHwgdGhpcy5zZWxlY3RlZDtcbiAgICAgICAgICAgIGlmKG9iaikge1xuICAgICAgICAgICAgICAgIGlmKG9iai5oYXNDbGFzcyhcIm9wZW5cIikpICAgIHRoaXMuY2xvc2VfYnJhbmNoKG9iaik7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmoucGFyZW50cyhcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5wYXJlbnRzKFwibGk6ZXEoMClcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZ2V0X3JpZ2h0IDogZnVuY3Rpb24oZm9yY2UsIHJ0bCkge1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy51aS5ydGwgJiYgIXJ0bCkgcmV0dXJuIHRoaXMuZ2V0X2xlZnQoZm9yY2UsIHRydWUpO1xuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuaG92ZXJlZCB8fCB0aGlzLnNlbGVjdGVkO1xuICAgICAgICAgICAgaWYob2JqKSB7XG4gICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwiY2xvc2VkXCIpKSAgICB0aGlzLm9wZW5fYnJhbmNoKG9iaik7XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JjZSA/IHRoaXMuc2VsZWN0X2JyYW5jaChvYmouZmluZChcImxpOmVxKDApXCIpKSA6IHRoaXMuaG92ZXJfYnJhbmNoKG9iai5maW5kKFwibGk6ZXEoMClcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdG9nZ2xlRG90cyA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnRvZ2dsZUNsYXNzKFwibm9fZG90c1wiKTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0X2Nvb2tpZSA6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLmNvb2tpZXMgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBzd2l0Y2godHlwZSkge1xuICAgICAgICAgICAgICAgIC8qY2FzZSBcInNlbGVjdGVkXCI6XG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MucnVsZXMubXVsdGlwbGUgIT0gZmFsc2UgJiYgdGhpcy5zZWxlY3RlZF9hcnIubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IEFycmF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZWFjaCh0aGlzLnNlbGVjdGVkX2FyciwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbC5wdXNoKHRoaXMuYXR0cihcImlkXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gdmFsLmpvaW4oXCIsXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgdmFyIHZhbCA9IHRoaXMuc2VsZWN0ZWQgPyB0aGlzLnNlbGVjdGVkLmF0dHIoXCJpZFwiKSA6IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX3NlbGVjdGVkJyx2YWwsdGhpcy5zZXR0aW5ncy5jb29raWVzLm9wdHMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhazsqL1xuICAgICAgICAgICAgICAgIGNhc2UgXCJvcGVuXCI6XG4gICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKFwibGkub3BlblwiKS5lYWNoKGZ1bmN0aW9uIChpKSB7IHN0ciArPSB0aGlzLmlkICsgXCIsXCI7IH0pO1xuICAgICAgICAgICAgICAgICAgICBqUXVlcnkuY29va2llKHRoaXMuc2V0dGluZ3MuY29va2llcy5wcmVmaXggKyAnX29wZW4nLHN0ci5yZXBsYWNlKC8sJC9pZyxcIlwiKSx0aGlzLnNldHRpbmdzLmNvb2tpZXMub3B0cyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBtb3ZlZCA6IGZ1bmN0aW9uICh3aGF0LCB3aGVyZSwgaG93LCBpc19uZXcsIGlzX2NvcHkpIHtcbiAgICAgICAgICAgIHZhciB3aGF0ICAgID0galF1ZXJ5KHdoYXQpO1xuICAgICAgICAgICAgdmFyICRwYXJlbnQgICAgPSBqUXVlcnkod2hhdCkucGFyZW50cyhcInVsOmVxKDApXCIpO1xuICAgICAgICAgICAgdmFyICR3aGVyZSAgICA9IGpRdWVyeSh3aGVyZSk7XG4gICAgICAgICAgICAvLyBJRiBNVUxUSVBMRVxuICAgICAgICAgICAgaWYod2hhdC5zaXplKCkgPiAxKSB7XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICB2YXIgdG1wID0gdGhpcy5tb3ZlZCh3aGF0LmVxKDApLHdoZXJlLGhvdywgZmFsc2UsIGlzX2NvcHkpO1xuICAgICAgICAgICAgICAgIHdoYXQuZWFjaChmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgICAgICAgICBpZihpID09IDApIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgdG1wID0gX3RoaXMubW92ZWQodGhpcywgdG1wLmNoaWxkcmVuKFwiYTplcSgwKVwiKSwgXCJhZnRlclwiLCBmYWxzZSwgaXNfY29weSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihpc19jb3B5KSB7XG4gICAgICAgICAgICAgICAgd2hhdCA9IHdoYXQuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB3aGF0LmVhY2goZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pZCA9IHRoaXMuaWQgKyBcIl9jb3B5XCI7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSh0aGlzKS5maW5kKFwibGlcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gdGhpcy5pZCArIFwiX2NvcHlcIjtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLmZpbmQoXCJhLmNsaWNrZWRcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoaXNfbmV3KSB7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlY3JlYXRlLmNhbGwobnVsbCx0aGlzLmdldF9ub2RlKHdoYXQpLmdldCgwKSwgdGhpcy5nZXRfbm9kZSh3aGVyZSkuZ2V0KDApLGhvdyx0aGlzKSkgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc2V0dGluZ3MuY2FsbGJhY2suYmVmb3JlbW92ZS5jYWxsKG51bGwsdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSxob3csdGhpcykpIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIWlzX25ldykge1xuICAgICAgICAgICAgICAgIHZhciB0bXAgPSBqUXVlcnkod2hhdCkucGFyZW50cyhcIi50cmVlOmVxKDApXCIpO1xuICAgICAgICAgICAgICAgIC8vIGlmIGRpZmZlcmVudCB0cmVlc1xuICAgICAgICAgICAgICAgIGlmKHRtcC5nZXQoMCkgIT0gdGhpcy5jb250YWluZXIuZ2V0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgIHRtcCA9IHRyZWVfY29tcG9uZW50Lmluc3RbdG1wLmF0dHIoXCJpZFwiKV07XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSBsYW5ndWFnZXMgLSBvdGhlcndpc2UgLSBubyBjbGVhbnVwIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICBpZih0bXAuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbmV3IHRyZWUgaGFzIG5vIGxhbmd1YWdlcyAtIHVzZSBjdXJyZW50IHZpc2libGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCA9PSAwKSByZXMucHVzaChcIi5cIiArIHRtcC5jdXJyZW50X2xhbmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGkgaW4gdGhpcy5zZXR0aW5ncy5sYW5ndWFnZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogaW4gdG1wLnNldHRpbmdzLmxhbmd1YWdlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5sYW5ndWFnZXNbaV0gPT0gdG1wLnNldHRpbmdzLmxhbmd1YWdlc1tqXSkgcmVzLnB1c2goXCIuXCIgKyB0aGlzLnNldHRpbmdzLmxhbmd1YWdlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihyZXMubGVuZ3RoID09IDApIHJldHVybiB0aGlzLmVycm9yKFwiTU9WRTogTk8gQ09NTU9OIExBTkdVQUdFU1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoYXQuZmluZChcImFcIikucmVtb3ZlQ2xhc3MoXCJjbGlja2VkXCIpLm5vdChyZXMuam9pbihcIixcIikpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBREQgTk9ERSBUTyBORVcgUExBQ0VcbiAgICAgICAgICAgIHN3aXRjaChob3cpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiYmVmb3JlXCI6XG4gICAgICAgICAgICAgICAgICAgICR3aGVyZS5wYXJlbnRzKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaS5sYXN0XCIpLnJlbW92ZUNsYXNzKFwibGFzdFwiKTtcbiAgICAgICAgICAgICAgICAgICAgJHdoZXJlLnBhcmVudHMoXCJsaTplcSgwKVwiKS5iZWZvcmUod2hhdC5yZW1vdmVDbGFzcyhcImxhc3RcIikpO1xuICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJhZnRlclwiOlxuICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGkubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICR3aGVyZS5wYXJlbnRzKFwibGk6ZXEoMClcIikuYWZ0ZXIod2hhdC5yZW1vdmVDbGFzcyhcImxhc3RcIikpO1xuICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcInVsOmVxKDApXCIpLmNoaWxkcmVuKFwibGk6bGFzdFwiKS5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpbnNpZGVcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5nZXRfbm9kZSgkd2hlcmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYob2JqLmhhc0NsYXNzKFwiY2xvc2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vcGVuX2JyYW5jaChvYmosIHRydWUsIGZ1bmN0aW9uICgpIHsgX3RoaXMubW92ZWQuYXBwbHkoX3RoaXMsIFt3aGF0LCB3aGVyZSwgaG93LCBpc19uZXcsIGlzX2NvcHldKTsgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZigkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmNoaWxkcmVuKFwidWw6Zmlyc3RcIikuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNldHRpbmdzLnJ1bGVzLmNyZWF0ZWF0ID09IFwidG9wXCIpICAgICR3aGVyZS5wYXJlbnRzKFwibGk6ZXEoMClcIikuY2hpbGRyZW4oXCJ1bDpmaXJzdFwiKS5wcmVwZW5kKHdoYXQucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpKS5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmNoaWxkcmVuKFwidWw6Zmlyc3RcIikuY2hpbGRyZW4oXCIubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIikuZW5kKCkuYXBwZW5kKHdoYXQucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpKS5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hhdC5hZGRDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkd2hlcmUucGFyZW50cyhcImxpOmVxKDApXCIpLmFwcGVuZChcIjx1bC8+XCIpLnJlbW92ZUNsYXNzKFwibGVhZlwiKS5hZGRDbGFzcyhcImNsb3NlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR3aGVyZS5wYXJlbnRzKFwibGk6ZXEoMClcIikuY2hpbGRyZW4oXCJ1bDpmaXJzdFwiKS5wcmVwZW5kKHdoYXQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmKCF0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3Blbl9icmFuY2goJHdoZXJlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIENMRUFOVVAgT0xEIFBBUkVOVFxuICAgICAgICAgICAgaWYoJHBhcmVudC5maW5kKFwibGlcIikuc2l6ZSgpID09IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgJGxpID0gJHBhcmVudC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAkbGkucmVtb3ZlQ2xhc3MoXCJvcGVuXCIpLnJlbW92ZUNsYXNzKFwiY2xvc2VkXCIpLmFkZENsYXNzKFwibGVhZlwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICRsaS5wYXJlbnRzKFwidWw6ZXEoMClcIikuY2hpbGRyZW4oXCJsaS5sYXN0XCIpLnJlbW92ZUNsYXNzKFwibGFzdFwiKS5lbmQoKS5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0X2Nvb2tpZShcIm9wZW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkcGFyZW50LmNoaWxkcmVuKFwibGkubGFzdFwiKS5yZW1vdmVDbGFzcyhcImxhc3RcIik7XG4gICAgICAgICAgICAgICAgJHBhcmVudC5jaGlsZHJlbihcImxpOmxhc3RcIikuYWRkQ2xhc3MoXCJsYXN0XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoaXNfbmV3ICYmIGhvdyAhPSBcImluc2lkZVwiKSB3aGVyZSA9IHRoaXMuZ2V0X25vZGUod2hlcmUpLnBhcmVudHMoXCJsaTplcSgwKVwiKTtcbiAgICAgICAgICAgIGlmKGlzX2NvcHkpICAgICAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uY29weS5jYWxsKG51bGwsIHRoaXMuZ2V0X25vZGUod2hhdCkuZ2V0KDApLCB0aGlzLmdldF9ub2RlKHdoZXJlKS5nZXQoMCksIGhvdywgdGhpcylcbiAgICAgICAgICAgIGVsc2UgaWYoaXNfbmV3KSAgICB0aGlzLnNldHRpbmdzLmNhbGxiYWNrLm9uY3JlYXRlLmNhbGwobnVsbCwgdGhpcy5nZXRfbm9kZSh3aGF0KS5nZXQoMCksIHRoaXMuZ2V0X25vZGUod2hlcmUpLmdldCgwKSwgdGhpcy5zZXR0aW5ncy5pbnNlcnRBdCwgdGhpcyk7XG4gICAgICAgICAgICBlbHNlICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5jYWxsYmFjay5vbm1vdmUuY2FsbChudWxsLCB0aGlzLmdldF9ub2RlKHdoYXQpLmdldCgwKSwgdGhpcy5nZXRfbm9kZSh3aGVyZSkuZ2V0KDApLCBob3csIHRoaXMpO1xuICAgICAgICAgICAgcmV0dXJuIHdoYXQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yIDogZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuY2FsbGJhY2suZXJyb3IuY2FsbChudWxsLGNvZGUsdGhpcyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGxvY2sgOiBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMubG9ja2VkID0gc3RhdGU7XG4gICAgICAgICAgICBpZih0aGlzLmxvY2tlZCkgICAgdGhpcy5jb250YWluZXIuYWRkQ2xhc3MoXCJsb2NrZWRcIik7XG4gICAgICAgICAgICBlbHNlICAgICAgICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlQ2xhc3MoXCJsb2NrZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGN1dCA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgIGlmKCF0aGlzLnNlbGVjdGVkKSByZXR1cm4gdGhpcy5lcnJvcihcIkNVVDogTk8gTk9ERSBTRUxFQ1RFRFwiKTtcbiAgICAgICAgICAgIHRoaXMuY29weV9ub2RlcyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5jdXRfbm9kZXMgPSB0aGlzLmNvbnRhaW5lci5maW5kKFwiYS5jbGlja2VkXCIpLmZpbHRlcihcIjpmaXJzdC1jaGlsZFwiKS5wYXJlbnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgY29weSA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmKHRoaXMubG9ja2VkKSByZXR1cm4gdGhpcy5lcnJvcihcIkxPQ0tFRFwiKTtcbiAgICAgICAgICAgIGlmKCF0aGlzLnNlbGVjdGVkKSByZXR1cm4gdGhpcy5lcnJvcihcIkNPUFk6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgICAgICB0aGlzLmNvcHlfbm9kZXMgPSB0aGlzLmNvbnRhaW5lci5maW5kKFwiYS5jbGlja2VkXCIpLmZpbHRlcihcIjpmaXJzdC1jaGlsZFwiKS5wYXJlbnQoKTtcbiAgICAgICAgICAgIHRoaXMuY3V0X25vZGVzID0gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIHBhc3RlIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYodGhpcy5sb2NrZWQpIHJldHVybiB0aGlzLmVycm9yKFwiTE9DS0VEXCIpO1xuICAgICAgICAgICAgaWYoIXRoaXMuc2VsZWN0ZWQpIHJldHVybiB0aGlzLmVycm9yKFwiUEFTVEU6IE5PIE5PREUgU0VMRUNURURcIik7XG4gICAgICAgICAgICBpZighdGhpcy5jb3B5X25vZGVzICYmICF0aGlzLmN1dF9ub2RlcykgcmV0dXJuIHRoaXMuZXJyb3IoXCJQQVNURTogTk9USElORyBUTyBET1wiKTtcbiAgICAgICAgICAgIGlmKHRoaXMuY29weV9ub2RlcyAmJiB0aGlzLmNvcHlfbm9kZXMuc2l6ZSgpKSB7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuY2hlY2tNb3ZlKHRoaXMuY29weV9ub2RlcywgdGhpcy5zZWxlY3RlZC5jaGlsZHJlbihcImE6ZXEoMClcIiksIFwiaW5zaWRlXCIpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlZCh0aGlzLmNvcHlfbm9kZXMsIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJhOmVxKDApXCIpLCBcImluc2lkZVwiLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb3B5X25vZGVzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLmN1dF9ub2RlcyAmJiB0aGlzLmN1dF9ub2Rlcy5zaXplKCkpIHtcbiAgICAgICAgICAgICAgICBpZighdGhpcy5jaGVja01vdmUodGhpcy5jdXRfbm9kZXMsIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJhOmVxKDApXCIpLCBcImluc2lkZVwiKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMubW92ZWQodGhpcy5jdXRfbm9kZXMsIHRoaXMuc2VsZWN0ZWQuY2hpbGRyZW4oXCJhOmVxKDApXCIpLCBcImluc2lkZVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN1dF9ub2RlcyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzZWFyY2ggOiBmdW5jdGlvbihzdHIpIHtcbiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICAgICBpZighc3RyIHx8ICh0aGlzLnNyY2ggJiYgc3RyICE9IHRoaXMuc3JjaCkgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcmNoID0gXCJcIjtcbiAgICAgICAgICAgICAgICB0aGlzLnNyY2hfb3BuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChcImEuc2VhcmNoXCIpLnJlbW92ZUNsYXNzKFwic2VhcmNoXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zcmNoID0gc3RyO1xuICAgICAgICAgICAgaWYoIXN0cikgcmV0dXJuO1xuICAgICAgICAgICAgaWYodGhpcy5zZXR0aW5ncy5kYXRhLmFzeW5jKSB7XG4gICAgICAgICAgICAgICAgaWYoIXRoaXMuc3JjaF9vcG4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRkID0galF1ZXJ5LmV4dGVuZCggeyBcInNlYXJjaFwiIDogc3RyIH0gLCB0aGlzLnNldHRpbmdzLmRhdGEuYXN5bmNfZGF0YShmYWxzZSkgKTtcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEubWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsICAgICAgICAgICAgOiB0aGlzLnNldHRpbmdzLmRhdGEudXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSAgICAgICAgOiBkZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlICAgIDogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzICAgICAgICA6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3JjaF9vcG4gPSBqUXVlcnkudW5pcXVlKGRhdGEuc3BsaXQoXCIsXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWFyY2guYXBwbHkoX3RoaXMsW3N0cl0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZih0aGlzLnNyY2hfb3BuLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNyY2hfb3BuICYmIHRoaXMuc3JjaF9vcG4ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3BuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgdGhpcy5zcmNoX29wbi5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2V0X25vZGUoXCIjXCIgKyB0aGlzLnNyY2hfb3BuW2pdKS5zaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSBcIiNcIiArIHRoaXMuc3JjaF9vcG5bal07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNyY2hfb3BuW2pdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9wZW5fYnJhbmNoKHRtcCwgdHJ1ZSwgZnVuY3Rpb24gKCkgeyBfdGhpcy5zZWFyY2guYXBwbHkoX3RoaXMsW3N0cl0pOyB9ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW9wbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3JjaF9vcG4gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoLmFwcGx5KF90aGlzLFtzdHJdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gXCJhXCI7XG4gICAgICAgICAgICAgICAgICAgIC8vIElGIExBTkdVQUdFIFZFUlNJT05TXG4gICAgICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkgc2VsZWN0b3IgKz0gXCIuXCIgKyB0aGlzLmN1cnJlbnRfbGFuZztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXIuZmluZChzZWxlY3RvciArIFwiOmNvbnRhaW5zKCdcIiArIHN0ciArIFwiJylcIikuYWRkQ2xhc3MoXCJzZWFyY2hcIik7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3JjaF9vcG4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgc2VsZWN0b3IgPSBcImFcIjtcbiAgICAgICAgICAgICAgICAvLyBJRiBMQU5HVUFHRSBWRVJTSU9OU1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuc2V0dGluZ3MubGFuZ3VhZ2VzLmxlbmd0aCkgc2VsZWN0b3IgKz0gXCIuXCIgKyB0aGlzLmN1cnJlbnRfbGFuZztcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5maW5kKHNlbGVjdG9yICsgXCI6Y29udGFpbnMoJ1wiICsgc3RyICsgXCInKVwiKS5hZGRDbGFzcyhcInNlYXJjaFwiKS5wYXJlbnRzKFwibGkuY2xvc2VkXCIpLmVhY2goIGZ1bmN0aW9uICgpIHsgX3RoaXMub3Blbl9icmFuY2godGhpcywgdHJ1ZSk7IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3kgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2dHMgPSBbXCJjbGlja1wiLFwiZGJsY2xpY2tcIixcImNvbnRleHRtZW51XCIsXCJwb2ludGVyb3ZlclwiLFwicG9pbnRlcmRvd25cIl07XG4gICAgICAgICAgICAgICAgZm9yKGkgaW4gZXZ0cykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ZXIgPSB0aGlzLmNvbnRhaW5lci5pbmRleGVyKGV2dHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICBpZHhlci5zdG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5yZW1vdmVEYXRhKCBpZHhlci5saXN0ZW5lciwgaWR4ZXIuZXZlbnQgKyAnLmluZGV4ZXInICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaChlcnIpIHsgfVxuICAgICAgICAgICAgdGhpcy5jb250YWluZXIudW5iaW5kKCk7XG5cbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNsYXNzKFwidHJlZVwiKS5jaGlsZHJlbihcInVsXCIpLnJlbW92ZUNsYXNzKFwidHJlZS1cIiArIHRoaXMuc2V0dGluZ3MudWkudGhlbWVfbmFtZSkuZmluZChcImxpXCIpLnJlbW92ZUNsYXNzKFwibGVhZlwiKS5yZW1vdmVDbGFzcyhcIm9wZW5cIikucmVtb3ZlQ2xhc3MoXCJjbG9zZWRcIikucmVtb3ZlQ2xhc3MoXCJsYXN0XCIpLmNoaWxkcmVuKFwiYVwiKS5yZW1vdmVDbGFzcyhcImNsaWNrZWRcIik7XG5cbiAgICAgICAgICAgIGlmKHRoaXMuY250ciA9PSB0cmVlX2NvbXBvbmVudC5mb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgZm9yKGkgaW4gdHJlZV9jb21wb25lbnQuaW5zdCkge1xuICAgICAgICAgICAgICAgICAgICBpZihpICE9IHRoaXMuY250ciAmJiBpICE9IHRoaXMuY29udGFpbmVyLmF0dHIoXCJpZFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJlZV9jb21wb25lbnQuaW5zdFtpXS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGUgdHJlZV9jb21wb25lbnQuaW5zdFt0aGlzLmNudHJdO1xuICAgICAgICAgICAgZGVsZXRlIHRyZWVfY29tcG9uZW50Lmluc3RbdGhpcy5jb250YWluZXIuYXR0cihcImlkXCIpXTtcbiAgICAgICAgICAgIHRyZWVfY29tcG9uZW50LmNudHIgLS07XG4gICAgICAgIH1cbiAgICB9XG59O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9