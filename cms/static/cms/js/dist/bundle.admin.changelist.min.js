/*! jQuery UI - v1.11.4 - 2015-11-13
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, sortable.js, effect.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */
!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,s){var n,o,r,a=e.nodeName.toLowerCase();return"area"===a?(n=e.parentNode,o=n.name,e.href&&o&&"map"===n.nodeName.toLowerCase()?(r=t("img[usemap='#"+o+"']")[0],!!r&&i(r)):!1):(/^(input|select|textarea|button|object)$/.test(a)?!e.disabled:"a"===a?e.href||s:s)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var s=t.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&e(i,!n)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?r["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?r["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(i,s){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),s&&s.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var i,s,n=t(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}};var s=0,n=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(r){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,r,a,h={},c=e.split(".")[0];return e=e.split(".")[1],n=c+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][n.toLowerCase()]=function(e){return!!t.data(e,n)},t[c]=t[c]||{},o=t[c][e],r=t[c][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new r(t,e)},t.extend(r,o,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?void(h[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},n=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(h[e]=s)}),r.prototype=t.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix||e:e},h,{constructor:r,namespace:c,widgetName:e,widgetFullName:n}),o?(t.each(o._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete o._childConstructors):i._childConstructors.push(r),t.widget.bridge(e,r),r},t.widget.extend=function(e){for(var i,s,o=n.call(arguments,1),r=0,a=o.length;a>r;r++)for(i in o[r])s=o[r][i],o[r].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(o){var r="string"==typeof o,a=n.call(arguments,1),h=this;return r?this.each(function(){var i,n=t.data(this,s);return"instance"===o?(h=n,!1):n?t.isFunction(n[o])&&"_"!==o.charAt(0)?(i=n[o].apply(n,a),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+o+"'")}):(a.length&&(o=t.widget.extend.apply(null,[o].concat(a))),this.each(function(){var e=t.data(this,s);e?(e.option(o||{}),e._init&&e._init()):t.data(this,s,new i(o,this))})),h}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,r=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(r={},s=e.split("."),e=s.shift(),s.length){for(n=r[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];r[e]=i}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,r){function a(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?o[r]:r).apply(o,arguments):void 0}"string"!=typeof r&&(a.guid=r.guid=r.guid||a.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),c=h[1]+o.eventNamespace,l=h[2];l?n.delegate(l,c,a):i.bind(c,a)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(i).undelegate(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var n,o,r=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var r,a=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),r=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),r&&t.effects&&t.effects.effect[a]?s[e](n):a!==e&&s[a]?s[a](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget;var o=!1;t(document).mouseup(function(){o=!1}),t.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!o){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),o=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),o=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s&&(!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n))?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(e,i,s){var n,o,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",r.cursor),this.storedStylesheet=t("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(o)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,r=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+r.scrollSpeed:e.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+r.scrollSpeed:e.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(e.pageY-this.document.scrollTop()<r.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-r.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<r.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+r.scrollSpeed)),e.pageX-this.document.scrollLeft()<r.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-r.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<r.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+r.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,r={};o&&"x"!==o||(r.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(r.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,r=o+t.width,a=t.top,h=a+t.height,c=this.offset.click.top,l=this.offset.click.left,u="x"===this.options.axis||s+c>a&&h>s+c,f="y"===this.options.axis||e+l>o&&r>e+l,p=u&&f;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&r>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>a&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=e&&i,n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return s?this.floating?o&&"right"===o||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){a.push(this)}var s,n,o,r,a=[],h=[],c=this._connectWith();if(c&&e)for(s=c.length-1;s>=0;s--)for(o=t(c[s],this.document[0]),n=o.length-1;n>=0;n--)r=t.data(o[n],this.widgetFullName),r&&r!==this&&!r.options.disabled&&h.push([t.isFunction(r.options.items)?r.options.items.call(r.element):t(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,r,a,h,c,l=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],f=this._connectWith();if(f&&this.ready)for(i=f.length-1;i>=0;i--)for(n=t(f[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(r=u[i][1],a=u[i][0],s=0,c=a.length;c>s;s++)h=t(a[s]),h.data(this.widgetName+"-item",r),l.push({item:h,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,r,a,h,c,l,u,f=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(f&&t.contains(this.containers[i].element[0],f.element[0]))continue;f=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,l=f.floating||this._isFloating(this.currentItem),r=l?"left":"top",a=l?"width":"height",u=l?"clientX":"clientY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[r],c=!1,e[u]-h>this.items[s][a]/2&&(c=!0),n>Math.abs(e[u]-h)&&(n=Math.abs(e[u]-h),o=this.items[s],this.direction=c?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),
/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,r=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/n.grid[1])*n.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:a.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}});var r="ui-effects-",a=t;t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=c(),n=s._rgba=[];return i=i.toLowerCase(),d(h,function(t,o){var r,a=o.re.exec(i),h=a&&o.parse(a),c=o.space||"rgba";return h?(r=s[c](h),s[l[c].cache]=r[l[c].cache],n=s._rgba=r._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,r="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],c=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},l={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},f=c.support={},p=t("<p>")[0],d=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",f.rgba=p.style.backgroundColor.indexOf("rgba")>-1,d(l,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),c.fn=t.extend(c.prototype,{parse:function(n,r,a,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(r),r=e);var u=this,f=t.type(n),p=this._rgba=[];return r!==e&&(n=[n,r,a,h],f="array"),"string"===f?this.parse(s(n)||o._default):"array"===f?(d(l.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===f?(n instanceof c?d(l,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):d(l,function(e,s){var o=s.cache;d(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=c(t),s=!0,n=this;return d(l,function(t,o){var r,a=i[o.cache];return a&&(r=n[o.cache]||o.to&&o.to(n._rgba)||[],d(o.props,function(t,i){return null!=a[i.idx]?s=a[i.idx]===r[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return d(l,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=c(t),n=s._space(),o=l[n],r=0===this.alpha()?c("transparent"):this,a=r[o.cache]||o.to(r._rgba),h=a.slice();return s=s[o.cache],d(o.props,function(t,n){var o=n.idx,r=a[o],c=s[o],l=u[n.type]||{};null!==c&&(null===r?h[o]=c:(l.mod&&(c-r>l.mod/2?r+=l.mod:r-c>l.mod/2&&(r-=l.mod)),h[o]=i((c-r)*e+r,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=c(e)._rgba;return c(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),c.fn.parse.prototype=c.fn,l.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,r=t[3],a=Math.max(s,n,o),h=Math.min(s,n,o),c=a-h,l=a+h,u=.5*l;return e=h===a?0:s===a?60*(n-o)/c+360:n===a?60*(o-s)/c+120:60*(s-n)/c+240,i=0===c?0:.5>=u?c/l:c/(2-l),[Math.round(e)%360,i,u,null==r?1:r]},l.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],r=.5>=s?s*(1+i):s+i-s*i,a=2*s-r;return[Math.round(255*n(a,r,e+1/3)),Math.round(255*n(a,r,e)),Math.round(255*n(a,r,e-1/3)),o]},d(l,function(s,n){var o=n.props,r=n.cache,h=n.to,l=n.from;c.fn[s]=function(s){if(h&&!this[r]&&(this[r]=h(this._rgba)),s===e)return this[r].slice();var n,a=t.type(s),u="array"===a||"object"===a?s:arguments,f=this[r].slice();return d(o,function(t,e){var s=u["object"===a?t:e.idx];null==s&&(s=f[e.idx]),f[e.idx]=i(s,e)}),l?(n=c(l(f)),n[r]=f,n):c(f)},d(o,function(e,i){c.fn[e]||(c.fn[e]=function(n){var o,r=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,c=this[h](),l=c[i.idx];return"undefined"===r?l:("function"===r&&(n=n.call(this,l),r=t.type(n)),null==n&&i.empty?this:("string"===r&&(o=a.exec(n),o&&(n=l+parseFloat(o[2])*("+"===o[1]?1:-1))),c[i.idx]=n,this[h](c)))})})}),c.hook=function(e){var i=e.split(" ");d(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,r,a="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=c(o||n),!f.rgba&&1!==n._rgba[3]){for(r="backgroundColor"===i?e.parentNode:e;(""===a||"transparent"===a)&&r&&r.style;)try{a=t.css(r,"backgroundColor"),r=r.parentNode}catch(h){}n=n.blend(a&&"transparent"!==a?a:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=c(e.elem,i),e.end=c(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},c.hook(r),t.cssHooks.borderColor={expand:function(t){var e={};return d(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(a),function(){function e(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(e,i){var s,o,r={};for(s in i)o=i[s],e[s]!==o&&(n[s]||(t.fx.step[s]||!isNaN(parseFloat(o)))&&(r[s]=o));return r}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(a.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(n,o,r,a){var h=t.speed(o,r,a);return this.queue(function(){var o,r=t(this),a=r.attr("class")||"",c=h.children?r.find("*").addBack():r;c=c.map(function(){var i=t(this);return{el:i,start:e(this)}}),o=function(){t.each(s,function(t,e){n[e]&&r[e+"Class"](n[e])})},o(),c=c.map(function(){return this.end=e(this.el[0]),this.diff=i(this.start,this.end),this}),r.attr("class",a),c=c.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,c.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(r[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(e){return function(i,s,n,o,r){return"boolean"==typeof s||void 0===s?n?t.effects.animateClass.call(this,s?{add:i}:{remove:i},n,o,r):e.apply(this,arguments):t.effects.animateClass.call(this,{toggle:i},s,n,o)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function e(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function i(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.11.4",save:function(t,e){for(var i=0;e.length>i;i++)null!==e[i]&&t.data(r+e[i],t[0].style[e[i]])},restore:function(t,e){var i,s;for(s=0;e.length>s;s++)null!==e[s]&&(i=t.data(r+e[s]),void 0===i&&(i=""),t.css(e[s],i))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;try{o.id}catch(r){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).focus(),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function i(e){function i(){t.isFunction(o)&&o.call(n[0]),t.isFunction(e)&&e()}var n=t(this),o=s.complete,a=s.mode;(n.is(":hidden")?"hide"===a:"show"===a)?(n[a](),i()):r.call(n[0],s,i)}var s=e.apply(this,arguments),n=s.mode,o=s.queue,r=t.effects.effect[s.effect];return t.fx.off||!r?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):o===!1?this.each(i):this.queue(o||"fx",i)},show:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(t.fn.show),hide:function(t){return function(s){if(i(s))return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(t.fn.hide),toggle:function(t){return function(s){if(i(s)||"boolean"==typeof s)return t.apply(this,arguments);var n=e.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}(),t.effects});
!function(e){"use strict";e(document).ready(function(){/*!
         * TreeManager
         * Handles treeview
         * TODO this will be refactored in 3.2
         */
CMS.TreeManager=new CMS.Class({options:{lang:{}},initialize:function(t){this.options=e.extend(!0,{},this.options,t),this.setupFunctions(),this.setupTreePublishing(),this.setupInfoTooltip(),this.setupUIHacks(),this.options.settings.filtered?e.syncCols():(this.setupGlobals(),this.setupTree(),window.initTree())},setupFunctions:function(){var t=this;e.syncCols=function(){e("#sitemap .col-softroot").syncWidth(0),e("#sitemap .col-apphook").syncWidth(0),e("#sitemap .col-language").syncWidth(0),e("#sitemap .col-navigation").syncWidth(0),e("#sitemap .col-actions").syncWidth(0),e("#sitemap .col-info").syncWidth(0),t.refreshColumns.call(e("ul.tree-default li"))},e.fn.syncWidth=function(t){var i=!1;e(this).each(function(){if(e(this).is(":visible")){i=!0;var n=e(this).width();n>t&&(t=n)}}),i&&t>0&&e(this).each(function(){e(this).css("width",t)})},e.curry=function(t){if(arguments.length<2)return t;var i=e.makeArray(arguments).slice(1,arguments.length);return function(){return t.apply(this,i.concat(e.makeArray(arguments)))}},e.__callbackPool={},e.callbackRegister=function(t,i){return arguments.length>2&&(i=e.curry.apply(this,e.makeArray(arguments).slice(1,arguments.length))),e.__callbackPool[t]=i,t},e.callbackCall=function(t){if(!(t&&t in e.__callbackPool))throw"No callback registered with name: "+t;return e.__callbackPool[t].apply(this,e.makeArray(arguments).slice(1,arguments.length)),e.callbackRemove(t),t},e.callbackRemove=function(t){delete e.__callbackPool[t]},e.fn.yft=function(){this.effect("highlight",{},1e3)},e.fn.replace=function(e){return this.after(e).remove().end()}},setupInfoTooltip:function(){var t,i=e(".tree"),n=".col-info .info",o=".info-details",a=function(){},s=100;i.delegate(n,"pointerover touchstart",function(i){var r=e(this).closest(".col-info").find(".info-details");if(clearTimeout(a),r.is(":visible")&&!t)return!1;if(e(o).hide(),e(n).removeClass("hover"),e(".moveable").removeClass("hover"),"touchstart"===i.type){i.preventDefault();var l=e(i.target).closest(n);if(t=t&&t.is(l)?!1:l)return}a=setTimeout(function(){r.show(),e(n).addClass("hover"),r.closest(".moveable").addClass("hover")},s)}),i.delegate(n,"pointerout",function(){t||(clearTimeout(a),a=setTimeout(function(){e(o).hide(),e(".moveable").removeClass("hover")},2*s))}),i.delegate(o,"pointerover",function(){clearTimeout(a)}),i.delegate(o,"pointerout",function(){a=setTimeout(function(){e(o).hide(),e(".moveable").removeClass("hover")},2*s)}),e("html").on("touchend",function(t){e(t.target).hasClass("info")||(e(o).hide(),e(n).removeClass("hover"),e(".moveable").removeClass("hover"))})},setupTreePublishing:function(){var t,i=this,n=e(".tree"),o=".col-language .trigger-tooltip",a=".language-tooltip",s=function(){},r=100;n.delegate(o,"pointerover touchstart",function(i){var n=e(this).closest(".col-language").find(".language-tooltip");if(clearTimeout(s),n.is(":visible")&&!t)return!1;if(n.css("right",32+e(this).position().left),e(a).hide(),e(".moveable").removeClass("hover"),"touchstart"===i.type){i.preventDefault();var l=e(i.target).closest(o);if(t=t&&t.is(l)?!1:l)return}s=setTimeout(function(){n.closest(".moveable").addClass("hover"),n.show()},r)}),n.delegate(o,"pointerout",function(){t||(clearTimeout(s),s=setTimeout(function(){e(a).hide(),e(".moveable").removeClass("hover")},2*r))}),n.delegate(a,"pointerover",function(){clearTimeout(s)}),n.delegate(a,"pointerout",function(){s=setTimeout(function(){e(a).hide(),e(".moveable").removeClass("hover")},2*r)}),n.delegate(".language-tooltip a","click touchstart",function(t){return t.preventDefault(),CMS.API.Helpers.secureConfirm(i.options.lang.publish.replace("",e(this).text().toLowerCase()))?void e.ajax({type:"post",url:e(this).prop("href"),success:function(){window.self!==window.top?CMS.API.Helpers.reloadBrowser(!1,!1,!0):CMS.API.Helpers.reloadBrowser()},error:function(e){throw new Error(e)}}):!1}),e("html").on("touchend",function(t){e(t.target).hasClass("unpublished")&&e(t.target).hasClass("published")&&e(t.target).hasClass("dirty")||(e(a).hide(),e(".moveable").removeClass("hover"))})},setupUIHacks:function(){if(e("#changelist-filter-button").bind("click",function(){e("#changelist-filter").toggle()}),window.parent&&window.parent.CMS&&window.parent.CMS.config){var t=window.parent.CMS.config.request.page_id;e('div[data-page_id="'+t+'"]').addClass("cont-active")}},setupGlobals:function(){var t=this,i="",n=null;window.moveSuccess=function(o){e.syncCols(),i=e('<span class="success">'+t.options.lang.success+"</span>"),n=window.parent,o.after(i),o.parent().find(".col2").hide(),i.fadeOut(1e3,function(){o.parent().find(".col2").show()}),window.self!==window.top&&(window.parent.CMS.API.Helpers.reloadBrowser(!1,!1,!0),window.parent.CMS.API.Messages.open({message:t.options.lang.changes,delay:0}))},window.moveError=function(n,o){i=e(o&&"error"!==o?'<span class="success">'+o+"</span>":'<span class="success">'+t.options.lang.error+"</span>"),n.parent().find(".col2").hide(),n.after(i)}},setupTree:function(){function t(t,i,n,o){void 0===i&&(i={}),e.post(t,i,function(t){""===t&&n&&n(),e("#dialogs").empty().append(t),o&&o(t)})}function i(t){return e("a.move-target, span.move-target-container, span.line").show(),e("#page_"+t).addClass("selected"),e("#page_"+t).parent().parent().children("div.cont").find("a.move-target.first-child, span.second").hide(),e("#page_"+t).parent().parent().children("ul").children("li").children("div.cont").find("a.move-target.left, a.move-target.right, span.first, span.second").hide(),"copy"}function n(){e.syncCols()}function o(i,n,o,s){return d.options.settings.permission?t("./"+i+"/dialog/copy/",{position:o,target:n,site:s,callback:e.callbackRegister("_copyTreeItem",a,i,n,o,s)}):a(i,n,o,s)}function a(t,i,n,o,a){var s={position:n,target:i,site:o};s=e.extend(s,a),e.post("./"+t+"/copy-page/",s,function(i){var n=i.content,o=i.status;200===o?window.location=window.location.href:(alert(n),window.moveError(e("#page_"+t+" div.col1:eq(0)"),n))})}function s(t,i,n,o,a){function s(i,n){var a=!0,s=null;if(o&&(a=o(i,n)),a){s=/page_\d+/.test(e(t).attr("id"))?e(t).find("div.cont:first"):e(t).parents("div.cont:first");var r=s.parent();if("NotFound"===i)return r.remove();var l=e(".messagelist");s.replace(i);var c=e(r).find(".messagelist");c.length&&(l.remove(),c.insertAfter(".breadcrumbs")),r.find("div.cont:first").yft(),e(window).trigger("resize")}}void 0===n&&(n={}),/\/\?/gi.test(window.location.href)&&(n.fitlered=1),e.ajax({type:"POST",data:n,url:i,success:s,error:function(e,t,i){a&&a(e,t,i)},xhr:window.ActiveXObject?function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}:function(){return new window.XMLHttpRequest}})}function r(t,i,n,o,a){s(t,"./"+i+"/move-page/",{position:o,target:n},function(t){var s=t.content,r=t.status;if(200===r){if(a){var l={left:"before",right:"after"}[o]||"inside";a.moved("#page_"+i,e("#page_"+n+" a.title")[0],l,!1,!1)}else window.moveSuccess(e("#page_"+i+" div.col1:eq(0)"));return!1}return window.moveError(e("#page_"+i+" div.col1:eq(0)"),s),!1})}function l(e,t,i){f.push({node:e,target:t,position:i})}var c,d=this,p=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");d.options.settings.staticPath.match(/^(https?:)?\/\//i)&&(p=""),window.initTree=function(){c=new tree_component;var t={rules:{clickable:"all",renameable:"none",deletable:"all",creatable:"all",draggable:"all",dragrules:"all",droppable:"all",metadata:"mdata",use_inline:!0},path:p+d.options.settings.staticPath+"cms/js/jstree/",ui:{dots:!0,rtl:!1,animation:0,hover_mode:!0,a_class:"title",context:!1},cookies:{prefix:"djangocms_nodes"},callback:{beforemove:function(t,i,n){return window.item_id=t.id.split("page_")[1],window.target_id=i.id.split("page_")[1],window.old_node=t,e(t).parent().children("li").length>1?(e(t).next("li").length&&(window.old_target=e(t).next("li")[0],window.old_position="right"),e(t).prev("li").length&&(window.old_target=e(t).prev("li")[0],window.old_position="left")):"topnode"!==e(t).attr("rel")&&(window.old_target=e(t).parent().parent()[0],window.old_position="inside"),l(t,i,n),!0},onmove:function(e,t,i){window.item_id=e.id.split("page_")[1],window.target_id=t.id.split("page_")[1],"before"===i?i="left":"after"===i?i="right":"inside"===i&&(i="last-child"),r(e,window.item_id,window.target_id,i,!1)},onload:function(){setTimeout(function(){n()},250)}}};e(e("div.tree").get(0)).hasClass("root_allow_children")||(t.rules.dragrules=["node inside topnode","topnode inside topnode","node * node"]),c.init(e("div.tree"),t)},window.selected_page=!1,w=!1;var u=e.ajax;e.ajax=function(t){e("#loader-message").show();var i=t.success||!1;return t.success=function(t,n){i&&i(t,n),e("#loader-message").hide()},u(t)},e("#changelist li").on("click",function(t){"IMG"===t.target.tagName||"SPAN"===t.target.tagName?window.target=t.target.parentNode:window.target=t.target;var a,l,d=e(window.target);if(d.hasClass("move"))return a=t.target.id.split("move-link-")[1],a||(a=t.target.parentNode.id.split("move-link-")[1]),l=a,window.selected_page=l,w="move",e("span.move-target-container, span.line, a.move-target").show(),e("#page_"+l).addClass("selected"),e("#page_"+l+" span.move-target-container").hide(),t.stopPropagation(),!1;if(d.hasClass("copy"))return a=t.target.id.split("copy-link-")[1],a||(a=t.target.parentNode.id.split("copy-link-")[1]),window.selected_page=a,w=i(a),t.stopPropagation(),!1;if(d.hasClass("viewpage")){var p=e("#"+window.target.id+"-select").val();p&&window.open(p)}if(d.hasClass("addlink"))return/#$/g.test(d.attr("href"))?(e("tr").removeClass("target"),e("#changelist table").removeClass("table-selected"),l=window.target.id.split("add-link-")[1],window.selected_page=l,w="add",e("tr").removeClass("selected"),e("#page-row-"+l).addClass("selected"),e(".move-target-container").hide(),e("a.move-target, span.line, #move-target-"+l).show(),t.stopPropagation(),!1):!0;window.admin_base_url=document.URL.split("/cms/page/")[0]+"/";var u,h;return d.hasClass("navigation-checkbox")&&(t.stopPropagation(),u=d.attr("name").split("navigation-")[1],h=d.closest(".cont").find("a[lang]").attr("lang")||"",s(d,window.admin_base_url+"cms/page/"+u+"/change-navigation/?language="+h,{1:1})),d.hasClass("closed")&&(0!==d.find("ul > li").length||d.hasClass("loading")?n():(d.addClass("loading"),u=e(d).attr("id").split("page_")[1],h=e(d).children("div.cont").children("div.col1").children(".title").attr("lang"),e.get(window.admin_base_url+"cms/page/"+u+"/"+h+"/descendants/",{},function(t){d.children("ul").append(t),e("span.move-target-container:visible").length>0&&d.children("ul").find("a.move-target, span.move-target-container, span.line").show(),n()}))),d.hasClass("move-target")?(d.hasClass("left")&&(window.position="left"),d.hasClass("right")&&(window.position="right"),d.hasClass("last-child")&&(window.position="last-child"),window.target_id=window.target.parentNode.id.split("move-target-")[1],"move"===w?(r(null,window.selected_page,window.target_id,window.position,c),e(".move-target-container").hide()):"copy"===w?(window.site=e("#site-select")[0].value,o(window.selected_page,window.target_id,window.position,window.site),e(".move-target-container").hide()):"add"===w&&(window.site=e("#site-select")[0].value,window.location.href=window.location.href.split("?")[0].split("#")[0]+"add/?target="+window.target_id+"&amp;position="+window.position+"&amp;site="+window.site),t.stopPropagation(),!1):!0}),e("div#sitemap").show(),e(window).bind("resize",n),e("#site-select").change(function(){var t=e(this).closest("form");"copy"===w&&e("#site-copy").val(window.selected_page),t.submit()}),e(document).on("keydown keyup",function(t){18===t.which&&e("a[data-alt-class]").each(function(){var i=e(this);i.toggleClass(i.data("alt-class"),"keydown"===t.type)})}),e("a[data-alt-href]").on("click",function(t){var i;t.preventDefault(),i=t.shiftKey?e(this).data("alt-href"):e(this).attr("href"),window.location=i});var h=window.location.href.split("copy=");if(h.length>1){var g=h[1].split("&")[0],w=i(g);window.selected_page=g}var f=[]},refreshColumns:function(){e("div.col2").children("div").each(function(t,i){e(i).css("display","block")});var t=1e5,i=0,n=null;e(this).each(function(){var o=e(this).children("div.cont");if(o.is(":visible")){var a=o.children("div.col1").find(".title span"),s=o.children("div.col2"),r=a.outerWidth(!0),l=s.outerWidth(!0),c=o.outerWidth(!0),d=c-r;t>d&&(t=d),l>i&&(i=l,n=s)}});var o=50,a=0,s=0,r=!1;n&&(n.children("div").each(function(){r||(a+=e(this).outerWidth(!0)),(r||a>t-o)&&(s+=1,r=!0)}),s&&(e(this).each(function(){e(this).children("div.cont").children("div.col2").children("div").slice(-s).each(function(){e(this).css("display","none")})}),e("div#sitemap ul.header div.col2").children().slice(-s).each(function(){e(this).css("display","none")})))}})})}(CMS.$);
function get_css(e,t,r){if(!document.styleSheets)return!1;e=e.toLowerCase(),t=t||0;for(var s=t;s<document.styleSheets.length;s++){document.styleSheets[s];if(css_rules=document.styleSheets[s].cssRules||document.styleSheets[s].rules,css_rules){var a=0;do if(css_rules[a].selectorText.toLowerCase()==e)return 1==r?(document.styleSheets[s].removeRule&&document.styleSheets[s].removeRule(a),document.styleSheets[s].deleteRule&&document.styleSheets[s].deleteRule(a),!0):css_rules[a];while(css_rules[++a])}}return!1}function add_css(e,t){return e=e.toLowerCase(),t=t||0,!document.styleSheets||get_css(e,t)?!1:(document.styleSheets[t].addRule?document.styleSheets[t].addRule(e,null,0):document.styleSheets[t].insertRule(e+" { }",0),get_css(e))}function get_sheet_num(e){if(!document.styleSheets)return!1;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].href&&document.styleSheets[t].href.toString().match(e))return t;return!1}function remove_css(e,t){return get_css(e,t,!0)}function add_sheet(e){if(document.createStyleSheet)document.createStyleSheet(e);else{var t="@import url(' "+e+" ');",r=document.createElement("link");r.rel="stylesheet",r.href="data:text/css,"+escape(t),document.getElementsByTagName("head")[0].appendChild(r)}}function Sarissa(){}if(function(e){function t(r,s){e.extend(this,{ids:{},tags:{},listener:s,event:r}),this.id=t.instances.push(this)}function r(e,t,r){for(var s=0,a=e.length;a>s;s++)t.call(r,e[s],s)}function s(e,t){return e.push.apply(e,t),e}var a="indexer",n=e.event,o=n.special,i=e.listen=function(e,s,a,n){"object"!=typeof s&&(n=a,a=s,s=document),r(e.split(/\s+/),function(e){e=i.fixes[e]||e;var r=l(s,e)||l(s,e,new t(e,s));r.append(a,n),r.start()})},l=function(t,r,s){return e.data(t,r+"."+a,s)};e.fn[a]=function(e){return this[0]&&l(this[0],e)||null},e[a]=function(e){return l(document,e)},e.extend(i,{regex:/^((?:\w*?|\*))(?:([#.])([\w-]+))?$/,fixes:{focus:"focusin",blur:"focusout"},cache:function(e){this.caching=e}}),e.each(i.fixes,function(t,r){o[r]={setup:function(){return e.browser.msie?!1:void this.addEventListener(t,o[r].handler,!0)},teardown:function(){return e.browser.msie?!1:void this.removeEventListener(t,o[r].handler,!0)},handler:function(e){return arguments[0]=e=n.fix(e),e.type=r,n.handle.apply(this,arguments)}}}),e.fn.listen=function(e,t,r){return this.each(function(){i(e,this,t,r)})},t.instances=[],t.prototype={constructor:t,handle:function(e){var t=e.stopPropagation;e.stopPropagation=function(){e.stopped=1,t.apply(this,arguments)},l(this,e.type).parse(e),e.stopPropagation=t,t=e.data=null},on:0,bubbles:0,start:function(){var e=this;e.on||(n.add(e.listener,e.event,e.handle),e.on=1)},stop:function(){var e=this;e.on&&(n.remove(e.listener,e.event,e.handle),e.on=0)},cache:function(t,r){return e.data(t,"listenCache_"+this.id,r)},parse:function(e){var t,a=this,n=e.data||e.target,o=arguments;i.caching&&(t=a.cache(n))||(t=[],n.id&&a.ids[n.id]&&s(t,a.ids[n.id]),r([n.nodeName,"*"],function(e){var o=a.tags[e];o&&r((n.className+" *").split(" "),function(e){e&&o[e]&&s(t,o[e])})}),i.caching&&a.cache(n,t)),t[0]&&r(t,function(t){t.apply(n,o)===!1&&(e.preventDefault(),e.stopPropagation())}),!e.stopped&&(n=n.parentNode)&&("A"==n.nodeName||a.bubbles&&n!=a.listener)&&(e.data=n,a.parse(e)),t=o=n=null},append:function(e,t){var s=this;r(e.split(/\s*,\s*/),function(e){var r=i.regex.exec(e);if(!r)throw'$.listen > "'+e+'" is not a supported selector.';var a="#"==r[2]&&r[3],n=r[1].toUpperCase()||"*",o=r[3]||"*";a?(s.ids[a]||(s.ids[a]=[])).push(t):n&&(n=s.tags[n]=s.tags[n]||{},(n[o]||(n[o]=[])).push(t))})}},e(window).unload(function(){"function"==typeof t&&r(t.instances,function(t){t.stop(),e.removeData(t.listener,t.event+"."+a),t.ids=t.names=t.listener=null})})}(jQuery),Sarissa.VERSION="0.9.9.4",Sarissa.PARSED_OK="Document contains no parsing errors",Sarissa.PARSED_EMPTY="Document is empty",Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error",Sarissa.IS_ENABLED_TRANSFORM_NODE=!1,Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG",Sarissa._lastUniqueSuffix=0,Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++},Sarissa._SARISSA_IEPREFIX4XSLPARAM="",Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&!0,Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument,Sarissa._SARISSA_HAS_DOM_FEATURE=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature,Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE,Sarissa._SARISSA_IS_SAFARI=-1!=navigator.userAgent.toLowerCase().indexOf("safari")||-1!=navigator.userAgent.toLowerCase().indexOf("konqueror"),Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420,Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&-1==navigator.userAgent.toLowerCase().indexOf("opera"),Sarissa._SARISSA_IS_OPERA=-1!=navigator.userAgent.toLowerCase().indexOf("opera"),window.Node&&Node.ELEMENT_NODE||(Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor,Node=HTMLElement={},HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__,HTMLDocument=Document=document.constructor;var x=new DOMParser;XMLDocument=x.constructor,Element=x.parseFromString("<Single />","text/xml").documentElement.constructor,x=null}if("undefined"==typeof XMLDocument&&"undefined"!=typeof Document&&(XMLDocument=Document),Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="",_SARISSA_XMLHTTP_PROGID="",_SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(e){for(var t,r,s=!1,a=0;a<e.length&&!s;a++)try{new ActiveXObject(e[a]);r=e[a],s=!0}catch(n){t=n}if(!s)throw"Could not retrieve a valid progID of Class: "+e[e.length-1]+". (original exception: "+t+")";return e=null,r},_SARISSA_DOM_PROGID=null,_SARISSA_THREADEDDOM_PROGID=null,_SARISSA_XSLTEMPLATE_PROGID=null,_SARISSA_XMLHTTP_PROGID=null,XMLHttpRequest=function(){return _SARISSA_XMLHTTP_PROGID||(_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"])),new ActiveXObject(_SARISSA_XMLHTTP_PROGID)},Sarissa.getDomDocument=function(e,t){_SARISSA_DOM_PROGID||(_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]));var r=new ActiveXObject(_SARISSA_DOM_PROGID);if(t){var s="";e&&(t.indexOf(":")>1?(s=t.substring(0,t.indexOf(":")),t=t.substring(t.indexOf(":")+1)):s="a"+Sarissa._getUniqueSuffix()),e?r.loadXML("<"+s+":"+t+" xmlns:"+s+'="'+e+'" />'):r.loadXML("<"+t+" />")}return r},Sarissa.getParseErrorText=function(e){var t=Sarissa.PARSED_OK;if(e&&e.parseError&&e.parseError.errorCode&&0!=e.parseError.errorCode){t="XML Parsing Error: "+e.parseError.reason+"\nLocation: "+e.parseError.url+"\nLine Number "+e.parseError.line+", Column "+e.parseError.linepos+":\n"+e.parseError.srcText+"\n";for(var r=0;r<e.parseError.linepos;r++)t+="-";t+="^\n"}else null===e.documentElement&&(t=Sarissa.PARSED_EMPTY);return t},Sarissa.setXpathNamespaces=function(e,t){e.setProperty("SelectionLanguage","XPath"),e.setProperty("SelectionNamespaces",t)},XSLTProcessor=function(){_SARISSA_XSLTEMPLATE_PROGID||(_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"])),this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID),this.processor=null},XSLTProcessor.prototype.importStylesheet=function(e){_SARISSA_THREADEDDOM_PROGID||(_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"])),e.setProperty("SelectionLanguage","XPath"),e.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var t=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{t.resolveExternals=!0,t.setProperty("AllowDocumentFunction",!0)}catch(r){}e.url&&null!=e.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")?(t.async=!1,t.load(e.url)):t.loadXML(e.xml),t.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var s=t.selectSingleNode("//xsl:output");s?this.outputMethod=s.getAttribute("method"):delete this.outputMethod,this.template.stylesheet=t,this.processor=this.template.createProcessor(),this.paramsSet=[]},XSLTProcessor.prototype.transformToDocument=function(e){var t;if(_SARISSA_THREADEDDOM_PROGID)return this.processor.input=e,t=new ActiveXObject(_SARISSA_DOM_PROGID),this.processor.output=t,this.processor.transform(),t;_SARISSA_DOM_XMLWRITER||(_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"])),this.processor.input=e,t=new ActiveXObject(_SARISSA_DOM_XMLWRITER),this.processor.output=t,this.processor.transform();var r=new ActiveXObject(_SARISSA_DOM_PROGID);return r.loadXML(t.output+""),r},XSLTProcessor.prototype.transformToFragment=function(e,t){this.processor.input=e,this.processor.transform();var r,s=this.processor.output,a=t.createDocumentFragment();if("text"==this.outputMethod)a.appendChild(t.createTextNode(s));else if(t.body&&t.body.innerHTML)for(r=t.createElement("div"),r.innerHTML=s;r.hasChildNodes();)a.appendChild(r.firstChild);else{var n=new ActiveXObject(_SARISSA_DOM_PROGID);"<?xml"==s.substring(0,5)&&(s=s.substring(s.indexOf("?>")+2));var o="".concat("<my>",s,"</my>");for(n.loadXML(o),r=n.documentElement;r.hasChildNodes();)a.appendChild(r.firstChild)}return a},XSLTProcessor.prototype.setParameter=function(e,t,r){r=r?r:"",e?this.processor.addParameter(t,r,e):this.processor.addParameter(t,r),e=""+(e||""),this.paramsSet[e]||(this.paramsSet[e]=[]),this.paramsSet[e][t]=r},XSLTProcessor.prototype.getParameter=function(e,t){return e=""+(e||""),this.paramsSet[e]&&this.paramsSet[e][t]?this.paramsSet[e][t]:null},XSLTProcessor.prototype.clearParameters=function(){for(var e in this.paramsSet)for(var t in this.paramsSet[e])""!=e?this.processor.addParameter(t,"",e):this.processor.addParameter(t,"");this.paramsSet=[]}}else Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&(Sarissa.__handleLoad__=function(e){Sarissa.__setReadyState__(e,4)},_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this)},Sarissa.__setReadyState__=function(e,t){e.readyState=t,e.readystate=t,null!=e.onreadystatechange&&"function"==typeof e.onreadystatechange&&e.onreadystatechange()},Sarissa.getDomDocument=function(e,t){var r=document.implementation.createDocument(e?e:null,t?t:null,null);return r.onreadystatechange||(r.onreadystatechange=null),r.readyState||(r.readyState=0),r.addEventListener("load",_sarissa_XMLDocument_onload,!1),r},window.XMLDocument||(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature("LS","3.0")?Sarissa.getDomDocument=function(e,t){var r=document.implementation.createDocument(e?e:null,t?t:null,null);return r}:Sarissa.getDomDocument=function(e,t){var r=document.implementation.createDocument(e?e:null,t?t:null,null);return r&&(e||t)&&!r.documentElement&&r.appendChild(r.createElementNS(e,t)),r}));if(window.DOMParser||(Sarissa._SARISSA_IS_SAFARI?(DOMParser=function(){},DOMParser.prototype.parseFromString=function(e,t){var r=new XMLHttpRequest;return r.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),r.send(null),r.responseXML}):Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(e,t){var r=Sarissa.getDomDocument();return r.loadXML(e),r})),"undefined"==typeof document.importNode&&Sarissa._SARISSA_IS_IE)try{document.importNode=function(e,t){var r;return"#text"==e.nodeName?document.createTextNode(e.data):(r="tbody"==e.nodeName||"tr"==e.nodeName?document.createElement("table"):"td"==e.nodeName?document.createElement("tr"):"option"==e.nodeName?document.createElement("select"):document.createElement("div"),t?r.innerHTML=e.xml?e.xml:e.outerHTML:r.innerHTML=e.xml?e.cloneNode(!1).xml:e.cloneNode(!1).outerHTML,r.getElementsByTagName("*")[0])}}catch(e){}Sarissa.getParseErrorText||(Sarissa.getParseErrorText=function(e){var t=Sarissa.PARSED_OK;if(e&&e.documentElement)if("parsererror"==e.documentElement.tagName)t=e.documentElement.firstChild.data,t+="\n"+e.documentElement.firstChild.nextSibling.firstChild.data;else if(e.getElementsByTagName("parsererror").length>0){var r=e.getElementsByTagName("parsererror")[0];t=Sarissa.getText(r,!0)+"\n"}else e.parseError&&0!=e.parseError.errorCode&&(t=Sarissa.PARSED_UNKNOWN_ERROR);else t=Sarissa.PARSED_EMPTY;return t}),Sarissa.getText=function(e,t){for(var r="",s=e.childNodes,a=0;a<s.length;a++){var n=s[a],o=n.nodeType;o==Node.TEXT_NODE||o==Node.CDATA_SECTION_NODE?r+=n.data:t!==!0||o!=Node.ELEMENT_NODE&&o!=Node.DOCUMENT_NODE&&o!=Node.DOCUMENT_FRAGMENT_NODE||(r+=Sarissa.getText(n,!0))}return r},!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml&&(XMLSerializer=function(){},XMLSerializer.prototype.serializeToString=function(e){return e.xml}),Sarissa.stripTags=function(e){return e?e.replace(/<[^>]+>/g,""):e},Sarissa.clearChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},Sarissa.copyChildNodes=function(e,t,r){if(Sarissa._SARISSA_IS_SAFARI&&t.nodeType==Node.DOCUMENT_NODE&&(t=t.documentElement),!e||!t)throw"Both source and destination nodes must be provided";r||Sarissa.clearChildNodes(t);var s,a=t.nodeType==Node.DOCUMENT_NODE?t:t.ownerDocument,n=e.childNodes;if("undefined"!=typeof a.importNode)for(s=0;s<n.length;s++)t.appendChild(a.importNode(n[s],!0));else for(s=0;s<n.length;s++)t.appendChild(n[s].cloneNode(!0))},Sarissa.moveChildNodes=function(e,t,r){if(!e||!t)throw"Both source and destination nodes must be provided";r||Sarissa.clearChildNodes(t);var s=e.childNodes;if(e.ownerDocument==t.ownerDocument)for(;e.firstChild;)t.appendChild(e.firstChild);else{var a,n=t.nodeType==Node.DOCUMENT_NODE?t:t.ownerDocument;if("undefined"!=typeof n.importNode)for(a=0;a<s.length;a++)t.appendChild(n.importNode(s[a],!0));else for(a=0;a<s.length;a++)t.appendChild(s[a].cloneNode(!0));Sarissa.clearChildNodes(e)}},Sarissa.xmlize=function(e,t,r){r=r?r:"";var s=r+"<"+t+">",a=!1;if(!(e instanceof Object)||e instanceof Number||e instanceof String||e instanceof Boolean||e instanceof Date)s+=Sarissa.escape(""+e),a=!0;else{s+="\n";var n=e instanceof Array;for(var o in e)s+=Sarissa.xmlize(e[o],n?'array-item key="'+o+'"':o,r+"   ");s+=r}return s+=-1!=t.indexOf(" ")?"</array-item>\n":"</"+t+">\n"},Sarissa.escape=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},Sarissa.unescape=function(e){return e.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},Sarissa.updateCursor=function(e,t){e&&e.style&&void 0!=e.style.cursor&&(e.style.cursor=t)},Sarissa.updateContentFromURI=function(e,t,r,s,a){try{Sarissa.updateCursor(t,"wait");var n=new XMLHttpRequest;if(n.open("GET",e,!0),n.onreadystatechange=function(){if(4==n.readyState)try{var a=n.responseXML;if(!a||Sarissa.getParseErrorText(a)!=Sarissa.PARSED_OK)throw Sarissa.getParseErrorText(a);Sarissa.updateContentFromNode(n.responseXML,t,r),s&&s(e,t)}catch(o){if(!s)throw o;s(e,t,o)}},a){var o="Sat, 1 Jan 2000 00:00:00 GMT";n.setRequestHeader("If-Modified-Since",o)}n.send("")}catch(i){if(Sarissa.updateCursor(t,"auto"),!s)throw i;s(e,t,i)}},Sarissa.updateContentFromNode=function(e,t,r){try{Sarissa.updateCursor(t,"wait"),Sarissa.clearChildNodes(t);var s=e.nodeType==Node.DOCUMENT_NODE?e:e.ownerDocument;if(s.parseError&&0!=s.parseError.errorCode){var a=document.createElement("pre");a.appendChild(document.createTextNode(Sarissa.getParseErrorText(s))),t.appendChild(a)}else if(r&&(e=r.transformToDocument(e)),"textarea"==t.tagName.toLowerCase()||"input"==t.tagName.toLowerCase())t.value=(new XMLSerializer).serializeToString(e);else try{t.appendChild(t.ownerDocument.importNode(e,!0))}catch(n){t.innerHTML=(new XMLSerializer).serializeToString(e)}}catch(n){throw n}finally{Sarissa.updateCursor(t,"auto")}},Sarissa.formToQueryString=function(e){for(var t="",r=0;r<e.elements.length;r++){var s=e.elements[r],a=s.getAttribute("name")?s.getAttribute("name"):s.getAttribute("id");if(a&&(!s.disabled||"hidden"==s.type))switch(s.type){case"hidden":case"text":case"textarea":case"password":t+=a+"="+encodeURIComponent(s.value)+"&";break;case"select-one":t+=a+"="+encodeURIComponent(s.options[s.selectedIndex].value)+"&";break;case"select-multiple":for(var n=0;n<s.length;n++){var o=s.options[n];o.selected===!0&&(t+=a+"[]="+encodeURIComponent(o.value)+"&")}break;case"checkbox":case"radio":s.checked&&(t+=a+"="+encodeURIComponent(s.value)+"&")}}return t.substr(0,t.length-1)},Sarissa.updateContentFromForm=function(e,t,r,s){try{Sarissa.updateCursor(t,"wait");var a=Sarissa.formToQueryString(e)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true",n=new XMLHttpRequest,o=e.getAttribute("method")&&"get"==e.getAttribute("method").toLowerCase();o?n.open("GET",e.getAttribute("action")+"?"+a,!0):(n.open("POST",e.getAttribute("action"),!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("Content-length",a.length),n.setRequestHeader("Connection","close")),n.onreadystatechange=function(){try{if(4==n.readyState){var a=n.responseXML;if(!a||Sarissa.getParseErrorText(a)!=Sarissa.PARSED_OK)throw Sarissa.getParseErrorText(a);Sarissa.updateContentFromNode(n.responseXML,t,r),s&&s(e,t)}}catch(o){if(!s)throw o;s(e,t,o)}},n.send(o?"":a)}catch(i){if(Sarissa.updateCursor(t,"auto"),!s)throw i;s(e,t,i)}return!1},Sarissa.FUNCTION_NAME_REGEXP=new RegExp(""),Sarissa.getFunctionName=function(e,t){var r;return r||(t?(r="SarissaAnonymous"+Sarissa._getUniqueSuffix(),window[r]=e):r=null),r&&(window[r]=e),r},Sarissa.setRemoteJsonCallback=function(e,t,r){r||(r="callback");var s=Sarissa.getFunctionName(t,!0),a="sarissa_json_script_id_"+Sarissa._getUniqueSuffix(),n=document.getElementsByTagName("head")[0],o=document.createElement("script");return o.type="text/javascript",o.id=a,o.onload=function(){},e+=-1!=e.indexOf("?")?"&"+r+"="+s:"?"+r+"="+s,o.src=e,n.appendChild(o),a},Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")&&(SarissaNodeList=function(e){this.length=e},SarissaNodeList.prototype=[],SarissaNodeList.prototype.constructor=Array,SarissaNodeList.prototype.item=function(e){return 0>e||e>=this.length?null:this[e]},SarissaNodeList.prototype.expr="",window.XMLDocument&&!XMLDocument.prototype.setProperty&&(XMLDocument.prototype.setProperty=function(e,t){}),Sarissa.setXpathNamespaces=function(e,t){e._sarissa_useCustomResolver=!0;var r=t.indexOf(" ")>-1?t.split(" "):[t];e._sarissa_xpathNamespaces=[];for(var s=0;s<r.length;s++){var a=r[s],n=a.indexOf(":"),o=a.indexOf("=");if(!(n>0&&o>n+1))throw"Bad format on namespace declaration(s) given";var i=a.substring(n+1,o),l=a.substring(o+2,a.length-1);e._sarissa_xpathNamespaces[i]=l}},XMLDocument.prototype._sarissa_useCustomResolver=!1,XMLDocument.prototype._sarissa_xpathNamespaces=[],XMLDocument.prototype.selectNodes=function(e,t,r){var s,a=this;s=this._sarissa_useCustomResolver?function(e){var t=a._sarissa_xpathNamespaces[e];if(t)return t;throw"No namespace URI found for prefix: '"+e+"'"}:this.createNSResolver(this.documentElement);var n=null;if(r)n=this.evaluate(e,t?t:this,s,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;else{var o=this.evaluate(e,t?t:this,s,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),i=new SarissaNodeList(o.snapshotLength);i.expr=e;for(var l=0;l<i.length;l++)i[l]=o.snapshotItem(l);n=i}return n},Element.prototype.selectNodes=function(e){var t=this.ownerDocument;if(t.selectNodes)return t.selectNodes(e,this);throw"Method selectNodes is only supported by XML Elements"},XMLDocument.prototype.selectSingleNode=function(e,t){var r=t?t:null;return this.selectNodes(e,r,!0)},Element.prototype.selectSingleNode=function(e){var t=this.ownerDocument;if(t.selectSingleNode)return t.selectSingleNode(e,this);throw"Method selectNodes is only supported by XML Elements"},Sarissa.IS_ENABLED_SELECT_NODES=!0);var xslTransform={version:20071203,debug:!1,init:function(){try{parseFloat(jQuery.fn.jquery)>=1}catch(e){alert("xslTransform requires jQuery 1.0.4 or greater ... please load it prior to xslTransform")}try{}catch(e){alert("Missing Sarissa ... please load it prior to xslTransform")}jQuery.log||(jQuery.log=function(){},jQuery.fn.debug=function(){}),this.debug&&jQuery.log("xslTransform:init(): version "+xslTransform.version)},XMLSerializer:new XMLSerializer,serialize:function(e){return this.debug&&jQuery.log("serialize(): received "+typeof e),"string"==typeof e?e:this.XMLSerializer.serializeToString(e)},load:function(e,t){this.debug&&jQuery.log("load(): received "+typeof e);var r;return"object"==typeof e?e:(r="<"==e.substring(0,1)?this.loadString(e):this.loadFile(e,t),r?(r.setProperty("SelectionNamespaces",'xmlns:xsl="http://www.w3.org/1999/XSL/Transform"'),r.setProperty("SelectionLanguage","XPath"),r):(this.debug&&$.log("Unable to load "+e),!1))},loadString:function(e){this.debug&&jQuery.log("loadString(): "+e+"::"+typeof e);var t=new DOMParser,r=t.parseFromString(e,"text/xml");return r?r:(this.debug&&jQuery.log("loadString(): parseFromString() failed"),!1)},loadFile:function(e,t){if(this.debug&&jQuery.log("loadFile(): "+e+"::"+typeof e),!e)return this.debug&&jQuery.log("ERROR: loadFile() missing url"),!1;var r;return this.xhrsuccess=function(e,t){return this.debug&&jQuery.log("loadFile() completed successfully ("+t+")"),r=e,!0},this.xhrerror=function(e,t){return window.DEBUG=!0,this.debug&&jQuery.log("loadFile() failed to load the requested file: ("+t+") - xml: "+e.responseXML+" - text: "+e.responseText),r=null,!1},t||(t="GET"),$.ajax({type:t,url:e,async:!1,success:this.xhrsuccess,error:this.xhrerror}),r?0==r.length?(this.debug&&jQuery.log("ERROR: document "+e+" loaded in loadFile() has no data"),!1):r:(this.debug&&jQuery.log("ERROR: document "+e+" not found (404), or unable to load"),!1)},transform:function(e,t,r){this.debug&&jQuery.log("transform(): "+e+"::"+t+"::"+r.toString()),r=r||{};var t={request:t,doc:this.load(t,r.meth)};r.xpath&&t.doc&&!jQuery.browser.msie&&(t.doc=t.doc.selectSingleNode(r.xpath.toString()),this.debug&&$.log("transform(): xpath has been run...resulting doc: "+this.serialize(t.doc)));var s={xsl:this.load(e,r.meth)};s.json=!1,r.json&&t.doc&&(s.json=t.doc.selectSingleNode(r.json.toString()));var a=new XSLTProcessor;if(a.importStylesheet(s.xsl),r.params&&a){this.debug&&jQuery.log("transform(): received xsl params: "+r.params.toString());for(key in r.params)a.setParameter(null,key.toString(),r.params[key].toString())}s.doc=a.transformToDocument(t.doc);var n=Sarissa.getParseErrorText(s.doc);return this.debug&&jQuery.log("transform(): Sarissa parse text: "+n),n!=Sarissa.PARSED_OK?(s.string=Sarissa.getParseErrorText(s.doc)+" :: using "+e+" => "+t.request,this.debug&&jQuery.log("transform(): error in transformation: "+Sarissa.getParseErrorText(s.doc)),s):(s.string=this.serialize(s.doc),s.scripts=jQuery("script",s.doc).text(),s)}};xslTransform.init(),jQuery.fn.getTransform=function(xsl,xml,options){var settings={append:!1,params:{},xpath:"",eval:!0,callback:"",json:!1,meth:"GET"};return jQuery.extend(settings,options),xslTransform.debug&&jQuery.log("getTransform: "+xsl+"::"+xml+"::"+settings.toString()),xsl&&xml?this.each(function(){var trans=xslTransform.transform(xsl,xml,settings),re=trans.string.match(/<\?xml.*?\?>/);re&&(trans.string=trans.string.replace(re,""),xslTransform.debug&&jQuery.log("getTransform(): found an xml declaration and removed it"));try{settings.append?$(this).append(trans.string):settings.repl?$(this).replaceWith(trans.string):$(this).html(trans.string)}catch(e){xslTransform.debug&&$.log("getTransform: error placing results of transform into element, falling back to innerHTML: "+e.toString()),$(this)[0].innerHTML=trans.string}if(settings.eval&&trans.scripts&&trans.scripts.length>0&&(xslTransform.debug&&jQuery.log("Found text/javascript in transformed result"),eval.call(window,trans.scripts)),settings.callback&&jQuery.isFunction(settings.callback)){var json=!1;settings.json&&trans.json&&eval("json = "+trans.json.firstChild.data),settings.callback.apply(window,[trans.string,json])}}):void(xslTransform.debug&&jQuery.log("getTransform: missing xsl or xml"))},function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(e,t){this.defaults.type=e,this.defaults.name=t},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);settings.single.length||(settings.single="metadata");var data=$.data(elem,settings.single);if(data)return data;if(data="{}","class"==settings.type){var m=settings.cre.exec(elem.className);m&&(data=m[1])}else if("elem"==settings.type){if(!elem.getElementsByTagName)return;var e=elem.getElementsByTagName(settings.name);e.length&&(data=$.trim(e[0].innerHTML))}else if(void 0!=elem.getAttribute){var attr=elem.getAttribute(settings.name);attr&&(data=attr)}return data.indexOf("{")<0&&(data="{"+data+"}"),data=eval("("+data+")"),$.data(elem,settings.single,data),data}}}),$.fn.metadata=function(e){return $.metadata.get(this[0],e)}}(jQuery),jQuery.cookie=function(e,t,r){if("undefined"==typeof t){var s=null;if(document.cookie&&""!=document.cookie)for(var a=document.cookie.split(";"),n=0;n<a.length;n++){var o=jQuery.trim(a[n]);if(o.substring(0,e.length+1)==e+"="){s=decodeURIComponent(o.substring(e.length+1));break}}return s}r=r||{},null===t&&(t="",r.expires=-1);var i="";if(r.expires&&("number"==typeof r.expires||r.expires.toUTCString)){var l;"number"==typeof r.expires?(l=new Date,l.setTime(l.getTime()+24*r.expires*60*60*1e3)):l=r.expires,i="; expires="+l.toUTCString()}var u=r.path?"; path="+r.path:"",c=r.domain?"; domain="+r.domain:"",d=r.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),i,u,c,d].join("")};
!function(e){e.browser={},e.browser.mozilla=/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.opera=/opera/.test(navigator.userAgent.toLowerCase()),e.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()),e.fn.tree=function(t){return this.each(function(){if(tree_component.inst&&tree_component.inst[e(this).attr("id")]&&tree_component.inst[e(this).attr("id")].destroy(),t!==!1){var s=new tree_component;s.init(this,t)}})},window.tree_component=function(){return"undefined"==typeof tree_component.inst&&(tree_component.cntr=0,tree_component.inst=[],tree_component.drop=[],tree_component.focusInst=function(){return tree_component.inst[tree_component.focused]},tree_component.mousedown=function(t){e("html").attr("data-touch-action","none");var s=tree_component.focusInst();if(s){var i=e(t.target);return tree_component.drop.length&&i.is("."+tree_component.drop.join(", ."))?(s.drag=e("<li id='dragged' class='dragged foreign "+t.target.className+"'><a href='#'>"+i.text()+"</a></li>"),s._drag=s.drag,s.isdown=!0,s.foreign=i,i.blur(),t.preventDefault(),t.stopPropagation(),!1):(t.stopPropagation(),!0)}},tree_component.mouseup=function(t){e("html").removeAttr("data-touch-action");var s=tree_component.focusInst();if(s){if(tree_component.to&&clearTimeout(tree_component.to),tree_component.sto&&clearTimeout(tree_component.sto),s.foreign===!1&&s.drag&&s.drag.parentNode&&s.drag.parentNode==e(s.container).children("ul:eq(0)").get(0)){if(e(s.drag).remove(),s.moveType){var i=tree_component.inst[e(s.moveRef).parents(".tree:eq(0)").attr("id")];i&&i.moved(s.container.find("li.dragged"),s.moveRef,s.moveType,!1,"on"==s.settings.rules.drag_copy||"ctrl"==s.settings.rules.drag_copy&&t.ctrlKey)}s.moveType=!1,s.moveRef=!1}if(s.drag&&s.foreign!==!1){if(e(s.drag).remove(),s.moveType){var i=tree_component.inst[e(s.moveRef).parents(".tree:eq(0)").attr("id")];i&&i.settings.callback.ondrop.call(null,s.foreign.get(0),s.get_node(s.moveRef).get(0),s.moveType,s)}s.foreign=!1,s.moveType=!1,s.moveRef=!1}return e("#marker").hide(),s._drag=!1,s.drag=!1,s.isdown=!1,s.appended=!1,s.container.find("li.dragged").removeClass("dragged"),t.preventDefault(),t.stopPropagation(),!1}},tree_component.mousemove=function(t){var s=tree_component.focusInst();if(s){if(s.locked)return s.error("LOCKED");if(s.isdown){if(tree_component.to&&clearTimeout(tree_component.to),!s.appended){s.container.children("ul:eq(0)").append(s.drag);var i=e(s.drag).offsetParent();i.is("html")&&(i=e("body")),s.po=i.offset(),s.appended=!0}if(e(s.drag).css({left:t.originalEvent.pageX-s.po.left-(s.settings.ui.rtl?e(s.drag).width():-5),top:t.originalEvent.pageY-s.po.top+(e.browser.opera?s.container.scrollTop():0)+15}),"IMG"==t.target.tagName&&"marker"==t.target.id)return!1;var n=e(t.target).parents(".tree:eq(0)");if(0==n.size())return tree_component.sto&&clearTimeout(tree_component.sto),0==e(s.drag).children("IMG").size()&&e(s.drag).append("<img class='removeicon' style='position:absolute; "+(s.settings.ui.rtl?"right":"left")+":4px; top:0px;' src='"+s.settings.ui.theme_path+"default/remove.gif' />"),s.moveType=!1,s.moveRef=!1,e("#marker").hide(),!1;if(tree_component.inst[n.attr("id")].off_height(),!(s.foreign!==!1||n.get(0)==s.container.get(0)||s.settings.rules.multitree&&tree_component.inst[n.attr("id")].settings.rules.multitree))return 0==e(s.drag).children("IMG").size()&&e(s.drag).append("<img class='removeicon' style='position:absolute; "+(s.settings.ui.rtl?"right":"left")+":4px; top:0px;' src='"+s.settings.ui.theme_path+"default/remove.gif' />"),s.moveType=!1,s.moveRef=!1,e("#marker").hide(),!1;tree_component.sto&&clearTimeout(tree_component.sto),tree_component.sto=setTimeout(function(){tree_component.inst[n.attr("id")].scrollCheck(t.originalEvent.pageX,t.originalEvent.pageY)},50);var r=!1,a=n.scrollTop();if("A"==t.target.tagName&&"title"==t.target.className){if(e(t.target).is("#dragged"))return!1;var l={x:e(t.target).offset().left-1,y:t.originalEvent.pageY-tree_component.inst[n.attr("id")].offset.top};n.hasClass("rtl")&&(l.x+=e(t.target).width()-8),(l.y+a)%s.li_height<s.li_height/3+1?(r="before",l.y=t.originalEvent.pageY-(l.y+a)%s.li_height-2):(l.y+a)%s.li_height>2*s.li_height/3-1?(r="after",l.y=t.originalEvent.pageY-(l.y+a)%s.li_height+s.li_height-2):(r="inside",l.x-=2,n.hasClass("rtl")&&(l.x+=36),l.y=t.originalEvent.pageY-(l.y+a)%s.li_height+Math.floor(s.li_height/2)-2,s.get_node(t.target).hasClass("closed")&&(tree_component.to=setTimeout(function(){s.open_branch(s.get_node(t.target))},500))),tree_component.inst[n.attr("id")].checkMove(s.container.find("li.dragged"),e(t.target),r)?("inside"==r?e("#marker").attr("src",s.settings.ui.theme_path+"default/plus.gif").width(14):n.hasClass("rtl")?e("#marker").attr("src",s.settings.ui.theme_path+"default/marker_rtl.gif").width(40):e("#marker").attr("src",s.settings.ui.theme_path+"default/marker.gif").width(40),s.moveType=r,s.moveRef=t.target,e(s.drag).children("IMG").remove(),e("#marker").css({left:l.x-1,top:l.y-2}).show()):(0==e(s.drag).children("IMG").size()&&e(s.drag).append("<img class='removeicon' style='position:absolute; "+(s.settings.ui.rtl?"right:0px;":"left:4px;")+" top:0px;' src='"+s.settings.ui.theme_path+"default/remove.gif' />"),s.moveType=!1,s.moveRef=!1,e("#marker").hide())}else 0==e(s.drag).children("IMG").size()&&e(s.drag).append("<img class='removeicon' style='position:absolute; "+(s.settings.ui.rtl?"right:0px;":"left:4px;")+" top:0px;' src='"+s.settings.ui.theme_path+"default/remove.gif' />"),s.moveType=!1,s.moveRef=!1,e("#marker").hide();return t.preventDefault(),t.stopPropagation(),!1}return!0}}),{cntr:tree_component.cntr++,settings:{data:{type:"predefined",method:"GET",async:!1,async_data:function(t){return{id:e(t).attr("id")||0}},url:!1,json:!1},selected:!1,opened:[],languages:[],path:!1,cookies:!1,ui:{dots:!0,rtl:!1,animation:0,hover_mode:!0,scroll_spd:4,theme_path:!1,theme_name:"default",context:[{id:"create",label:"Create",icon:"create.png",visible:function(e,t){return 1!=e.length?!1:t.check("creatable",e)},action:function(e,t){t.create(!1,e)}},"separator",{id:"rename",label:"Rename",icon:"rename.png",visible:function(e,t){return 1!=e.length?!1:t.check("renameable",e)},action:function(e,t){t.rename()}},{id:"delete",label:"Delete",icon:"remove.gif",visible:function(e,t){return t.check("deletable",e)},action:function(e,t){e.each(function(){t.remove(this)})}}]},rules:{multiple:!1,metadata:!1,type_attr:"rel",multitree:!1,createat:"bottom",use_inline:!1,clickable:"all",renameable:"all",deletable:"all",creatable:"all",draggable:"none",dragrules:"all",drag_copy:!1,droppable:[]},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(e,t){return!0},beforemove:function(e,t,s,i){return!0},beforecreate:function(e,t,s,i){return!0},beforerename:function(e,t,s){return!0},beforedelete:function(e,t){return!0},onchange:function(e,t){},onrename:function(e,t,s){},onmove:function(e,t,s,i){},oncopy:function(e,t,s,i){},oncreate:function(e,t,s,i){},ondelete:function(e,t){},onopen:function(e,t){},onclose:function(e,t){},error:function(e,t){},ondblclk:function(e,t){t.toggle_branch.call(t,e),t.select_branch.call(t,e)},onrgtclk:function(e,t,s){},onload:function(e){},onfocus:function(e){},ondrop:function(e,t,s,i){}}},init:function(t,s){var n=this;if(this.container=e(t),0==this.container.size)return void alert("Invalid container node!");if(tree_component.inst[this.cntr]=this,this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr),tree_component.inst[this.container.attr("id")]=tree_component.inst[this.cntr],tree_component.focused=this.cntr,s&&s.cookies&&(this.settings.cookies=e.extend({},this.settings.cookies,s.cookies),delete s.cookies,this.settings.cookies.opts||(this.settings.cookies.opts={})),s&&s.callback&&(this.settings.callback=e.extend({},this.settings.callback,s.callback),delete s.callback),s&&s.data&&(this.settings.data=e.extend({},this.settings.data,s.data),delete s.data),s&&s.ui&&(this.settings.ui=e.extend({},this.settings.ui,s.ui),delete s.ui),s&&s.rules&&(this.settings.rules=e.extend({},this.settings.rules,s.rules),delete s.rules),s&&s.lang&&(this.settings.lang=e.extend({},this.settings.lang,s.lang),delete s.lang),this.settings=e.extend({},this.settings,s),0==this.settings.path?(this.path="",e("script").each(function(){this.src.toString().match(/tree_component.*?js.*$/)&&(n.path=this.src.toString().replace(/tree_component.*?js.*$/,""))})):this.path=this.settings.path,this.current_lang=this.settings.languages&&this.settings.languages.length?this.settings.languages[0]:!1,this.settings.languages&&this.settings.languages.length){this.sn=get_sheet_num("tree_component.css");for(var r=!1,a=this.container.attr("id")?"#"+this.container.attr("id"):".tree",l=0;l<this.settings.languages.length;l++)r=add_css(a+" ."+this.settings.languages[l],this.sn),r!==!1&&(this.settings.languages[l]==this.current_lang?r.style.display="inline":r.style.display="none")}if(this.settings.rules.droppable.length)for(i in this.settings.rules.droppable)tree_component.drop.push(this.settings.rules.droppable[i]),tree_component.drop=e.unique(tree_component.drop);if(this.settings.ui.theme_path===!1&&(this.settings.ui.theme_path=this.path+"themes/"),this.theme=this.settings.ui.theme_path+n.settings.ui.theme_name+"/",add_sheet(n.settings.ui.theme_path+"default/style.css"),"default"!=this.settings.ui.theme_name&&add_sheet(n.theme+"style.css"),this.container.addClass("tree"),this.settings.ui.rtl&&this.container.addClass("rtl"),this.settings.rules.multiple&&(this.selected_arr=[]),this.offset=!1,0==this.settings.ui.dots&&this.container.addClass("no_dots"),this.context=!1,0!=this.settings.ui.context){var o='<div class="context">';for(i in this.settings.ui.context)if("separator"!=this.settings.ui.context[i]){var h="";this.settings.ui.context[i].icon&&(h="background-image:url('"+(-1==this.settings.ui.context[i].icon.indexOf("/")?this.theme+this.settings.ui.context[i].icon:this.settings.ui.context[i].icon)+"');"),o+='<a rel="'+this.settings.ui.context[i].id+'" href="#" style="'+h+'">'+this.settings.ui.context[i].label+"</a>"}else o+="<span class='separator'>&nbsp;</span>";o+="</div>",this.context=e(o),this.context.hide(),this.context.append=!1}if(this.hovered=!1,this.locked=!1,"none"!=this.settings.rules.draggable&&"none"!=this.settings.rules.dragrules){var n=this;e("<img>").attr({id:"marker",src:n.settings.ui.theme_path+"default/marker.gif"}).css({height:"8px",width:"42px",display:"block",position:"absolute",left:"30px",top:"30px",zIndex:"1000"}).hide().appendTo("body")}this.refresh(),this.attachEvents(),this.focus()},off_height:function(){if(this.offset===!1){this.container.css({position:"relative"}),this.offset=this.container.offset();var t=0;t=parseInt(e.css(this.container.get(0),"paddingTop",!0),10),t&&(this.offset.top+=t),t=parseInt(e.css(this.container.get(0),"borderTopWidth",!0),10),t&&(this.offset.top+=t),this.container.css({position:""})}if(!this.li_height){var t=this.container.find("ul li:eq(0)");this.li_height=t.find(".title:first").height()+1,this.li_height||(this.li_height=18)}},refresh:function(t){if(this.locked)return this.error("LOCKED");var s=this;if(this.opened=Array(),this.settings.cookies&&e.cookie(this.settings.cookies.prefix+"_open")){var i=e.cookie(this.settings.cookies.prefix+"_open"),n=i.split(",");e.each(n,function(){s.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1}else 0!=this.settings.opened?(e.each(this.settings.opened,function(e,t){s.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(e){s.opened.push("#"+this.id)});if(this.selected)this.settings.selected=Array(),this.selected_arr?e.each(this.selected_arr,function(){s.settings.selected.push("#"+this.attr("id"))}):this.settings.selected.push("#"+this.selected.attr("id"));else if(this.settings.selected!==!1){var n=Array();"object"==(typeof this.settings.selected).toLowerCase()?e.each(this.settings.selected,function(){n.push("#"+this.replace(/^#/,""))}):n.push("#"+this.settings.selected.replace(/^#/,"")),this.settings.selected=n}if(t&&this.settings.data.async)return this.opened=Array(),t=this.get_node(t),t.find("li.open").each(function(e){s.opened.push("#"+this.id)}),this.close_branch(t,!0),t.children("ul:eq(0)").html(""),this.open_branch(t,!0,function(){s.reselect.apply(s)});var r="tree-default";if("default"!=this.settings.ui.theme_name&&(r+=" tree-"+s.settings.ui.theme_name),"xml_flat"==this.settings.data.type||"xml_nested"==this.settings.data.type){this.scrtop=this.container.get(0).scrollTop;var a="xml_flat"==this.settings.data.type?"flat.xsl":"nested.xsl";return void this.container.getTransform(this.path+a,this.settings.data.url,{params:{theme_name:r,theme_path:s.theme},meth:s.settings.data.method,callback:function(){s.reselect.apply(s)}})}if("json"==this.settings.data.type)if(this.settings.data.json){var i="";if(this.settings.data.json.length)for(var l=0;l<this.settings.data.json.length;l++)i+=this.parseJSON(this.settings.data.json[l]);else i=this.parseJSON(this.settings.data.json);this.container.html("<ul class='"+r+"'>"+i+"</ul>"),this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),this.container.find("li").not(".open").not(".closed").addClass("leaf"),this.reselect()}else{var s=this;e.ajax({type:this.settings.data.method,url:this.settings.data.url,data:this.settings.data.async_data(!1),dataType:"json",success:function(e){var t="";if(e.length)for(var i=0;i<e.length;i++)t+=s.parseJSON(e[i]);else t=s.parseJSON(e);s.container.html("<ul class='"+r+"'>"+t+"</ul>"),s.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),s.container.find("li").not(".open").not(".closed").addClass("leaf"),s.reselect.apply(s)}})}else this.container.children("ul:eq(0)").attr("class",r),this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),this.container.find("li").not(".open").not(".closed").addClass("leaf"),this.reselect()},parseJSON:function(e){var t="";t+="<li ";var s=!1;for(i in e.attributes)"class"==i?(t+=" class='"+e.attributes[i]+" ",("closed"==e.state||"open"==e.state)&&(t+=" "+e.state+" "),t+="' ",s=!0):t+=" "+i+"='"+e.attributes[i]+"' ";if(s||"closed"!=e.state&&"open"!=e.state||(t+=" class='"+e.state+"' "),t+=">",this.settings.languages.length)for(var i=0;i<this.settings.languages.length;i++){var n=[];if(n.href="#",n.style="",n["class"]=this.settings.languages[i],e.data[this.settings.languages[i]]&&"undefined"!=(typeof e.data[this.settings.languages[i]].attributes).toLowerCase())for(j in e.data[this.settings.languages[i]].attributes)"style"==j||"class"==j?n[j]+=" "+e.data[this.settings.languages[i]].attributes[j]:n[j]=e.data[this.settings.languages[i]].attributes[j];if(e.data[this.settings.languages[i]]&&e.data[this.settings.languages[i]].icon){var r=-1==e.data[this.settings.languages[i]].icon.indexOf("/")?this.theme+e.data[this.settings.languages[i]].icon:e.data[this.settings.languages[i]].icon;n.style+=" ; background-image:url('"+r+"'); "}t+="<a";for(j in n)t+=" "+j+'="'+n[j]+'" ';t+=">"+("undefined"!=(typeof e.data[this.settings.languages[i]].title).toLowerCase()?e.data[this.settings.languages[i]].title:e.data[this.settings.languages[i]])+"</a>"}else{var n=[];if(n.href="#",n.style="",n["class"]="","undefined"!=(typeof e.data.attributes).toLowerCase())for(i in e.data.attributes)"style"==i||"class"==i?n[i]+=" "+e.data.attributes[i]:n[i]=e.data.attributes[i];if(e.data.icon){var r=-1==e.data.icon.indexOf("/")?this.theme+e.data.icon:e.data.icon;n.style+=" ; background-image:url('"+r+"');"}t+="<a";for(i in n)t+=" "+i+'="'+n[i]+'" ';t+=">"+("undefined"!=(typeof e.data.title).toLowerCase()?e.data.title:e.data)+"</a>"}if(e.children&&e.children.length){t+="<ul>";for(var i=0;i<e.children.length;i++)t+=this.parseJSON(e.children[i]);t+="</ul>"}return t+="</li>"},getJSON:function(t,s,n,r){var a=this;if(t=t&&0!=e(t).size()?e(t):this.container.children("ul").children("li"),t.size()>1){var l=[];return t.each(function(){l.push(a.getJSON(this,s,n))}),l}s||(s=["id","rel","class"]),n||(n=[]);var o={attributes:{},data:!1};for(i in s)o.attributes[s[i]]=t.attr(s[i]);if(this.settings.languages.length){o.data={};for(i in this.settings.languages){var h=t.children("a."+this.settings.languages[i]);if(r||n.length||h.get(0).style.backgroundImage.toString().length){if(o.data[this.settings.languages[i]]={},o.data[this.settings.languages[i]].title=h.text(),h.get(0).style.backgroundImage.length&&(o.data[this.settings.languages[i]].icon=h.get(0).style.backgroundImage.replace("url(","").replace(")","")),n.length){o.data[this.settings.languages[i]].attributes={};for(j in n)o.data[this.settings.languages[i]].attributes[n[j]]=h.attr(n[j])}}else o.data[this.settings.languages[i]]=h.text()}}else{var h=t.children("a");if(r||n.length||h.get(0).style.backgroundImage.toString().length){if(o.data={},o.data.title=h.text(),h.get(0).style.backgroundImage.length&&(o.data.icon=h.get(0).style.backgroundImage.replace("url(","").replace(")","")),n.length){o.data.attributes={};for(j in n)o.data.attributes[n[j]]=h.attr(n[j])}}else o.data=h.text()}return t.children("ul").size()>0&&(o.children=[],t.children("ul").children("li").each(function(){o.children.push(a.getJSON(this,s,n))})),o},focus:function(){return this.locked?!1:void(tree_component.focused!=this.cntr&&(tree_component.focused=this.cntr,this.settings.callback.onfocus.call(null,this)))},show_context:function(t,s,i){var n=this.context.show().offsetParent();n.is("html")&&(n=e("body")),n=n.offset(),this.context.css({left:s-n.left-(this.settings.ui.rtl?e(this.context).width():-5),top:i-n.top+(e.browser.opera?this.container.scrollTop():0)+15})},hide_context:function(){this.context.hide()},attachEvents:function(){var t=this;this.container.listen("click","li",function(e){e.stopPropagation(),t.toggle_branch.apply(t,[e.target])}).listen("click","a.title",function(e){return t.locked?(e.preventDefault(),e.target.blur(),t.error("LOCKED")):(t.select_branch.apply(t,[e.target,e.ctrlKey||"on"==t.settings.rules.multiple]),t.inp&&t.inp.blur(),e.preventDefault(),e.target.blur(),!1)}).listen("dblclick","a.title",function(e){return t.locked?(e.preventDefault(),e.stopPropagation(),e.target.blur(),t.error("LOCKED")):(t.settings.callback.ondblclk.call(null,t.get_node(e.target).get(0),t),e.preventDefault(),e.stopPropagation(),void e.target.blur())}).listen("contextmenu","a.title",function(e){if(t.locked)return e.target.blur(),t.error("LOCKED");if(t.settings.callback.onrgtclk.call(null,t.get_node(e.target).get(0),t,e),t.context){if(0==t.context.append){t.container.find("ul:eq(0)").append(t.context),t.context.append=!0;for(i in t.settings.ui.context)"separator"!=t.settings.ui.context[i]&&!function(){var e=t.settings.ui.context[i].action;t.context.children("[rel="+t.settings.ui.context[i].id+"]").bind("click",function(s){return e.call(null,t.selected_arr||t.selected,t),t.hide_context(),s.stopPropagation(),s.preventDefault(),!1})}()}var s=t.get_node(e.target);if(t.inp&&t.inp.blur(),s){s.children("a:eq(0)").hasClass("clicked")||(t.select_branch.apply(t,[e.target,e.ctrlKey||"on"==t.settings.rules.multiple]),e.target.blur()),t.context.children("li").show();var n=!1;for(i in t.settings.ui.context)"separator"!=t.settings.ui.context[i]&&(t.settings.ui.context[i].visible.call(null,t.selected_arr||t.selected,t)?n=!0:t.context.children("[rel="+t.settings.ui.context[i].id+"]").hide());return 1==n&&t.show_context(s,e.originalEvent.pageX,e.originalEvent.pageY),e.preventDefault(),e.stopPropagation(),!1}}return!0}).listen("pointerenter","a.title",function(e){return t.locked?(e.preventDefault(),e.stopPropagation(),t.error("LOCKED")):void(t.settings.ui.hover_mode&&t.hovered!==!1&&"A"==e.target.tagName&&(t.hovered.children("a").removeClass("hover"),t.hovered=!1))}),"none"!=this.settings.rules.draggable&&"none"!=this.settings.rules.dragrules&&(this.container.on("pointerup pointerdown",".col2",function(e){t._drag||e.stopPropagation()}).on("pointerdown","a.title",function(s){if(t.focus.apply(t),t.locked)return t.error("LOCKED");var n=t.get_node(s.target);if(0!=t.settings.rules.multiple&&t.selected_arr.length>1&&n.children("a:eq(0)").hasClass("clicked")){var r=0;for(i in t.selected_arr)t.check("draggable",t.selected_arr[i])&&(t.selected_arr[i].addClass("dragged"),r++);r>0&&(t.check("draggable",n)?t._drag=n:t._drag=t.container.find("li.dragged:eq(0)"),t.isdown=!0,t.drag=t._drag.get(0).cloneNode(!0),t.drag.id="dragged",e(t.drag).children("a").html("Multiple selection").end().children("ul").remove())}else t.check("draggable",n)&&(t._drag=n,t.drag=n.get(0).cloneNode(!0),t.drag.id="dragged",t.isdown=!0,t.foreign=!1,n.addClass("dragged"));return n.blur(),s.preventDefault(),s.stopPropagation(),!1}).listen("pointerup","li",function(e){e.stopPropagation()}).listen("pointerup","a.title",function(e){t._drag||e.stopPropagation()}),e("html").bind("pointerdown",tree_component.mousedown).bind("pointerup",tree_component.mouseup).bind("pointermove",tree_component.mousemove)),t.context&&e("html").bind("pointerup",function(){t.hide_context()})},checkMove:function(t,s,n){if(this.locked)return this.error("LOCKED");var r=this;if(s.parents("li.dragged").size()>0||s.is(".dragged"))return this.error("MOVE: NODE OVER SELF");if(1==t.size()){var a=t.eq(0);if(a.hasClass("foreign")){if(0==this.settings.rules.droppable.length)return!1;if(!a.is("."+this.settings.rules.droppable.join(", .")))return!1;var l=!1;for(i in this.settings.rules.droppable)if(a.is("."+this.settings.rules.droppable[i])){this.settings.rules.metadata?(e.metadata.setType("attr",this.settings.rules.metadata),a.attr(this.settings.rules.metadata,"type: '"+this.settings.rules.droppable[i]+"'")):a.attr(this.settings.rules.type_attr,this.settings.rules.droppable[i]),l=!0;break}if(!l)return!1}if(!this.check("dragrules",[a,n,s.parents("li:eq(0)")]))return this.error("MOVE: AGAINST DRAG RULES")}else{var l=!0;if(t.each(function(i){if(0==l)return!1;if(i>0)var a=t.eq(i-1),o="after";else var a=s,o=n;r.check.apply(r,["dragrules",[e(this),o,a]])||(l=!1)}),0==l)return this.error("MOVE: AGAINST DRAG RULES")}if(this.settings.rules.use_inline&&this.settings.rules.metadata){var o=!1;if(o="inside"==n?s.parents("li:eq(0)"):s.parents("li:eq(1)"),o.size()){if("undefined"!=typeof o.metadata().valid_children){var h=o.metadata().valid_children,l=!0;if(t.each(function(t){return 0==l?!1:void(-1==e.inArray(r.get_type(this),h)&&(l=!1))}),0==l)return this.error("MOVE: NOT A VALID CHILD")}if("undefined"!=typeof o.metadata().max_children&&o.children("ul:eq(0)").children("li").not(".dragged").size()+t.size()>o.metadata().max_children)return this.error("MOVE: MAX CHILDREN REACHED");var c=0;t.each(function(t){for(var t=1,s=e(this);100>t&&(s=s.children("ul:eq(0)"),0!=s.size());)t++;c=Math.max(t,c)});var l=!0;if(o.parents("li").each(function(t){return 0==l?!1:void(e(this).metadata().max_depth&&t+c>=e(this).metadata().max_depth&&(l=!1))}),0==l)return this.error("MOVE: MAX_DEPTH REACHED")}}return!0},reselect:function(){var t=this;if(this.opened&&this.opened.length){for(var s=!1,i=0;i<this.opened.length;i++)if(this.settings.data.async){if(this.get_node(this.opened[i]).size()>0){s=!0;var n=this.opened[i];delete this.opened[i],this.open_branch(n,!0,function(){t.reselect.apply(t)})}}else this.open_branch(this.opened[i],!0);if(this.settings.data.async&&s)return;delete this.opened}this.scrtop&&(this.container.scrollTop(t.scrtop),delete this.scrtop),this.settings.selected!==!1&&(e.each(this.settings.selected,function(s){t.select_branch(e(t.settings.selected[s]),t.settings.rules.multiple!==!1&&s>0)}),this.settings.selected=!1),this.settings.callback.onload.call(null,t)},get_node:function(t){var t=e(t);return t.is("li")?t:t.parents("li:eq(0)")},get_type:function(t){if(t=t?this.get_node(t):this.selected){if(this.settings.rules.metadata){e.metadata.setType("attr",this.settings.rules.metadata);var s=t.metadata().type;if(s)return s}return t.attr(this.settings.rules.type_attr)}},scrollCheck:function(t,s){var i=this,n=i.container,r=i.offset,a=n.scrollTop(),l=n.scrollLeft(),o=n.get(0).scrollWidth>n.width()?40:20;s-r.top<20&&n.scrollTop(Math.max(a-i.settings.ui.scroll_spd,0)),n.height()-(s-r.top)<o&&n.scrollTop(a+i.settings.ui.scroll_spd),t-r.left<20&&n.scrollLeft(Math.max(l-i.settings.ui.scroll_spd,0)),n.width()-(t-r.left)<40&&n.scrollLeft(l+i.settings.ui.scroll_spd),(n.scrollLeft()!=l||n.scrollTop()!=a)&&(i.moveType=!1,i.moveRef=!1,e("#marker").hide()),tree_component.sto=setTimeout(function(){i.scrollCheck(t,s)},50)},check:function(t,s){if(this.locked)return this.error("LOCKED");if("dragrules"!=t&&this.settings.rules.use_inline&&this.settings.rules.metadata&&(e.metadata.setType("attr",this.settings.rules.metadata),"undefined"!=typeof this.get_node(s).metadata()[t]))return this.get_node(s).metadata()[t];if(!this.settings.rules[t])return!1;if("none"==this.settings.rules[t])return!1;if("all"==this.settings.rules[t])return!0;if("dragrules"==t){var i=new Array;i[0]=this.get_type(s[0]),i[1]=s[1],i[2]=this.get_type(s[2]);for(var n=0;n<this.settings.rules.dragrules.length;n++){var r=this.settings.rules.dragrules[n],a=0===r.indexOf("!")?!1:!0;a||(r=r.replace("!",""));for(var l=r.split(" "),o=0;3>o;o++)(l[o]==i[o]||"*"==l[o])&&(l[o]=!0);if(l[0]===!0&&l[1]===!0&&l[2]===!0)return a}return!1}return-1!=e.inArray(this.get_type(s),this.settings.rules[t])?!0:!1},hover_branch:function(e){if(this.locked)return this.error("LOCKED");if(0==this.settings.ui.hover_mode)return this.select_branch(e);var t=this,e=t.get_node(e);if(!e.size())return this.error("HOVER: NOT A VALID NODE");if(!t.check("clickable",e))return this.error("SELECT: NODE NOT SELECTABLE");this.hovered&&this.hovered.children("A").removeClass("hover"),this.hovered=e,this.hovered.children("a").removeClass("hover").addClass("hover");var s=this.hovered.offset().top,i=this.container.offset().top,n=i+this.container.height(),r=this.container.get(0).scrollWidth>this.container.width()?40:20;i>s+5&&this.container.scrollTop(this.container.scrollTop()-(i-s+5)),s+r>n&&this.container.scrollTop(this.container.scrollTop()+(s+r-n))},select_branch:function(e,t){if(this.locked)return this.error("LOCKED");e||this.hovered===!1||(e=this.hovered);var s=this;if(e=s.get_node(e),!e.size())return this.error("SELECT: NOT A VALID NODE");if(e.children("a").removeClass("hover"),!s.check("clickable",e))return this.error("SELECT: NODE NOT SELECTABLE");if(s.settings.callback.beforechange.call(null,e.get(0),s)===!1)return this.error("SELECT: STOPPED BY USER");if(0!=this.settings.rules.multiple&&t&&e.children("a.clicked").size()>0)return this.deselect_branch(e);if(0!=this.settings.rules.multiple&&t&&this.selected_arr.push(e),0!=this.settings.rules.multiple&&!t){for(i in this.selected_arr)this.selected_arr[i].children("A").removeClass("clicked");this.selected_arr=[],this.selected_arr.push(e),this.selected&&this.selected.children("A").removeClass("clicked")}this.settings.rules.multiple||this.selected&&this.selected.children("A").removeClass("clicked"),this.selected=e,this.settings.ui.hover_mode&&this.hovered!==!1&&(this.hovered.children("A").removeClass("hover"),this.hovered=e),this.selected.children("a").removeClass("clicked").addClass("clicked").end().parents("li.closed").each(function(){s.open_branch(this,!0)});var n=this.selected.offset().top,r=this.container.offset().top,a=r+this.container.height(),l=this.container.get(0).scrollWidth>this.container.width()?40:20;r>n+5&&this.container.scrollTop(this.container.scrollTop()-(r-n+5)),n+l>a&&this.container.scrollTop(this.container.scrollTop()+(n+l-a)),this.set_cookie("selected"),this.settings.callback.onchange.call(null,this.selected.get(0),s)},deselect_branch:function(t){if(this.locked)return this.error("LOCKED");var s=this,t=this.get_node(t);t.children("a").removeClass("clicked"),0!=this.settings.rules.multiple&&this.selected_arr.length>1?(this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){s.selected_arr.push(e(this))}),t.get(0)==this.selected.get(0)&&(this.selected=this.selected_arr[0],this.set_cookie("selected"))):(0!=this.settings.rules.multiple&&(this.selected_arr=[]),this.selected=!1,this.set_cookie("selected")),this.selected?this.settings.callback.onchange.call(null,this.selected.get(0),s):this.settings.callback.onchange.call(null,!1,s)},toggle_branch:function(e){if(this.locked)return this.error("LOCKED");var e=this.get_node(e);return e.hasClass("closed")?this.open_branch(e):e.hasClass("open")?this.close_branch(e):void 0},open_branch:function(t,s,i){if(this.locked)return this.error("LOCKED");var t=this.get_node(t);if(!t.size())return this.error("OPEN: NO SUCH NODE");if(t.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&0==t.find("li").size()){var n=this;if(t.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a style='background-image:url("+n.settings.ui.theme_path+"default/throbber.gif)' href='#'>"+(n.settings.lang.loading||"Loading ...")+"</a></li></ul>"),t.removeClass("closed").addClass("open"),"xml_flat"==this.settings.data.type||"xml_nested"==this.settings.data.type){var r="xml_flat"==this.settings.data.type?"flat.xsl":"nested.xsl",a=-1==this.settings.data.url.indexOf("?")?"?id="+encodeURIComponent(t.attr("id")):"&id="+encodeURIComponent(t.attr("id"));t.children("ul:eq(0)").getTransform(this.path+r,this.settings.data.url+a,{params:{theme_path:n.theme},meth:this.settings.data.method,repl:!0,callback:function(e,s){return e.length<15?(t.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),void(i&&i.call())):(n.open_branch.apply(n,[t]),void(i&&i.call()))}})}else e.ajax({type:this.settings.data.method,url:this.settings.data.url,data:this.settings.data.async_data(t),dataType:"json",success:function(e,s){if(!e||0==e.length)return t.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),void(i&&i.call());var r="";if(e.length)for(var a=0;a<e.length;a++)r+=n.parseJSON(e[a]);else r=n.parseJSON(e);t.children("ul:eq(0)").replaceWith("<ul>"+r+"</ul>"),t.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),t.find("li").not(".open").not(".closed").addClass("leaf"),n.open_branch.apply(n,[t]),i&&i.call()}});return!0}return!(parseInt(this.settings.ui.animation)>0)||s||e.browser.msie&&e.browser.version<7?(t.removeClass("closed").addClass("open"),i&&i.call()):(t.children("ul:eq(0)").css("display","none"),t.removeClass("closed").addClass("open"),t.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){e(this).css("display",""),i&&i.call()})),this.set_cookie("open"),this.settings.callback.onopen.call(null,t.get(0),this),!0},close_branch:function(t,s){if(this.locked)return this.error("LOCKED");var i=this,t=this.get_node(t);!(parseInt(this.settings.ui.animation)>0)||s||e.browser.msie&&e.browser.version<7||1!=t.children("ul:eq(0)").size()?(t.removeClass("open").addClass("closed"),this.set_cookie("open")):t.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){t.removeClass("open").addClass("closed"),i.set_cookie("open"),e(this).css("display","")}),this.selected&&t.children("ul:eq(0)").find("a.clicked").size()>0&&(t.find("li:has(a.clicked)").each(function(){i.deselect_branch(this)}),0==t.children("a.clicked").size()&&this.select_branch(t,0!=this.settings.rules.multiple&&this.selected_arr.length>0)),this.settings.callback.onclose.call(null,t.get(0),this)},open_all:function(t){if(this.locked)return this.error("LOCKED");var s=this;t=t?e(t):this.container,t.find("li.closed").each(function(){var e=this;s.open_branch.apply(s,[this,!0,function(){s.open_all.apply(s,[e])}])})},close_all:function(){if(this.locked)return this.error("LOCKED");var t=this;e(this.container).find("li.open").each(function(){
t.close_branch(this,!0)})},show_lang:function(e){if(this.locked)return this.error("LOCKED");if(this.settings.languages[e]==this.current_lang)return!0;var t=!1,s=this.container.attr("id")?"#"+this.container.attr("id"):".tree";return t=get_css(s+" ."+this.current_lang,this.sn),t!==!1&&(t.style.display="none"),t=get_css(s+" ."+this.settings.languages[e],this.sn),t!==!1&&(t.style.display="block"),this.current_lang=this.settings.languages[e],!0},cycle_lang:function(){if(this.locked)return this.error("LOCKED");var t=e.inArray(this.current_lang,this.settings.languages);t++,t>this.settings.languages.length-1&&(t=0),this.show_lang(t)},create:function(t,s,n,r,a){if(this.locked)return this.error("LOCKED");if(s=s?this.get_node(s):this.selected,!s||!s.size())return this.error("CREATE: NO NODE SELECTED");if(!this.check("creatable",s))return this.error("CREATE: CANNOT CREATE IN NODE");var l=t||this.get_type(s)||"";if(this.settings.rules.use_inline&&this.settings.rules.metadata){if(e.metadata.setType("attr",this.settings.rules.metadata),"undefined"!=typeof s.metadata().valid_children&&-1==e.inArray(l,s.metadata().valid_children))return this.error("CREATE: NODE NOT A VALID CHILD");if("undefined"!=typeof s.metadata().max_children&&s.children("ul:eq(0)").children("li").size()+1>s.metadata().max_children)return this.error("CREATE: MAX_CHILDREN REACHED");var o=!0;if(s.parents("li").each(function(t){e(this).metadata().max_depth&&t+1>=e(this).metadata().max_depth&&(o=!1)}),!o)return this.error("CREATE: MAX_DEPTH REACHED")}if(s.hasClass("closed")){var h=this;return this.open_branch(s,!0,function(){h.create.apply(h,[t,s,n,r,a])})}a?$li=e("<li id='"+a+"' />"):$li=e("<li />"),this.settings.rules.metadata?(e.metadata.setType("attr",this.settings.rules.metadata),$li.attr(this.settings.rules.metadata,"type: '"+l+"'")):$li.attr(this.settings.rules.type_attr,l);var c="";if("string"==(typeof r).toLowerCase()&&(c=r,c=-1==c.indexOf("/")?this.theme+c:c),this.settings.languages.length)for(i=0;i<this.settings.languages.length;i++)"string"==(typeof n).toLowerCase()?val=n:n&&n[i]?val=n[i]:this.settings.lang.new_node?"string"!=(typeof this.settings.lang.new_node).toLowerCase()&&this.settings.lang.new_node[i]?val=this.settings.lang.new_node[i]:val=this.settings.lang.new_node:val="New folder","string"!=(typeof r).toLowerCase()&&r&&r[i]&&(c=r[i],c=-1==c.indexOf("/")?this.theme+c:c),$li.append("<a href='#'"+(c.length?" style='background-image:url(\""+c+"\");' ":" ")+"class='"+this.settings.languages[i]+"'>"+val+"</a>");else $li.append("<a href='#'"+(c.length?" style='background-image:url(\""+c+"\");' ":" ")+">"+(n||this.settings.lang.new_node||"New folder")+"</a>");return $li.addClass("leaf"),"top"==this.settings.rules.createat||0==s.children("ul").size()?this.moved($li,s.children("a:eq(0)"),"inside",!0):this.moved($li,s.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!0),this.select_branch($li.children("a:eq(0)")),n||this.rename(),$li},rename:function(){if(this.locked)return this.error("LOCKED");if(!this.selected)return this.error("RENAME: NO NODE SELECTED");var t=this;if(!this.check("renameable",this.selected))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.settings.callback.beforerename.call(null,this.selected.get(0),t.current_lang,t))return this.error("RENAME: STOPPED BY USER");var s=this.selected;s=this.current_lang?s.find("a."+this.current_lang).get(0):s.find("a:first").get(0),last_value=s.innerHTML,t.inp=e("<input type='text' />"),t.inp.val(last_value).bind("pointerdown",function(e){e.stopPropagation()}).bind("pointerup",function(e){e.stopPropagation()}).bind("click",function(e){e.stopPropagation()}).bind("keyup",function(e){var t=e.keyCode||e.which;return 27==t?(this.value=last_value,void this.blur()):13==t?void this.blur():void 0}),t.inp.blur(function(i){""==this.value&&this.value==last_value,e(s).html(e(s).parent().find("input").eq(0).attr("value")).get(0).style.display="",e(s).prevAll("span").remove(),this.value!=last_value&&t.settings.callback.onrename.call(null,t.get_node(s).get(0),t.current_lang,t),t.inp=!1});var i=e("<span />").addClass(s.className).append(t.inp);i.attr("style",e(s).attr("style")),s.style.display="none",e(s).parent().prepend(i),t.inp.get(0).focus(),t.inp.get(0).select()},remove:function(t){if(this.locked)return this.error("LOCKED");if(t){if(t=this.get_node(t),t.size()){if(!this.check("deletable",t))return this.error("DELETE: NODE NOT DELETABLE");if(!this.settings.callback.beforedelete.call(null,t.get(0),n))return this.error("DELETE: STOPPED BY USER");$parent=t.parent(),t=t.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove(),this.set_cookie("open")),this.settings.callback.ondelete.call(null,t,this)}}else{if(!this.selected)return this.error("DELETE: NO NODE SELECTED");if(!this.check("deletable",this.selected))return this.error("DELETE: NODE NOT DELETABLE");if(!this.settings.callback.beforedelete.call(null,this.selected.get(0),n))return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();var t=this.selected;if(0==this.settings.rules.multiple||1==this.selected_arr.length)var s=!0,i=this.selected.prev("li:eq(0)").size()?this.selected.prev("li:eq(0)"):this.selected.parents("li:eq(0)");if(t=t.remove(),$parent.children("li:last").addClass("last"),0==$parent.children("li").size()&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove(),this.set_cookie("open")),this.settings.callback.ondelete.call(null,t,this),s&&i&&this.select_branch(i),0!=this.settings.rules.multiple&&!s){var n=this;this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){n.selected_arr.push(e(this))}),this.selected_arr.length>0&&(this.selected=this.selected_arr[0],this.remove())}}},get_next:function(t){var s=this.hovered||this.selected;return s?s.hasClass("open")?t?this.select_branch(s.find("li:eq(0)")):this.hover_branch(s.find("li:eq(0)")):e(s).nextAll("li").size()>0?t?this.select_branch(s.nextAll("li:eq(0)")):this.hover_branch(s.nextAll("li:eq(0)")):t?this.select_branch(s.parents("li").next("li").eq(0)):this.hover_branch(s.parents("li").next("li").eq(0)):void 0},get_prev:function(e){var t=this.hovered||this.selected;if(t){if(t.prev("li").size()){for(var t=t.prev("li").eq(0);t.hasClass("open");)t=t.children("ul:eq(0)").children("li:last");return e?this.select_branch(t):this.hover_branch(t)}return e?this.select_branch(t.parents("li:eq(0)")):this.hover_branch(t.parents("li:eq(0)"))}},get_left:function(e,t){if(this.settings.ui.rtl&&!t)return this.get_right(e,!0);var s=this.hovered||this.selected;if(s){if(!s.hasClass("open"))return e?this.select_branch(s.parents("li:eq(0)")):this.hover_branch(s.parents("li:eq(0)"));this.close_branch(s)}},get_right:function(e,t){if(this.settings.ui.rtl&&!t)return this.get_left(e,!0);var s=this.hovered||this.selected;if(s){if(!s.hasClass("closed"))return e?this.select_branch(s.find("li:eq(0)")):this.hover_branch(s.find("li:eq(0)"));this.open_branch(s)}},toggleDots:function(){this.container.toggleClass("no_dots")},set_cookie:function(t){if(this.settings.cookies===!1)return!1;switch(t){case"open":var s="";this.container.find("li.open").each(function(e){s+=this.id+","}),e.cookie(this.settings.cookies.prefix+"_open",s.replace(/,$/gi,""),this.settings.cookies.opts)}},moved:function(t,s,n,r,a){var t=e(t),l=e(t).parents("ul:eq(0)"),o=e(s);if(t.size()>1){var h=this,c=this.moved(t.eq(0),s,n,!1,a);return void t.each(function(e){0!=e&&(c=h.moved(this,c.children("a:eq(0)"),"after",!1,a))})}if(a&&(t=t.clone(),t.each(function(t){this.id=this.id+"_copy",e(this).find("li").each(function(){this.id=this.id+"_copy"}),e(this).find("a.clicked").removeClass("clicked")})),r){if(!this.settings.callback.beforecreate.call(null,this.get_node(t).get(0),this.get_node(s).get(0),n,this))return}else if(!this.settings.callback.beforemove.call(null,this.get_node(t).get(0),this.get_node(s).get(0),n,this))return;if(!r){var c=e(t).parents(".tree:eq(0)");if(c.get(0)!=this.container.get(0)&&(c=tree_component.inst[c.attr("id")],c.settings.languages.length)){var d=[];if(0==this.settings.languages.length)d.push("."+c.current_lang);else for(i in this.settings.languages)for(j in c.settings.languages)this.settings.languages[i]==c.settings.languages[j]&&d.push("."+this.settings.languages[i]);if(0==d.length)return this.error("MOVE: NO COMMON LANGUAGES");t.find("a").removeClass("clicked").not(d.join(",")).remove()}}switch(n){case"before":o.parents("ul:eq(0)").children("li.last").removeClass("last"),o.parents("li:eq(0)").before(t.removeClass("last")),o.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":o.parents("ul:eq(0)").children("li.last").removeClass("last"),o.parents("li:eq(0)").after(t.removeClass("last")),o.parents("ul:eq(0)").children("li:last").addClass("last");break;case"inside":if(this.settings.data.async){var g=this.get_node(o);if(g.hasClass("closed")){var h=this;return this.open_branch(g,!0,function(){h.moved.apply(h,[t,s,n,r,a])})}}o.parents("li:eq(0)").children("ul:first").size()?"top"==this.settings.rules.createat?o.parents("li:eq(0)").children("ul:first").prepend(t.removeClass("last")).children("li:last").addClass("last"):o.parents("li:eq(0)").children("ul:first").children(".last").removeClass("last").end().append(t.removeClass("last")).children("li:last").addClass("last"):(t.addClass("last"),o.parents("li:eq(0)").append("<ul/>").removeClass("leaf").addClass("closed"),o.parents("li:eq(0)").children("ul:first").prepend(t)),this.settings.data.async||this.open_branch(o)}if(0==l.find("li").size()){var u=l.parent();u.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove(),u.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last"),this.set_cookie("open")}else l.children("li.last").removeClass("last"),l.children("li:last").addClass("last");return r&&"inside"!=n&&(s=this.get_node(s).parents("li:eq(0)")),a?this.settings.callback.oncopy.call(null,this.get_node(t).get(0),this.get_node(s).get(0),n,this):r?this.settings.callback.oncreate.call(null,this.get_node(t).get(0),this.get_node(s).get(0),this.settings.insertAt,this):this.settings.callback.onmove.call(null,this.get_node(t).get(0),this.get_node(s).get(0),n,this),t},error:function(e){return this.settings.callback.error.call(null,e,this),!1},lock:function(e){this.locked=e,this.locked?this.container.addClass("locked"):this.container.removeClass("locked")},cut:function(){return this.locked?this.error("LOCKED"):this.selected?(this.copy_nodes=!1,void(this.cut_nodes=this.container.find("a.clicked").filter(":first-child").parent())):this.error("CUT: NO NODE SELECTED")},copy:function(){return this.locked?this.error("LOCKED"):this.selected?(this.copy_nodes=this.container.find("a.clicked").filter(":first-child").parent(),void(this.cut_nodes=!1)):this.error("COPY: NO NODE SELECTED")},paste:function(){if(this.locked)return this.error("LOCKED");if(!this.selected)return this.error("PASTE: NO NODE SELECTED");if(!this.copy_nodes&&!this.cut_nodes)return this.error("PASTE: NOTHING TO DO");if(this.copy_nodes&&this.copy_nodes.size()){if(!this.checkMove(this.copy_nodes,this.selected.children("a:eq(0)"),"inside"))return!1;this.moved(this.copy_nodes,this.selected.children("a:eq(0)"),"inside",!1,!0),this.copy_nodes=!1}if(this.cut_nodes&&this.cut_nodes.size()){if(!this.checkMove(this.cut_nodes,this.selected.children("a:eq(0)"),"inside"))return!1;this.moved(this.cut_nodes,this.selected.children("a:eq(0)"),"inside"),this.cut_nodes=!1}},search:function(t){var s=this;if((!t||this.srch&&t!=this.srch)&&(this.srch="",this.srch_opn=!1,this.container.find("a.search").removeClass("search")),this.srch=t,t)if(this.settings.data.async)if(this.srch_opn)if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){for(var i=!1,n=0;n<this.srch_opn.length;n++)if(this.get_node("#"+this.srch_opn[n]).size()>0){i=!0;var r="#"+this.srch_opn[n];delete this.srch_opn[n],this.open_branch(r,!0,function(){s.search.apply(s,[t])})}i||(this.srch_opn=[],s.search.apply(s,[t]))}}else{var a="a";this.settings.languages.length&&(a+="."+this.current_lang),this.container.find(a+":contains('"+t+"')").addClass("search"),this.srch_opn=!1}else{var l=e.extend({search:t},this.settings.data.async_data(!1));e.ajax({type:this.settings.data.method,url:this.settings.data.url,data:l,dataType:"text",success:function(i){s.srch_opn=e.unique(i.split(",")),s.search.apply(s,[t])}})}else{var a="a";this.settings.languages.length&&(a+="."+this.current_lang),this.container.find(a+":contains('"+t+"')").addClass("search").parents("li.closed").each(function(){s.open_branch(this,!0)})}},destroy:function(){try{var t=["click","dblclick","contextmenu","pointerover","pointerdown"];for(i in t){var s=this.container.indexer(t[i]);s.stop(),e.removeData(s.listener,s.event+".indexer")}}catch(n){}if(this.container.unbind(),this.container.removeClass("tree").children("ul").removeClass("tree-"+this.settings.ui.theme_name).find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked"),this.cntr==tree_component.focused)for(i in tree_component.inst)if(i!=this.cntr&&i!=this.container.attr("id")){tree_component.inst[i].focus();break}delete tree_component.inst[this.cntr],delete tree_component.inst[this.container.attr("id")],tree_component.cntr--}}}}(CMS.$);