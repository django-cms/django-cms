{% load i18n %}
{% include "cms/inc/csrf_js.html" %}
{% include "cms/inc/jquery.html" %}
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/libs/classy-1.3.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/jquery.cookie.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/cms.toolbar.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/plugins/cms.placeholders.js"></script>
<script type="text/javascript">
//<![CDATA[
jQuery(document).ready(function ($) {
	// load css file
	$('<link>').appendTo('head').attr({
		rel: 'stylesheet', type: 'text/css',
		href: '{{ CMS_MEDIA_URL }}css/plugins/cms.toolbar.css'
	});
	$('<link>').appendTo('head').attr({
		rel: 'stylesheet', type: 'text/css',
		href: '{{ CMS_MEDIA_URL }}css/plugins/cms.placeholders.css'
	});
	
	// toolbar data
	var items=[
	{dir:'left',type:'anchor',order:1,class:'cms_toolbar-item_logo',title:'{% trans "django CMS" %}',url:'http://www.django-cms.org/'},
	{%if auth%}{dir:'left',type:'switcher',order:10,class:'cms_toolbar-item_editmode',addParameter:'edit',removeParameter:'edit-off',state:{% if edit %}true{% else %}false{% endif %},title:'{% trans "Edit mode" %}',url:'/'},{%if page.last_page_states%}{dir:'left',type:'html',order:20,class:'cms_toolbar-item_status',html:'<div class="cms_toolbar-item"><p>{% trans "Status" %}: <em>{% for state in page.last_page_states %}{{ state.get_action_display }} {% endfor %}</em></p></div>',htmlElement:''},{%endif%}{dir:'right',type:'list',order:30,class:'cms_toolbar-item_page',title:'{% trans "Page" %}',icon:'cms_toolbar_icon-edit',items:[{title:'{% trans "Move/add Pages" %}',url:'{% url admin:cms_page_changelist %}',icon:'cms_toolbar_icon-sitemap'}{%if has_add_page_permission%},{title:'{% trans "Add child page" %}',url:'{% url admin:cms_page_add %}?target={{ page.pk }}&amp;position=last-child',icon:'cms_toolbar_icon-child'},{title:'{% trans "Add sibling page" %}',url:'{% url admin:cms_page_add %}?{% if page.parent_id %}target={{ page.parent_id }}&amp;position=last-child{% endif %}',icon:'cms_toolbar_icon-sibling'}{%endif%}{%if has_delete_permission%},{title:'{% trans "Delete" %}',url:'{% url admin:cms_page_delete page.pk %}',icon:'cms_toolbar_icon-delete'},{%endif%}]},{dir:'right',type:'list',order:40,class:'cms_toolbar-item_admin',title:'{% trans "Admin" %}',icon:'cms_toolbar_icon-settings',items:[{title:'{% trans "Administration" %}',url:'{% url admin:index %}',icon:'cms_toolbar_icon-admin'}{%if has_change_permission%},{title:'{% trans "Page Settings" %}',url:'{% url admin:cms_page_change page.pk %}',icon:'cms_toolbar_icon-edit'},{title:'{% trans "Page History" %}',url:'{% url admin:cms_page_history page.pk %}',icon:'cms_toolbar_icon-history'}{%endif%}]},{dir:'right',type:'button',order:50,class:'cms_toolbar-item_logout',title:'{% trans "Logout" %}',icon:'cms_toolbar_icon-lock',action:'',hidden:'<input type="hidden" name="logout_submit" />'}{%if edit and page%},{%if moderator_should_approve and has_moderate_permission%}{dir:'right',type:'button',order:25,class:'cms_toolbar-item_moderator',title:'{{ page_moderator_state.label }}',icon:'',action:'',hidden:'',redirect:'{% url admin:cms_page_approve_page page.pk %}'}{%else%}{%if has_publish_permission%}{dir:'right',type:'button',order:25,class:'cms_toolbar-item_moderator',title:'{% trans "Publish" %}',icon:'',action:'',hidden:'',redirect:'{% url admin:cms_page_publish_page page.pk %}'}{%else%}{dir:'right',type:'button',order:25,class:'cms_toolbar-item_moderator',title:'{% trans "Request Approval" %}',icon:'',action:'',hidden:'',redirect:'{% url admin:cms_page_approve_page page.pk %}'}{%endif%}{%endif%}{%endif%}{%else%}{dir:'left',type:'html',order:20,class:'cms_toolbar-item_login',html:'',htmlElement:'#cms_toolbar-item_login'},{dir:'right',type:'button',order:20,class:'cms_toolbar-item_admin',title:'{% trans "Admin" %}',icon:'cms_toolbar_icon-settings',action:'',hidden:'',redirect:'{% url admin:index %}'}{%endif%}];
	
	// initialize toolbar and pass all the variables, use same namespace to trigger
	CMS.Toolbar = new CMS.Toolbar('#cms_toolbar', { 
		debug: true,
		items: items,
		csrf_token: "{% csrf_token %}"
	});
	
	// initialize placeholders
	CMS.Placeholders = new CMS.Placeholders('#cms_toolbar', {
		{% if edit %}editmode: true,{% endif %}
		data: '{{ placeholder_data }}',
		urls: {
			cms_page_move_plugin: '{% url admin:cms_page_move_plugin %}',
			cms_page_changelist: '{% url admin:cms_page_changelist %}',              
			cms_page_change_template: {% if page %}'{% url admin:cms_page_change_template page.pk %}'{% else %}null{% endif %},
			cms_page_add_plugin: '{% url admin:cms_page_add_plugin %}',
			cms_page_remove_plugin: '{% url admin:cms_page_remove_plugin %}',
			cms_page_move_plugin: '{% url admin:cms_page_move_plugin %}'
		},
		lang: {
			move_slot: "{% trans 'Move to %(name)s' %}",
			question: "{% trans 'Are you sure you want to delete this plugin?' %}"
		}
		{% if page %},
		page_is_defined: true
		{% endif %}
	});
});
//]]>
</script>

<div id="cms_toolbar" class="cms_reset" style="display:none;">
	<!-- start: toolbar -->
	<div class="cms_toolbar">
		<div id="cms_toolbar-toggle">
			<a href="#" class="cms_toolbar-btn cms_toolbar-btn_left">
				<span class="cms_toolbar-btn_right cms_toolbar_icon-toggle">
					<span class="cms_toolbar_icon">&nbsp;</span>
					<span class="cms_toolbar_icon-hide">{% trans "Show/Hide toolbar" %}</span>
				</span>
			</a>
		</div>
		<div id="cms_toolbar-toolbar">
			<div class="cms_toolbar-left"></div>
			<div class="cms_toolbar-right"></div>
		</div>
	</div>
	<!-- end: toolbar -->

	<!-- placeholder dimmer, loader and overlay -->
	<div id="cms_placeholder-dim"></div>
	<div id="cms_placeholder-content"><div class="cms_placeholder-content_inner cms_placeholder-content_loader"></div></div>
	<div id="cms_placeholder-overlay">
		&nbsp;
	</div>
	
	<!-- template: anchor -->
	<div id="cms_toolbar-item_anchor" class="cms_toolbar-item">
		<a href="[url]" class="cms_toolbar-item_logo-link">[title]</a>
	</div>
	
	<!-- template: switcher -->
	<div id="cms_toolbar-item_switcher" class="cms_toolbar-item cms_toolbar-item_switcher">
		<span class="cms_toolbar-item_switcher-label">[title]</span> 
		<a href="#" class="cms_toolbar-item_switcher-link"><span>{% trans "Switch on/off" %}</span></a>
	</div>
	
	<!-- template: button -->
	<form id="cms_toolbar-item_button" action="[action]" method="post" class="cms_toolbar-item">
		<fieldset>
			[hidden]
			[token]
			<a href="#" class="cms_toolbar-btn cms_toolbar-btn_left">
				<span class="cms_toolbar-btn_right">
					<span class="cms_toolbar_icon">&nbsp;</span>
					<span class="cms_toolbar_title">&nbsp;[title]</span>
				</span>
			</a>
		</fieldset>
	</form>
	
	<!-- template: list -->
	<div id="cms_toolbar-item_list" class="cms_toolbar-item">
		<a href="#" class="cms_toolbar-btn cms_toolbar-btn_left">
			<span class="cms_toolbar-btn_right">
				<span class="cms_toolbar_icon">&nbsp;</span>
				<span class="cms_toolbar_title">&nbsp;[title]</span>
				<span class="cms_toolbar_icon cms_toolbar_icon-more">-</span>
			</span>
		</a>
		<ul class="cms_toolbar-item_list">
			<li><a href="[list_url]"><span>&nbsp;</span>[list_title]</a></li>
		</ul>
	</div>
	
	<!-- item: html - login -->
	<form action="" method="post" id="cms_toolbar-item_login" class="cms_toolbar-item{% if auth_error %} cms_toolbar_error{% endif %}">
		<fieldset>
			<label for="cms_toolbar-item_login-username">{% trans "Username" %}</label>
			<div><input type="text" name="cms_username" id="cms_toolbar-item_login-username" /></div>
			<label for="cms_toolbar-item_login-password">{% trans "Password" %}</label>
			<div><input type="password" name="cms_password" id="cms_toolbar-item_login-password" /></div>
			{% csrf_token %}
			<a href="#" class="cms_toolbar-btn cms_toolbar-btn_left">
				<span class="cms_toolbar-btn_right">{% trans "Login" %}</span>
			</a>
			<input type="submit" value="{% trans 'Login' %}" style="display:none;" />
		</fieldset>
	</form>
</div>










<script type="text/javascript">
//<![CDATA[
	// When jQuery is sourced, it's going to overwrite whatever might be in the
    // '$' variable, so store a reference of it in a temporary variable...
    var _$ = window.$;

    // add stylesheets to head
    (function ($) {
		$('<link>').appendTo('head').attr({
			rel: 'stylesheet', type: 'text/css',
			href: '{{ CMS_MEDIA_URL }}css/toolbar.css'
		});
		$('<link>').appendTo('head').attr({
			rel: 'stylesheet', type: 'text/css',
			href: '{{ CMS_MEDIA_URL }}css/jquery.dialog.css'
		});
	})(jQuery);
//]]>
</script>

<!--
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/lib/jquery.cookie.js"></script> 
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/lib/jquery.backgroundposition.js"></script> 
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/tools.js"></script>
-->
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/lib/jquery.nyroModal-1.6.2.pack.js"></script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/lib/ui.core.js"></script> 
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/lib/ui.dialog.js"></script> 
<script type="text/javascript">
    //<![CDATA[
    // dynamic variables for the toolbar js file
    var placeholder_data = {{ placeholder_data }};
    var page_is_defined = {% if page %}true{% else %}false{% endif %};
    var translations = {
        move_slot: "{% trans 'Move to %(name)s' %}",
        question: "{% trans "Are you sure you want to delete this plugin?" %}"
    };
    var urls = {
        cms_page_move_plugin: "{% url admin:cms_page_move_plugin %}",
        cms_page_changelist: "{% url admin:cms_page_changelist %}",              
        cms_page_change_template: {% if page %}"{% url admin:cms_page_change_template page.pk %}"{% else %}null{% endif %},
        cms_page_add_plugin: "{% url admin:cms_page_add_plugin %}",
        cms_page_remove_plugin: "{% url admin:cms_page_remove_plugin %}",
        cms_page_move_plugin: "{% url admin:cms_page_move_plugin %}"
    }
    //]]>
</script>
<script type="text/javascript">
    //<![CDATA[ 
    (function($) {
        $(document).ready(function() {
        
            var submitActor;
            var forceSubmit = false;
            var seen = false;

            // change submit states, open dialog
            $('#cms_toolbar_requestapproval').click(function(event){
                return showDialog(event);
            });

            function showDialog(event, actor) {
                if (forceSubmit) return true; // escape sequence

                if (!seen) {
                    // show previously posted message if there were an error
                    //$('#id_df_moderator_message').val($('#id_moderator_message').val());
                }
                seen = true
                event.preventDefault();
                submitActor = actor;
                $('#dialog').dialog('open');
                return false;
            }

            function dialogSave(){
                // assign values from dialog form to real form
                $('#id_moderator_message').val($('#id_df_moderator_message').val());
                $('#id_moderator_state').val(
                    $('#id_df_moderator_state').is(':checked') ? $('#id_df_moderator_state').val() : 0 
                );
                $('#dialog').dialog('close');
                forceSubmit = true;
                
                // we need to post an updated to server-side to send the email!
                $(submitActor || '#page_form input[name=_save]').click();
                return false;
            }

            $('#dialog').dialog({
                bgiframe: true,
                autoOpen: false,
                height: 200,
                width: 400,
                modal: true,
                buttons: {
                    Cancel: function() {
                        $(this).dialog('close');
                    },
                    Save: function() {
                        dialogSave();
                    }
                },
                open: function(){
                    var val = $('#id_moderator_state').val();
                    $('#id_df_moderator_state').attr('checked', val >= 1 ? 'checked': '');
                    $('#id_df_moderator_message')
                        .focus()
                        .keydown(function(event) { if (event.keyCode == 13) dialogSave()});

                    // add default button class to last rendered button (Save)
                    $(this.uiDialogButtonPane).find('div.ui-dialog-buttonpane button:last').addClass('default');
                },
                close: function(){
                    forceSubmit = false;
                }
            });
        });
    })(jQuery);
    //]]>
</script>
<script type="text/javascript" src="{{ CMS_MEDIA_URL }}js/toolbar.js"></script>
<script type="text/javascript" charset="utf-8">
    //<![CDATA[
    // Now that jQuery is done loading, put the '$' variable back to what it was...
    var $ = _$;
    //]]>
</script>





<div id="cms_plugin_overlay">
    <div class="cms_toolbar_plugintools cms_toolbar">
        <div class="cms_toolbar_plugintools_holder">
            <a href="#" class="cms_toolbar_plugin_edit cms_toolbar_button cms_toolbar_iconbutton"><span><strong class="cms_toolbar_icon_edit">{% trans "edit" %}</strong></span></a>            
            
            <a href="#" class="cms_toolbar_upbutton cms_toolbar_button cms_toolbar_iconbutton"><span><strong>{% trans "up" %}</strong></span></a>
            <a href="#" class="cms_toolbar_downbutton cms_toolbar_button cms_toolbar_iconbutton"><span><strong>{% trans "down" %}</strong></span></a>                
            
            <div class="cms_toolbar_settingsbutton cms_toolbar_button cms_toolbar_submenubutton"><span class="cms_toolbar_submenubutton_content"><strong>{% trans "Settings" %}</strong><em>arrow</em></span>        
                <ul class="cms_toolbar_submenu">
                    <li class="last"><a href="#" class="cms_toolbar_plugin_delete"><span class="cms_toolbar_icon_delete">{% trans "delete" %}</span>{% trans "Delete Plugin" %}</a></li>            
                </ul>
            </div>
        </div>    
    </div>
    <div class="cms_plugin_overlay_bg">&nbsp;</div>
    
    <div id="dialog" title="Approve dialog">
        <p>This page must be moderated at level 0, post a message for moderator.</p>
        <div class="row"><input type="text" name="df_moderator_message" id="id_df_moderator_message" class="wide" value=""/></div>
        <div class="row"><input type="checkbox" name="df_moderator_state" id="id_df_moderator_state" value="1"/><label for="id_df_moderator_state">Request approval</label></div>
    </div>

</div>
<div id="cms_plugin_overlay2">
    <div class="cms_plugin_overlay_bg">&nbsp;</div>
</div>
